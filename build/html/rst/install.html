

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>VQNet 安装步骤 &mdash; VQNET v2.15.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />

  
      <script src="../_static/documentation_options.js?v=a149e6fc"></script>
      <script src="../_static/doctools.js?v=9a2dae69"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="使用自动微分模拟的量子机器学习示例" href="vqc_demo.html" />
    <link rel="prev" title="VQNet" href="../index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            VQNET
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">安装介绍</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">VQNet 安装步骤</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#vqnet-python">VQNet python包安装</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id1">VQNet 测试安装成功</a></li>
<li class="toctree-l2"><a class="reference internal" href="#vqnet-gpu">VQNet 测试GPU功能</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id2">VQNet 的一个简单例子</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">上手实例</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="vqc_demo.html">使用自动微分模拟的量子机器学习示例</a></li>
<li class="toctree-l1"><a class="reference internal" href="qml_demo.html">使用pyQPanda2的量子机器学习示例</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">经典神经网络接口介绍</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="QTensor.html">QTensor 模块</a></li>
<li class="toctree-l1"><a class="reference internal" href="nn.html">经典神经网络模块</a></li>
<li class="toctree-l1"><a class="reference internal" href="utils.html">实用函数</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">使用pyqpanda的量子神经网络接口</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="qnn.html">使用pyQPanda2量子机器学习模块</a></li>
<li class="toctree-l1"><a class="reference internal" href="qnn_pq3.html">使用pyQPanda3量子机器学习模块</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">量子神经网络自动微分模拟接口</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="vqc.html">变分量子线路自动微分模拟</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">量子大模型微调</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="llm.html">量子大模型微调示例</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">其他</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="torch_api.html">VQNet使用torch进行底层计算</a></li>
<li class="toctree-l1"><a class="reference internal" href="FAQ.html">常见问题</a></li>
<li class="toctree-l1"><a class="reference internal" href="CHANGELOG.html">VQNet Changelog</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">VQNET</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">VQNet 安装步骤</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/rst/install.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="vqnet">
<h1>VQNet 安装步骤<a class="headerlink" href="#vqnet" title="Link to this heading">¶</a></h1>
<section id="vqnet-python">
<h2>VQNet python包安装<a class="headerlink" href="#vqnet-python" title="Link to this heading">¶</a></h2>
<p>我们提供了Linux, Windows, x86_64 OSX &gt;=10.12, arm64 OSX&gt;=13.0 上的python预编译包供安装,需要 <strong>python3.9, 3.10, 3.11 或 3.12</strong> 。</p>
<p>对于Linux系统,pyvqnet提供了基于Nvidia GPU对经典神经网络计算加速功能,当您的电脑的GPU是GTX10系列及其以后的型号,可使用pyvqnet的GPU功能运行模型。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">pyvqnet</span>
</pre></div>
</div>
<p>或者：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">pyvqnet</span> <span class="o">--</span><span class="n">index</span><span class="o">-</span><span class="n">url</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">pypi</span><span class="o">.</span><span class="n">originqc</span><span class="o">.</span><span class="n">com</span><span class="o">.</span><span class="n">cn</span>
</pre></div>
</div>
<p>如果您遇到网络问题导致无法下载,可尝试增加timeout。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">pyvqnet</span> <span class="o">--</span><span class="n">index</span><span class="o">-</span><span class="n">url</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">pypi</span><span class="o">.</span><span class="n">originqc</span><span class="o">.</span><span class="n">com</span><span class="o">.</span><span class="n">cn</span> <span class="o">--</span><span class="n">default</span><span class="o">-</span><span class="n">timeout</span><span class="o">=</span><span class="mi">100</span>
</pre></div>
</div>
</section>
<section id="id1">
<h2>VQNet 测试安装成功<a class="headerlink" href="#id1" title="Link to this heading">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.tensor</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">25</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="vqnet-gpu">
<h2>VQNet 测试GPU功能<a class="headerlink" href="#vqnet-gpu" title="Link to this heading">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet</span><span class="w"> </span><span class="kn">import</span> <span class="n">DEV_GPU_0</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.tensor</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">ones</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span><span class="n">device</span> <span class="o">=</span> <span class="n">DEV_GPU_0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id2">
<h2>VQNet 的一个简单例子<a class="headerlink" href="#id2" title="Link to this heading">¶</a></h2>
<p>这里使用VQNet的经典神经网络模块以及量子模块完成一个机器学习模型的整体流程的例子介绍。该例子参考 <a class="reference external" href="https://arxiv.org/abs/1907.02085">Data re-uploading for a universal quantum classifier</a>
。
量子机器学习中的量子计算模块一般有如下几个部分:</p>
<p>(1)编码线路(Encoder),用于将经典数据编码到量子数据；
(2)可变参数的量子线路(Ansatz),用于训练带参量子门中的参数；
(3)测量模块(Measurement),用于检测测量值(也就是某个量子比特的量子态在某些轴上的投影)。</p>
<p>量子计算模块与经典神经网络的运算模块一样是可微分的,是量子经典神经网络混合模型的理论基础。
VQNet支持将量子计算模块与经典计算模块(例如: 卷积,池化,全连接层,激活函数等)一起构成混合机器学习模型,提供多种优化算法优化参数。</p>
<figure class="align-default">
<img alt="../_images/classic-quantum.PNG" src="../_images/classic-quantum.PNG" />
</figure>
<p>在量子计算模块,VQNet支持使用本源量子高效的量子软件计算包 <a class="reference external" href="https://pyqpanda-toturial.readthedocs.io/zh/latest/">pyqpanda</a>  进行量子模块构建。
使用pyQPanda提供的各种常用 <a class="reference external" href="https://pyqpanda-toturial.readthedocs.io/zh/latest/QGate.html">量子逻辑门函数接口</a> , <a class="reference external" href="https://pyqpanda-toturial.readthedocs.io/zh/latest/QCircuit.html">量子线路接口</a> , <a class="reference external" href="https://pyqpanda-toturial.readthedocs.io/zh/latest/QuantumMachine.html">量子虚拟机函数接口</a> , <a class="reference external" href="https://pyqpanda-toturial.readthedocs.io/zh/latest/Measure.html">测量函数接口</a>,用户可以快速构建量子计算模块。</p>
<p>接下来的例子我们使用pyQPanda构建了一个量子计算模块。通过VQNet,该量子计算模块可以直接嵌入到混合机器学习模型中进行量子线路参数训练。
本例使用1个量子比特,使用了多个带参数的旋转门 <cite>RZ</cite>,`RY`,`RZ` 对输入x进行编码,并使用 <cite>prob_run_dict()</cite> 函数观测量子比特的概率测量结果作为输出。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pyqpanda</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pq</span>
<span class="k">def</span><span class="w"> </span><span class="nf">qdrl_circuit</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span><span class="n">weights</span><span class="p">,</span><span class="n">qlist</span><span class="p">,</span><span class="n">clist</span><span class="p">,</span><span class="n">machine</span><span class="p">):</span>

        <span class="n">x1</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
        <span class="n">param1</span> <span class="o">=</span> <span class="n">weights</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
        <span class="c1">#使用pyqpanda接口构建量子线路实例</span>
        <span class="n">circult</span> <span class="o">=</span> <span class="n">pq</span><span class="o">.</span><span class="n">QCircuit</span><span class="p">()</span>
        <span class="c1">#使用pyqpanda接口在第一个量子比特上插入逻辑门RZ门,参数位x1[0]</span>
        <span class="n">circult</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">RZ</span><span class="p">(</span><span class="n">qlist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x1</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="c1">#使用pyqpanda接口在第一个量子比特上插入逻辑门RY门,参数位x1[1]</span>
        <span class="n">circult</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">RY</span><span class="p">(</span><span class="n">qlist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x1</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="c1">#使用pyqpanda接口在第一个量子比特上插入逻辑门RZ门,参数位x1[2]</span>
        <span class="n">circult</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">RZ</span><span class="p">(</span><span class="n">qlist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x1</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
        <span class="c1">#使用pyqpanda接口在第一个量子比特上插入逻辑门RZ门,参数位param1[0]</span>
        <span class="n">circult</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">RZ</span><span class="p">(</span><span class="n">qlist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">param1</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="c1">#使用pyqpanda接口在第一个量子比特上插入逻辑门RY门,参数位param1[1]</span>
        <span class="n">circult</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">RY</span><span class="p">(</span><span class="n">qlist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">param1</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="c1">#使用pyqpanda接口在第一个量子比特上插入逻辑门RZ门,参数位param1[2]</span>
        <span class="n">circult</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">RZ</span><span class="p">(</span><span class="n">qlist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">param1</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
        <span class="c1">#使用pyqpanda接口在第一个量子比特上插入逻辑门RZ门,参数位x1[0]</span>
        <span class="n">circult</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">RZ</span><span class="p">(</span><span class="n">qlist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x1</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="c1">#使用pyqpanda接口在第一个量子比特上插入逻辑门RY门,参数位x1[1]</span>
        <span class="n">circult</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">RY</span><span class="p">(</span><span class="n">qlist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x1</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="c1">#使用pyqpanda接口在第一个量子比特上插入逻辑门RZ门,参数位x1[2]</span>
        <span class="n">circult</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">RZ</span><span class="p">(</span><span class="n">qlist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x1</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
        <span class="c1">#使用pyqpanda接口在第一个量子比特上插入逻辑门RZ门,参数位param1[3]</span>
        <span class="n">circult</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">RZ</span><span class="p">(</span><span class="n">qlist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">param1</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
        <span class="c1">#使用pyqpanda接口在第一个量子比特上插入逻辑门RY门,参数位param1[4]</span>
        <span class="n">circult</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">RY</span><span class="p">(</span><span class="n">qlist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">param1</span><span class="p">[</span><span class="mi">4</span><span class="p">]))</span>
        <span class="c1">#使用pyqpanda接口在第一个量子比特上插入逻辑门RZ门,参数位param1[5]</span>
        <span class="n">circult</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">RZ</span><span class="p">(</span><span class="n">qlist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">param1</span><span class="p">[</span><span class="mi">5</span><span class="p">]))</span>
        <span class="c1">#使用pyqpanda接口在第一个量子比特上插入逻辑门RZ门,参数位x1[0]</span>
        <span class="n">circult</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">RZ</span><span class="p">(</span><span class="n">qlist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x1</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="c1">#使用pyqpanda接口在第一个量子比特上插入逻辑门RY门,参数位x1[1]</span>
        <span class="n">circult</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">RY</span><span class="p">(</span><span class="n">qlist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x1</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="c1">#使用pyqpanda接口在第一个量子比特上插入逻辑门RZ门,参数位x1[2]</span>
        <span class="n">circult</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">RZ</span><span class="p">(</span><span class="n">qlist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x1</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
        <span class="c1">#使用pyqpanda接口在第一个量子比特上插入逻辑门RZ门,参数位param1[6]</span>
        <span class="n">circult</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">RZ</span><span class="p">(</span><span class="n">qlist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">param1</span><span class="p">[</span><span class="mi">6</span><span class="p">]))</span>
        <span class="c1">#使用pyqpanda接口在第一个量子比特上插入逻辑门RY门,参数位param1[7]</span>
        <span class="n">circult</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">RY</span><span class="p">(</span><span class="n">qlist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">param1</span><span class="p">[</span><span class="mi">7</span><span class="p">]))</span>
        <span class="c1">#使用pyqpanda接口在第一个量子比特上插入逻辑门RZ门,参数位param1[8]</span>
        <span class="n">circult</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">RZ</span><span class="p">(</span><span class="n">qlist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">param1</span><span class="p">[</span><span class="mi">8</span><span class="p">]))</span>
        <span class="c1">#构建量子程序</span>
        <span class="n">prog</span> <span class="o">=</span> <span class="n">pq</span><span class="o">.</span><span class="n">QProg</span><span class="p">()</span>
        <span class="n">prog</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">circult</span><span class="p">)</span>
        <span class="c1">#获取概率测量值</span>
        <span class="n">prob</span> <span class="o">=</span> <span class="n">machine</span><span class="o">.</span><span class="n">prob_run_dict</span><span class="p">(</span><span class="n">prog</span><span class="p">,</span> <span class="n">qlist</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">prob</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">prob</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">prob</span>
</pre></div>
</div>
<p>本例子中机器学习的任务是对随机生成的数据根据进行二分类,其中下图是该数据样例,零为圆点,半径为1以内红色的二维点为一类,蓝色的点为另一类。</p>
<figure class="align-default">
<img alt="../_images/origin_circle.png" src="../_images/origin_circle.png" />
</figure>
<p>训练测试代码流程</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#导入必须的库和函数</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.qnn.qdrl.vqnet_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">qdrl_circuit</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.qnn.quantumlayer</span><span class="w"> </span><span class="kn">import</span> <span class="n">QuantumLayer</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.optim</span><span class="w"> </span><span class="kn">import</span> <span class="n">adam</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.nn.loss</span><span class="w"> </span><span class="kn">import</span> <span class="n">CategoricalCrossEntropy</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.tensor</span><span class="w"> </span><span class="kn">import</span> <span class="n">QTensor</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.nn.module</span><span class="w"> </span><span class="kn">import</span> <span class="n">Module</span>
</pre></div>
</div>
<p>定义模型Model,其中 <cite>__init__</cite> 函数定义内部各个神经网络模块以及量子模块,`forward` 函数定义前传函数。<cite>QuantumLayer</cite> 为封装量子计算的抽象类。
您只需将刚才定义的量子计算函数 <cite>qdrl_circuit</cite>,待训练参数个数 <cite>param_num</cite> ,运行后端配置 <cite>“cpu”</cite> , 量子比特数 <cite>qbit_num</cite> 输入参数,该类就在 <cite>VQNet</cite> 中自动计算参数梯度。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#待训练参数个数</span>
<span class="n">param_num</span> <span class="o">=</span> <span class="mi">9</span>
<span class="c1">#量子计算模块量子比特数</span>
<span class="n">qbit_num</span>  <span class="o">=</span> <span class="mi">1</span>
<span class="c1">#定义一个继承于Module的机器学习模型类</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Model</span><span class="p">(</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Model</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="c1">#使用QuantumLayer类,可以把带训练参数的量子线路纳入VQNet的自动微分的训练流程中</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pqc</span> <span class="o">=</span> <span class="n">QuantumLayer</span><span class="p">(</span><span class="n">qdrl_circuit</span><span class="p">,</span><span class="n">param_num</span><span class="p">,</span><span class="s2">&quot;cpu&quot;</span><span class="p">,</span><span class="n">qbit_num</span><span class="p">)</span>
    <span class="c1">#定义模型前向函数</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pqc</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span>
</pre></div>
</div>
<p>定义一些训练模型需要的函数</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># 随机产生待训练数据的函数</span>
<span class="k">def</span><span class="w"> </span><span class="nf">circle</span><span class="p">(</span><span class="n">samples</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span>  <span class="n">rads</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span> <span class="p">:</span>
    <span class="n">data_x</span><span class="p">,</span> <span class="n">data_y</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">samples</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">rads</span><span class="p">:</span>
            <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">data_x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">data_y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_x</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_y</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>

<span class="c1"># 数据载入函数</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_minibatch_data</span><span class="p">(</span><span class="n">x_data</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">x_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">batch_size</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">batch_size</span><span class="p">):</span>
        <span class="n">idxs</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="n">batch_size</span><span class="p">)</span>
        <span class="k">yield</span> <span class="n">x_data</span><span class="p">[</span><span class="n">idxs</span><span class="p">],</span> <span class="n">label</span><span class="p">[</span><span class="n">idxs</span><span class="p">]</span>

<span class="c1">#计算准确率的函数</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_score</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="n">label</span><span class="p">):</span>
    <span class="n">pred</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pred</span><span class="o">.</span><span class="n">data</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">label</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">label</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">pred</span> <span class="o">==</span> <span class="n">score</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">score</span>
</pre></div>
</div>
<p>VQNet遵循机器学习一般的训练测试流程: 迭代进行载入数据,前传计算,损失函数计算,反向计算,更新参数的操作。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#实例化定义的模型</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">()</span>
<span class="c1">#定义一个优化器,这里用的是Adam</span>
<span class="n">optimizer</span> <span class="o">=</span> <span class="n">adam</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span><span class="n">lr</span> <span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="c1">#定义一个损失函数,这里用的交叉熵损失函数</span>
<span class="n">Closs</span> <span class="o">=</span> <span class="n">CategoricalCrossEntropy</span><span class="p">()</span>
</pre></div>
</div>
<p>训练模型部分的函数</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">train</span><span class="p">():</span>

    <span class="c1"># 随机产生待训练数据</span>
    <span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span> <span class="o">=</span> <span class="n">circle</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
    <span class="n">x_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">x_train</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">x_train</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)))</span>
    <span class="c1"># 定义每个批次训练的数据个数</span>
    <span class="n">batch_size</span> <span class="o">=</span> <span class="mi">32</span>
    <span class="c1"># 最大训练迭代次数</span>
    <span class="n">epoch</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;start training...........&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">epoch</span><span class="p">):</span>
        <span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
        <span class="n">accuracy</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">loss</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">data</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">get_minibatch_data</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span><span class="n">batch_size</span><span class="p">):</span>
            <span class="c1"># 优化器中缓存梯度清零</span>
            <span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
            <span class="c1"># 模型前向计算</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="c1"># 损失函数计算</span>
            <span class="n">losss</span> <span class="o">=</span> <span class="n">Closs</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span>
            <span class="c1"># 损失反向传播</span>
            <span class="n">losss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
            <span class="c1"># 优化器参数更新</span>
            <span class="n">optimizer</span><span class="o">.</span><span class="n">_step</span><span class="p">()</span>
            <span class="c1"># 计算准确率等指标</span>
            <span class="n">accuracy</span> <span class="o">+=</span> <span class="n">get_score</span><span class="p">(</span><span class="n">output</span><span class="p">,</span><span class="n">label</span><span class="p">)</span>

            <span class="n">loss</span> <span class="o">+=</span> <span class="n">losss</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
            <span class="n">count</span> <span class="o">+=</span> <span class="n">batch_size</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;epoch:</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">, train_accuracy:</span><span class="si">{</span><span class="n">accuracy</span><span class="o">/</span><span class="n">count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;epoch:</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">, train_loss:</span><span class="si">{</span><span class="n">loss</span><span class="o">/</span><span class="n">count</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>验证模型部分的函数</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test</span><span class="p">():</span>

    <span class="n">batch_size</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;start eval...................&quot;</span><span class="p">)</span>
    <span class="n">xtest</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">circle</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
    <span class="n">test_accuracy</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">x_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">xtest</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">xtest</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)))</span>

    <span class="k">for</span> <span class="n">test_data</span><span class="p">,</span> <span class="n">test_label</span> <span class="ow">in</span> <span class="n">get_minibatch_data</span><span class="p">(</span><span class="n">x_test</span><span class="p">,</span><span class="n">y_test</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">):</span>

        <span class="n">test_data</span><span class="p">,</span> <span class="n">test_label</span> <span class="o">=</span> <span class="n">QTensor</span><span class="p">(</span><span class="n">test_data</span><span class="p">),</span><span class="n">QTensor</span><span class="p">(</span><span class="n">test_label</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">test_data</span><span class="p">)</span>
        <span class="n">test_accuracy</span> <span class="o">+=</span> <span class="n">get_score</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">test_label</span><span class="p">)</span>
        <span class="n">count</span> <span class="o">+=</span> <span class="n">batch_size</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;test_accuracy:</span><span class="si">{</span><span class="n">test_accuracy</span><span class="o">/</span><span class="n">count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>训练测试结果图:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">start</span> <span class="n">training</span><span class="o">...........</span>
<span class="n">epoch</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="n">train_accuracy</span><span class="p">:</span><span class="mf">0.6145833333333334</span>
<span class="n">epoch</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="n">train_loss</span><span class="p">:</span><span class="mf">0.020432369535168013</span>

<span class="n">epoch</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="n">train_accuracy</span><span class="p">:</span><span class="mf">0.6854166666666667</span>
<span class="n">epoch</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="n">train_loss</span><span class="p">:</span><span class="mf">0.01872217481335004</span>

<span class="n">epoch</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="n">train_accuracy</span><span class="p">:</span><span class="mf">0.8104166666666667</span>
<span class="n">epoch</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="n">train_loss</span><span class="p">:</span><span class="mf">0.016634768371780715</span>

<span class="n">epoch</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="n">train_accuracy</span><span class="p">:</span><span class="mf">0.7479166666666667</span>
<span class="n">epoch</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="n">train_loss</span><span class="p">:</span><span class="mf">0.016975031544764835</span>

<span class="n">epoch</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span> <span class="n">train_accuracy</span><span class="p">:</span><span class="mf">0.7875</span>
<span class="n">epoch</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span> <span class="n">train_loss</span><span class="p">:</span><span class="mf">0.016502128106852372</span>

<span class="n">epoch</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span> <span class="n">train_accuracy</span><span class="p">:</span><span class="mf">0.8083333333333333</span>
<span class="n">epoch</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span> <span class="n">train_loss</span><span class="p">:</span><span class="mf">0.0163204787299037</span>

<span class="n">epoch</span><span class="p">:</span><span class="mi">6</span><span class="p">,</span> <span class="n">train_accuracy</span><span class="p">:</span><span class="mf">0.8083333333333333</span>
<span class="n">epoch</span><span class="p">:</span><span class="mi">6</span><span class="p">,</span> <span class="n">train_loss</span><span class="p">:</span><span class="mf">0.01634311651190122</span>

<span class="n">epoch</span><span class="p">:</span><span class="mi">7</span><span class="p">,</span> <span class="n">train_loss</span><span class="p">:</span><span class="mf">0.016330583145221074</span>

<span class="n">epoch</span><span class="p">:</span><span class="mi">8</span><span class="p">,</span> <span class="n">train_accuracy</span><span class="p">:</span><span class="mf">0.8125</span>
<span class="n">epoch</span><span class="p">:</span><span class="mi">8</span><span class="p">,</span> <span class="n">train_loss</span><span class="p">:</span><span class="mf">0.01629052646458149</span>

<span class="n">epoch</span><span class="p">:</span><span class="mi">9</span><span class="p">,</span> <span class="n">train_accuracy</span><span class="p">:</span><span class="mf">0.8083333333333333</span>
<span class="n">epoch</span><span class="p">:</span><span class="mi">9</span><span class="p">,</span> <span class="n">train_loss</span><span class="p">:</span><span class="mf">0.016270687493185203</span>

<span class="n">start</span> <span class="nb">eval</span><span class="o">...................</span>
<span class="n">test_accuracy</span><span class="p">:</span><span class="mf">0.826</span>
</pre></div>
</div>
<figure class="align-default">
<img alt="../_images/qdrl_for_simple.png" src="../_images/qdrl_for_simple.png" />
</figure>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../index.html" class="btn btn-neutral float-left" title="VQNet" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="vqc_demo.html" class="btn btn-neutral float-right" title="使用自动微分模拟的量子机器学习示例" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Original Quantum.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>