

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>VQNet使用torch进行底层计算 &mdash; VQNET v2.15.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />

  
      <script src="../_static/documentation_options.js?v=a149e6fc"></script>
      <script src="../_static/doctools.js?v=9a2dae69"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="常见问题" href="FAQ.html" />
    <link rel="prev" title="量子大模型微调示例" href="llm.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            VQNET
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">安装介绍</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="install.html">VQNet 安装步骤</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">上手实例</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="vqc_demo.html">使用自动微分模拟的量子机器学习示例</a></li>
<li class="toctree-l1"><a class="reference internal" href="qml_demo.html">使用pyQPanda2的量子机器学习示例</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">经典神经网络接口介绍</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="QTensor.html">QTensor 模块</a></li>
<li class="toctree-l1"><a class="reference internal" href="nn.html">经典神经网络模块</a></li>
<li class="toctree-l1"><a class="reference internal" href="utils.html">实用函数</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">使用pyqpanda的量子神经网络接口</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="qnn.html">使用pyQPanda2量子机器学习模块</a></li>
<li class="toctree-l1"><a class="reference internal" href="qnn_pq3.html">使用pyQPanda3量子机器学习模块</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">量子神经网络自动微分模拟接口</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="vqc.html">变分量子线路自动微分模拟</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">量子大模型微调</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="llm.html">量子大模型微调示例</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">其他</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">VQNet使用torch进行底层计算</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id1">计算后端基本设置</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#set-backend">set_backend</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#pyvqnet.backends.set_backend"><code class="docutils literal notranslate"><span class="pre">pyvqnet.backends.set_backend()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#get-backend">get_backend</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#pyvqnet.backends.get_backend"><code class="docutils literal notranslate"><span class="pre">pyvqnet.backends.get_backend()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#qtensor">QTensor函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id2">经典神经网络类以及变分量子神经网络模块</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id3">基类</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#torchmodule">TorchModule</a></li>
<li class="toctree-l4"><a class="reference internal" href="#torchmodulelist">TorchModuleList</a></li>
<li class="toctree-l4"><a class="reference internal" href="#torchparameterlist">TorchParameterList</a></li>
<li class="toctree-l4"><a class="reference internal" href="#torchsequential">TorchSequential</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id4">模型参数保存和载入</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id5">经典神经网络模块</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#linear">Linear</a></li>
<li class="toctree-l4"><a class="reference internal" href="#conv1d">Conv1D</a></li>
<li class="toctree-l4"><a class="reference internal" href="#conv2d">Conv2D</a></li>
<li class="toctree-l4"><a class="reference internal" href="#convt2d">ConvT2D</a></li>
<li class="toctree-l4"><a class="reference internal" href="#avgpool1d">AvgPool1D</a></li>
<li class="toctree-l4"><a class="reference internal" href="#maxpool1d">MaxPool1D</a></li>
<li class="toctree-l4"><a class="reference internal" href="#avgpool2d">AvgPool2D</a></li>
<li class="toctree-l4"><a class="reference internal" href="#maxpool2d">MaxPool2D</a></li>
<li class="toctree-l4"><a class="reference internal" href="#embedding">Embedding</a></li>
<li class="toctree-l4"><a class="reference internal" href="#batchnorm2d">BatchNorm2d</a></li>
<li class="toctree-l4"><a class="reference internal" href="#batchnorm1d">BatchNorm1d</a></li>
<li class="toctree-l4"><a class="reference internal" href="#layernormnd">LayerNormNd</a></li>
<li class="toctree-l4"><a class="reference internal" href="#layernorm2d">LayerNorm2d</a></li>
<li class="toctree-l4"><a class="reference internal" href="#layernorm1d">LayerNorm1d</a></li>
<li class="toctree-l4"><a class="reference internal" href="#groupnorm">GroupNorm</a></li>
<li class="toctree-l4"><a class="reference internal" href="#dropout">Dropout</a></li>
<li class="toctree-l4"><a class="reference internal" href="#droppath">DropPath</a></li>
<li class="toctree-l4"><a class="reference internal" href="#pixel-shuffle">Pixel_Shuffle</a></li>
<li class="toctree-l4"><a class="reference internal" href="#pixel-unshuffle">Pixel_Unshuffle</a></li>
<li class="toctree-l4"><a class="reference internal" href="#gru">GRU</a></li>
<li class="toctree-l4"><a class="reference internal" href="#rnn">RNN</a></li>
<li class="toctree-l4"><a class="reference internal" href="#lstm">LSTM</a></li>
<li class="toctree-l4"><a class="reference internal" href="#dynamic-gru">Dynamic_GRU</a></li>
<li class="toctree-l4"><a class="reference internal" href="#dynamic-rnn">Dynamic_RNN</a></li>
<li class="toctree-l4"><a class="reference internal" href="#dynamic-lstm">Dynamic_LSTM</a></li>
<li class="toctree-l4"><a class="reference internal" href="#interpolate">Interpolate</a></li>
<li class="toctree-l4"><a class="reference internal" href="#sdpa">SDPA</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id6">损失函数接口</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#meansquarederror">MeanSquaredError</a></li>
<li class="toctree-l4"><a class="reference internal" href="#binarycrossentropy">BinaryCrossEntropy</a></li>
<li class="toctree-l4"><a class="reference internal" href="#categoricalcrossentropy">CategoricalCrossEntropy</a></li>
<li class="toctree-l4"><a class="reference internal" href="#softmaxcrossentropy">SoftmaxCrossEntropy</a></li>
<li class="toctree-l4"><a class="reference internal" href="#nll-loss">NLL_Loss</a></li>
<li class="toctree-l4"><a class="reference internal" href="#crossentropyloss">CrossEntropyLoss</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id7">激活函数</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#sigmoid">Sigmoid</a></li>
<li class="toctree-l4"><a class="reference internal" href="#softplus">Softplus</a></li>
<li class="toctree-l4"><a class="reference internal" href="#softsign">Softsign</a></li>
<li class="toctree-l4"><a class="reference internal" href="#softmax">Softmax</a></li>
<li class="toctree-l4"><a class="reference internal" href="#hardsigmoid">HardSigmoid</a></li>
<li class="toctree-l4"><a class="reference internal" href="#relu">ReLu</a></li>
<li class="toctree-l4"><a class="reference internal" href="#leakyrelu">LeakyReLu</a></li>
<li class="toctree-l4"><a class="reference internal" href="#gelu">Gelu</a></li>
<li class="toctree-l4"><a class="reference internal" href="#elu">ELU</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tanh">Tanh</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id8">优化器模块</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#pyqpanda2">pyqpanda2量子变分线路训练函数</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#torchqpandaquantumlayer">TorchQpandaQuantumLayer</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#pyvqnet.qnn.vqc.torch.TorchQpandaQuantumLayer"><code class="docutils literal notranslate"><span class="pre">pyvqnet.qnn.vqc.torch.TorchQpandaQuantumLayer</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#torchqcloudquantumlayer">TorchQcloudQuantumLayer</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#pyvqnet.qnn.vqc.torch.TorchQcloudQuantumLayer"><code class="docutils literal notranslate"><span class="pre">pyvqnet.qnn.vqc.torch.TorchQcloudQuantumLayer</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#torchqcloud3quantumlayer">TorchQcloud3QuantumLayer</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#pyvqnet.qnn.vqc.torch.TorchQcloud3QuantumLayer"><code class="docutils literal notranslate"><span class="pre">pyvqnet.qnn.vqc.torch.TorchQcloud3QuantumLayer</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#torchqpanda3quantumlayer">TorchQpanda3QuantumLayer</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#pyvqnet.qnn.vqc.torch.TorchQpanda3QuantumLayer"><code class="docutils literal notranslate"><span class="pre">pyvqnet.qnn.vqc.torch.TorchQpanda3QuantumLayer</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id9">基于自动微分的变分量子线路模块和接口</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id10">基类</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#qmodule">QModule</a></li>
<li class="toctree-l4"><a class="reference internal" href="#qmachine">QMachine</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id11">变分量子逻辑门模块</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#i">I</a></li>
<li class="toctree-l4"><a class="reference internal" href="#hadamard">Hadamard</a></li>
<li class="toctree-l4"><a class="reference internal" href="#t">T</a></li>
<li class="toctree-l4"><a class="reference internal" href="#s">S</a></li>
<li class="toctree-l4"><a class="reference internal" href="#paulix">PauliX</a></li>
<li class="toctree-l4"><a class="reference internal" href="#pauliy">PauliY</a></li>
<li class="toctree-l4"><a class="reference internal" href="#pauliz">PauliZ</a></li>
<li class="toctree-l4"><a class="reference internal" href="#x1">X1</a></li>
<li class="toctree-l4"><a class="reference internal" href="#rx">RX</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ry">RY</a></li>
<li class="toctree-l4"><a class="reference internal" href="#rz">RZ</a></li>
<li class="toctree-l4"><a class="reference internal" href="#crx">CRX</a></li>
<li class="toctree-l4"><a class="reference internal" href="#cry">CRY</a></li>
<li class="toctree-l4"><a class="reference internal" href="#crz">CRZ</a></li>
<li class="toctree-l4"><a class="reference internal" href="#u1">U1</a></li>
<li class="toctree-l4"><a class="reference internal" href="#u2">U2</a></li>
<li class="toctree-l4"><a class="reference internal" href="#u3">U3</a></li>
<li class="toctree-l4"><a class="reference internal" href="#cnot">CNOT</a></li>
<li class="toctree-l4"><a class="reference internal" href="#cy">CY</a></li>
<li class="toctree-l4"><a class="reference internal" href="#cz">CZ</a></li>
<li class="toctree-l4"><a class="reference internal" href="#cr">CR</a></li>
<li class="toctree-l4"><a class="reference internal" href="#swap">SWAP</a></li>
<li class="toctree-l4"><a class="reference internal" href="#cswap">CSWAP</a></li>
<li class="toctree-l4"><a class="reference internal" href="#rxx">RXX</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ryy">RYY</a></li>
<li class="toctree-l4"><a class="reference internal" href="#rzz">RZZ</a></li>
<li class="toctree-l4"><a class="reference internal" href="#rzx">RZX</a></li>
<li class="toctree-l4"><a class="reference internal" href="#toffoli">Toffoli</a></li>
<li class="toctree-l4"><a class="reference internal" href="#isingxx">IsingXX</a></li>
<li class="toctree-l4"><a class="reference internal" href="#isingyy">IsingYY</a></li>
<li class="toctree-l4"><a class="reference internal" href="#isingzz">IsingZZ</a></li>
<li class="toctree-l4"><a class="reference internal" href="#isingxy">IsingXY</a></li>
<li class="toctree-l4"><a class="reference internal" href="#phaseshift">PhaseShift</a></li>
<li class="toctree-l4"><a class="reference internal" href="#multirz">MultiRZ</a></li>
<li class="toctree-l4"><a class="reference internal" href="#sdg">SDG</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tdg">TDG</a></li>
<li class="toctree-l4"><a class="reference internal" href="#controlledphaseshift">ControlledPhaseShift</a></li>
<li class="toctree-l4"><a class="reference internal" href="#multicontrolledx">MultiControlledX</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id12">测量接口</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#probability">Probability</a></li>
<li class="toctree-l4"><a class="reference internal" href="#measureall">MeasureAll</a></li>
<li class="toctree-l4"><a class="reference internal" href="#samples">Samples</a></li>
<li class="toctree-l4"><a class="reference internal" href="#sparsehamiltonian">SparseHamiltonian</a></li>
<li class="toctree-l4"><a class="reference internal" href="#hermitianexpval">HermitianExpval</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id13">量子线路常见模板</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#vqc-hardwareefficientansatz">VQC_HardwareEfficientAnsatz</a></li>
<li class="toctree-l4"><a class="reference internal" href="#vqc-basicentanglertemplate">VQC_BasicEntanglerTemplate</a></li>
<li class="toctree-l4"><a class="reference internal" href="#vqc-stronglyentanglingtemplate">VQC_StronglyEntanglingTemplate</a></li>
<li class="toctree-l4"><a class="reference internal" href="#vqc-quantumembedding">VQC_QuantumEmbedding</a></li>
<li class="toctree-l4"><a class="reference internal" href="#expressiveentanglingansatz">ExpressiveEntanglingAnsatz</a></li>
<li class="toctree-l4"><a class="reference internal" href="#vqc-basis-embedding">vqc_basis_embedding</a></li>
<li class="toctree-l4"><a class="reference internal" href="#vqc-angle-embedding">vqc_angle_embedding</a></li>
<li class="toctree-l4"><a class="reference internal" href="#vqc-amplitude-embedding">vqc_amplitude_embedding</a></li>
<li class="toctree-l4"><a class="reference internal" href="#vqc-iqp-embedding">vqc_iqp_embedding</a></li>
<li class="toctree-l4"><a class="reference internal" href="#vqc-rotcircuit">vqc_rotcircuit</a></li>
<li class="toctree-l4"><a class="reference internal" href="#vqc-crot-circuit">vqc_crot_circuit</a></li>
<li class="toctree-l4"><a class="reference internal" href="#vqc-controlled-hadamard">vqc_controlled_hadamard</a></li>
<li class="toctree-l4"><a class="reference internal" href="#vqc-ccz">vqc_ccz</a></li>
<li class="toctree-l4"><a class="reference internal" href="#vqc-fermionic-single-excitation">vqc_fermionic_single_excitation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#vqc-fermionic-double-excitation">vqc_fermionic_double_excitation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#vqc-uccsd">vqc_uccsd</a></li>
<li class="toctree-l4"><a class="reference internal" href="#vqc-zfeaturemap">vqc_zfeaturemap</a></li>
<li class="toctree-l4"><a class="reference internal" href="#vqc-zzfeaturemap">vqc_zzfeaturemap</a></li>
<li class="toctree-l4"><a class="reference internal" href="#vqc-allsinglesdoubles">vqc_allsinglesdoubles</a></li>
<li class="toctree-l4"><a class="reference internal" href="#vqc-basisrotation">vqc_basisrotation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#vqc-quantumpooling-circuit">vqc_quantumpooling_circuit</a></li>
<li class="toctree-l4"><a class="reference internal" href="#quantumlayeradjoint">QuantumLayerAdjoint</a></li>
<li class="toctree-l4"><a class="reference internal" href="#hybirdvqcqpandaqvmlayer">HybirdVQCQpandaQVMLayer</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#torchhybirdvqcqpanda3qvmlayer">TorchHybirdVQCQpanda3QVMLayer</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#pyvqnet.qnn.vqc.torch.TorchHybirdVQCQpanda3QVMLayer"><code class="docutils literal notranslate"><span class="pre">pyvqnet.qnn.vqc.torch.TorchHybirdVQCQpanda3QVMLayer</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id15">分布式接口</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#commcontroller">CommController</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#pyvqnet.distributed.ControllComm.CommController"><code class="docutils literal notranslate"><span class="pre">pyvqnet.distributed.ControllComm.CommController</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="FAQ.html">常见问题</a></li>
<li class="toctree-l1"><a class="reference internal" href="CHANGELOG.html">VQNet Changelog</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">VQNET</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">VQNet使用torch进行底层计算</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/rst/torch_api.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="vqnettorch">
<span id="torch-api"></span><h1>VQNet使用torch进行底层计算<a class="headerlink" href="#vqnettorch" title="Link to this heading">¶</a></h1>
<p>自2.15.0版本开始,本软件支持使用torch作为计算后端进行底层运算,方便接入主流大模型训练库进行大模型微调。</p>
<blockquote>
<div><div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><a class="reference internal" href="vqc.html#vqc-api"><span class="std std-ref">变分量子线路自动微分模拟</span></a> 中的变分量子计算函数(小写命名,例如 <cite>rx</cite>, <cite>ry</cite>, <cite>rz</cite> 等), <a class="reference internal" href="QTensor.html#qtensor-api"><span class="std std-ref">QTensor 模块</span></a> 中的QTensor基本计算函数,
在 <code class="docutils literal notranslate"><span class="pre">pyvqnet.backends.set_backend(&quot;torch&quot;)</span></code> 后,可以输入 <code class="docutils literal notranslate"><span class="pre">QTensor</span></code>,其成员 <cite>data</cite> 从pyvqnet的Tensor变为 <code class="docutils literal notranslate"><span class="pre">torch.Tensor</span></code> 计算。</p>
<p><code class="docutils literal notranslate"><span class="pre">pyvqnet.backends.set_backend(&quot;torch&quot;)</span></code> 以及 <code class="docutils literal notranslate"><span class="pre">pyvqnet.backends.set_backend(&quot;pyvqnet&quot;)</span></code> 会修改全局运行后端。
不同后端配置下申请的 <code class="docutils literal notranslate"><span class="pre">QTensor</span></code> 不能混在一起运算。</p>
<p>使用 <code class="docutils literal notranslate"><span class="pre">to_tensor</span></code> 可将 <code class="docutils literal notranslate"><span class="pre">torch.Tensor</span></code> 封装为一个 <code class="docutils literal notranslate"><span class="pre">QTensor</span></code> 。</p>
</div>
</div></blockquote>
<section id="id1">
<h2>计算后端基本设置<a class="headerlink" href="#id1" title="Link to this heading">¶</a></h2>
<section id="set-backend">
<h3>set_backend<a class="headerlink" href="#set-backend" title="Link to this heading">¶</a></h3>
<dl class="py function">
<dt class="sig sig-object py" id="pyvqnet.backends.set_backend">
<span class="sig-prename descclassname"><span class="pre">pyvqnet.backends.</span></span><span class="sig-name descname"><span class="pre">set_backend</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">backend_name</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.backends.set_backend" title="Link to this definition">¶</a></dt>
<dd><p>设置当前计算和储存数据所使用的后端,默认为 “pyvqnet”,可设置为 “torch”。</p>
<p>使用 <code class="docutils literal notranslate"><span class="pre">pyvqnet.backends.set_backend(&quot;torch&quot;)</span></code> 后,接口保持不变,但VQNet的 <code class="docutils literal notranslate"><span class="pre">QTensor</span></code> 的 <code class="docutils literal notranslate"><span class="pre">data</span></code> 成员变量均使用 <code class="docutils literal notranslate"><span class="pre">torch.Tensor</span></code> 储存数据,
并使用torch计算。
使用 <code class="docutils literal notranslate"><span class="pre">pyvqnet.backends.set_backend(&quot;pyvqnet&quot;)</span></code> 后,VQNet <code class="docutils literal notranslate"><span class="pre">QTensor</span></code> 的 <code class="docutils literal notranslate"><span class="pre">data</span></code> 成员变量均使用 <code class="docutils literal notranslate"><span class="pre">pyvqnet._core.Tensor</span></code> 储存数据,并使用pyvqnet c++库计算。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该函数修改当前计算后端,在不同backends下得到的 <code class="docutils literal notranslate"><span class="pre">QTensor</span></code> 无法在一起运算。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>backend_name</strong> – backend name</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="get-backend">
<h3>get_backend<a class="headerlink" href="#get-backend" title="Link to this heading">¶</a></h3>
<dl class="py function">
<dt class="sig sig-object py" id="pyvqnet.backends.get_backend">
<span class="sig-prename descclassname"><span class="pre">pyvqnet.backends.</span></span><span class="sig-name descname"><span class="pre">get_backend</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">t</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.backends.get_backend" title="Link to this definition">¶</a></dt>
<dd><p>如果 t 为 None,则获取当前计算后端。
如果 t 是 QTensor,则根据其 <code class="docutils literal notranslate"><span class="pre">data</span></code> 属性返回创建 QTensor 时使用的计算后端。
如果 “torch” 是使用的后端,则返回 pyvqnet torch api 后端。
如果 “pyvqnet” 是使用的后端, 则简单地返回“pyvqnet”。</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>t</strong> – 当前张量,默认值: None。</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>后端。默认返回 “pyvqnet”。</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">get_backend</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

</section>
</section>
<section id="qtensor">
<h2>QTensor函数<a class="headerlink" href="#qtensor" title="Link to this heading">¶</a></h2>
<p>在设置 <code class="docutils literal notranslate"><span class="pre">torch</span></code> 计算后端后</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;pyvqnet&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>在 <a class="reference internal" href="QTensor.html#qtensor-api"><span class="std std-ref">QTensor 模块</span></a> 下的所有成员函数,创建函数,数学函数,逻辑函数,矩阵变换等均使用torch进行计算。使用 <code class="docutils literal notranslate"><span class="pre">QTensor.data</span></code> 可获取torch数据。</p>
<p>使用 <code class="docutils literal notranslate"><span class="pre">to_tensor</span></code> 可将 <code class="docutils literal notranslate"><span class="pre">torch.Tensor</span></code> 封装为一个 <code class="docutils literal notranslate"><span class="pre">QTensor</span></code> 。</p>
</section>
<section id="id2">
<h2>经典神经网络类以及变分量子神经网络模块<a class="headerlink" href="#id2" title="Link to this heading">¶</a></h2>
<section id="id3">
<h3>基类<a class="headerlink" href="#id3" title="Link to this heading">¶</a></h3>
<section id="torchmodule">
<h4>TorchModule<a class="headerlink" href="#torchmodule" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.nn.torch.TorchModule">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.nn.torch.</span></span><span class="sig-name descname"><span class="pre">TorchModule</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.nn.torch.TorchModule" title="Link to this definition">¶</a></dt>
<dd><p>当用户使用 <cite>torch</cite> 后端时候,定义模型 <cite>Module</cite> 应该继承的基类。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.nn.torch.TorchModule</span></code> 。
该类可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。
使用torch后端情况时候,所有模块应该继承于该类。</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类以及其派生类仅适用于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.backends.set_backend(&quot;torch&quot;)</span></code> , 不要与默认 <code class="docutils literal notranslate"><span class="pre">pyvqnet.nn</span></code> 下的 <code class="docutils literal notranslate"><span class="pre">Module</span></code> 混用。</p>
<p>该类的 <code class="docutils literal notranslate"><span class="pre">_buffers</span></code> 中的数据为 <code class="docutils literal notranslate"><span class="pre">torch.Tensor</span></code> 类型。
该类的 <code class="docutils literal notranslate"><span class="pre">_parmeters</span></code> 中的数据为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Parameter</span></code> 类型。</p>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="pyvqnet.nn.torch.TorchModule.forward">
<span class="sig-name descname"><span class="pre">forward</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.nn.torch.TorchModule.forward" title="Link to this definition">¶</a></dt>
<dd><p>TorchModule类抽象前向计算函数。</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> – 输入QTensor。</p></li>
<li><p><strong>*args</strong> – 非关键字可变参数。</p></li>
<li><p><strong>**kwargs</strong> – 关键字可变参数。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>输出QTensor,内部的data是 <code class="docutils literal notranslate"><span class="pre">torch.Tensor</span></code> 。</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.tensor</span><span class="w"> </span><span class="kn">import</span> <span class="n">QTensor</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.nn.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">Conv2D</span>
<span class="n">b</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">ic</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">oc</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">test_conv</span> <span class="o">=</span> <span class="n">Conv2D</span><span class="p">(</span><span class="n">ic</span><span class="p">,</span> <span class="n">oc</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="s2">&quot;valid&quot;</span><span class="p">)</span>
<span class="n">x0</span> <span class="o">=</span> <span class="n">QTensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">b</span> <span class="o">*</span> <span class="n">ic</span> <span class="o">*</span> <span class="mi">5</span> <span class="o">*</span> <span class="mi">5</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="n">b</span><span class="p">,</span> <span class="n">ic</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">]),</span>
            <span class="n">requires_grad</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">dtype</span><span class="o">=</span><span class="n">pyvqnet</span><span class="o">.</span><span class="n">kfloat32</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">test_conv</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">x0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyvqnet.nn.torch.TorchModule.state_dict">
<span class="sig-name descname"><span class="pre">state_dict</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">destination</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prefix</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.nn.torch.TorchModule.state_dict" title="Link to this definition">¶</a></dt>
<dd><p>返回包含模块整个状态的字典:包括参数和缓存值。
键是对应的参数和缓存值名称。</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>destination</strong> – 返回保存模型内部模块,参数的字典。</p></li>
<li><p><strong>prefix</strong> – 使用的参数和缓存值的命名前缀。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>包含模块整个状态的字典。</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.nn.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">Conv2D</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="n">test_conv</span> <span class="o">=</span> <span class="n">Conv2D</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="s2">&quot;same&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">test_conv</span><span class="o">.</span><span class="n">state_dict</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyvqnet.nn.torch.TorchModule.load_state_dict">
<span class="sig-name descname"><span class="pre">load_state_dict</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state_dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">strict</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.nn.torch.TorchModule.load_state_dict" title="Link to this definition">¶</a></dt>
<dd><p>将参数和缓冲区从 <a class="reference internal" href="#pyvqnet.nn.torch.TorchModule.state_dict" title="pyvqnet.nn.torch.TorchModule.state_dict"><code class="xref py py-attr docutils literal notranslate"><span class="pre">state_dict</span></code></a> 复制到此模块及其子模块。</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>state_dic</strong> – 包含参数和持久缓冲区的字典。</p></li>
<li><p><strong>strict</strong> – 是否严格执行 state_dict 中的键与模型的 <cite>state_dict()</cite> 匹配,默认: True。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>如果发生错误,则返回错误消息。</p>
</dd>
</dl>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.nn.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">TorchModule</span><span class="p">,</span><span class="n">Conv2D</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet.utils</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Net</span><span class="p">(</span><span class="n">TorchModule</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Net</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conv1</span> <span class="o">=</span> <span class="n">Conv2D</span><span class="p">(</span><span class="n">input_channels</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">output_channels</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
            <span class="n">stride</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">padding</span><span class="o">=</span><span class="s2">&quot;valid&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">Net</span><span class="p">()</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">save_parameters</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">state_dict</span><span class="p">(),</span> <span class="s2">&quot;tmp.model&quot;</span><span class="p">)</span>
<span class="n">model_param</span> <span class="o">=</span> <span class="n">pyvqnet</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">load_parameters</span><span class="p">(</span><span class="s2">&quot;tmp.model&quot;</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">load_state_dict</span><span class="p">(</span><span class="n">model_param</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyvqnet.nn.torch.TorchModule.toGPU">
<span class="sig-name descname"><span class="pre">toGPU</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">device</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">DEV_GPU_0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.nn.torch.TorchModule.toGPU" title="Link to this definition">¶</a></dt>
<dd><p>将模块和其子模块的参数和缓冲数据移动到指定的 GPU 设备中。</p>
<p>device 指定存储其内部数据的设备。 当device &gt;= DEV_GPU_0时,数据存储在GPU上。如果您的计算机有多个GPU,
则可以指定不同的设备来存储数据。例如device = DEV_GPU_1 , DEV_GPU_2, DEV_GPU_3, … 表示存储在不同序列号的GPU上。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Module在不同GPU上无法进行计算。
如果您尝试在 ID 超过验证 GPU 最大数量的 GPU 上创建 QTensor,将引发 Cuda 错误。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>device</strong> – 当前保存QTensor的设备,默认:DEV_GPU_0。device= pyvqnet.DEV_GPU_0,存储在第一个 GPU 中,devcie = DEV_GPU_1,存储在第二个 GPU 中,依此类推</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Module 移动到 GPU 设备。</p>
</dd>
</dl>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.nn.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">ConvT2D</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="n">test_conv</span> <span class="o">=</span> <span class="n">ConvT2D</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
<span class="n">test_conv</span> <span class="o">=</span> <span class="n">test_conv</span><span class="o">.</span><span class="n">toGPU</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">test_conv</span><span class="o">.</span><span class="n">backend</span><span class="p">)</span>
<span class="c1">#1000</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyvqnet.nn.torch.TorchModule.pyvqnet.torch.TorchModule.toCPU">
<span class="sig-prename descclassname"><span class="pre">pyvqnet.torch.TorchModule.</span></span><span class="sig-name descname"><span class="pre">toCPU</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.nn.torch.TorchModule.pyvqnet.torch.TorchModule.toCPU" title="Link to this definition">¶</a></dt>
<dd><p>将模块和其子模块的参数和缓冲数据移动到特定的 CPU 设备中。</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>Module 移动到 CPU 设备。</p>
</dd>
</dl>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.nn.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">ConvT2D</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="n">test_conv</span> <span class="o">=</span> <span class="n">ConvT2D</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
<span class="n">test_conv</span> <span class="o">=</span> <span class="n">test_conv</span><span class="o">.</span><span class="n">toCPU</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">test_conv</span><span class="o">.</span><span class="n">backend</span><span class="p">)</span>
<span class="c1">#0</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

</section>
<section id="torchmodulelist">
<h4>TorchModuleList<a class="headerlink" href="#torchmodulelist" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.nn.torch.TorchModuleList">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.nn.torch.</span></span><span class="sig-name descname"><span class="pre">TorchModuleList</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">modules</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.nn.torch.TorchModuleList" title="Link to this definition">¶</a></dt>
<dd><p>该模块用于将子 <code class="docutils literal notranslate"><span class="pre">TorchModule</span></code> 保存在列表中。 TorchModuleList 可以像普通的 Python 列表一样被索引, 它包含的内部参数等可以被保存起来。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.nn.torch.TorchModule</span></code> 以及 <code class="docutils literal notranslate"><span class="pre">pyvqnet.nn.ModuleList</span></code>,可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>modules</strong> – <code class="docutils literal notranslate"><span class="pre">pyvqnet.nn.torch.TorchModule</span></code> 列表</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>一个TorchModuleList 类</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.tensor</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.nn.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">TorchModule</span><span class="p">,</span><span class="n">Linear</span><span class="p">,</span><span class="n">TorchModuleList</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>

<span class="k">class</span><span class="w"> </span><span class="nc">M</span><span class="p">(</span><span class="n">TorchModule</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pqc2</span> <span class="o">=</span> <span class="n">TorchModuleList</span><span class="p">([</span><span class="n">Linear</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">Linear</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="p">])</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pqc2</span><span class="p">[</span><span class="mi">0</span><span class="p">](</span><span class="n">x</span><span class="p">)</span>  <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">pqc2</span><span class="p">[</span><span class="mi">1</span><span class="p">](</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">y</span>

<span class="n">mm</span> <span class="o">=</span> <span class="n">M</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="torchparameterlist">
<h4>TorchParameterList<a class="headerlink" href="#torchparameterlist" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.nn.torch.TorchParameterList">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.nn.torch.</span></span><span class="sig-name descname"><span class="pre">TorchParameterList</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">value</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.nn.torch.TorchParameterList" title="Link to this definition">¶</a></dt>
<dd><p>该模块用于将子 <code class="docutils literal notranslate"><span class="pre">pyvqnet.nn.Parameter</span></code> 保存在列表中。 TorchParameterList 可以像普通的 Python 列表一样被索引, 它包含的Parameter的内部参数等可以被保存起来。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.nn.torch.TorchModule</span></code> 以及 <code class="docutils literal notranslate"><span class="pre">pyvqnet.nn.ParameterList</span></code>,可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>value</strong> – nn.Parameter 列表</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>一个TorchParameterList 类</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.tensor</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.nn.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">TorchModule</span><span class="p">,</span><span class="n">Linear</span><span class="p">,</span><span class="n">TorchParameterList</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet.nn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">nn</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">MyModule</span><span class="p">(</span><span class="n">TorchModule</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="n">TorchParameterList</span><span class="p">([</span><span class="n">nn</span><span class="o">.</span><span class="n">Parameter</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)])</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>

        <span class="c1"># ParameterList can act as an iterable, or be indexed using ints</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">):</span>
            <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">i</span> <span class="o">//</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">p</span> <span class="o">*</span> <span class="n">x</span>
        <span class="k">return</span> <span class="n">x</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">MyModule</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">state_dict</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="torchsequential">
<h4>TorchSequential<a class="headerlink" href="#torchsequential" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.nn.torch.TorchSequential">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.nn.torch.</span></span><span class="sig-name descname"><span class="pre">TorchSequential</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.nn.torch.TorchSequential" title="Link to this definition">¶</a></dt>
<dd><p>模块将按照传递的顺序添加模块。或者,也可以将模块的 <code class="docutils literal notranslate"><span class="pre">OrderedDict</span></code> 传入。 <code class="docutils literal notranslate"><span class="pre">Sequential</span></code> 的 <code class="docutils literal notranslate"><span class="pre">forward()</span></code> 方法接受任何输入,并将其转发给它的第一个模块。
然后将输出依次链接到其后每个模块的输入、最后返回最后一个模块的输出。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.nn.torch.TorchModule</span></code> 以及 <code class="docutils literal notranslate"><span class="pre">pyvqnet.nn.Sequential</span></code>,可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>args</strong> – 添加的Module</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>一个 TorchSequential 类</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">OrderedDict</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.tensor</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.nn.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">TorchModule</span><span class="p">,</span><span class="n">Conv2D</span><span class="p">,</span><span class="n">ReLu</span><span class="p">,</span>\
    <span class="n">TorchSequential</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">TorchSequential</span><span class="p">(</span>
            <span class="n">Conv2D</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">20</span><span class="p">,(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)),</span>
            <span class="n">ReLu</span><span class="p">(),</span>
            <span class="n">Conv2D</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">64</span><span class="p">,(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)),</span>
            <span class="n">ReLu</span><span class="p">()</span>
        <span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">state_dict</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">TorchSequential</span><span class="p">(</span><span class="n">OrderedDict</span><span class="p">([</span>
            <span class="p">(</span><span class="s1">&#39;conv1&#39;</span><span class="p">,</span> <span class="n">Conv2D</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">20</span><span class="p">,(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))),</span>
            <span class="p">(</span><span class="s1">&#39;relu1&#39;</span><span class="p">,</span> <span class="n">ReLu</span><span class="p">()),</span>
            <span class="p">(</span><span class="s1">&#39;conv2&#39;</span><span class="p">,</span> <span class="n">Conv2D</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">64</span><span class="p">,(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))),</span>
            <span class="p">(</span><span class="s1">&#39;relu2&#39;</span><span class="p">,</span> <span class="n">ReLu</span><span class="p">())</span>
        <span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">state_dict</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</pre></div>
</div>
</dd></dl>

</section>
</section>
<section id="id4">
<h3>模型参数保存和载入<a class="headerlink" href="#id4" title="Link to this heading">¶</a></h3>
<p>使用 <a class="reference internal" href="nn.html#save-parameters"><span class="std std-ref">模型参数保存和载入</span></a> 中的 <code class="docutils literal notranslate"><span class="pre">save_parameters</span></code> 以及 <code class="docutils literal notranslate"><span class="pre">load_parameters</span></code> 可以进行 <code class="docutils literal notranslate"><span class="pre">TorchModule</span></code> 模型参数以字典形式保存到文件中,其中数值以 <cite>numpy.ndarray</cite> 保存。
或从文件中读取参数文件。但请注意,文件中不保存模型结构,需要用户手动构建模型结构。
你也可以直接使用 <code class="docutils literal notranslate"><span class="pre">torch.save</span></code> 以及 <code class="docutils literal notranslate"><span class="pre">torch.load</span></code> 去直接读取 <code class="docutils literal notranslate"><span class="pre">torch</span></code> 模型参数,因为 <code class="docutils literal notranslate"><span class="pre">TorchModule</span></code> 的参数是以 <code class="docutils literal notranslate"><span class="pre">torch.Tensor</span></code> 储存的。</p>
</section>
<section id="id5">
<h3>经典神经网络模块<a class="headerlink" href="#id5" title="Link to this heading">¶</a></h3>
<p>以下经典神经网络模块均继承于继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.nn.Module</span></code> 以及 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code>,可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
<section id="linear">
<h4>Linear<a class="headerlink" href="#linear" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.nn.torch.Linear">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.nn.torch.</span></span><span class="sig-name descname"><span class="pre">Linear</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_channels</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output_channels</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weight_initializer</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bias_initializer</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_bias</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.nn.torch.Linear" title="Link to this definition">¶</a></dt>
<dd><p>线性模块(全连接层)。
<span class="math notranslate nohighlight">\(y = Ax + b\)</span></p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.nn.torch.TorchModule</span></code> ,可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
</div>
<p>该类的 <code class="docutils literal notranslate"><span class="pre">_buffers</span></code> 中的数据为 <code class="docutils literal notranslate"><span class="pre">torch.Tensor</span></code> 类型。
该类的 <code class="docutils literal notranslate"><span class="pre">_parmeters</span></code> 中的数据为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Parameter</span></code> 类型。</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>input_channels</strong> – <cite>int</cite> - 输入数据通道数。</p></li>
<li><p><strong>output_channels</strong> – <cite>int</cite> - 输出数据通道数。</p></li>
<li><p><strong>weight_initializer</strong> – <cite>callable</cite> - 权重初始化函数,默认为空,使用he_uniform。</p></li>
<li><p><strong>bias_initializer</strong> – <cite>callable</cite> - 偏置初始化参数,默认为空,使用he_uniform。</p></li>
<li><p><strong>use_bias</strong> – <cite>bool</cite> - 是否使用偏置项, 默认使用。</p></li>
<li><p><strong>dtype</strong> – 参数的数据类型,defaults:None,使用默认数据类型:kfloat32,代表32位浮点数。</p></li>
<li><p><strong>name</strong> – 线性层的命名,默认为””。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>线性层实例。</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.tensor</span><span class="w"> </span><span class="kn">import</span> <span class="n">QTensor</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.nn.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">Linear</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="n">c1</span> <span class="o">=</span><span class="mi">2</span>
<span class="n">c2</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">cin</span> <span class="o">=</span> <span class="mi">7</span>
<span class="n">cout</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">Linear</span><span class="p">(</span><span class="n">cin</span><span class="p">,</span><span class="n">cout</span><span class="p">)</span>
<span class="nb">input</span> <span class="o">=</span> <span class="n">QTensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">c1</span><span class="o">*</span><span class="n">c2</span><span class="o">*</span><span class="n">cin</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">c1</span><span class="p">,</span><span class="n">c2</span><span class="p">,</span><span class="n">cin</span><span class="p">)),</span><span class="n">requires_grad</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">pyvqnet</span><span class="o">.</span><span class="n">kfloat32</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="conv1d">
<h4>Conv1D<a class="headerlink" href="#conv1d" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.nn.torch.Conv1D">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.nn.torch.</span></span><span class="sig-name descname"><span class="pre">Conv1D</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_channels</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output_channels</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kernel_size</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stride</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">padding</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'valid'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_bias</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kernel_initializer</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bias_initializer</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dilation_rate</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">group</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.nn.torch.Conv1D" title="Link to this definition">¶</a></dt>
<dd><p>在输入上进行一维卷积运算。 Conv1D模块的输入具有形状(batch_size、input_channels、in_height)。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.nn.torch.TorchModule</span></code> ,可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
<p>该类的 <code class="docutils literal notranslate"><span class="pre">_buffers</span></code> 中的数据为 <code class="docutils literal notranslate"><span class="pre">torch.Tensor</span></code> 类型。
该类的 <code class="docutils literal notranslate"><span class="pre">_parmeters</span></code> 中的数据为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Parameter</span></code> 类型。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>input_channels</strong> – <cite>int</cite> - 输入数据的通道数。</p></li>
<li><p><strong>output_channels</strong> – <cite>int</cite> - 输出数据的通道数。</p></li>
<li><p><strong>kernel_size</strong> – <cite>int</cite> - 卷积核的尺寸. 卷积核形状 = [output_channels,input_channels/group,kernel_size,1]。</p></li>
<li><p><strong>stride</strong> – <cite>int</cite> - 步长, 默认为1。</p></li>
<li><p><strong>padding</strong> – <cite>str|int</cite> - 填充选项, 它可以是一个字符串 {‘valid’, ‘same’} 或一个整数,给出应用在输入上的填充量。 默认 “valid”。</p></li>
<li><p><strong>use_bias</strong> – <cite>bool</cite> - 是否使用偏置项, 默认使用。</p></li>
<li><p><strong>kernel_initializer</strong> – <cite>callable</cite> - 卷积核初始化方法。默认为空,使用kaiming_uniform。</p></li>
<li><p><strong>bias_initializer</strong> – <cite>callable</cite> - 偏置初始化方法。默认为空,使用kaiming_uniform。</p></li>
<li><p><strong>dilation_rate</strong> – <cite>int</cite> - 空洞大小,defaults: 1。</p></li>
<li><p><strong>group</strong> – <cite>int</cite> -  分组卷积的分组数. Default: 1。</p></li>
<li><p><strong>dtype</strong> – 参数的数据类型,defaults:None,使用默认数据类型:kfloat32,代表32位浮点数。</p></li>
<li><p><strong>name</strong> – 模块的名字,default:””。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>一维卷积实例。</p>
</dd>
</dl>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><code class="docutils literal notranslate"><span class="pre">padding='valid'</span></code> 不进行填充。</p>
<p><code class="docutils literal notranslate"><span class="pre">padding='same'</span></code> 补零填充输入, 输出的out_height 为 = ceil(in_height / stride),不支持 stride&gt;1 的情况。</p>
</div>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.tensor</span><span class="w"> </span><span class="kn">import</span> <span class="n">QTensor</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.nn.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">Conv1D</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="n">b</span><span class="o">=</span> <span class="mi">2</span>
<span class="n">ic</span> <span class="o">=</span><span class="mi">3</span>
<span class="n">oc</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">test_conv</span> <span class="o">=</span> <span class="n">Conv1D</span><span class="p">(</span><span class="n">ic</span><span class="p">,</span><span class="n">oc</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">x0</span> <span class="o">=</span> <span class="n">QTensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">b</span><span class="o">*</span><span class="n">ic</span><span class="o">*</span><span class="mi">5</span><span class="o">*</span><span class="mi">5</span> <span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="n">b</span><span class="p">,</span><span class="n">ic</span><span class="p">,</span><span class="mi">25</span><span class="p">]),</span><span class="n">requires_grad</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">pyvqnet</span><span class="o">.</span><span class="n">kfloat32</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">test_conv</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">x0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="conv2d">
<h4>Conv2D<a class="headerlink" href="#conv2d" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.nn.torch.Conv2D">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.nn.torch.</span></span><span class="sig-name descname"><span class="pre">Conv2D</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_channels</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output_channels</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kernel_size</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">tuple</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stride</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">tuple</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">(1,</span> <span class="pre">1)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">padding</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'valid'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_bias</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kernel_initializer</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bias_initializer</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dilation_rate</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">group</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.nn.torch.Conv2D" title="Link to this definition">¶</a></dt>
<dd><p>在输入上进行二维卷积运算。 Conv2D模块的输入具有形状(batch_size, input_channels, height, width)。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.nn.torch.TorchModule</span></code> ,可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
<p>该类的 <code class="docutils literal notranslate"><span class="pre">_buffers</span></code> 中的数据为 <code class="docutils literal notranslate"><span class="pre">torch.Tensor</span></code> 类型。
该类的 <code class="docutils literal notranslate"><span class="pre">_parmeters</span></code> 中的数据为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Parameter</span></code> 类型。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>input_channels</strong> – <cite>int</cite> - 输入数据的通道数。</p></li>
<li><p><strong>output_channels</strong> – <cite>int</cite> - 输出数据的通道数。</p></li>
<li><p><strong>kernel_size</strong> – <cite>tuple|list</cite> - 卷积核的尺寸. 卷积核形状 = [output_channels,input_channels/group,kernel_size,kernel_size]。</p></li>
<li><p><strong>stride</strong> – <cite>tuple|list</cite> - 步长, 默认为 (1, 1)|[1,1]。</p></li>
<li><p><strong>padding</strong> – <cite>str|tuple</cite> - 填充选项, 它可以是一个字符串 {‘valid’, ‘same’} 或一个整数元组,给出在两边应用的隐式填充量。 默认 “valid”。</p></li>
<li><p><strong>use_bias</strong> – <cite>bool</cite> - 是否使用偏置项, 默认使用。</p></li>
<li><p><strong>kernel_initializer</strong> – <cite>callable</cite> - 卷积核初始化方法。默认为空,使用kaiming_uniform。</p></li>
<li><p><strong>bias_initializer</strong> – <cite>callable</cite> - 偏置初始化方法。默认为空,使用kaiming_uniform。</p></li>
<li><p><strong>dilation_rate</strong> – <cite>int</cite> - 空洞大小,defaults: 1。</p></li>
<li><p><strong>group</strong> – <cite>int</cite> -  分组卷积的分组数. Default: 1。</p></li>
<li><p><strong>dtype</strong> – 参数的数据类型,defaults:None,使用默认数据类型:kfloat32,代表32位浮点数。</p></li>
<li><p><strong>name</strong> – 模块的名字,default:””。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>二维卷积实例。</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">padding='valid'</span></code> 不进行填充。
<code class="docutils literal notranslate"><span class="pre">padding='same'</span></code> 补零填充输入, 输出的out_height 为 = ceil(in_height / stride),不支持 stride&gt;1 的情况。</p>
</div>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.tensor</span><span class="w"> </span><span class="kn">import</span> <span class="n">QTensor</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.nn.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">Conv2D</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="n">b</span><span class="o">=</span> <span class="mi">2</span>
<span class="n">ic</span> <span class="o">=</span><span class="mi">3</span>
<span class="n">oc</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">test_conv</span> <span class="o">=</span> <span class="n">Conv2D</span><span class="p">(</span><span class="n">ic</span><span class="p">,</span><span class="n">oc</span><span class="p">,(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="n">x0</span> <span class="o">=</span> <span class="n">QTensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">b</span><span class="o">*</span><span class="n">ic</span><span class="o">*</span><span class="mi">5</span><span class="o">*</span><span class="mi">5</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="n">b</span><span class="p">,</span><span class="n">ic</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">]),</span><span class="n">requires_grad</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">pyvqnet</span><span class="o">.</span><span class="n">kfloat32</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">test_conv</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">x0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="convt2d">
<h4>ConvT2D<a class="headerlink" href="#convt2d" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.nn.torch.ConvT2D">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.nn.torch.</span></span><span class="sig-name descname"><span class="pre">ConvT2D</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_channels</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output_channels</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kernel_size</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stride</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[1,</span> <span class="pre">1]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">padding</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">(0,</span> <span class="pre">0)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_bias</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'True'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kernel_initializer</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bias_initializer</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dilation_rate</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">out_padding</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">(0,</span> <span class="pre">0)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">group</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.nn.torch.ConvT2D" title="Link to this definition">¶</a></dt>
<dd><p>在输入上进行二维转置卷积运算。 Conv2D模块的输入具有形状(batch_size, input_channels, height, width)。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.nn.torch.TorchModule</span></code> ,可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
<p>该类的 <code class="docutils literal notranslate"><span class="pre">_buffers</span></code> 中的数据为 <code class="docutils literal notranslate"><span class="pre">torch.Tensor</span></code> 类型。
该类的 <code class="docutils literal notranslate"><span class="pre">_parmeters</span></code> 中的数据为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Parameter</span></code> 类型。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>input_channels</strong> – <cite>int</cite> - 输入数据的通道数。</p></li>
<li><p><strong>output_channels</strong> – <cite>int</cite> - 输出数据的通道数。</p></li>
<li><p><strong>kernel_size</strong> – <cite>tuple|list</cite> - 卷积核的尺寸,卷积核形状 = [input_channels,output_channels/group,kernel_size,kernel_size]。</p></li>
<li><p><strong>stride</strong> – <cite>tuple|list</cite> - 步长, 默认为 (1, 1)|[1,1]。</p></li>
<li><p><strong>padding</strong> – <cite>tuple</cite> - 填充选项, 一个整数元组,给出在两边应用的隐式填充量。 默认 (0,0)。</p></li>
<li><p><strong>use_bias</strong> – <cite>bool</cite> - 是否使用偏置项, 默认使用。</p></li>
<li><p><strong>kernel_initializer</strong> – <cite>callable</cite> - 卷积核初始化方法。默认为空,使用kaiming_uniform。</p></li>
<li><p><strong>bias_initializer</strong> – <cite>callable</cite> - 偏置项初始化方法。默认为空,使用kaiming_uniform。</p></li>
<li><p><strong>dilation_rate</strong> – <cite>int</cite> - 空洞大小,defaults: 1。</p></li>
<li><p><strong>out_padding</strong> – 在输出形状中每个维度的一侧添加的额外尺寸。默认值:(0,0)</p></li>
<li><p><strong>group</strong> – <cite>int</cite> -  分组卷积的分组数. Default: 1。</p></li>
<li><p><strong>dtype</strong> – 参数的数据类型,defaults:None,使用默认数据类型:kfloat32,代表32位浮点数。</p></li>
<li><p><strong>name</strong> – 模块的名字,default:””。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>二维转置卷积实例。</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">padding='valid'</span></code> 不进行填充。
<code class="docutils literal notranslate"><span class="pre">padding='same'</span></code> 补零填充输入,输出的height 为 = ceil(height / stride)。</p>
</div>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.tensor</span><span class="w"> </span><span class="kn">import</span> <span class="n">QTensor</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.nn.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">ConvT2D</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="n">test_conv</span> <span class="o">=</span> <span class="n">ConvT2D</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">QTensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">*</span> <span class="mi">5</span> <span class="o">*</span> <span class="mi">5</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">]),</span> <span class="n">requires_grad</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">pyvqnet</span><span class="o">.</span><span class="n">kfloat32</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">test_conv</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="avgpool1d">
<h4>AvgPool1D<a class="headerlink" href="#avgpool1d" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.nn.torch.AvgPool1D">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.nn.torch.</span></span><span class="sig-name descname"><span class="pre">AvgPool1D</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">kernel</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stride</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">padding</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.nn.torch.AvgPool1D" title="Link to this definition">¶</a></dt>
<dd><p>对一维输入进行平均池化。输入具有形状(batch_size, input_channels, in_height)。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.nn.torch.TorchModule</span></code> ,可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
<p>该类的 <code class="docutils literal notranslate"><span class="pre">_buffers</span></code> 中的数据为 <code class="docutils literal notranslate"><span class="pre">torch.Tensor</span></code> 类型。
该类的 <code class="docutils literal notranslate"><span class="pre">_parmeters</span></code> 中的数据为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Parameter</span></code> 类型。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>kernel</strong> – 平均池化的窗口大小。</p></li>
<li><p><strong>strides</strong> – 窗口移动的步长。</p></li>
<li><p><strong>padding</strong> – 填充选项, 整数指定填充长度。 默认 0。</p></li>
<li><p><strong>name</strong> – 模块的名字,default:””。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>一维平均池化层实例。</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.tensor</span><span class="w"> </span><span class="kn">import</span> <span class="n">QTensor</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.nn.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">AvgPool1D</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="n">test_mp</span> <span class="o">=</span> <span class="n">AvgPool1D</span><span class="p">([</span><span class="mi">3</span><span class="p">],[</span><span class="mi">2</span><span class="p">],</span><span class="mi">0</span><span class="p">)</span>
<span class="n">x</span><span class="o">=</span> <span class="n">QTensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span>
                            <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>
                            <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>
                            <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span>
                            <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">]),</span><span class="n">requires_grad</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">y</span><span class="o">=</span> <span class="n">test_mp</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="maxpool1d">
<h4>MaxPool1D<a class="headerlink" href="#maxpool1d" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.nn.torch.MaxPool1D">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.nn.torch.</span></span><span class="sig-name descname"><span class="pre">MaxPool1D</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">kernel</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stride</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">padding</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.nn.torch.MaxPool1D" title="Link to this definition">¶</a></dt>
<dd><p>对一维输入进行最大池化。输入具有形状(batch_size, input_channels, in_height)。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.nn.torch.TorchModule</span></code> ,可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
<p>该类的 <code class="docutils literal notranslate"><span class="pre">_buffers</span></code> 中的数据为 <code class="docutils literal notranslate"><span class="pre">torch.Tensor</span></code> 类型。
该类的 <code class="docutils literal notranslate"><span class="pre">_parmeters</span></code> 中的数据为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Parameter</span></code> 类型。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>kernel</strong> – 最大池化的窗口大小。</p></li>
<li><p><strong>strides</strong> – 窗口移动的步长。</p></li>
<li><p><strong>padding</strong> – 填充选项,整数指定填充长度。 默认 0。</p></li>
<li><p><strong>name</strong> – 命名,默认为””。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>一维最大池化层实例。</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.tensor</span><span class="w"> </span><span class="kn">import</span> <span class="n">QTensor</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.nn.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">MaxPool1D</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="n">test_mp</span> <span class="o">=</span> <span class="n">MaxPool1D</span><span class="p">([</span><span class="mi">3</span><span class="p">],[</span><span class="mi">2</span><span class="p">],</span><span class="mi">0</span><span class="p">)</span>
<span class="n">x</span><span class="o">=</span> <span class="n">QTensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span>
                            <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>
                            <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>
                            <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span>
                            <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">]),</span><span class="n">requires_grad</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">y</span><span class="o">=</span> <span class="n">test_mp</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="avgpool2d">
<h4>AvgPool2D<a class="headerlink" href="#avgpool2d" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.nn.torch.AvgPool2D">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.nn.torch.</span></span><span class="sig-name descname"><span class="pre">AvgPool2D</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">kernel</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stride</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">padding</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">(0,</span> <span class="pre">0)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.nn.torch.AvgPool2D" title="Link to this definition">¶</a></dt>
<dd><p>对二维输入进行平均池化。输入具有形状(batch_size, input_channels, height, width)。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.nn.torch.TorchModule</span></code> ,可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
<p>该类的 <code class="docutils literal notranslate"><span class="pre">_buffers</span></code> 中的数据为 <code class="docutils literal notranslate"><span class="pre">torch.Tensor</span></code> 类型。
该类的 <code class="docutils literal notranslate"><span class="pre">_parmeters</span></code> 中的数据为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Parameter</span></code> 类型。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>kernel</strong> – 平均池化的窗口大小。</p></li>
<li><p><strong>strides</strong> – 窗口移动的步长。</p></li>
<li><p><strong>padding</strong> – 填充选项, 包含2个整数的元组,整数为两个维度上的填充长度。 默认:(0,0)。</p></li>
<li><p><strong>name</strong> – 命名,默认为””。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>二维平均池化层实例。</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.tensor</span><span class="w"> </span><span class="kn">import</span> <span class="n">QTensor</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.nn.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">AvgPool2D</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="n">test_mp</span> <span class="o">=</span> <span class="n">AvgPool2D</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span><span class="mi">1</span><span class="p">)</span>
<span class="n">x</span><span class="o">=</span> <span class="n">QTensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span>
                            <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>
                            <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>
                            <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span>
                            <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">]),</span><span class="n">requires_grad</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">y</span><span class="o">=</span> <span class="n">test_mp</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="maxpool2d">
<h4>MaxPool2D<a class="headerlink" href="#maxpool2d" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.nn.torch.MaxPool2D">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.nn.torch.</span></span><span class="sig-name descname"><span class="pre">MaxPool2D</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">kernel</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stride</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">padding</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">(0,</span> <span class="pre">0)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.nn.torch.MaxPool2D" title="Link to this definition">¶</a></dt>
<dd><p>对二维输入进行最大池化。输入具有形状(batch_size, input_channels, height, width)。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.nn.torch.TorchModule</span></code> ,可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
<p>该类的 <code class="docutils literal notranslate"><span class="pre">_buffers</span></code> 中的数据为 <code class="docutils literal notranslate"><span class="pre">torch.Tensor</span></code> 类型。
该类的 <code class="docutils literal notranslate"><span class="pre">_parmeters</span></code> 中的数据为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Parameter</span></code> 类型。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>kernel</strong> – 最大池化的窗口大小。</p></li>
<li><p><strong>strides</strong> – 窗口移动的步长。</p></li>
<li><p><strong>padding</strong> – 填充选项, 包含2个整数的元组,整数为两个维度上的填充长度。 默认: (0,0)。</p></li>
<li><p><strong>name</strong> – 命名,默认为””。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>二维最大池化层实例。</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.tensor</span><span class="w"> </span><span class="kn">import</span> <span class="n">QTensor</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.nn.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">MaxPool2D</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="n">test_mp</span> <span class="o">=</span> <span class="n">MaxPool2D</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">],(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
<span class="n">x</span><span class="o">=</span> <span class="n">QTensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span>
                            <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>
                            <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>
                            <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span>
                            <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">]),</span><span class="n">requires_grad</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">y</span><span class="o">=</span> <span class="n">test_mp</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="embedding">
<h4>Embedding<a class="headerlink" href="#embedding" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.nn.torch.Embedding">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.nn.torch.</span></span><span class="sig-name descname"><span class="pre">Embedding</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">num_embeddings</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">embedding_dim</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weight_initializer</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">xavier_normal</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.nn.torch.Embedding" title="Link to this definition">¶</a></dt>
<dd><p>该模块通常用于存储词嵌入并使用索引检索它们。模块的输入是索引列表,输出是对应的词嵌入。
该层的输入应该是kint64。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.nn.torch.TorchModule</span></code> ,可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
<p>该类的 <code class="docutils literal notranslate"><span class="pre">_buffers</span></code> 中的数据为 <code class="docutils literal notranslate"><span class="pre">torch.Tensor</span></code> 类型。
该类的 <code class="docutils literal notranslate"><span class="pre">_parmeters</span></code> 中的数据为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Parameter</span></code> 类型。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>num_embeddings</strong> – <cite>int</cite> - 嵌入字典的大小。</p></li>
<li><p><strong>embedding_dim</strong> – <cite>int</cite> - 每个嵌入向量的大小</p></li>
<li><p><strong>weight_initializer</strong> – <cite>callable</cite> - 参数初始化方式,默认正态分布。</p></li>
<li><p><strong>dtype</strong> – 参数的数据类型,defaults:None,使用默认数据类型:kfloat32,代表32位浮点数。</p></li>
<li><p><strong>name</strong> – 嵌入层的命名,默认为””。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>a Embedding 实例。</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.tensor</span><span class="w"> </span><span class="kn">import</span> <span class="n">QTensor</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.nn.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">Embedding</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="n">vlayer</span> <span class="o">=</span> <span class="n">Embedding</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">QTensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">25</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]),</span><span class="n">dtype</span><span class="o">=</span> <span class="n">pyvqnet</span><span class="o">.</span><span class="n">kint64</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">vlayer</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="batchnorm2d">
<h4>BatchNorm2d<a class="headerlink" href="#batchnorm2d" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.nn.torch.BatchNorm2d">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.nn.torch.</span></span><span class="sig-name descname"><span class="pre">BatchNorm2d</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">channel_num</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">momentum</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0.1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">epsilon</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1e-5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">affine</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">beta_initializer</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">zeros</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gamma_initializer</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">ones</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.nn.torch.BatchNorm2d" title="Link to this definition">¶</a></dt>
<dd><p>在 4D 输入(B、C、H、W)上应用批归一化。参照论文
<a class="reference external" href="https://arxiv.org/abs/1502.03167">Batch Normalization: Accelerating Deep Network Training by Reducing
Internal Covariate Shift</a> 。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.nn.torch.TorchModule</span></code> ,可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
<p>该类的 <code class="docutils literal notranslate"><span class="pre">_buffers</span></code> 中的数据为 <code class="docutils literal notranslate"><span class="pre">torch.Tensor</span></code> 类型。
该类的 <code class="docutils literal notranslate"><span class="pre">_parmeters</span></code> 中的数据为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Parameter</span></code> 类型。</p>
</div>
<div class="math notranslate nohighlight">
\[y = \frac{x - \mathrm{E}[x]}{\sqrt{\mathrm{Var}[x] + \epsilon}} * \gamma + \beta\]</div>
<p>其中 <span class="math notranslate nohighlight">\(\gamma\)</span> 和 <span class="math notranslate nohighlight">\(\beta\)</span> 为待训练参数。此外,默认情况下,在训练期间,该层会继续运行估计其计算的均值和方差,然后在评估期间用于归一化。平均方差均值保持默认动量 0.1。</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>channel_num</strong> – <cite>int</cite> - 输入通道数。</p></li>
<li><p><strong>momentum</strong> – <cite>float</cite> - 计算指数加权平均时的动量,默认为 0.1。</p></li>
<li><p><strong>epsilon</strong> – <cite>float</cite> - 数值稳定参数, 默认 1e-5。</p></li>
<li><p><strong>affine</strong> – <cite>bool</cite> - 一个布尔值,当设置为 <code class="docutils literal notranslate"><span class="pre">True</span></code> 时,此模块具有可学习的每通道仿射参数,初始化为 1(用于权重)和 0(用于偏差)。默认值:<code class="docutils literal notranslate"><span class="pre">True</span></code>。</p></li>
<li><p><strong>beta_initializer</strong> – <cite>callable</cite> - beta的初始化方式,默认全零初始化。</p></li>
<li><p><strong>gamma_initializer</strong> – <cite>callable</cite> - gamma的的初始化方式,默认全一初始化。</p></li>
<li><p><strong>dtype</strong> – 参数的数据类型,defaults:None,使用默认数据类型:kfloat32,代表32位浮点数。</p></li>
<li><p><strong>name</strong> – 批归一化层命名,默认为””。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>二维批归一化层实例。</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.tensor</span><span class="w"> </span><span class="kn">import</span> <span class="n">QTensor</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.nn.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">BatchNorm2d</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">ic</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">test_conv</span> <span class="o">=</span> <span class="n">BatchNorm2d</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">QTensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">17</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="n">b</span><span class="p">,</span> <span class="n">ic</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span>
            <span class="n">requires_grad</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">dtype</span><span class="o">=</span><span class="n">pyvqnet</span><span class="o">.</span><span class="n">kfloat32</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">test_conv</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="batchnorm1d">
<h4>BatchNorm1d<a class="headerlink" href="#batchnorm1d" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.nn.torch.BatchNorm1d">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.nn.torch.</span></span><span class="sig-name descname"><span class="pre">BatchNorm1d</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">channel_num</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">momentum</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0.1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">epsilon</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1e-5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">affine</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">beta_initializer</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">zeros</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gamma_initializer</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">ones</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.nn.torch.BatchNorm1d" title="Link to this definition">¶</a></dt>
<dd><p>在 2D 输入 (B,C) 上进行批归一化操作。 参照论文
<a class="reference external" href="https://arxiv.org/abs/1502.03167">Batch Normalization: Accelerating Deep Network Training by Reducing
Internal Covariate Shift</a> 。</p>
<div class="math notranslate nohighlight">
\[y = \frac{x - \mathrm{E}[x]}{\sqrt{\mathrm{Var}[x] + \epsilon}} * \gamma + \beta\]</div>
<p>其中 <span class="math notranslate nohighlight">\(\gamma\)</span> 和 <span class="math notranslate nohighlight">\(\beta\)</span> 为待训练参数。此外,默认情况下,在训练期间,该层会继续运行估计其计算的均值和方差,然后在评估期间用于归一化。平均方差均值保持默认动量 0.1。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.nn.torch.TorchModule</span></code> ,可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
<p>该类的 <code class="docutils literal notranslate"><span class="pre">_buffers</span></code> 中的数据为 <code class="docutils literal notranslate"><span class="pre">torch.Tensor</span></code> 类型。
该类的 <code class="docutils literal notranslate"><span class="pre">_parmeters</span></code> 中的数据为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Parameter</span></code> 类型。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>channel_num</strong> – <cite>int</cite> - 输入通道数。</p></li>
<li><p><strong>momentum</strong> – <cite>float</cite> - 计算指数加权平均时的动量,默认为 0.1。</p></li>
<li><p><strong>epsilon</strong> – <cite>float</cite> - 数值稳定性常数,默认为 1e-5。</p></li>
<li><p><strong>affine</strong> – <cite>bool</cite> - 一个布尔值,当设置为 <code class="docutils literal notranslate"><span class="pre">True</span></code> 时,此模块具有可学习的每通道仿射参数,初始化为 1(用于权重)和 0(用于偏差)。默认值:<code class="docutils literal notranslate"><span class="pre">True</span></code>。</p></li>
<li><p><strong>beta_initializer</strong> – <cite>callable</cite> - beta的初始化方式,默认全零初始化。</p></li>
<li><p><strong>gamma_initializer</strong> – <cite>callable</cite> - gamma的的初始化方式,默认全一初始化。</p></li>
<li><p><strong>dtype</strong> – 参数的数据类型,defaults:None,使用默认数据类型:kfloat32,代表32位浮点数。</p></li>
<li><p><strong>name</strong> – 批归一化层命名,默认为””。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>一维批归一化层实例。</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.tensor</span><span class="w"> </span><span class="kn">import</span> <span class="n">QTensor</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.nn.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">BatchNorm1d</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="n">test_conv</span> <span class="o">=</span> <span class="n">BatchNorm1d</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">QTensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">17</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">]),</span>
            <span class="n">requires_grad</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">dtype</span><span class="o">=</span><span class="n">pyvqnet</span><span class="o">.</span><span class="n">kfloat32</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">test_conv</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="layernormnd">
<h4>LayerNormNd<a class="headerlink" href="#layernormnd" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.nn.torch.LayerNormNd">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.nn.torch.</span></span><span class="sig-name descname"><span class="pre">LayerNormNd</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">normalized_shape</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">epsilon</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1e-5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">affine</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.nn.torch.LayerNormNd" title="Link to this definition">¶</a></dt>
<dd><p>在任意输入的后D个维度上进行层归一化。具体方式如论文所述:
<a class="reference external" href="https://arxiv.org/abs/1607.06450">Layer Normalization</a>。</p>
<div class="math notranslate nohighlight">
\[y = \frac{x - \mathrm{E}[x]}{ \sqrt{\mathrm{Var}[x] + \epsilon}} * \gamma + \beta\]</div>
<p>对于像 (B,C,H,W,D) 这样的输入, <code class="docutils literal notranslate"><span class="pre">norm_shape</span></code> 可以是 [C,H,W,D],[H,W,D],[W,D] 或 [D] .</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.nn.torch.TorchModule</span></code> ,可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
<p>该类的 <code class="docutils literal notranslate"><span class="pre">_buffers</span></code> 中的数据为 <code class="docutils literal notranslate"><span class="pre">torch.Tensor</span></code> 类型。
该类的 <code class="docutils literal notranslate"><span class="pre">_parmeters</span></code> 中的数据为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Parameter</span></code> 类型。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>norm_shape</strong> – <cite>float</cite> - 标准化形状。</p></li>
<li><p><strong>epsilon</strong> – <cite>float</cite> - 数值稳定性常数,默认为 1e-5。</p></li>
<li><p><strong>affine</strong> – <cite>bool</cite> - 一个布尔值,当设置为 <code class="docutils literal notranslate"><span class="pre">True</span></code> 时,此模块具有可学习的每通道仿射参数,初始化为 1(用于权重)和 0(用于偏差)。默认值:<code class="docutils literal notranslate"><span class="pre">True</span></code>。</p></li>
<li><p><strong>dtype</strong> – 参数的数据类型,defaults:None,使用默认数据类型:kfloat32,代表32位浮点数。</p></li>
<li><p><strong>name</strong> – 这个模块的名字, 默认为””。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>一个 LayerNormNd 类</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.tensor</span><span class="w"> </span><span class="kn">import</span> <span class="n">QTensor</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet</span><span class="w"> </span><span class="kn">import</span> <span class="n">kfloat32</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.nn.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">LayerNormNd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="n">ic</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">test_conv</span> <span class="o">=</span> <span class="n">LayerNormNd</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">QTensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">17</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]),</span><span class="n">requires_grad</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">kfloat32</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">test_conv</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="layernorm2d">
<h4>LayerNorm2d<a class="headerlink" href="#layernorm2d" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.nn.torch.LayerNorm2d">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.nn.torch.</span></span><span class="sig-name descname"><span class="pre">LayerNorm2d</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">norm_size</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">epsilon</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1e-5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">affine</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.nn.torch.LayerNorm2d" title="Link to this definition">¶</a></dt>
<dd><p>在 4D 输入上进行层归一化。具体方式如论文所述:
<a class="reference external" href="https://arxiv.org/abs/1607.06450">Layer Normalization</a>。</p>
<div class="math notranslate nohighlight">
\[y = \frac{x - \mathrm{E}[x]}{ \sqrt{\mathrm{Var}[x] + \epsilon}} * \gamma + \beta\]</div>
<p>平均值和标准差是在除去第一个维度以外的剩余维度数据上计算的。对于像 (B,C,H,W) 这样的输入, <code class="docutils literal notranslate"><span class="pre">norm_size</span></code> 应该等于 C * H * W。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.nn.torch.TorchModule</span></code> ,可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
<p>该类的 <code class="docutils literal notranslate"><span class="pre">_buffers</span></code> 中的数据为 <code class="docutils literal notranslate"><span class="pre">torch.Tensor</span></code> 类型。
该类的 <code class="docutils literal notranslate"><span class="pre">_parmeters</span></code> 中的数据为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Parameter</span></code> 类型。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>norm_size</strong> – <cite>float</cite> - 归一化大小,应该等于 C * H * W。</p></li>
<li><p><strong>epsilon</strong> – <cite>float</cite> - 数值稳定性常数,默认为 1e-5。</p></li>
<li><p><strong>affine</strong> – <cite>bool</cite> - 一个布尔值,当设置为 <code class="docutils literal notranslate"><span class="pre">True</span></code> 时,此模块具有可学习的每通道仿射参数,初始化为 1(用于权重)和 0(用于偏差)。默认值:<code class="docutils literal notranslate"><span class="pre">True</span></code>。</p></li>
<li><p><strong>dtype</strong> – 参数的数据类型,defaults:None,使用默认数据类型:kfloat32,代表32位浮点数。</p></li>
<li><p><strong>name</strong> – 这个模块的名字, 默认为””。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>二维层归一化实例。</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.tensor</span><span class="w"> </span><span class="kn">import</span> <span class="n">QTensor</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.nn.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">LayerNorm2d</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="n">ic</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">test_conv</span> <span class="o">=</span> <span class="n">LayerNorm2d</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">QTensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">17</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">]),</span><span class="n">requires_grad</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">pyvqnet</span><span class="o">.</span><span class="n">kfloat32</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">test_conv</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="layernorm1d">
<h4>LayerNorm1d<a class="headerlink" href="#layernorm1d" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.nn.torch.LayerNorm1d">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.nn.torch.</span></span><span class="sig-name descname"><span class="pre">LayerNorm1d</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">norm_size</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">epsilon</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1e-5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">affine</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.nn.torch.LayerNorm1d" title="Link to this definition">¶</a></dt>
<dd><p>在 2D 输入上进行层归一化。具体方式如论文所述:
<a class="reference external" href="https://arxiv.org/abs/1607.06450">Layer Normalization</a>。</p>
<div class="math notranslate nohighlight">
\[y = \frac{x - \mathrm{E}[x]}{ \sqrt{\mathrm{Var}[x] + \epsilon}} * \gamma + \beta\]</div>
<p>均值和标准差是在最后一个维度大小上计算的,其中“norm_size” 是 <code class="docutils literal notranslate"><span class="pre">norm_size</span></code> 的值。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.nn.torch.TorchModule</span></code> ,可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
<p>该类的 <code class="docutils literal notranslate"><span class="pre">_buffers</span></code> 中的数据为 <code class="docutils literal notranslate"><span class="pre">torch.Tensor</span></code> 类型。
该类的 <code class="docutils literal notranslate"><span class="pre">_parmeters</span></code> 中的数据为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Parameter</span></code> 类型。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>norm_size</strong> – <cite>float</cite> - 归一化大小,应该等于最后一维大小。</p></li>
<li><p><strong>epsilon</strong> – <cite>float</cite> - 数值稳定性常数,默认为 1e-5。</p></li>
<li><p><strong>affine</strong> – <cite>bool</cite> - 一个布尔值,当设置为 <code class="docutils literal notranslate"><span class="pre">True</span></code> 时,此模块具有可学习的每通道仿射参数,初始化为 1(用于权重)和 0(用于偏差)。默认值:<code class="docutils literal notranslate"><span class="pre">True</span></code>。</p></li>
<li><p><strong>dtype</strong> – 参数的数据类型,defaults:None,使用默认数据类型:kfloat32,代表32位浮点数。</p></li>
<li><p><strong>name</strong> – 这个模块的名字, 默认为””。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>一维层归一化实例。</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.tensor</span><span class="w"> </span><span class="kn">import</span> <span class="n">QTensor</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.nn.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">LayerNorm1d</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="n">test_conv</span> <span class="o">=</span> <span class="n">LayerNorm1d</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">QTensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">17</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">]),</span><span class="n">requires_grad</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">pyvqnet</span><span class="o">.</span><span class="n">kfloat32</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">test_conv</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="groupnorm">
<h4>GroupNorm<a class="headerlink" href="#groupnorm" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.nn.torch.GroupNorm">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.nn.torch.</span></span><span class="sig-name descname"><span class="pre">GroupNorm</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">num_groups</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_channels</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">epsilon</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1e-5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">affine</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.nn.torch.GroupNorm" title="Link to this definition">¶</a></dt>
<dd><p>对小批量输入应用组归一化。输入: <span class="math notranslate nohighlight">\((N, C, *)\)</span> 其中 <span class="math notranslate nohighlight">\(C=\text{num_channels}\)</span> , 输出: <span class="math notranslate nohighlight">\((N, C, *)\)</span> 。</p>
<p>此层实现论文 <a class="reference external" href="https://arxiv.org/abs/1803.08494">组归一化</a> 中描述的操作。</p>
<div class="math notranslate nohighlight">
\[y = \frac{x - \mathrm{E}[x]}{ \sqrt{\mathrm{Var}[x] + \epsilon}} * \gamma + \beta\]</div>
<p>输入通道被分成 <code class="xref py py-attr docutils literal notranslate"><span class="pre">num_groups</span></code> 组,每组包含 <code class="docutils literal notranslate"><span class="pre">num_channels</span> <span class="pre">/</span> <span class="pre">num_groups</span></code> 个通道。<code class="xref py py-attr docutils literal notranslate"><span class="pre">num_channels</span></code> 必须能被 <code class="xref py py-attr docutils literal notranslate"><span class="pre">num_groups</span></code> 整除。平均值和标准差是在每个组中分别计算的。如果 <code class="xref py py-attr docutils literal notranslate"><span class="pre">affine</span></code> 为 <code class="docutils literal notranslate"><span class="pre">True</span></code>,则 <span class="math notranslate nohighlight">\(\gamma\)</span> 和 <span class="math notranslate nohighlight">\(\beta\)</span> 是可学习的。每个通道仿射变换参数向量,大小为 <code class="xref py py-attr docutils literal notranslate"><span class="pre">num_channels</span></code>。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.nn.torch.TorchModule</span></code> ,可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
<p>该类的 <code class="docutils literal notranslate"><span class="pre">_buffers</span></code> 中的数据为 <code class="docutils literal notranslate"><span class="pre">torch.Tensor</span></code> 类型。
该类的 <code class="docutils literal notranslate"><span class="pre">_parmeters</span></code> 中的数据为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Parameter</span></code> 类型。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>(</strong><strong>int</strong><strong>)</strong> (<em>num_channels</em>) – 将通道分成的组数</p></li>
<li><p><strong>(</strong><strong>int</strong><strong>)</strong> – 输入中预期的通道数</p></li>
<li><p><strong>eps</strong> – 添加到分母的值,以实现数值稳定性。默认值:1e-5</p></li>
<li><p><strong>affine</strong> – 一个布尔值,当设置为 <code class="docutils literal notranslate"><span class="pre">True</span></code> 时,此模块具有可学习的每通道仿射参数,初始化为 1(用于权重)和 0(用于偏差)。默认值: <code class="docutils literal notranslate"><span class="pre">True</span></code>。</p></li>
<li><p><strong>dtype</strong> – 参数的数据类型,defaults:None,使用默认数据类型:kfloat32,代表32位浮点数。</p></li>
<li><p><strong>name</strong> – 这个模块的名字, 默认为””。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>GroupNorm 类对象</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.tensor</span><span class="w"> </span><span class="kn">import</span> <span class="n">QTensor</span><span class="p">,</span><span class="n">kfloat32</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.nn.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">GroupNorm</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="n">test_conv</span> <span class="o">=</span> <span class="n">GroupNorm</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">QTensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">60</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">]),</span><span class="n">requires_grad</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">kfloat32</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">test_conv</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="dropout">
<h4>Dropout<a class="headerlink" href="#dropout" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.nn.torch.Dropout">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.nn.torch.</span></span><span class="sig-name descname"><span class="pre">Dropout</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dropout_rate</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.5</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.nn.torch.Dropout" title="Link to this definition">¶</a></dt>
<dd><p>Dropout 模块。dropout 模块将一些单元的输出随机设置为零,同时根据给定的 dropout_rate 概率升级其他单元。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.nn.torch.TorchModule</span></code> ,可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dropout_rate</strong> – <cite>float</cite> - 神经元被设置为零的概率。</p></li>
<li><p><strong>name</strong> – 这个模块的名字, 默认为””。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Dropout实例。</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.nn.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dropout</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.tensor</span><span class="w"> </span><span class="kn">import</span> <span class="n">arange</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">ic</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">ic</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="mf">2.0</span><span class="p">,</span>
                    <span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">ic</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="n">b</span><span class="p">,</span> <span class="n">ic</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="n">droplayer</span> <span class="o">=</span> <span class="n">Dropout</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">droplayer</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">droplayer</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="droppath">
<h4>DropPath<a class="headerlink" href="#droppath" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.nn.torch.DropPath">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.nn.torch.</span></span><span class="sig-name descname"><span class="pre">DropPath</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dropout_rate</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.nn.torch.DropPath" title="Link to this definition">¶</a></dt>
<dd><p>DropPath 模块将逐样本丢弃路径(随机深度)。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.nn.torch.TorchModule</span></code> ,可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dropout_rate</strong> – <cite>float</cite> - 神经元被设置为零的概率。</p></li>
<li><p><strong>name</strong> – 这个模块的名字, 默认为””。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>DropPath实例。</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet.nn.torch</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">nn</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet.tensor</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">tensor</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">tensor</span><span class="o">.</span><span class="n">randu</span><span class="p">([</span><span class="mi">4</span><span class="p">])</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">DropPath</span><span class="p">()(</span><span class="n">x</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<span class="c1">#[0.2008128,0.3908308,0.7102265,0.3784221]</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="pixel-shuffle">
<h4>Pixel_Shuffle<a class="headerlink" href="#pixel-shuffle" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.nn.torch.Pixel_Shuffle">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.nn.torch.</span></span><span class="sig-name descname"><span class="pre">Pixel_Shuffle</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">upscale_factors</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.nn.torch.Pixel_Shuffle" title="Link to this definition">¶</a></dt>
<dd><p>重新排列形状为:(<em>, C * r^2, H, W)  的张量
到形状为 (</em>, C, H * r, W * r) 的张量,其中 r 是尺度变换因子。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.nn.torch.TorchModule</span></code> ,可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>upscale_factors</strong> – 增加尺度变换的因子</p></li>
<li><p><strong>name</strong> – 这个模块的名字, 默认为””。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Pixel_Shuffle 模块</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.nn.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">Pixel_Shuffle</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.tensor</span><span class="w"> </span><span class="kn">import</span> <span class="n">tensor</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="n">ps</span> <span class="o">=</span> <span class="n">Pixel_Shuffle</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">inx</span> <span class="o">=</span> <span class="n">tensor</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">18</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">])</span>
<span class="n">inx</span><span class="o">.</span><span class="n">requires_grad</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">ps</span><span class="p">(</span><span class="n">inx</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="pixel-unshuffle">
<h4>Pixel_Unshuffle<a class="headerlink" href="#pixel-unshuffle" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.nn.torch.Pixel_Unshuffle">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.nn.torch.</span></span><span class="sig-name descname"><span class="pre">Pixel_Unshuffle</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">downscale_factors</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.nn.torch.Pixel_Unshuffle" title="Link to this definition">¶</a></dt>
<dd><p>通过重新排列元素来反转 Pixel_Shuffle 操作. 将 (<em>, C, H * r, W * r) 形状的张量变化为 (</em>, C * r^2, H, W) ,其中 r 是缩小因子。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.nn.torch.TorchModule</span></code> ,可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>downscale_factors</strong> – 增加尺度变换的因子</p></li>
<li><p><strong>name</strong> – 这个模块的名字, 默认为””。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Pixel_Unshuffle 模块</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.nn.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">Pixel_Unshuffle</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.tensor</span><span class="w"> </span><span class="kn">import</span> <span class="n">tensor</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="n">ps</span> <span class="o">=</span> <span class="n">Pixel_Unshuffle</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">inx</span> <span class="o">=</span> <span class="n">tensor</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">])</span>
<span class="n">inx</span><span class="o">.</span><span class="n">requires_grad</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">ps</span><span class="p">(</span><span class="n">inx</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="gru">
<h4>GRU<a class="headerlink" href="#gru" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.nn.torch.GRU">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.nn.torch.</span></span><span class="sig-name descname"><span class="pre">GRU</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_size</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hidden_size</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_layers</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nonlinearity</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'tanh'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_first</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_bias</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bidirectional</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.nn.torch.GRU" title="Link to this definition">¶</a></dt>
<dd><p>门控循环单元 (GRU) 模块。支持多层堆叠,双向配置。单层单向GRU的计算公式如下:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}{ll}
    r_t = \sigma(W_{ir} x_t + b_{ir} + W_{hr} h_{(t-1)} + b_{hr}) \\
    z_t = \sigma(W_{iz} x_t + b_{iz} + W_{hz} h_{(t-1)} + b_{hz}) \\
    n_t = \tanh(W_{in} x_t + b_{in} + r_t * (W_{hn} h_{(t-1)}+ b_{hn})) \\
    h_t = (1 - z_t) * n_t + z_t * h_{(t-1)}
\end{array}\end{split}\]</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.nn.torch.TorchModule</span></code> ,可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
<p>该类的 <code class="docutils literal notranslate"><span class="pre">_buffers</span></code> 中的数据为 <code class="docutils literal notranslate"><span class="pre">torch.Tensor</span></code> 类型。
该类的 <code class="docutils literal notranslate"><span class="pre">_parmeters</span></code> 中的数据为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Parameter</span></code> 类型。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>input_size</strong> – 输入特征维度。</p></li>
<li><p><strong>hidden_size</strong> – 隐藏特征维度。</p></li>
<li><p><strong>num_layers</strong> – 堆叠GRU层数, 默认: 1。</p></li>
<li><p><strong>batch_first</strong> – 如果为 True, 则输入形状为 [batch_size,seq_len,feature_dim],
如果为 False, 则输入形状为 [seq_len,batch_size,feature_dim],默认为 True。</p></li>
<li><p><strong>use_bias</strong> – 如果为 False,该模块不适用偏置项,默认: True。</p></li>
<li><p><strong>bidirectional</strong> – 如果为 True, 变为双向GRU, 默认: False。</p></li>
<li><p><strong>dtype</strong> – 参数的数据类型,defaults:None,使用默认数据类型:kfloat32,代表32位浮点数。</p></li>
<li><p><strong>name</strong> – 这个模块的名字, 默认为””。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>GRU 实例</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.nn.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">GRU</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.tensor</span><span class="w"> </span><span class="kn">import</span> <span class="n">tensor</span>

<span class="n">rnn2</span> <span class="o">=</span> <span class="n">GRU</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">batch_first</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bidirectional</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nb">input</span> <span class="o">=</span> <span class="n">tensor</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
<span class="n">h0</span> <span class="o">=</span> <span class="n">tensor</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>

<span class="n">output</span><span class="p">,</span> <span class="n">hn</span> <span class="o">=</span> <span class="n">rnn2</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">h0</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="rnn">
<h4>RNN<a class="headerlink" href="#rnn" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.nn.torch.RNN">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.nn.torch.</span></span><span class="sig-name descname"><span class="pre">RNN</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_size</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hidden_size</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_layers</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nonlinearity</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'tanh'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_first</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_bias</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bidirectional</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.nn.torch.RNN" title="Link to this definition">¶</a></dt>
<dd><p>循环神经网络(RNN)模块,使用 <span class="math notranslate nohighlight">\(\tanh\)</span> 或 <span class="math notranslate nohighlight">\(\text{ReLU}\)</span> 作为激活函数。支持双向,多层配置。
单层单向RNN计算公式如下:</p>
<div class="math notranslate nohighlight">
\[h_t = \tanh(W_{ih} x_t + b_{ih} + W_{hh} h_{(t-1)} + b_{hh})\]</div>
<p>如果 <code class="xref py py-attr docutils literal notranslate"><span class="pre">nonlinearity</span></code> 是 <code class="docutils literal notranslate"><span class="pre">'relu'</span></code>, 则 <span class="math notranslate nohighlight">\(\text{ReLU}\)</span> 将替代 <span class="math notranslate nohighlight">\(\tanh\)</span>。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.nn.torch.TorchModule</span></code> ,可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
<p>该类的 <code class="docutils literal notranslate"><span class="pre">_buffers</span></code> 中的数据为 <code class="docutils literal notranslate"><span class="pre">torch.Tensor</span></code> 类型。
该类的 <code class="docutils literal notranslate"><span class="pre">_parmeters</span></code> 中的数据为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Parameter</span></code> 类型。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>input_size</strong> – 输入特征维度。</p></li>
<li><p><strong>hidden_size</strong> – 隐藏特征维度。</p></li>
<li><p><strong>num_layers</strong> – 堆叠RNN层数, 默认: 1。</p></li>
<li><p><strong>nonlinearity</strong> – 非线性激活函数,默认为 <code class="docutils literal notranslate"><span class="pre">'tanh'</span></code>。</p></li>
<li><p><strong>batch_first</strong> – 如果为 True, 则输入形状为 [batch_size,seq_len,feature_dim],
如果为 False, 则输入形状为 [seq_len,batch_size,feature_dim],默认为 True。</p></li>
<li><p><strong>use_bias</strong> – 如果为 False, 该模块不适用偏置项,默认: True。</p></li>
<li><p><strong>bidirectional</strong> – 如果为 True,变为双向RNN,默认: False。</p></li>
<li><p><strong>dtype</strong> – 参数的数据类型,defaults:None,使用默认数据类型:kfloat32,代表32位浮点数。</p></li>
<li><p><strong>name</strong> – 这个模块的名字, 默认为””。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>RNN 实例</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.nn.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">RNN</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.tensor</span><span class="w"> </span><span class="kn">import</span> <span class="n">tensor</span>

<span class="n">rnn2</span> <span class="o">=</span> <span class="n">RNN</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">batch_first</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bidirectional</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

<span class="nb">input</span> <span class="o">=</span> <span class="n">tensor</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
<span class="n">h0</span> <span class="o">=</span> <span class="n">tensor</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>
<span class="n">output</span><span class="p">,</span> <span class="n">hn</span> <span class="o">=</span> <span class="n">rnn2</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">h0</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="lstm">
<h4>LSTM<a class="headerlink" href="#lstm" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.nn.torch.LSTM">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.nn.torch.</span></span><span class="sig-name descname"><span class="pre">LSTM</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_size</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hidden_size</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_layers</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_first</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_bias</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bidirectional</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.nn.torch.LSTM" title="Link to this definition">¶</a></dt>
<dd><p>长短期记忆(LSTM)模块。支持双向LSTM, 堆叠多层LSTM等配置。单层单向LSTM计算公式如下:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}{ll} \\
    i_t = \sigma(W_{ii} x_t + b_{ii} + W_{hi} h_{t-1} + b_{hi}) \\
    f_t = \sigma(W_{if} x_t + b_{if} + W_{hf} h_{t-1} + b_{hf}) \\
    g_t = \tanh(W_{ig} x_t + b_{ig} + W_{hg} h_{t-1} + b_{hg}) \\
    o_t = \sigma(W_{io} x_t + b_{io} + W_{ho} h_{t-1} + b_{ho}) \\
    c_t = f_t \odot c_{t-1} + i_t \odot g_t \\
    h_t = o_t \odot \tanh(c_t) \\
\end{array}\end{split}\]</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.nn.torch.TorchModule</span></code> ,可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
<p>该类的 <code class="docutils literal notranslate"><span class="pre">_buffers</span></code> 中的数据为 <code class="docutils literal notranslate"><span class="pre">torch.Tensor</span></code> 类型。
该类的 <code class="docutils literal notranslate"><span class="pre">_parmeters</span></code> 中的数据为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Parameter</span></code> 类型。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>input_size</strong> – 输入特征维度。</p></li>
<li><p><strong>hidden_size</strong> – 隐藏特征维度。</p></li>
<li><p><strong>num_layers</strong> – 堆叠LSTM层数,默认: 1。</p></li>
<li><p><strong>batch_first</strong> – 如果为 True,则输入形状为 [batch_size,seq_len,feature_dim],
如果为 False, 则输入形状为 [seq_len,batch_size,feature_dim],默认为 True。</p></li>
<li><p><strong>use_bias</strong> – 如果为 False,该模块不适用偏置项, 默认: True。</p></li>
<li><p><strong>bidirectional</strong> – 如果为 True,变为双向LSTM, 默认: False。</p></li>
<li><p><strong>dtype</strong> – 参数的数据类型,defaults:None,使用默认数据类型:kfloat32,代表32位浮点数。</p></li>
<li><p><strong>name</strong> – 这个模块的名字, 默认为””。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>LSTM 实例</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.nn.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">LSTM</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.tensor</span><span class="w"> </span><span class="kn">import</span> <span class="n">tensor</span>

<span class="n">rnn2</span> <span class="o">=</span> <span class="n">LSTM</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">batch_first</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bidirectional</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

<span class="nb">input</span> <span class="o">=</span> <span class="n">tensor</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
<span class="n">h0</span> <span class="o">=</span> <span class="n">tensor</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>
<span class="n">c0</span> <span class="o">=</span> <span class="n">tensor</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>
<span class="n">output</span><span class="p">,</span> <span class="p">(</span><span class="n">hn</span><span class="p">,</span> <span class="n">cn</span><span class="p">)</span> <span class="o">=</span> <span class="n">rnn2</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="p">(</span><span class="n">h0</span><span class="p">,</span> <span class="n">c0</span><span class="p">))</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="dynamic-gru">
<h4>Dynamic_GRU<a class="headerlink" href="#dynamic-gru" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.nn.torch.Dynamic_GRU">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.nn.torch.</span></span><span class="sig-name descname"><span class="pre">Dynamic_GRU</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_size</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hidden_size</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_layers</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_first</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_bias</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bidirectional</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.nn.torch.Dynamic_GRU" title="Link to this definition">¶</a></dt>
<dd><p>将多层门控循环单元 (GRU) RNN 应用于动态长度输入序列。</p>
<p>第一个输入应该是定义了可变长度的批处理序列输入
通过 <code class="docutils literal notranslate"><span class="pre">tensor.PackedSequence</span></code> 类。
<code class="docutils literal notranslate"><span class="pre">tensor.PackedSequence</span></code> 类可以构造为
连续调用下一个函数: <code class="docutils literal notranslate"><span class="pre">pad_sequence</span></code> 、 <code class="docutils literal notranslate"><span class="pre">pack_pad_sequence</span></code>。</p>
<p>Dynamic_GRU 的第一个输出也是一个 <code class="docutils literal notranslate"><span class="pre">tensor.PackedSequence</span></code> 类,
可以使用 <code class="docutils literal notranslate"><span class="pre">tensor.pad_pack_sequence</span></code> 将其解压缩为普通 QTensor。</p>
<p>对于输入序列中的每个元素,每一层计算以下公式:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}{ll}
    r_t = \sigma(W_{ir} x_t + b_{ir} + W_{hr} h_{(t-1)} + b_{hr}) \\
    z_t = \sigma(W_{iz} x_t + b_{iz} + W_{hz} h_{(t-1)} + b_{hz}) \\
    n_t = \tanh(W_{in} x_t + b_{in} + r_t * (W_{hn} h_{(t-1)}+ b_{hn})) \\
    h_t = (1 - z_t) * n_t + z_t * h_{(t-1)}
\end{array}\end{split}\]</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.nn.torch.TorchModule</span></code> ,可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
<p>该类的 <code class="docutils literal notranslate"><span class="pre">_buffers</span></code> 中的数据为 <code class="docutils literal notranslate"><span class="pre">torch.Tensor</span></code> 类型。
该类的 <code class="docutils literal notranslate"><span class="pre">_parmeters</span></code> 中的数据为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Parameter</span></code> 类型。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>input_size</strong> – 输入特征维度。</p></li>
<li><p><strong>hidden_size</strong> – 隐藏的特征维度。</p></li>
<li><p><strong>num_layers</strong> – 循环层数。 默认值:1</p></li>
<li><p><strong>batch_first</strong> – 如果为 True,输入形状提供为 [批大小,序列长度,特征维度]。如果为 False,输入形状提供为 [序列长度,批大小,特征维度],默认为 True。</p></li>
<li><p><strong>use_bias</strong> – 如果为False,则该层不使用偏置权重b_ih和b_hh。 默认值:True。</p></li>
<li><p><strong>bidirectional</strong> – 如果为真,则成为双向 GRU。 默认值:False。</p></li>
<li><p><strong>dtype</strong> – 参数的数据类型,defaults:None,使用默认数据类型:kfloat32,代表32位浮点数。</p></li>
<li><p><strong>name</strong> – 这个模块的名字, 默认为””。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>一个 Dynamic_GRU 类</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.nn.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dynamic_GRU</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.tensor</span><span class="w"> </span><span class="kn">import</span> <span class="n">tensor</span>
<span class="n">seq_len</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
<span class="n">input_size</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">batch_size</span> <span class="o">=</span><span class="mi">3</span>
<span class="n">hidden_size</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">ml</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">rnn2</span> <span class="o">=</span> <span class="n">Dynamic_GRU</span><span class="p">(</span><span class="n">input_size</span><span class="p">,</span>
                <span class="n">hidden_size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                <span class="n">num_layers</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                <span class="n">batch_first</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">bidirectional</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">tensor</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">seq_len</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">input_size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
    <span class="p">[</span><span class="n">seq_len</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">input_size</span><span class="p">])</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">tensor</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">seq_len</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">input_size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
    <span class="p">[</span><span class="n">seq_len</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">input_size</span><span class="p">])</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">tensor</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">seq_len</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">input_size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
    <span class="p">[</span><span class="n">seq_len</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">input_size</span><span class="p">])</span>

<span class="n">y</span> <span class="o">=</span> <span class="n">tensor</span><span class="o">.</span><span class="n">pad_sequence</span><span class="p">([</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">],</span> <span class="kc">False</span><span class="p">)</span>

<span class="nb">input</span> <span class="o">=</span> <span class="n">tensor</span><span class="o">.</span><span class="n">pack_pad_sequence</span><span class="p">(</span><span class="n">y</span><span class="p">,</span>
                                <span class="n">seq_len</span><span class="p">,</span>
                                <span class="n">batch_first</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                <span class="n">enforce_sorted</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">h0</span> <span class="o">=</span> <span class="n">tensor</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="n">ml</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">])</span>

<span class="n">output</span><span class="p">,</span> <span class="n">hn</span> <span class="o">=</span> <span class="n">rnn2</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">h0</span><span class="p">)</span>

<span class="n">seq_unpacked</span><span class="p">,</span> <span class="n">lens_unpacked</span> <span class="o">=</span> \
<span class="n">tensor</span><span class="o">.</span><span class="n">pad_packed_sequence</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">batch_first</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="dynamic-rnn">
<h4>Dynamic_RNN<a class="headerlink" href="#dynamic-rnn" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.nn.torch.Dynamic_RNN">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.nn.torch.</span></span><span class="sig-name descname"><span class="pre">Dynamic_RNN</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_size</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hidden_size</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_layers</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nonlinearity</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'tanh'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_first</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_bias</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bidirectional</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.nn.torch.Dynamic_RNN" title="Link to this definition">¶</a></dt>
<dd><p>将循环神经网络 RNN 应用于动态长度输入序列。</p>
<p>第一个输入应该是定义了可变长度的批处理序列输入
通过 <code class="docutils literal notranslate"><span class="pre">tensor.PackedSequence</span></code> 类。
<code class="docutils literal notranslate"><span class="pre">tensor.PackedSequence</span></code> 类可以构造为
连续调用下一个函数: <code class="docutils literal notranslate"><span class="pre">pad_sequence</span></code> 、 <code class="docutils literal notranslate"><span class="pre">pack_pad_sequence</span></code>。</p>
<p>Dynamic_RNN 的第一个输出也是一个 <code class="docutils literal notranslate"><span class="pre">tensor.PackedSequence</span></code> 类,
可以使用 <code class="docutils literal notranslate"><span class="pre">tensor.pad_pack_sequence</span></code> 将其解压缩为普通 QTensor。</p>
<p>循环神经网络(RNN)模块,使用 <span class="math notranslate nohighlight">\(\tanh\)</span> 或 <span class="math notranslate nohighlight">\(\text{ReLU}\)</span> 作为激活函数。支持双向,多层配置。
单层单向RNN计算公式如下:</p>
<div class="math notranslate nohighlight">
\[h_t = \tanh(W_{ih} x_t + b_{ih} + W_{hh} h_{(t-1)} + b_{hh})\]</div>
<p>如果 <code class="xref py py-attr docutils literal notranslate"><span class="pre">nonlinearity</span></code> 是 <code class="docutils literal notranslate"><span class="pre">'relu'</span></code>, 则 <span class="math notranslate nohighlight">\(\text{ReLU}\)</span> 将替代 <span class="math notranslate nohighlight">\(\tanh\)</span>。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.nn.torch.TorchModule</span></code> ,可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
<p>该类的 <code class="docutils literal notranslate"><span class="pre">_buffers</span></code> 中的数据为 <code class="docutils literal notranslate"><span class="pre">torch.Tensor</span></code> 类型。
该类的 <code class="docutils literal notranslate"><span class="pre">_parmeters</span></code> 中的数据为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Parameter</span></code> 类型。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>input_size</strong> – 输入特征维度。</p></li>
<li><p><strong>hidden_size</strong> – 隐藏特征维度。</p></li>
<li><p><strong>num_layers</strong> – 堆叠RNN层数, 默认: 1。</p></li>
<li><p><strong>nonlinearity</strong> – 非线性激活函数,默认为 <code class="docutils literal notranslate"><span class="pre">'tanh'</span></code>。</p></li>
<li><p><strong>batch_first</strong> – 如果为 True, 则输入形状为 [批大小,序列长度,特征维度],
如果为 False, 则输入形状为 [序列长度,批大小,特征维度],默认为 True。</p></li>
<li><p><strong>use_bias</strong> – 如果为 False, 该模块不适用偏置项,默认: True。</p></li>
<li><p><strong>bidirectional</strong> – 如果为 True,变为双向RNN,默认: False。</p></li>
<li><p><strong>dtype</strong> – 参数的数据类型,defaults:None,使用默认数据类型:kfloat32,代表32位浮点数。</p></li>
<li><p><strong>name</strong> – 这个模块的名字, 默认为””。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Dynamic_RNN 实例</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.nn.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dynamic_RNN</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.tensor</span><span class="w"> </span><span class="kn">import</span> <span class="n">tensor</span>
<span class="n">seq_len</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
<span class="n">input_size</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">batch_size</span> <span class="o">=</span><span class="mi">3</span>
<span class="n">hidden_size</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">ml</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">rnn2</span> <span class="o">=</span> <span class="n">Dynamic_RNN</span><span class="p">(</span><span class="n">input_size</span><span class="p">,</span>
                <span class="n">hidden_size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                <span class="n">num_layers</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                <span class="n">batch_first</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">bidirectional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">nonlinearity</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">)</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">tensor</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">seq_len</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">input_size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
    <span class="p">[</span><span class="n">seq_len</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">input_size</span><span class="p">])</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">tensor</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">seq_len</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">input_size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
    <span class="p">[</span><span class="n">seq_len</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">input_size</span><span class="p">])</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">tensor</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">seq_len</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">input_size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
    <span class="p">[</span><span class="n">seq_len</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">input_size</span><span class="p">])</span>

<span class="n">y</span> <span class="o">=</span> <span class="n">tensor</span><span class="o">.</span><span class="n">pad_sequence</span><span class="p">([</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">],</span> <span class="kc">False</span><span class="p">)</span>

<span class="nb">input</span> <span class="o">=</span> <span class="n">tensor</span><span class="o">.</span><span class="n">pack_pad_sequence</span><span class="p">(</span><span class="n">y</span><span class="p">,</span>
                                <span class="n">seq_len</span><span class="p">,</span>
                                <span class="n">batch_first</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                <span class="n">enforce_sorted</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">h0</span> <span class="o">=</span> <span class="n">tensor</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="n">ml</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">])</span>

<span class="n">output</span><span class="p">,</span> <span class="n">hn</span> <span class="o">=</span> <span class="n">rnn2</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">h0</span><span class="p">)</span>

<span class="n">seq_unpacked</span><span class="p">,</span> <span class="n">lens_unpacked</span> <span class="o">=</span> \
<span class="n">tensor</span><span class="o">.</span><span class="n">pad_packed_sequence</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">batch_first</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="dynamic-lstm">
<h4>Dynamic_LSTM<a class="headerlink" href="#dynamic-lstm" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.nn.torch.Dynamic_LSTM">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.nn.torch.</span></span><span class="sig-name descname"><span class="pre">Dynamic_LSTM</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_size</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hidden_size</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_layers</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_first</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_bias</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bidirectional</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.nn.torch.Dynamic_LSTM" title="Link to this definition">¶</a></dt>
<dd><p>将长短期记忆(LSTM) RNN 应用于动态长度输入序列。</p>
<p>第一个输入应该是定义了可变长度的批处理序列输入
通过 <code class="docutils literal notranslate"><span class="pre">tensor.PackedSequence</span></code> 类。
<code class="docutils literal notranslate"><span class="pre">tensor.PackedSequence</span></code> 类可以构造为
连续调用下一个函数: <code class="docutils literal notranslate"><span class="pre">pad_sequence</span></code> 、 <code class="docutils literal notranslate"><span class="pre">pack_pad_sequence</span></code>。</p>
<p>Dynamic_LSTM 的第一个输出也是一个 <code class="docutils literal notranslate"><span class="pre">tensor.PackedSequence</span></code> 类,
可以使用 <code class="docutils literal notranslate"><span class="pre">tensor.pad_pack_sequence</span></code> 将其解压缩为普通 QTensor。</p>
<p>循环神经网络(RNN)模块,使用 <span class="math notranslate nohighlight">\(\tanh\)</span> 或 <span class="math notranslate nohighlight">\(\text{ReLU}\)</span> 作为激活函数。支持双向,多层配置。
单层单向RNN计算公式如下:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}{ll} \\
    i_t = \sigma(W_{ii} x_t + b_{ii} + W_{hi} h_{t-1} + b_{hi}) \\
    f_t = \sigma(W_{if} x_t + b_{if} + W_{hf} h_{t-1} + b_{hf}) \\
    g_t = \tanh(W_{ig} x_t + b_{ig} + W_{hg} h_{t-1} + b_{hg}) \\
    o_t = \sigma(W_{io} x_t + b_{io} + W_{ho} h_{t-1} + b_{ho}) \\
    c_t = f_t \odot c_{t-1} + i_t \odot g_t \\
    h_t = o_t \odot \tanh(c_t) \\
\end{array}\end{split}\]</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.nn.torch.TorchModule</span></code> ,可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
<p>该类的 <code class="docutils literal notranslate"><span class="pre">_buffers</span></code> 中的数据为 <code class="docutils literal notranslate"><span class="pre">torch.Tensor</span></code> 类型。
该类的 <code class="docutils literal notranslate"><span class="pre">_parmeters</span></code> 中的数据为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Parameter</span></code> 类型。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>input_size</strong> – 输入特征维度。</p></li>
<li><p><strong>hidden_size</strong> – 隐藏特征维度。</p></li>
<li><p><strong>num_layers</strong> – 堆叠LSTM层数,默认: 1。</p></li>
<li><p><strong>batch_first</strong> – 如果为 True,则输入形状为 [批大小,序列长度,特征维度],
如果为 False, 则输入形状为 [序列长度,批大小,特征维度],默认为 True。</p></li>
<li><p><strong>use_bias</strong> – 如果为 False,该模块不适用偏置项, 默认: True。</p></li>
<li><p><strong>bidirectional</strong> – 如果为 True,变为双向LSTM, 默认: False。</p></li>
<li><p><strong>dtype</strong> – 参数的数据类型,defaults:None,使用默认数据类型:kfloat32,代表32位浮点数。</p></li>
<li><p><strong>name</strong> – 这个模块的名字, 默认为””。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Dynamic_LSTM 实例</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.nn.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dynamic_LSTM</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.tensor</span><span class="w"> </span><span class="kn">import</span> <span class="n">tensor</span>

<span class="n">input_size</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">hidden_size</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">ml</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">seq_len</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">batch_size</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">rnn2</span> <span class="o">=</span> <span class="n">Dynamic_LSTM</span><span class="p">(</span><span class="n">input_size</span><span class="p">,</span>
                    <span class="n">hidden_size</span><span class="o">=</span><span class="n">hidden_size</span><span class="p">,</span>
                    <span class="n">num_layers</span><span class="o">=</span><span class="n">ml</span><span class="p">,</span>
                    <span class="n">batch_first</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">bidirectional</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">tensor</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">seq_len</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">input_size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
    <span class="p">[</span><span class="n">seq_len</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">input_size</span><span class="p">])</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">tensor</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">seq_len</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">input_size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
    <span class="p">[</span><span class="n">seq_len</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">input_size</span><span class="p">])</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">tensor</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">seq_len</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">input_size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
    <span class="p">[</span><span class="n">seq_len</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">input_size</span><span class="p">])</span>
<span class="n">a</span><span class="o">.</span><span class="n">requires_grad</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">b</span><span class="o">.</span><span class="n">requires_grad</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">c</span><span class="o">.</span><span class="n">requires_grad</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">tensor</span><span class="o">.</span><span class="n">pad_sequence</span><span class="p">([</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">],</span> <span class="kc">False</span><span class="p">)</span>

<span class="nb">input</span> <span class="o">=</span> <span class="n">tensor</span><span class="o">.</span><span class="n">pack_pad_sequence</span><span class="p">(</span><span class="n">y</span><span class="p">,</span>
                                <span class="n">seq_len</span><span class="p">,</span>
                                <span class="n">batch_first</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                <span class="n">enforce_sorted</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">h0</span> <span class="o">=</span> <span class="n">tensor</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="n">ml</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">])</span>
<span class="n">c0</span> <span class="o">=</span> <span class="n">tensor</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="n">ml</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">])</span>

<span class="n">output</span><span class="p">,</span> <span class="p">(</span><span class="n">hn</span><span class="p">,</span> <span class="n">cn</span><span class="p">)</span> <span class="o">=</span> <span class="n">rnn2</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="p">(</span><span class="n">h0</span><span class="p">,</span> <span class="n">c0</span><span class="p">))</span>

<span class="n">seq_unpacked</span><span class="p">,</span> <span class="n">lens_unpacked</span> <span class="o">=</span> \
<span class="n">tensor</span><span class="o">.</span><span class="n">pad_packed_sequence</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">batch_first</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="interpolate">
<h4>Interpolate<a class="headerlink" href="#interpolate" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.nn.torch.Interpolate">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.nn.torch.</span></span><span class="sig-name descname"><span class="pre">Interpolate</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scale_factor</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mode</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'nearest'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">align_corners</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">recompute_scale_factor</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.nn.torch.Interpolate" title="Link to this definition">¶</a></dt>
<dd><p>向下/向上对输入进行采样。</p>
<p>目前只支持四维输入数据。</p>
<p>输入尺寸的解释形式为 <cite>B x C x H x W</cite>。</p>
<p>可用于选择的 <cite>mode</cite> 有 <code class="docutils literal notranslate"><span class="pre">nearest</span></code> 、<code class="docutils literal notranslate"><span class="pre">bilinear</span></code> 、<code class="docutils literal notranslate"><span class="pre">bicubic</span></code>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.nn.torch.TorchModule</span></code> ,可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>size</strong> – 输出大小,默认为None。</p></li>
<li><p><strong>scale_factor</strong> – 缩放因子,默认为None。</p></li>
<li><p><strong>mode</strong> – 用于上采样的算法  <code class="docutils literal notranslate"><span class="pre">nearest</span></code> | <code class="docutils literal notranslate"><span class="pre">bilinear</span></code> | <code class="docutils literal notranslate"><span class="pre">bicubic</span></code>.</p></li>
<li><p><strong>align_corners</strong> – 从几何学角度看,我们将输入和输出的像素点视为方形而不是点。输入和输出的像素点视为正方形,而不是点。
如果设置为 <cite>true</cite>,输入和输出张量将根据其角像素的中心点对齐。角像素的中心点对齐,保留角像素的值。
如果设置为 <cite>false</cite>,输入和输出张量将按其角像素的角点对齐,而角像素的值将保留。角像素的角点对齐,插值会使用边缘值填充
对超出边界的值进行填充,从而使此操作与输入大小无关。
当 <code class="docutils literal notranslate"><span class="pre">scale_factor</span></code> 保持不变时。这只有在 <code class="docutils literal notranslate"><span class="pre">mode</span></code> 为 <code class="docutils literal notranslate"><span class="pre">bilinear</span></code> 时才有效。</p></li>
<li><p><strong>recompute_scale_factor</strong> – 重新计算缩放因子,以便在插值计算中使用。 当 <code class="docutils literal notranslate"><span class="pre">scale_factor</span></code> 作为参数传递时,它将用于来计算输出尺寸。</p></li>
<li><p><strong>name</strong> – 模块名字.</p></li>
</ul>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.nn.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">Interpolate</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.tensor</span><span class="w"> </span><span class="kn">import</span> <span class="n">tensor</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">set_random_seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">mode_</span> <span class="o">=</span> <span class="s2">&quot;bilinear&quot;</span>
<span class="n">size_</span> <span class="o">=</span> <span class="mi">3</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">Interpolate</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">size_</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode_</span><span class="p">)</span>
<span class="n">input_vqnet</span> <span class="o">=</span> <span class="n">tensor</span><span class="o">.</span><span class="n">randu</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
                        <span class="n">dtype</span><span class="o">=</span><span class="n">pyvqnet</span><span class="o">.</span><span class="n">kfloat32</span><span class="p">,</span>
                        <span class="n">requires_grad</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">output_vqnet</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">input_vqnet</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="sdpa">
<h4>SDPA<a class="headerlink" href="#sdpa" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.nn.torch.SDPA">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.nn.torch.</span></span><span class="sig-name descname"><span class="pre">SDPA</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">attn_mask</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dropout_p</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scale</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">is_causal</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.nn.torch.SDPA" title="Link to this definition">¶</a></dt>
<dd><p>构造计算查询、键和值张量的缩放点积注意力的类。如果输入为cpu下的QTensor,则使用数学公式计算, 如果输入在gpu下QTensor,则使用flash-attention方法计算。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.nn.torch.TorchModule</span></code> ,可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>attn_mask</strong> – 注意掩码；默认值: 无。shape 必须可广播到注意权重的形状。</p></li>
<li><p><strong>dropout_p</strong> – Dropout 概率；默认值: 0,如果大于 0.0,则应用 dropout。</p></li>
<li><p><strong>scale</strong> – 在 softmax 之前应用的缩放因子,默认值: 无。</p></li>
<li><p><strong>is_causal</strong> – 默认值: False,如果设置为 true,则当掩码为方阵时,注意掩码为下三角矩阵。如果同时设置了 attn_mask 和 is_causal,则会引发错误。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>一个SDPA类</p>
</dd>
</dl>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.nn.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">SDPA</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet</span><span class="w"> </span><span class="kn">import</span> <span class="n">tensor</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">SDPA</span><span class="p">(</span><span class="n">tensor</span><span class="o">.</span><span class="n">QTensor</span><span class="p">([</span><span class="mf">1.</span><span class="p">]))</span>
</pre></div>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="pyvqnet.nn.torch.SDPA.forward">
<span class="sig-name descname"><span class="pre">forward</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">query</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">key</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.nn.torch.SDPA.forward" title="Link to this definition">¶</a></dt>
<dd><p>进行前向计算,如果输入为cpu下的QTensor,则使用数学公式计算, 如果输入在gpu下QTensor,则使用flash-attention方法计算。</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>query</strong> – query输入QTensor。</p></li>
<li><p><strong>key</strong> – key输入QTensor。</p></li>
<li><p><strong>value</strong> – key输入QTensor。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>SDPA计算返回的QTensor。</p>
</dd>
</dl>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.nn.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">SDPA</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet</span><span class="w"> </span><span class="kn">import</span> <span class="n">tensor</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">SDPA</span><span class="p">(</span><span class="n">tensor</span><span class="o">.</span><span class="n">QTensor</span><span class="p">([</span><span class="mf">1.</span><span class="p">]))</span>

<span class="n">query_np</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="n">key_np</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="n">value_np</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

<span class="n">query_p</span> <span class="o">=</span> <span class="n">tensor</span><span class="o">.</span><span class="n">QTensor</span><span class="p">(</span><span class="n">query_np</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">pyvqnet</span><span class="o">.</span><span class="n">kfloat32</span><span class="p">,</span> <span class="n">requires_grad</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">key_p</span> <span class="o">=</span> <span class="n">tensor</span><span class="o">.</span><span class="n">QTensor</span><span class="p">(</span><span class="n">key_np</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">pyvqnet</span><span class="o">.</span><span class="n">kfloat32</span><span class="p">,</span> <span class="n">requires_grad</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">value_p</span> <span class="o">=</span> <span class="n">tensor</span><span class="o">.</span><span class="n">QTensor</span><span class="p">(</span><span class="n">value_np</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">pyvqnet</span><span class="o">.</span><span class="n">kfloat32</span><span class="p">,</span> <span class="n">requires_grad</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">out_sdpa</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">query_p</span><span class="p">,</span> <span class="n">key_p</span><span class="p">,</span> <span class="n">value_p</span><span class="p">)</span>

<span class="n">out_sdpa</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

</section>
</section>
<section id="id6">
<h3>损失函数接口<a class="headerlink" href="#id6" title="Link to this heading">¶</a></h3>
<section id="meansquarederror">
<h4>MeanSquaredError<a class="headerlink" href="#meansquarederror" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.nn.torch.MeanSquaredError">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.nn.torch.</span></span><span class="sig-name descname"><span class="pre">MeanSquaredError</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.nn.torch.MeanSquaredError" title="Link to this definition">¶</a></dt>
<dd><p>计算输入 <span class="math notranslate nohighlight">\(x\)</span> 和目标值 <span class="math notranslate nohighlight">\(y\)</span> 之间的均方根误差。</p>
<p>若平方根误差可由如下函数描述:</p>
<div class="math notranslate nohighlight">
\[\ell(x, y) = L = \{l_1,\dots,l_N\}^\top, \quad
l_n = \left( x_n - y_n \right)^2,\]</div>
<p><span class="math notranslate nohighlight">\(x\)</span> 和 <span class="math notranslate nohighlight">\(y\)</span> 是任意形状的 QTensor , 总 <span class="math notranslate nohighlight">\(n\)</span> 个元素的均方根误差由下式计算。</p>
<div class="math notranslate nohighlight">
\[\ell(x, y) =
    \operatorname{mean}(L)\]</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.nn.torch.TorchModule</span></code> ,可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>name</strong> – 这个模块的名字, 默认为””。</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>一个均方根误差实例。</p>
</dd>
</dl>
<p>均方根误差前向计算函数的所需参数:</p>
<blockquote>
<div><p>x: <span class="math notranslate nohighlight">\((N, *)\)</span> 预测值,其中 <span class="math notranslate nohighlight">\(*\)</span> 表示任意维度。</p>
<p>y: <span class="math notranslate nohighlight">\((N, *)\)</span>, 目标值, 和输入一样维度的 QTensor 。</p>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>请注意,跟pytorch等框架不同的是,以下MeanSquaredError函数的前向函数中,第一个参数为目标值,第二个参数为预测值。</p>
</div>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.tensor</span><span class="w"> </span><span class="kn">import</span> <span class="n">QTensor</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet</span><span class="w"> </span><span class="kn">import</span> <span class="n">kfloat64</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.nn.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">MeanSquaredError</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">QTensor</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]],</span>
            <span class="n">requires_grad</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">dtype</span><span class="o">=</span><span class="n">kfloat64</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">QTensor</span><span class="p">([[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]],</span>
            <span class="n">requires_grad</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">dtype</span><span class="o">=</span><span class="n">kfloat64</span><span class="p">)</span>

<span class="n">loss_result</span> <span class="o">=</span> <span class="n">MeanSquaredError</span><span class="p">()</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">loss_result</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="binarycrossentropy">
<h4>BinaryCrossEntropy<a class="headerlink" href="#binarycrossentropy" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.nn.torch.BinaryCrossEntropy">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.nn.torch.</span></span><span class="sig-name descname"><span class="pre">BinaryCrossEntropy</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.nn.torch.BinaryCrossEntropy" title="Link to this definition">¶</a></dt>
<dd><p>测量目标和输入之间的平均二元交叉熵损失。</p>
<p>未做平均运算的二元交叉熵如下式:</p>
<div class="math notranslate nohighlight">
\[\ell(x, y) = L = \{l_1,\dots,l_N\}^\top, \quad
l_n = - w_n \left[ y_n \cdot \log x_n + (1 - y_n) \cdot \log (1 - x_n) \right],\]</div>
<p>若 <span class="math notranslate nohighlight">\(N\)</span> 为批的大小,则平均二元交叉熵.</p>
<div class="math notranslate nohighlight">
\[\ell(x, y) = \operatorname{mean}(L)\]</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.nn.torch.TorchModule</span></code> ,可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>name</strong> – 这个模块的名字, 默认为””。</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>一个平均二元交叉熵实例。</p>
</dd>
</dl>
<p>平均二元交叉熵误差前向计算函数的所需参数:</p>
<blockquote>
<div><p>x: <span class="math notranslate nohighlight">\((N, *)\)</span> 预测值,其中 <span class="math notranslate nohighlight">\(*\)</span> 表示任意维度。</p>
<p>y: <span class="math notranslate nohighlight">\((N, *)\)</span>, 目标值,和输入一样维度的 QTensor 。</p>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>请注意,跟pytorch等框架不同的是,BinaryCrossEntropy函数的前向函数中,第一个参数为目标值,第二个参数为预测值。</p>
</div>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.tensor</span><span class="w"> </span><span class="kn">import</span> <span class="n">QTensor</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.nn.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">BinaryCrossEntropy</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">QTensor</span><span class="p">([[</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">]],</span> <span class="n">requires_grad</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">QTensor</span><span class="p">([[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]],</span> <span class="n">requires_grad</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">loss_result</span> <span class="o">=</span> <span class="n">BinaryCrossEntropy</span><span class="p">()</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">loss_result</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="n">result</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="categoricalcrossentropy">
<h4>CategoricalCrossEntropy<a class="headerlink" href="#categoricalcrossentropy" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.nn.torch.CategoricalCrossEntropy">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.nn.torch.</span></span><span class="sig-name descname"><span class="pre">CategoricalCrossEntropy</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.nn.torch.CategoricalCrossEntropy" title="Link to this definition">¶</a></dt>
<dd><p>该损失函数将 LogSoftmax 和 NLLLoss 同时计算的平均分类交叉熵。</p>
<p>损失函数计算方式如下,其中 class 为目标值的对应分类标签:</p>
<div class="math notranslate nohighlight">
\[\text{loss}(x, y) = -\log\left(\frac{\exp(x[class])}{\sum_j \exp(x[j])}\right)
               = -x[class] + \log\left(\sum_j \exp(x[j])\right)\]</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>name</strong> – 这个模块的名字, 默认为””。</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>平均分类交叉熵实例。</p>
</dd>
</dl>
<p>误差前向计算函数的所需参数:</p>
<blockquote>
<div><p>x: <span class="math notranslate nohighlight">\((N, *)\)</span> 预测值,其中 <span class="math notranslate nohighlight">\(*\)</span> 表示任意维度。</p>
<p>y: <span class="math notranslate nohighlight">\((N, *)\)</span>, 目标值,和输入一样维度的 QTensor 。必须为64位整数,kint64。</p>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>请注意,跟pytorch等框架不同的是,CategoricalCrossEntropy函数的前向函数中,第一个参数为目标值,第二个参数为预测值。</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.nn.torch.TorchModule</span></code> ,可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
</div>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.tensor</span><span class="w"> </span><span class="kn">import</span> <span class="n">QTensor</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet</span><span class="w"> </span><span class="kn">import</span> <span class="n">kfloat32</span><span class="p">,</span><span class="n">kint64</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.nn.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">CategoricalCrossEntropy</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">QTensor</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
<span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
<span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]],</span> <span class="n">requires_grad</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">kfloat32</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">QTensor</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]],</span> <span class="n">requires_grad</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">kint64</span><span class="p">)</span>
<span class="n">loss_result</span> <span class="o">=</span> <span class="n">CategoricalCrossEntropy</span><span class="p">()</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">loss_result</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="softmaxcrossentropy">
<h4>SoftmaxCrossEntropy<a class="headerlink" href="#softmaxcrossentropy" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.nn.torch.SoftmaxCrossEntropy">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.nn.torch.</span></span><span class="sig-name descname"><span class="pre">SoftmaxCrossEntropy</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.nn.torch.SoftmaxCrossEntropy" title="Link to this definition">¶</a></dt>
<dd><p>该损失函数将 LogSoftmax 和 NLLLoss 同时计算的平均分类交叉熵,并具有更高的数值稳定性。</p>
<p>损失函数计算方式如下,其中 class 为目标值的对应分类标签:</p>
<div class="math notranslate nohighlight">
\[\text{loss}(x, y) = -\log\left(\frac{\exp(x[class])}{\sum_j \exp(x[j])}\right)
               = -x[class] + \log\left(\sum_j \exp(x[j])\right)\]</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>name</strong> – 这个模块的名字, 默认为””。</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>一个Softmax交叉熵损失函数实例</p>
</dd>
</dl>
<p>误差前向计算函数的所需参数:</p>
<blockquote>
<div><p>x: <span class="math notranslate nohighlight">\((N, *)\)</span> 预测值,其中 <span class="math notranslate nohighlight">\(*\)</span> 表示任意维度。</p>
<p>y: <span class="math notranslate nohighlight">\((N, *)\)</span>, 目标值,和输入一样维度的 QTensor 。必须为64位整数,kint64。</p>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>请注意,跟pytorch等框架不同的是,SoftmaxCrossEntropy函数的前向函数中,第一个参数为目标值,第二个参数为预测值。</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.nn.torch.TorchModule</span></code> ,可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
</div>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.tensor</span><span class="w"> </span><span class="kn">import</span> <span class="n">QTensor</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet</span><span class="w"> </span><span class="kn">import</span> <span class="n">kfloat32</span><span class="p">,</span> <span class="n">kint64</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.nn.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">SoftmaxCrossEntropy</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">QTensor</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]],</span>
            <span class="n">requires_grad</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">dtype</span><span class="o">=</span><span class="n">kfloat32</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">QTensor</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]],</span>
            <span class="n">requires_grad</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">dtype</span><span class="o">=</span><span class="n">kint64</span><span class="p">)</span>
<span class="n">loss_result</span> <span class="o">=</span> <span class="n">SoftmaxCrossEntropy</span><span class="p">()</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">loss_result</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="n">result</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="nll-loss">
<h4>NLL_Loss<a class="headerlink" href="#nll-loss" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.nn.torch.NLL_Loss">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.nn.torch.</span></span><span class="sig-name descname"><span class="pre">NLL_Loss</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.nn.torch.NLL_Loss" title="Link to this definition">¶</a></dt>
<dd><p>平均负对数似然损失。 对C个类别的分类问题很有用。</p>
<p><cite>x</cite> 是模型给出的概率形式的似然量。其尺寸可以是 <span class="math notranslate nohighlight">\((N, C)\)</span> or <span class="math notranslate nohighlight">\((N, C, d_1, d_2, ..., d_K)\)</span> 。 <cite>y</cite> 是损失函数期望的真值,包含 <span class="math notranslate nohighlight">\([0, C-1]\)</span> 的类别索引。</p>
<div class="math notranslate nohighlight">
\[\ell(x, y) = L = \{l_1,\dots,l_N\}^\top, \quad
l_n = -
    \sum_{n=1}^N \frac{1}{N}x_{n,y_n} \quad\]</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>name</strong> – 这个模块的名字, 默认为””。</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>一个NLL_Loss损失函数实例</p>
</dd>
</dl>
<p>误差前向计算函数的所需参数:</p>
<blockquote>
<div><p>x: <span class="math notranslate nohighlight">\((N, *)\)</span>,损失函数的输出预测值,可以为多维变量。</p>
<p>y: <span class="math notranslate nohighlight">\((N, *)\)</span>,损失函数目标值。必须为64位整数,kint64。</p>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>请注意,跟pytorch等框架不同的是,NLL_Loss函数的前向函数中,第一个参数为目标值,第二个参数为预测值。</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.nn.torch.TorchModule</span></code> ,可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
</div>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.tensor</span><span class="w"> </span><span class="kn">import</span> <span class="n">QTensor</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet</span><span class="w"> </span><span class="kn">import</span> <span class="n">kint64</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.nn.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">NLL_Loss</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">QTensor</span><span class="p">([</span>
    <span class="mf">0.9476322568516703</span><span class="p">,</span> <span class="mf">0.226547421131723</span><span class="p">,</span> <span class="mf">0.5944201443911326</span><span class="p">,</span>
    <span class="mf">0.42830868492969476</span><span class="p">,</span> <span class="mf">0.76414068655387</span><span class="p">,</span> <span class="mf">0.00286059168094277</span><span class="p">,</span>
    <span class="mf">0.3574236812873617</span><span class="p">,</span> <span class="mf">0.9096948856639084</span><span class="p">,</span> <span class="mf">0.4560809854582528</span><span class="p">,</span>
    <span class="mf">0.9818027091583286</span><span class="p">,</span> <span class="mf">0.8673569904602182</span><span class="p">,</span> <span class="mf">0.9860275114020933</span><span class="p">,</span>
    <span class="mf">0.9232667066664217</span><span class="p">,</span> <span class="mf">0.303693313961628</span><span class="p">,</span> <span class="mf">0.8461034903175555</span>
<span class="p">])</span>
<span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
<span class="n">x</span><span class="o">.</span><span class="n">requires_grad</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">QTensor</span><span class="p">([[[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">kint64</span><span class="p">)</span>

<span class="n">loss_result</span> <span class="o">=</span> <span class="n">NLL_Loss</span><span class="p">()</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">loss_result</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="crossentropyloss">
<h4>CrossEntropyLoss<a class="headerlink" href="#crossentropyloss" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.nn.torch.CrossEntropyLoss">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.nn.torch.</span></span><span class="sig-name descname"><span class="pre">CrossEntropyLoss</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.nn.torch.CrossEntropyLoss" title="Link to this definition">¶</a></dt>
<dd><p>该函数计算LogSoftmax以及NLL_Loss在一起的损失。</p>
<p><cite>x</cite> 是包含未做归一化的输出.它的尺寸可以为 <span class="math notranslate nohighlight">\((C)\)</span> , <span class="math notranslate nohighlight">\((N, C)\)</span> 二维或 <span class="math notranslate nohighlight">\((N, C, d_1, d_2, ..., d_K)\)</span> 多维。</p>
<p>损失函数的公式如下,其中 class 为目标值的对应分类标签:</p>
<div class="math notranslate nohighlight">
\[\text{loss}(x, y) = -\log\left(\frac{\exp(x[class])}{\sum_j \exp(x[j])}\right)
               = -x[class] + \log\left(\sum_j \exp(x[j])\right)\]</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>name</strong> – 这个模块的名字, 默认为””。</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>一个CrossEntropyLoss损失函数实例</p>
</dd>
</dl>
<p>误差前向计算函数的所需参数:</p>
<blockquote>
<div><p>x: <span class="math notranslate nohighlight">\((N, *)\)</span>,损失函数的输出,可以为多维变量。</p>
<p>y: <span class="math notranslate nohighlight">\((N, *)\)</span>,损失函数期望的真值。必须为64位整数,kint64。</p>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>请注意,跟pytorch等框架不同的是,CrossEntropyLoss函数的前向函数中,第一个参数为目标值,第二个参数为预测值。</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.nn.torch.TorchModule</span></code> ,可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
</div>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.tensor</span><span class="w"> </span><span class="kn">import</span> <span class="n">QTensor</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet</span><span class="w"> </span><span class="kn">import</span> <span class="n">kint64</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.nn.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">CrossEntropyLoss</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">QTensor</span><span class="p">([</span>
    <span class="mf">0.9476322568516703</span><span class="p">,</span> <span class="mf">0.226547421131723</span><span class="p">,</span> <span class="mf">0.5944201443911326</span><span class="p">,</span>
    <span class="mf">0.42830868492969476</span><span class="p">,</span> <span class="mf">0.76414068655387</span><span class="p">,</span> <span class="mf">0.00286059168094277</span><span class="p">,</span>
    <span class="mf">0.3574236812873617</span><span class="p">,</span> <span class="mf">0.9096948856639084</span><span class="p">,</span> <span class="mf">0.4560809854582528</span><span class="p">,</span>
    <span class="mf">0.9818027091583286</span><span class="p">,</span> <span class="mf">0.8673569904602182</span><span class="p">,</span> <span class="mf">0.9860275114020933</span><span class="p">,</span>
    <span class="mf">0.9232667066664217</span><span class="p">,</span> <span class="mf">0.303693313961628</span><span class="p">,</span> <span class="mf">0.8461034903175555</span>
<span class="p">])</span>
<span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
<span class="n">x</span><span class="o">.</span><span class="n">requires_grad</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">QTensor</span><span class="p">([[[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">kint64</span><span class="p">)</span>

<span class="n">loss_result</span> <span class="o">=</span> <span class="n">CrossEntropyLoss</span><span class="p">()</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">loss_result</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
</section>
<section id="id7">
<h3>激活函数<a class="headerlink" href="#id7" title="Link to this heading">¶</a></h3>
<section id="sigmoid">
<h4>Sigmoid<a class="headerlink" href="#sigmoid" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.nn.torch.Sigmoid">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.nn.torch.</span></span><span class="sig-name descname"><span class="pre">Sigmoid</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.nn.torch.Sigmoid" title="Link to this definition">¶</a></dt>
<dd><p>Sigmoid激活函数层。</p>
<div class="math notranslate nohighlight">
\[\text{Sigmoid}(x) = \frac{1}{1 + \exp(-x)}\]</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.nn.torch.TorchModule</span></code> ,可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>name</strong> – 激活函数层的命名,默认为””。</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>一个Sigmoid激活函数层实例。</p>
</dd>
</dl>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.nn.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">Sigmoid</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.tensor</span><span class="w"> </span><span class="kn">import</span> <span class="n">QTensor</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="n">layer</span> <span class="o">=</span> <span class="n">Sigmoid</span><span class="p">()</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">layer</span><span class="p">(</span><span class="n">QTensor</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="softplus">
<h4>Softplus<a class="headerlink" href="#softplus" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.nn.torch.Softplus">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.nn.torch.</span></span><span class="sig-name descname"><span class="pre">Softplus</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.nn.torch.Softplus" title="Link to this definition">¶</a></dt>
<dd><p>Softplus激活函数层。</p>
<div class="math notranslate nohighlight">
\[\text{Softplus}(x) = \log(1 + \exp(x))\]</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.nn.torch.TorchModule</span></code> ,可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>name</strong> – 激活函数层的命名,默认为””。</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>一个Softplus激活函数层实例。</p>
</dd>
</dl>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.nn.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">Softplus</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.tensor</span><span class="w"> </span><span class="kn">import</span> <span class="n">QTensor</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="n">layer</span> <span class="o">=</span> <span class="n">Softplus</span><span class="p">()</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">layer</span><span class="p">(</span><span class="n">QTensor</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">]))</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="softsign">
<h4>Softsign<a class="headerlink" href="#softsign" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.nn.torch.Softsign">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.nn.torch.</span></span><span class="sig-name descname"><span class="pre">Softsign</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.nn.torch.Softsign" title="Link to this definition">¶</a></dt>
<dd><p>Softsign 激活函数层。</p>
<div class="math notranslate nohighlight">
\[\text{SoftSign}(x) = \frac{x}{ 1 + |x|}\]</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.nn.torch.TorchModule</span></code> ,可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>name</strong> – 激活函数层的命名,默认为””。</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>一个Softsign 激活函数层实例。</p>
</dd>
</dl>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.nn.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">Softsign</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.tensor</span><span class="w"> </span><span class="kn">import</span> <span class="n">QTensor</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="n">layer</span> <span class="o">=</span> <span class="n">Softsign</span><span class="p">()</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">layer</span><span class="p">(</span><span class="n">QTensor</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">]))</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="softmax">
<h4>Softmax<a class="headerlink" href="#softmax" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.nn.torch.Softmax">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.nn.torch.</span></span><span class="sig-name descname"><span class="pre">Softmax</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">axis</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">-1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.nn.torch.Softmax" title="Link to this definition">¶</a></dt>
<dd><p>Softmax 激活函数层。</p>
<div class="math notranslate nohighlight">
\[\text{Softmax}(x_{i}) = \frac{\exp(x_i)}{\sum_j \exp(x_j)}\]</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.nn.torch.TorchModule</span></code> ,可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>axis</strong> – 计算的维度(最后一个轴为-1),默认值 = -1。</p></li>
<li><p><strong>name</strong> – 激活函数层的命名,默认为””。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>一个Softmax 激活函数层实例。</p>
</dd>
</dl>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.nn.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">Softmax</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.tensor</span><span class="w"> </span><span class="kn">import</span> <span class="n">QTensor</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="n">layer</span> <span class="o">=</span> <span class="n">Softmax</span><span class="p">()</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">layer</span><span class="p">(</span><span class="n">QTensor</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">]))</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="hardsigmoid">
<h4>HardSigmoid<a class="headerlink" href="#hardsigmoid" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.nn.torch.HardSigmoid">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.nn.torch.</span></span><span class="sig-name descname"><span class="pre">HardSigmoid</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.nn.torch.HardSigmoid" title="Link to this definition">¶</a></dt>
<dd><p>HardSigmoid 激活函数层。</p>
<div class="math notranslate nohighlight">
\[\begin{split}\text{Hardsigmoid}(x) = \begin{cases}
    0 &amp; \text{ if } x \le -3, \\
    1 &amp; \text{ if } x \ge +3, \\
    x / 6 + 1 / 2 &amp; \text{otherwise}
\end{cases}\end{split}\]</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.nn.torch.TorchModule</span></code> ,可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>name</strong> – 激活函数层的命名,默认为””。</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>一个HardSigmoid 激活函数层实例。</p>
</dd>
</dl>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.nn.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">HardSigmoid</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.tensor</span><span class="w"> </span><span class="kn">import</span> <span class="n">QTensor</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="n">layer</span> <span class="o">=</span> <span class="n">HardSigmoid</span><span class="p">()</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">layer</span><span class="p">(</span><span class="n">QTensor</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">]))</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="relu">
<h4>ReLu<a class="headerlink" href="#relu" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.nn.torch.ReLu">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.nn.torch.</span></span><span class="sig-name descname"><span class="pre">ReLu</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.nn.torch.ReLu" title="Link to this definition">¶</a></dt>
<dd><p>ReLu 整流线性单元激活函数层。</p>
<div class="math notranslate nohighlight">
\[\begin{split}\text{ReLu}(x) = \begin{cases}
x, &amp; \text{ if } x &gt; 0\\
0, &amp; \text{ if } x \leq 0
\end{cases}\end{split}\]</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.nn.torch.TorchModule</span></code> ,可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>name</strong> – 激活函数层的命名,默认为””。</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>一个ReLu 激活函数层实例。</p>
</dd>
</dl>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.nn.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">ReLu</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.tensor</span><span class="w"> </span><span class="kn">import</span> <span class="n">QTensor</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="n">layer</span> <span class="o">=</span> <span class="n">ReLu</span><span class="p">()</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">layer</span><span class="p">(</span><span class="n">QTensor</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">]))</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="leakyrelu">
<h4>LeakyReLu<a class="headerlink" href="#leakyrelu" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.nn.torch.LeakyReLu">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.nn.torch.</span></span><span class="sig-name descname"><span class="pre">LeakyReLu</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">alpha</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0.01</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.nn.torch.LeakyReLu" title="Link to this definition">¶</a></dt>
<dd><p>LeakyReLu 带泄露的修正线性单元激活函数层。</p>
<div class="math notranslate nohighlight">
\[\begin{split}\text{LeakyRelu}(x) =
\begin{cases}
x, &amp; \text{ if } x \geq 0 \\
\alpha * x, &amp; \text{ otherwise }
\end{cases}\end{split}\]</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.nn.torch.TorchModule</span></code> ,可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>alpha</strong> – LeakyRelu 系数,默认:0.01。</p></li>
<li><p><strong>name</strong> – 激活函数层的命名,默认为””。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>一个LeakyReLu 激活函数层实例。</p>
</dd>
</dl>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.nn.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">LeakyReLu</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.tensor</span><span class="w"> </span><span class="kn">import</span> <span class="n">QTensor</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="n">layer</span> <span class="o">=</span> <span class="n">LeakyReLu</span><span class="p">()</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">layer</span><span class="p">(</span><span class="n">QTensor</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">]))</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="gelu">
<h4>Gelu<a class="headerlink" href="#gelu" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.nn.torch.Gelu">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.nn.torch.</span></span><span class="sig-name descname"><span class="pre">Gelu</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">approximate</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'tanh'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.nn.torch.Gelu" title="Link to this definition">¶</a></dt>
<dd><p>应用高斯误差线性单元函数:</p>
<div class="math notranslate nohighlight">
\[\text{GELU}(x) = x * \Phi(x)\]</div>
<p>当近似参数为 ‘tanh’ 时, GELU 通过以下方式估计:</p>
<div class="math notranslate nohighlight">
\[\text{GELU}(x) = 0.5 * x * (1 + \text{Tanh}(\sqrt{2 / \pi} * (x + 0.044715 * x^3)))\]</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.nn.torch.TorchModule</span></code> ,可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>approximate</strong> – 近似计算方式,默认为”tanh”。</p></li>
<li><p><strong>name</strong> – 激活函数层的命名,默认为””。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Gelu 激活函数层实例。</p>
</dd>
</dl>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.tensor</span><span class="w"> </span><span class="kn">import</span> <span class="n">randu</span><span class="p">,</span> <span class="n">ones_like</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.nn.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">Gelu</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="n">qa</span> <span class="o">=</span> <span class="n">randu</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span><span class="mi">4</span><span class="p">])</span>
<span class="n">qb</span> <span class="o">=</span> <span class="n">Gelu</span><span class="p">()(</span><span class="n">qa</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="elu">
<h4>ELU<a class="headerlink" href="#elu" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.nn.torch.ELU">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.nn.torch.</span></span><span class="sig-name descname"><span class="pre">ELU</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">alpha</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.nn.torch.ELU" title="Link to this definition">¶</a></dt>
<dd><p>ELU 指数线性单位激活函数层。</p>
<div class="math notranslate nohighlight">
\[\begin{split}\text{ELU}(x) = \begin{cases}
x, &amp; \text{ if } x &gt; 0\\
\alpha * (\exp(x) - 1), &amp; \text{ if } x \leq 0
\end{cases}\end{split}\]</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.nn.torch.TorchModule</span></code> ,可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>alpha</strong> – ELU 系数,默认:1。</p></li>
<li><p><strong>name</strong> – 激活函数层的命名,默认为””。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>ELU 激活函数层实例。</p>
</dd>
</dl>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.nn.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">ELU</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.tensor</span><span class="w"> </span><span class="kn">import</span> <span class="n">QTensor</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="n">layer</span> <span class="o">=</span> <span class="n">ELU</span><span class="p">()</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">layer</span><span class="p">(</span><span class="n">QTensor</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">]))</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="tanh">
<h4>Tanh<a class="headerlink" href="#tanh" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.nn.torch.Tanh">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.nn.torch.</span></span><span class="sig-name descname"><span class="pre">Tanh</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.nn.torch.Tanh" title="Link to this definition">¶</a></dt>
<dd><p>Tanh双曲正切激活函数.</p>
<div class="math notranslate nohighlight">
\[\text{Tanh}(x) = \frac{\exp(x) - \exp(-x)} {\exp(x) + \exp(-x)}\]</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.nn.torch.TorchModule</span></code> ,可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>name</strong> – 激活函数层的命名,默认为””。</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Tanh 激活函数层实例。</p>
</dd>
</dl>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.nn.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">Tanh</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.tensor</span><span class="w"> </span><span class="kn">import</span> <span class="n">QTensor</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="n">layer</span> <span class="o">=</span> <span class="n">Tanh</span><span class="p">()</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">layer</span><span class="p">(</span><span class="n">QTensor</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">]))</span>
</pre></div>
</div>
</dd></dl>

</section>
</section>
<section id="id8">
<h3>优化器模块<a class="headerlink" href="#id8" title="Link to this heading">¶</a></h3>
<p>对于继承于 <cite>TorchModule</cite> 的VQNet的经典和量子线路模块,对其中的参数 <cite>model.paramters()</cite> 可继续使用 <a class="reference internal" href="nn.html#optimizer"><span class="std std-ref">Optimizer</span></a> 下的除 <cite>Rotosolve</cite> 以外的VQNet优化器进行参数优化。</p>
<p>对于继承于 <cite>TorchModule</cite> 的VQNet的经典和量子线路模块,其中参数同样可以被 <cite>torch.nn.Module.parameters()</cite> 获取,可同样使用 torch 的优化器进行优化。</p>
</section>
</section>
<section id="pyqpanda2">
<h2>pyqpanda2量子变分线路训练函数<a class="headerlink" href="#pyqpanda2" title="Link to this heading">¶</a></h2>
<p>以下是使用pyqpanda以及pyqpanda3进行线路计算的训练变分量子线路接口。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>以下 TorchQpandaQuantumLayer, TorchQcloudQuantumLayer 的量子计算部分使用pyqpanda2 <a class="reference external" href="https://pyqpanda-toturial.readthedocs.io/zh/latest/">https://pyqpanda-toturial.readthedocs.io/zh/latest/</a>。</p>
<p>由于pyqpanda2以及pyqpanda3兼容性问题,您需要自行安装pyqpnda2, <cite>pip install pyqpanda</cite></p>
</div>
<section id="torchqpandaquantumlayer">
<h3>TorchQpandaQuantumLayer<a class="headerlink" href="#torchqpandaquantumlayer" title="Link to this heading">¶</a></h3>
<p>如您更加熟悉pyQPanda2语法,可以使用该接口TorchQpandaQuantumLayer,自定义量子比特 <code class="docutils literal notranslate"><span class="pre">qubits</span></code> ,经典比特 <code class="docutils literal notranslate"><span class="pre">cbits</span></code> ,后端模拟器 <code class="docutils literal notranslate"><span class="pre">machine</span></code> 加入TorchQpandaQuantumLayer的参数 <code class="docutils literal notranslate"><span class="pre">qprog_with_measure</span></code> 函数中。</p>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.qnn.vqc.torch.TorchQpandaQuantumLayer">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.qnn.vqc.torch.</span></span><span class="sig-name descname"><span class="pre">TorchQpandaQuantumLayer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">qprog_with_measure</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">para_num</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">diff_method</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'parameter_shift'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">delta</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0.01</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.qnn.vqc.torch.TorchQpandaQuantumLayer" title="Link to this definition">¶</a></dt>
<dd><blockquote>
<div><p>变分量子层的抽象计算模块。对一个参数化的量子线路使用pyQPanda2进行仿真,得到测量结果。该变分量子层继承了VQNet框架的梯度计算模块,可以使用参数漂移法等计算线路参数的梯度,训练变分量子线路模型或将变分量子线路嵌入混合量子和经典模型。</p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>qprog_with_measure</strong> – 用pyQPand构建的量子线路运行和测量函数。</p></li>
<li><p><strong>para_num</strong> – <cite>int</cite> - 参数个数。</p></li>
<li><p><strong>diff_method</strong> – 求解量子线路参数梯度的方法,“参数位移”或“有限差分”,默认参数偏移。</p></li>
<li><p><strong>delta</strong> – 有限差分计算梯度时的 delta。</p></li>
<li><p><strong>dtype</strong> – 参数的数据类型,defaults:None,使用默认数据类型:kfloat32,代表32位浮点数。</p></li>
<li><p><strong>name</strong> – 这个模块的名字, 默认为””。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>一个可以计算量子线路的模块。</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>qprog_with_measure是pyQPanda2中定义的量子线路函数 :<a class="reference external" href="https://pyqpanda-toturial.readthedocs.io/zh/latest/QCircuit.html">https://pyqpanda-toturial.readthedocs.io/zh/latest/QCircuit.html</a>。</p>
<p>此函数必须包含以下参数作为函数入参（即使某个参数未实际使用）,否则无法在本函数中正常运行。</p>
<p>与QuantumLayer相比。该接口传入的变分线路运行函数中,用户应该手动创建量子比特和模拟器: <a class="reference external" href="https://pyqpanda-toturial.readthedocs.io/zh/latest/QuantumMachine.html">https://pyqpanda-toturial.readthedocs.io/zh/latest/QuantumMachine.html</a>,</p>
<p>如果qprog_with_measure需要quantum measure,用户还需要手动创建需要分配cbits: <a class="reference external" href="https://pyqpanda-toturial.readthedocs.io/zh/latest/Measure.html">https://pyqpanda-toturial.readthedocs.io/zh/latest/Measure.html</a></p>
<p>量子线路函数 qprog_with_measure (input,param,nqubits,ncubits)的使用可参考下面的例子。</p>
<p><cite>input</cite>: 输入一维经典数据。如果没有,输入 None。</p>
<p><cite>param</cite>: 输入一维的变分量子线路的待训练参数。</p>
</div>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pyqpanda</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pq</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.qnn</span><span class="w"> </span><span class="kn">import</span> <span class="n">ProbsMeasure</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.tensor</span><span class="w"> </span><span class="kn">import</span> <span class="n">QTensor</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.qnn.vqc.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">TorchQpandaQuantumLayer</span>
<span class="k">def</span><span class="w"> </span><span class="nf">pqctest</span> <span class="p">(</span><span class="nb">input</span><span class="p">,</span><span class="n">param</span><span class="p">):</span>
    <span class="n">num_of_qubits</span> <span class="o">=</span> <span class="mi">4</span>

    <span class="n">m_machine</span> <span class="o">=</span> <span class="n">pq</span><span class="o">.</span><span class="n">CPUQVM</span><span class="p">()</span><span class="c1"># outside</span>
    <span class="n">m_machine</span><span class="o">.</span><span class="n">init_qvm</span><span class="p">()</span><span class="c1"># outside</span>
    <span class="n">qubits</span> <span class="o">=</span> <span class="n">m_machine</span><span class="o">.</span><span class="n">qAlloc_many</span><span class="p">(</span><span class="n">num_of_qubits</span><span class="p">)</span>

    <span class="n">circuit</span> <span class="o">=</span> <span class="n">pq</span><span class="o">.</span><span class="n">QCircuit</span><span class="p">()</span>
    <span class="n">circuit</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">H</span><span class="p">(</span><span class="n">qubits</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">circuit</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">H</span><span class="p">(</span><span class="n">qubits</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="n">circuit</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">H</span><span class="p">(</span><span class="n">qubits</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
    <span class="n">circuit</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">H</span><span class="p">(</span><span class="n">qubits</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>

    <span class="n">circuit</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">RZ</span><span class="p">(</span><span class="n">qubits</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nb">input</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">circuit</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">RZ</span><span class="p">(</span><span class="n">qubits</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="nb">input</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="n">circuit</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">RZ</span><span class="p">(</span><span class="n">qubits</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="nb">input</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
    <span class="n">circuit</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">RZ</span><span class="p">(</span><span class="n">qubits</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="nb">input</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>

    <span class="n">circuit</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">CNOT</span><span class="p">(</span><span class="n">qubits</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">qubits</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="n">circuit</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">RZ</span><span class="p">(</span><span class="n">qubits</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">param</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">circuit</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">CNOT</span><span class="p">(</span><span class="n">qubits</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">qubits</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

    <span class="n">circuit</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">CNOT</span><span class="p">(</span><span class="n">qubits</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">qubits</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
    <span class="n">circuit</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">RZ</span><span class="p">(</span><span class="n">qubits</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">param</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="n">circuit</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">CNOT</span><span class="p">(</span><span class="n">qubits</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">qubits</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>

    <span class="n">circuit</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">CNOT</span><span class="p">(</span><span class="n">qubits</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">qubits</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
    <span class="n">circuit</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">RZ</span><span class="p">(</span><span class="n">qubits</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="n">param</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
    <span class="n">circuit</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">CNOT</span><span class="p">(</span><span class="n">qubits</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">qubits</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>

    <span class="n">prog</span> <span class="o">=</span> <span class="n">pq</span><span class="o">.</span><span class="n">QProg</span><span class="p">()</span>
    <span class="n">prog</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">circuit</span><span class="p">)</span>

    <span class="n">rlt_prob</span> <span class="o">=</span> <span class="n">ProbsMeasure</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span><span class="n">prog</span><span class="p">,</span><span class="n">m_machine</span><span class="p">,</span><span class="n">qubits</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">rlt_prob</span>

<span class="n">pqc</span> <span class="o">=</span> <span class="n">TorchQpandaQuantumLayer</span><span class="p">(</span><span class="n">pqctest</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>

<span class="c1">#classic data as input</span>
<span class="nb">input</span> <span class="o">=</span> <span class="n">QTensor</span><span class="p">([[</span><span class="mf">1.0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">],[</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],[</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]],</span><span class="n">requires_grad</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1">#forward circuits</span>
<span class="n">rlt</span> <span class="o">=</span> <span class="n">pqc</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">rlt</span><span class="p">)</span>

<span class="n">grad</span> <span class="o">=</span>  <span class="n">QTensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">rlt</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">*</span><span class="mi">1000</span><span class="p">)</span>
<span class="c1">#backward circuits</span>
<span class="n">rlt</span><span class="o">.</span><span class="n">backward</span><span class="p">(</span><span class="n">grad</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">pqc</span><span class="o">.</span><span class="n">m_para</span><span class="o">.</span><span class="n">grad</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">input</span><span class="o">.</span><span class="n">grad</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="torchqcloudquantumlayer">
<h3>TorchQcloudQuantumLayer<a class="headerlink" href="#torchqcloudquantumlayer" title="Link to this heading">¶</a></h3>
<p>当您安装最新版本pyqpanda2,可以使用本接口定义一个变分线路,并提交到originqc的真实芯片上运行。</p>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.qnn.vqc.torch.TorchQcloudQuantumLayer">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.qnn.vqc.torch.</span></span><span class="sig-name descname"><span class="pre">TorchQcloudQuantumLayer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">origin_qprog_func</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">qcloud_token</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">para_num</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_qubits</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_cubits</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pauli_str_dict</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shots</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">initializer</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">diff_method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'parameter_shift'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">submit_kwargs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">query_kwargs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{}</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.qnn.vqc.torch.TorchQcloudQuantumLayer" title="Link to this definition">¶</a></dt>
<dd><p>使用 pyqpanda QCloud 从版本 3.8.2.2 开始的 originqc 真实芯片的抽象计算模块。 它提交参数化量子电路到真实芯片并获得测量结果。
如果 diff_method == “random_coordinate_descent” ,该层将随机选择单个参数来计算梯度,其他参数将保持为零。参考:<a class="reference external" href="https://arxiv.org/abs/2311.00088">https://arxiv.org/abs/2311.00088</a></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>qcloud_token 为您到 <a class="reference external" href="https://qcloud.originqc.com.cn/">https://qcloud.originqc.com.cn/</a> 中申请的api token。
origin_qprog_func 需要返回pypqanda.QProg类型的数据,如果没有设置pauli_str_dict,需要保证该QProg中已经插入了measure。
origin_qprog_func 的形式必须按照如下:</p>
<p>origin_qprog_func(input,param,qubits,cbits,machine)</p>
<blockquote>
<div><p><cite>input</cite>: 输入1~2维经典数据,二维的情况下,第一个维度为批处理大小。</p>
<p><cite>param</cite>: 输入一维的变分量子线路的待训练参数。</p>
<p><cite>machine</cite>: 由QuantumBatchAsyncQcloudLayer创建的模拟器QCloud,无需用户额外在函数中定义。</p>
<p><cite>qubits</cite>: 由QuantumBatchAsyncQcloudLayer创建的模拟器QCloud创建的量子比特,数量为  <cite>num_qubits</cite>, 类型为pyQpanda.Qubits,无需用户额外在函数中定义。</p>
<p><cite>cbits</cite>: 由QuantumBatchAsyncQcloudLayer分配的经典比特, 数量为  <cite>num_cubits</cite>, 类型为 pyQpanda.ClassicalCondition,无需用户额外在函数中定义。。</p>
</div></blockquote>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>origin_qprog_func</strong> – QPanda 构建的变分量子电路函数,必须返回QProg。</p></li>
<li><p><strong>qcloud_token</strong> – <cite>str</cite> - 量子机的类型或用于执行的云令牌。</p></li>
<li><p><strong>para_num</strong> – <cite>int</cite> - 参数数量,参数是大小为[para_num]的QTensor。</p></li>
<li><p><strong>num_qubits</strong> – <cite>int</cite> - 量子电路中的量子比特数量。</p></li>
<li><p><strong>num_cubits</strong> – <cite>int</cite> - 量子电路中用于测量的经典比特数量。</p></li>
<li><p><strong>pauli_str_dict</strong> – <cite>dict|list</cite> - 表示量子电路中泡利运算符的字典或字典列表。 默认为“无”,则进行测量操作,如果输入泡利算符的字典,则会计算单个期望或者多个期望。</p></li>
<li><p><strong>shot</strong> – <cite>int</cite> - 测量次数。 默认值为 1000。</p></li>
<li><p><strong>initializer</strong> – 参数值的初始化器。 默认为“无”,使用0~2*pi正态分布。</p></li>
<li><p><strong>dtype</strong> – 参数的数据类型。 默认值为 None,即使用默认数据类型pyvqnet.kfloat32。</p></li>
<li><p><strong>name</strong> – 模块的名称。 默认为空字符串。</p></li>
<li><p><strong>diff_method</strong> – 梯度计算的微分方法。 默认为“parameter_shift”,”random_coordinate_descent”。</p></li>
<li><p><strong>submit_kwargs</strong> – 用于提交量子电路的附加关键字参数,默认:{“chip_id”:pyqpanda.real_chip_type.origin_72,”is_amend”:True,”is_mapping”:True,”is_optimization”:True,”compile_level”:3,”default_task_group_size”:200,”test_qcloud_fake”:False},当设置test_qcloud_fake为True则本地CPUQVM模拟。</p></li>
<li><p><strong>query_kwargs</strong> – 用于查询量子结果的附加关键字参数,默认:{“timeout”:2,”print_query_info”:True,”sub_circuits_split_size”:1}。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>一个可以计算量子电路的模块。</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pyqpanda</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pq</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.qnn.vqc.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">TorchQcloudQuantumLayer</span>

<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">qfun</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span><span class="n">param</span><span class="p">,</span> <span class="n">m_machine</span><span class="p">,</span> <span class="n">m_qlist</span><span class="p">,</span><span class="n">cubits</span><span class="p">):</span>
    <span class="n">measure_qubits</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">m_prog</span> <span class="o">=</span> <span class="n">pq</span><span class="o">.</span><span class="n">QProg</span><span class="p">()</span>
    <span class="n">cir</span> <span class="o">=</span> <span class="n">pq</span><span class="o">.</span><span class="n">QCircuit</span><span class="p">()</span>
    <span class="n">cir</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">RZ</span><span class="p">(</span><span class="n">m_qlist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nb">input</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">cir</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">CNOT</span><span class="p">(</span><span class="n">m_qlist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">m_qlist</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="n">cir</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">RY</span><span class="p">(</span><span class="n">m_qlist</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">param</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">cir</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">CNOT</span><span class="p">(</span><span class="n">m_qlist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">m_qlist</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
    <span class="n">cir</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">RZ</span><span class="p">(</span><span class="n">m_qlist</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="nb">input</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="n">cir</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">RY</span><span class="p">(</span><span class="n">m_qlist</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">param</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="n">cir</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">H</span><span class="p">(</span><span class="n">m_qlist</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
    <span class="n">m_prog</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">cir</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">ele</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">measure_qubits</span><span class="p">):</span>
        <span class="n">m_prog</span> <span class="o">&lt;&lt;</span> <span class="n">pq</span><span class="o">.</span><span class="n">Measure</span><span class="p">(</span><span class="n">m_qlist</span><span class="p">[</span><span class="n">ele</span><span class="p">],</span> <span class="n">cubits</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>  <span class="c1"># pylint: disable=expression-not-assigned</span>
    <span class="k">return</span> <span class="n">m_prog</span>

<span class="n">l</span> <span class="o">=</span> <span class="n">TorchQcloudQuantumLayer</span><span class="p">(</span><span class="n">qfun</span><span class="p">,</span>
                <span class="s2">&quot;3047DE8A59764BEDAC9C3282093B16AF1&quot;</span><span class="p">,</span>
                <span class="mi">2</span><span class="p">,</span>
                <span class="mi">6</span><span class="p">,</span>
                <span class="mi">6</span><span class="p">,</span>
                <span class="n">pauli_str_dict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">shots</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
                <span class="n">initializer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="n">diff_method</span><span class="o">=</span><span class="s2">&quot;parameter_shift&quot;</span><span class="p">,</span>
                <span class="n">submit_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;test_qcloud_fake&quot;</span><span class="p">:</span><span class="kc">True</span><span class="p">},</span>
                <span class="n">query_kwargs</span><span class="o">=</span><span class="p">{})</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">pyvqnet</span><span class="o">.</span><span class="n">tensor</span><span class="o">.</span><span class="n">QTensor</span><span class="p">([[</span><span class="mf">0.56</span><span class="p">,</span><span class="mf">1.2</span><span class="p">],[</span><span class="mf">0.56</span><span class="p">,</span><span class="mf">1.2</span><span class="p">],[</span><span class="mf">0.56</span><span class="p">,</span><span class="mf">1.2</span><span class="p">],[</span><span class="mf">0.56</span><span class="p">,</span><span class="mf">1.2</span><span class="p">],[</span><span class="mf">0.56</span><span class="p">,</span><span class="mf">1.2</span><span class="p">]],</span><span class="n">requires_grad</span><span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">l</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<span class="n">y</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">l</span><span class="o">.</span><span class="n">m_para</span><span class="o">.</span><span class="n">grad</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">grad</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">qfun2</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span><span class="n">param</span><span class="p">,</span> <span class="n">m_machine</span><span class="p">,</span> <span class="n">m_qlist</span><span class="p">,</span><span class="n">cubits</span><span class="p">):</span>
    <span class="n">measure_qubits</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">m_prog</span> <span class="o">=</span> <span class="n">pq</span><span class="o">.</span><span class="n">QProg</span><span class="p">()</span>
    <span class="n">cir</span> <span class="o">=</span> <span class="n">pq</span><span class="o">.</span><span class="n">QCircuit</span><span class="p">()</span>
    <span class="n">cir</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">RZ</span><span class="p">(</span><span class="n">m_qlist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nb">input</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">cir</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">CNOT</span><span class="p">(</span><span class="n">m_qlist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">m_qlist</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="n">cir</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">RY</span><span class="p">(</span><span class="n">m_qlist</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">param</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">cir</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">CNOT</span><span class="p">(</span><span class="n">m_qlist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">m_qlist</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
    <span class="n">cir</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">RZ</span><span class="p">(</span><span class="n">m_qlist</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="nb">input</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="n">cir</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">RY</span><span class="p">(</span><span class="n">m_qlist</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">param</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="n">cir</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">H</span><span class="p">(</span><span class="n">m_qlist</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
    <span class="n">m_prog</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">cir</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">m_prog</span>
<span class="n">l</span> <span class="o">=</span> <span class="n">TorchQcloudQuantumLayer</span><span class="p">(</span><span class="n">qfun2</span><span class="p">,</span>
        <span class="s2">&quot;3047DE8A59764BEDAC9C3282093B16AF&quot;</span><span class="p">,</span>
        <span class="mi">2</span><span class="p">,</span>
        <span class="mi">6</span><span class="p">,</span>
        <span class="mi">6</span><span class="p">,</span>
        <span class="n">pauli_str_dict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Z0 X1&#39;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">:</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="s1">&#39;Y2&#39;</span><span class="p">:</span><span class="o">-</span><span class="mf">0.543</span><span class="p">},</span>
        <span class="n">shots</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
        <span class="n">initializer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">diff_method</span><span class="o">=</span><span class="s2">&quot;parameter_shift&quot;</span><span class="p">,</span>
        <span class="n">submit_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;test_qcloud_fake&quot;</span><span class="p">:</span><span class="kc">True</span><span class="p">},</span>
        <span class="n">query_kwargs</span><span class="o">=</span><span class="p">{})</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">pyvqnet</span><span class="o">.</span><span class="n">tensor</span><span class="o">.</span><span class="n">QTensor</span><span class="p">([[</span><span class="mf">0.56</span><span class="p">,</span><span class="mf">1.2</span><span class="p">],[</span><span class="mf">0.56</span><span class="p">,</span><span class="mf">1.2</span><span class="p">],[</span><span class="mf">0.56</span><span class="p">,</span><span class="mf">1.2</span><span class="p">],[</span><span class="mf">0.56</span><span class="p">,</span><span class="mf">1.2</span><span class="p">]],</span><span class="n">requires_grad</span><span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">l</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<span class="n">y</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">l</span><span class="o">.</span><span class="n">m_para</span><span class="o">.</span><span class="n">grad</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">grad</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>以下TorchQcloud3QuantumLayer,TorchQpanda3QuantumLayer接口的量子计算部分使用pyqpanda3 <a class="reference external" href="https://qcloud.originqc.com.cn/document/qpanda-3/index.html">https://qcloud.originqc.com.cn/document/qpanda-3/index.html</a>。</p>
<p>如果您使用了本模块下的QCloud功能,在代码中导入pyqpanda2 或 使用pyvqnet的pyqpanda2相关封装接口会有错误。</p>
</div>
</section>
<section id="torchqcloud3quantumlayer">
<h3>TorchQcloud3QuantumLayer<a class="headerlink" href="#torchqcloud3quantumlayer" title="Link to this heading">¶</a></h3>
<p>当您安装最新版本pyqpanda3,可以使用本接口定义一个变分线路,并提交到originqc的真实芯片上运行。</p>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.qnn.vqc.torch.TorchQcloud3QuantumLayer">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.qnn.vqc.torch.</span></span><span class="sig-name descname"><span class="pre">TorchQcloud3QuantumLayer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">origin_qprog_func</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">qcloud_token</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">para_num</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pauli_str_dict</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shots</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">initializer</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">diff_method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'parameter_shift'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">submit_kwargs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">query_kwargs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{}</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.qnn.vqc.torch.TorchQcloud3QuantumLayer" title="Link to this definition">¶</a></dt>
<dd><p>使用 pyqpanda3的 originqc 真实芯片的抽象计算模块。 它提交参数化量子电路到真实芯片并获得测量结果。
如果 diff_method == “random_coordinate_descent” ,该层将随机选择单个参数来计算梯度,其他参数将保持为零。参考:<a class="reference external" href="https://arxiv.org/abs/2311.00088">https://arxiv.org/abs/2311.00088</a></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>qcloud_token 为您到 <a class="reference external" href="https://qcloud.originqc.com.cn/">https://qcloud.originqc.com.cn/</a> 中申请的api token。
origin_qprog_func 需要返回pypqanda3.core.QProg类型的数据,如果没有设置pauli_str_dict,需要保证该QProg中已经插入了measure。
origin_qprog_func 的形式必须按照如下:</p>
<p>origin_qprog_func(input,param )</p>
<blockquote>
<div><p><cite>input</cite>: 输入1~2维经典数据,二维的情况下,第一个维度为批处理大小。</p>
<p><cite>param</cite>: 输入一维的变分量子线路的待训练参数。</p>
</div></blockquote>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.nn.Module</span></code> 以及 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code>,可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
<p>该类的 <code class="docutils literal notranslate"><span class="pre">_buffers</span></code> 中的数据为 <code class="docutils literal notranslate"><span class="pre">torch.Tensor</span></code> 类型。
该类的 <code class="docutils literal notranslate"><span class="pre">_parmeters</span></code> 中的数据为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Parameter</span></code> 类型。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>origin_qprog_func</strong> – QPanda 构建的变分量子电路函数,必须返回QProg。</p></li>
<li><p><strong>qcloud_token</strong> – <cite>str</cite> - 量子机的类型或用于执行的云令牌。</p></li>
<li><p><strong>para_num</strong> – <cite>int</cite> - 参数数量,参数是大小为[para_num]的QTensor。</p></li>
<li><p><strong>pauli_str_dict</strong> – <cite>dict|list</cite> - 表示量子电路中泡利运算符的字典或字典列表。 默认为“无”,则进行测量操作,如果输入泡利算符的字典,则会计算单个期望或者多个期望。</p></li>
<li><p><strong>shot</strong> – <cite>int</cite> - 测量次数。 默认值为 1000。</p></li>
<li><p><strong>initializer</strong> – 参数值的初始化器。 默认为“无”,使用0~2*pi正态分布。</p></li>
<li><p><strong>dtype</strong> – 参数的数据类型。 默认值为 None,即使用默认数据类型pyvqnet.kfloat32。</p></li>
<li><p><strong>name</strong> – 模块的名称。 默认为空字符串。</p></li>
<li><p><strong>diff_method</strong> – 梯度计算的微分方法。 默认为“parameter_shift”,”random_coordinate_descent”。</p></li>
<li><p><strong>submit_kwargs</strong> – 用于提交量子电路的附加关键字参数,默认:{“chip_id”:pyqpanda.real_chip_type.origin_72,”is_amend”:True,”is_mapping”:True,”is_optimization”:True,”compile_level”:3,”default_task_group_size”:200,”test_qcloud_fake”:False},当设置test_qcloud_fake为True则本地CPUQVM模拟。</p></li>
<li><p><strong>query_kwargs</strong> – 用于查询量子结果的附加关键字参数,默认:{“timeout”:2,”print_query_info”:True,”sub_circuits_split_size”:1}。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>一个可以计算量子电路的模块。</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pyqpanda3.core</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pq</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.qnn.vqc.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">TorchQcloud3QuantumLayer</span>

<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">qfun</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span><span class="n">param</span><span class="p">):</span>

    <span class="n">m_qlist</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
    <span class="n">cubits</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
    <span class="n">measure_qubits</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">m_prog</span> <span class="o">=</span> <span class="n">pq</span><span class="o">.</span><span class="n">QProg</span><span class="p">()</span>
    <span class="n">cir</span> <span class="o">=</span> <span class="n">pq</span><span class="o">.</span><span class="n">QCircuit</span><span class="p">()</span>
    <span class="n">cir</span><span class="o">&lt;&lt;</span><span class="n">pq</span><span class="o">.</span><span class="n">RZ</span><span class="p">(</span><span class="n">m_qlist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nb">input</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">cir</span><span class="o">&lt;&lt;</span><span class="n">pq</span><span class="o">.</span><span class="n">CNOT</span><span class="p">(</span><span class="n">m_qlist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">m_qlist</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">cir</span><span class="o">&lt;&lt;</span><span class="n">pq</span><span class="o">.</span><span class="n">RY</span><span class="p">(</span><span class="n">m_qlist</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">param</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">cir</span><span class="o">&lt;&lt;</span><span class="n">pq</span><span class="o">.</span><span class="n">CNOT</span><span class="p">(</span><span class="n">m_qlist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">m_qlist</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">cir</span><span class="o">&lt;&lt;</span><span class="n">pq</span><span class="o">.</span><span class="n">RZ</span><span class="p">(</span><span class="n">m_qlist</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="nb">input</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">cir</span><span class="o">&lt;&lt;</span><span class="n">pq</span><span class="o">.</span><span class="n">RY</span><span class="p">(</span><span class="n">m_qlist</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">param</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">cir</span><span class="o">&lt;&lt;</span><span class="n">pq</span><span class="o">.</span><span class="n">H</span><span class="p">(</span><span class="n">m_qlist</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">m_prog</span><span class="o">&lt;&lt;</span><span class="n">cir</span>

    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">ele</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">measure_qubits</span><span class="p">):</span>
        <span class="n">m_prog</span> <span class="o">&lt;&lt;</span> <span class="n">pq</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="n">m_qlist</span><span class="p">[</span><span class="n">ele</span><span class="p">],</span> <span class="n">cubits</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>  <span class="c1"># pylint: disable=expression-not-assigned</span>
    <span class="k">return</span> <span class="n">m_prog</span>

<span class="n">l</span> <span class="o">=</span> <span class="n">TorchQcloud3QuantumLayer</span><span class="p">(</span><span class="n">qfun</span><span class="p">,</span>
                <span class="s2">&quot;3047DE8A59764BEDAC9C3282093B16AF1&quot;</span><span class="p">,</span>
                <span class="mi">2</span><span class="p">,</span>
                <span class="n">pauli_str_dict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">shots</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
                <span class="n">initializer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="n">diff_method</span><span class="o">=</span><span class="s2">&quot;parameter_shift&quot;</span><span class="p">,</span>
                <span class="n">submit_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;test_qcloud_fake&quot;</span><span class="p">:</span><span class="kc">True</span><span class="p">},</span>
                <span class="n">query_kwargs</span><span class="o">=</span><span class="p">{})</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">pyvqnet</span><span class="o">.</span><span class="n">tensor</span><span class="o">.</span><span class="n">QTensor</span><span class="p">([[</span><span class="mf">0.56</span><span class="p">,</span><span class="mf">1.2</span><span class="p">],[</span><span class="mf">0.56</span><span class="p">,</span><span class="mf">1.2</span><span class="p">],[</span><span class="mf">0.56</span><span class="p">,</span><span class="mf">1.2</span><span class="p">],[</span><span class="mf">0.56</span><span class="p">,</span><span class="mf">1.2</span><span class="p">],[</span><span class="mf">0.56</span><span class="p">,</span><span class="mf">1.2</span><span class="p">]],</span><span class="n">requires_grad</span><span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">l</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<span class="n">y</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">l</span><span class="o">.</span><span class="n">m_para</span><span class="o">.</span><span class="n">grad</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">grad</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">qfun2</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span><span class="n">param</span> <span class="p">):</span>

    <span class="n">m_qlist</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
    <span class="n">cubits</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
    <span class="n">measure_qubits</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">m_prog</span> <span class="o">=</span> <span class="n">pq</span><span class="o">.</span><span class="n">QProg</span><span class="p">()</span>
    <span class="n">cir</span> <span class="o">=</span> <span class="n">pq</span><span class="o">.</span><span class="n">QCircuit</span><span class="p">()</span>
    <span class="n">cir</span><span class="o">&lt;&lt;</span><span class="n">pq</span><span class="o">.</span><span class="n">RZ</span><span class="p">(</span><span class="n">m_qlist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nb">input</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">cir</span><span class="o">&lt;&lt;</span><span class="n">pq</span><span class="o">.</span><span class="n">CNOT</span><span class="p">(</span><span class="n">m_qlist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">m_qlist</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">cir</span><span class="o">&lt;&lt;</span><span class="n">pq</span><span class="o">.</span><span class="n">RY</span><span class="p">(</span><span class="n">m_qlist</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">param</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">cir</span><span class="o">&lt;&lt;</span><span class="n">pq</span><span class="o">.</span><span class="n">CNOT</span><span class="p">(</span><span class="n">m_qlist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">m_qlist</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">cir</span><span class="o">&lt;&lt;</span><span class="n">pq</span><span class="o">.</span><span class="n">RZ</span><span class="p">(</span><span class="n">m_qlist</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="nb">input</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">cir</span><span class="o">&lt;&lt;</span><span class="n">pq</span><span class="o">.</span><span class="n">RY</span><span class="p">(</span><span class="n">m_qlist</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">param</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">cir</span><span class="o">&lt;&lt;</span><span class="n">pq</span><span class="o">.</span><span class="n">H</span><span class="p">(</span><span class="n">m_qlist</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">m_prog</span><span class="o">&lt;&lt;</span><span class="n">cir</span>

    <span class="k">return</span> <span class="n">m_prog</span>
<span class="n">l</span> <span class="o">=</span> <span class="n">TorchQcloud3QuantumLayer</span><span class="p">(</span><span class="n">qfun2</span><span class="p">,</span>
        <span class="s2">&quot;3047DE8A59764BEDAC9C3282093B16AF&quot;</span><span class="p">,</span>
        <span class="mi">2</span><span class="p">,</span>

        <span class="n">pauli_str_dict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Z0 X1&#39;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">:</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="s1">&#39;Y2&#39;</span><span class="p">:</span><span class="o">-</span><span class="mf">0.543</span><span class="p">},</span>
        <span class="n">shots</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
        <span class="n">initializer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">diff_method</span><span class="o">=</span><span class="s2">&quot;parameter_shift&quot;</span><span class="p">,</span>
        <span class="n">submit_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;test_qcloud_fake&quot;</span><span class="p">:</span><span class="kc">True</span><span class="p">},</span>
        <span class="n">query_kwargs</span><span class="o">=</span><span class="p">{})</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">pyvqnet</span><span class="o">.</span><span class="n">tensor</span><span class="o">.</span><span class="n">QTensor</span><span class="p">([[</span><span class="mf">0.56</span><span class="p">,</span><span class="mf">1.2</span><span class="p">],[</span><span class="mf">0.56</span><span class="p">,</span><span class="mf">1.2</span><span class="p">],[</span><span class="mf">0.56</span><span class="p">,</span><span class="mf">1.2</span><span class="p">],[</span><span class="mf">0.56</span><span class="p">,</span><span class="mf">1.2</span><span class="p">]],</span><span class="n">requires_grad</span><span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">l</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<span class="n">y</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">l</span><span class="o">.</span><span class="n">m_para</span><span class="o">.</span><span class="n">grad</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">grad</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="torchqpanda3quantumlayer">
<h3>TorchQpanda3QuantumLayer<a class="headerlink" href="#torchqpanda3quantumlayer" title="Link to this heading">¶</a></h3>
<p>如您更加熟悉pyQPanda3语法,可以使用该接口TorchQpanda3QuantumLayer。</p>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.qnn.vqc.torch.TorchQpanda3QuantumLayer">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.qnn.vqc.torch.</span></span><span class="sig-name descname"><span class="pre">TorchQpanda3QuantumLayer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">qprog_with_measure</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">para_num</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">diff_method</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'parameter_shift'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">delta</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0.01</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.qnn.vqc.torch.TorchQpanda3QuantumLayer" title="Link to this definition">¶</a></dt>
<dd><blockquote>
<div><p>变分量子层的抽象计算模块。对一个参数化的量子线路使用pyQPanda3进行仿真,得到测量结果。该变分量子层继承了VQNet框架的梯度计算模块,可以使用参数漂移法等计算线路参数的梯度,训练变分量子线路模型或将变分量子线路嵌入混合量子和经典模型。</p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>qprog_with_measure</strong> – 用pyQPand构建的量子线路运行和测量函数。</p></li>
<li><p><strong>para_num</strong> – <cite>int</cite> - 参数个数。</p></li>
<li><p><strong>diff_method</strong> – 求解量子线路参数梯度的方法,“参数位移”或“有限差分”,默认参数偏移。</p></li>
<li><p><strong>delta</strong> – 有限差分计算梯度时的 delta。</p></li>
<li><p><strong>dtype</strong> – 参数的数据类型,defaults:None,使用默认数据类型:kfloat32,代表32位浮点数。</p></li>
<li><p><strong>name</strong> – 这个模块的名字, 默认为””。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>一个可以计算量子线路的模块。</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>qprog_with_measure是pyQPanda中定义的量子线路函数 :<a class="reference external" href="https://qcloud.originqc.com.cn/document/qpanda-3/db/d6c/tutorial_circuit_and_program.html">https://qcloud.originqc.com.cn/document/qpanda-3/db/d6c/tutorial_circuit_and_program.html</a>.。</p>
<p>此函数必须包含以下参数作为函数入参（即使某个参数未实际使用）,否则无法在本函数中正常运行。</p>
<p>量子线路函数 qprog_with_measure (input,param,nqubits,ncubits)的使用可参考下面的例子。</p>
<p><cite>input</cite>: 输入一维经典数据。如果没有,输入 None。</p>
<p><cite>param</cite>: 输入一维的变分量子线路的待训练参数。</p>
</div>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pyqpanda3.core</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pq</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.qnn.pq3</span><span class="w"> </span><span class="kn">import</span> <span class="n">ProbsMeasure</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.tensor</span><span class="w"> </span><span class="kn">import</span> <span class="n">QTensor</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.qnn.vqc.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">TorchQpanda3QuantumLayer</span>
<span class="k">def</span><span class="w"> </span><span class="nf">pqctest</span> <span class="p">(</span><span class="nb">input</span><span class="p">,</span><span class="n">param</span><span class="p">):</span>
    <span class="n">num_of_qubits</span> <span class="o">=</span> <span class="mi">4</span>

    <span class="n">m_machine</span> <span class="o">=</span> <span class="n">pq</span><span class="o">.</span><span class="n">CPUQVM</span><span class="p">()</span><span class="c1"># outside</span>

    <span class="n">qubits</span> <span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="n">num_of_qubits</span><span class="p">)</span>

    <span class="n">circuit</span> <span class="o">=</span> <span class="n">pq</span><span class="o">.</span><span class="n">QCircuit</span><span class="p">()</span>
    <span class="n">circuit</span><span class="o">&lt;&lt;</span><span class="n">pq</span><span class="o">.</span><span class="n">H</span><span class="p">(</span><span class="n">qubits</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">circuit</span><span class="o">&lt;&lt;</span><span class="n">pq</span><span class="o">.</span><span class="n">H</span><span class="p">(</span><span class="n">qubits</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">circuit</span><span class="o">&lt;&lt;</span><span class="n">pq</span><span class="o">.</span><span class="n">H</span><span class="p">(</span><span class="n">qubits</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">circuit</span><span class="o">&lt;&lt;</span><span class="n">pq</span><span class="o">.</span><span class="n">H</span><span class="p">(</span><span class="n">qubits</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>

    <span class="n">circuit</span><span class="o">&lt;&lt;</span><span class="n">pq</span><span class="o">.</span><span class="n">RZ</span><span class="p">(</span><span class="n">qubits</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nb">input</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">circuit</span><span class="o">&lt;&lt;</span><span class="n">pq</span><span class="o">.</span><span class="n">RZ</span><span class="p">(</span><span class="n">qubits</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="nb">input</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">circuit</span><span class="o">&lt;&lt;</span><span class="n">pq</span><span class="o">.</span><span class="n">RZ</span><span class="p">(</span><span class="n">qubits</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="nb">input</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">circuit</span><span class="o">&lt;&lt;</span><span class="n">pq</span><span class="o">.</span><span class="n">RZ</span><span class="p">(</span><span class="n">qubits</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="nb">input</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>

    <span class="n">circuit</span><span class="o">&lt;&lt;</span><span class="n">pq</span><span class="o">.</span><span class="n">CNOT</span><span class="p">(</span><span class="n">qubits</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">qubits</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">circuit</span><span class="o">&lt;&lt;</span><span class="n">pq</span><span class="o">.</span><span class="n">RZ</span><span class="p">(</span><span class="n">qubits</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">param</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">circuit</span><span class="o">&lt;&lt;</span><span class="n">pq</span><span class="o">.</span><span class="n">CNOT</span><span class="p">(</span><span class="n">qubits</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">qubits</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="n">circuit</span><span class="o">&lt;&lt;</span><span class="n">pq</span><span class="o">.</span><span class="n">CNOT</span><span class="p">(</span><span class="n">qubits</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">qubits</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">circuit</span><span class="o">&lt;&lt;</span><span class="n">pq</span><span class="o">.</span><span class="n">RZ</span><span class="p">(</span><span class="n">qubits</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">param</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">circuit</span><span class="o">&lt;&lt;</span><span class="n">pq</span><span class="o">.</span><span class="n">CNOT</span><span class="p">(</span><span class="n">qubits</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">qubits</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

    <span class="n">circuit</span><span class="o">&lt;&lt;</span><span class="n">pq</span><span class="o">.</span><span class="n">CNOT</span><span class="p">(</span><span class="n">qubits</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">qubits</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
    <span class="n">circuit</span><span class="o">&lt;&lt;</span><span class="n">pq</span><span class="o">.</span><span class="n">RZ</span><span class="p">(</span><span class="n">qubits</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="n">param</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">circuit</span><span class="o">&lt;&lt;</span><span class="n">pq</span><span class="o">.</span><span class="n">CNOT</span><span class="p">(</span><span class="n">qubits</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">qubits</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
    <span class="c1">#print(circuit)</span>

    <span class="n">prog</span> <span class="o">=</span> <span class="n">pq</span><span class="o">.</span><span class="n">QProg</span><span class="p">()</span>
    <span class="n">prog</span><span class="o">&lt;&lt;</span><span class="n">circuit</span>

    <span class="n">rlt_prob</span> <span class="o">=</span> <span class="n">ProbsMeasure</span><span class="p">(</span><span class="n">m_machine</span><span class="p">,</span><span class="n">prog</span><span class="p">,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">rlt_prob</span>

<span class="n">pqc</span> <span class="o">=</span> <span class="n">TorchQpanda3QuantumLayer</span><span class="p">(</span><span class="n">pqctest</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>

<span class="c1">#classic data as input</span>
<span class="nb">input</span> <span class="o">=</span> <span class="n">QTensor</span><span class="p">([[</span><span class="mf">1.0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">],[</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],[</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]],</span><span class="n">requires_grad</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1">#forward circuits</span>
<span class="n">rlt</span> <span class="o">=</span> <span class="n">pqc</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">rlt</span><span class="p">)</span>

<span class="n">grad</span> <span class="o">=</span>  <span class="n">QTensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">rlt</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">*</span><span class="mi">1000</span><span class="p">)</span>
<span class="c1">#backward circuits</span>
<span class="n">rlt</span><span class="o">.</span><span class="n">backward</span><span class="p">(</span><span class="n">grad</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">pqc</span><span class="o">.</span><span class="n">m_para</span><span class="o">.</span><span class="n">grad</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">input</span><span class="o">.</span><span class="n">grad</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
</section>
<section id="id9">
<h2>基于自动微分的变分量子线路模块和接口<a class="headerlink" href="#id9" title="Link to this heading">¶</a></h2>
<section id="id10">
<h3>基类<a class="headerlink" href="#id10" title="Link to this heading">¶</a></h3>
<p>编写变分量子线路模型需要继承于 <code class="docutils literal notranslate"><span class="pre">QModule</span></code>。</p>
<section id="qmodule">
<h4>QModule<a class="headerlink" href="#qmodule" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.qnn.vqc.torch.QModule">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.qnn.vqc.torch.</span></span><span class="sig-name descname"><span class="pre">QModule</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.qnn.vqc.torch.QModule" title="Link to this definition">¶</a></dt>
<dd><p>当用户使用 <cite>torch</cite> 后端时候,定义量子变分线路模型 <cite>Module</cite> 应该继承的基类。
该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.nn.torch.TorchModule</span></code> 以及 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code>。
该类可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>该类以及其派生类仅适用于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.backends.set_backend(&quot;torch&quot;)</span></code> , 不要与默认 <code class="docutils literal notranslate"><span class="pre">pyvqnet.nn</span></code> 下的 <code class="docutils literal notranslate"><span class="pre">Module</span></code> 混用。</p>
<p>该类的 <code class="docutils literal notranslate"><span class="pre">_buffers</span></code> 中的数据为 <code class="docutils literal notranslate"><span class="pre">torch.Tensor</span></code> 类型。
该类的 <code class="docutils literal notranslate"><span class="pre">_parmeters</span></code> 中的数据为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Parameter</span></code> 类型。</p>
</div>
</dd></dl>

</section>
<section id="qmachine">
<h4>QMachine<a class="headerlink" href="#qmachine" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.qnn.vqc.torch.QMachine">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.qnn.vqc.torch.</span></span><span class="sig-name descname"><span class="pre">QMachine</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">num_wires</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">pyvqnet.kcomplex64</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">grad_mode</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save_ir</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.qnn.vqc.torch.QMachine" title="Link to this definition">¶</a></dt>
<dd><p>变分量子计算的模拟器类,包含states属性为量子线路的statevectors。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.nn.torch.TorchModule</span></code> 以及 <code class="docutils literal notranslate"><span class="pre">pyvqnet.qnn.QMachine</span></code> 。
该类可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>在每次运行一个完整的量子线路之前,必须使用 <cite>pyvqnet.qnn.vqc.QMachine.reset_states(batchsize)</cite> 将模拟器里面初态重新初始化,并且广播为
(batchsize,*) 维度从而适应批量数据训练。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>num_wires</strong> – 量子比特数。</p></li>
<li><p><strong>dtype</strong> – 计算数据的数据类型。默认值是pyvqnet。kcomplex64,对应的参数精度为pyvqnet.kfloat32。</p></li>
<li><p><strong>grad_mode</strong> – 梯度计算模式,可为 “adjoint”,默认值:””,使用自动微分模拟。</p></li>
<li><p><strong>save_ir</strong> – 设置为True时,将操作保存到originIR,默认值:False。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>输出一个QMachine对象。</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.qnn.vqc.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">QMachine</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="n">qm</span> <span class="o">=</span> <span class="n">QMachine</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">qm</span><span class="o">.</span><span class="n">states</span><span class="p">)</span>
</pre></div>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="pyvqnet.qnn.vqc.torch.QMachine.reset_states">
<span class="sig-name descname"><span class="pre">reset_states</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">batchsize</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.qnn.vqc.torch.QMachine.reset_states" title="Link to this definition">¶</a></dt>
<dd><p>将模拟器里面初态重新初始化,并且广播为
(batchsize,*) 维度从而适应批量数据训练。</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>batchsize</strong> – 批处理维度。</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
</section>
<section id="id11">
<h3>变分量子逻辑门模块<a class="headerlink" href="#id11" title="Link to this heading">¶</a></h3>
<p>以下 <code class="docutils literal notranslate"><span class="pre">pyvqnet.qnn.vqc</span></code> 中的函数接口直接支持 <code class="docutils literal notranslate"><span class="pre">torch</span></code> 后端的 <code class="docutils literal notranslate"><span class="pre">QTensor</span></code> 进行计算。</p>
<table class="docutils align-default" id="id16">
<caption><span class="caption-text">已支持pyvqnet.qnn.vqc接口列表</span><a class="headerlink" href="#id16" title="Link to this table">¶</a></caption>
<tbody>
<tr class="row-odd"><td><p>i</p></td>
<td><p>u3</p></td>
<td><p>phaseshift</p></td>
</tr>
<tr class="row-even"><td><p>hadamard</p></td>
<td><p>cy</p></td>
<td><p>multirz</p></td>
</tr>
<tr class="row-odd"><td><p>t</p></td>
<td><p>cnot</p></td>
<td><p>sdg</p></td>
</tr>
<tr class="row-even"><td><p>s</p></td>
<td><p>cr</p></td>
<td><p>tdg</p></td>
</tr>
<tr class="row-odd"><td><p>paulix</p></td>
<td><p>swap</p></td>
<td><p>controlledphaseshift</p></td>
</tr>
<tr class="row-even"><td><p>pauliy</p></td>
<td><p>cswap</p></td>
<td><p>multicontrolledx</p></td>
</tr>
<tr class="row-odd"><td><p>pauliz</p></td>
<td><p>iswap</p></td>
<td><p>single_excitation</p></td>
</tr>
<tr class="row-even"><td><p>x1</p></td>
<td><p>cz</p></td>
<td><p>double_excitation</p></td>
</tr>
<tr class="row-odd"><td><p>rx</p></td>
<td><p>rxx</p></td>
<td><p>vqc_to_originir_list</p></td>
</tr>
<tr class="row-even"><td><p>ry</p></td>
<td><p>ryy</p></td>
<td><p>originir_to_vqc</p></td>
</tr>
<tr class="row-odd"><td><p>rz</p></td>
<td><p>rzz</p></td>
<td><p>model_summary</p></td>
</tr>
<tr class="row-even"><td><p>crx</p></td>
<td><p>rzx</p></td>
<td><p>wrapper_single_qubit_op_fuse</p></td>
</tr>
<tr class="row-odd"><td><p>cry</p></td>
<td><p>toffoli</p></td>
<td><p>wrapper_commute_controlled</p></td>
</tr>
<tr class="row-even"><td><p>crz</p></td>
<td><p>isingxx</p></td>
<td><p>wrapper_merge_rotations</p></td>
</tr>
<tr class="row-odd"><td><p>p</p></td>
<td><p>isingyy</p></td>
<td><p>wrapper_compile</p></td>
</tr>
<tr class="row-even"><td><p>u1</p></td>
<td><p>isingzz</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>u2</p></td>
<td><p>isingxy</p></td>
<td></td>
</tr>
</tbody>
</table>
<p>以下量子线路模块继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.qnn.vqc.torch.QModule</span></code>,其中计算使用 <code class="docutils literal notranslate"><span class="pre">torch.Tensor</span></code> 进行计算。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类以及其派生类仅适用于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.backends.set_backend(&quot;torch&quot;)</span></code> , 不要与默认 <code class="docutils literal notranslate"><span class="pre">pyvqnet.nn</span></code> 下的 <code class="docutils literal notranslate"><span class="pre">Module</span></code> 混用。</p>
<p>这些类如果有非参数成员变量 <code class="docutils literal notranslate"><span class="pre">_buffers</span></code> ,则其中的数据为 <code class="docutils literal notranslate"><span class="pre">torch.Tensor</span></code> 类型。
这些类如果有参数成员变量 <code class="docutils literal notranslate"><span class="pre">_parmeters</span></code> ,则其中的数据为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Parameter</span></code> 类型。</p>
</div>
<section id="i">
<h4>I<a class="headerlink" href="#i" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.qnn.vqc.torch.I">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.qnn.vqc.torch.</span></span><span class="sig-name descname"><span class="pre">I</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">has_params</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trainable</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">init_params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wires</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">pyvqnet.kcomplex64</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_dagger</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.qnn.vqc.torch.I" title="Link to this definition">¶</a></dt>
<dd><p>定义一个I逻辑门类 。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.qnn.vqc.torch.QModule</span></code> 以及 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code>。
该类可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>has_params</strong> – 是否具有参数,例如RX,RY等门需要设置为True,不含参数的需要设置为False,默认为False。</p></li>
<li><p><strong>trainable</strong> – 是否自带含待训练参数,如果该层使用外部输入数据构建逻辑门矩阵,设置为False,如果待训练参数需要从该层初始化,则为True,默认为False。</p></li>
<li><p><strong>init_params</strong> – 初始化参数,用来编码经典数据QTensor,默认为None。</p></li>
<li><p><strong>wires</strong> – 线路作用的比特索引,默认为None。</p></li>
<li><p><strong>dtype</strong> – 逻辑门内部矩阵的数据精度,可以设置为pyvqnet.kcomplex64,或pyvqnet.kcomplex128,分别对应float输入或者double入参。</p></li>
<li><p><strong>use_dagger</strong> – 是否使用该门的转置共轭版本,默认为False。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>一个 I 逻辑门实例</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.qnn.vqc.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">I</span><span class="p">,</span><span class="n">QMachine</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="n">device</span> <span class="o">=</span> <span class="n">QMachine</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">layer</span> <span class="o">=</span> <span class="n">I</span><span class="p">(</span><span class="n">wires</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">batchsize</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">device</span><span class="o">.</span><span class="n">reset_states</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">layer</span><span class="p">(</span><span class="n">q_machine</span> <span class="o">=</span> <span class="n">device</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">device</span><span class="o">.</span><span class="n">states</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="hadamard">
<h4>Hadamard<a class="headerlink" href="#hadamard" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.qnn.vqc.torch.Hadamard">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.qnn.vqc.torch.</span></span><span class="sig-name descname"><span class="pre">Hadamard</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">has_params</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trainable</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">init_params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wires</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">pyvqnet.kcomplex64</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_dagger</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.qnn.vqc.torch.Hadamard" title="Link to this definition">¶</a></dt>
<dd><p>定义一个Hadamard逻辑门类 。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.qnn.vqc.torch.QModule</span></code> 以及 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code>。
该类可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>has_params</strong> – 是否具有参数,例如RX,RY等门需要设置为True,不含参数的需要设置为False,默认为False。</p></li>
<li><p><strong>trainable</strong> – 是否自带含待训练参数,如果该层使用外部输入数据构建逻辑门矩阵,设置为False,如果待训练参数需要从该层初始化,则为True,默认为False。</p></li>
<li><p><strong>init_params</strong> – 初始化参数,用来编码经典数据QTensor,默认为None。</p></li>
<li><p><strong>wires</strong> – 线路作用的比特索引,默认为None。</p></li>
<li><p><strong>dtype</strong> – 逻辑门内部矩阵的数据精度,可以设置为pyvqnet.kcomplex64,或pyvqnet.kcomplex128,分别对应float输入或者double入参。</p></li>
<li><p><strong>use_dagger</strong> – 是否使用该门的转置共轭版本,默认为False。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>一个 Hadamard 逻辑门实例</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.qnn.vqc.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">Hadamard</span><span class="p">,</span><span class="n">QMachine</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="n">device</span> <span class="o">=</span> <span class="n">QMachine</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">layer</span> <span class="o">=</span> <span class="n">Hadamard</span><span class="p">(</span><span class="n">wires</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">batchsize</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">device</span><span class="o">.</span><span class="n">reset_states</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">layer</span><span class="p">(</span><span class="n">q_machine</span> <span class="o">=</span> <span class="n">device</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">device</span><span class="o">.</span><span class="n">states</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="t">
<h4>T<a class="headerlink" href="#t" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.qnn.vqc.torch.T">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.qnn.vqc.torch.</span></span><span class="sig-name descname"><span class="pre">T</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">has_params</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trainable</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">init_params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wires</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">pyvqnet.kcomplex64</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_dagger</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.qnn.vqc.torch.T" title="Link to this definition">¶</a></dt>
<dd><p>定义一个T逻辑门类 。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.qnn.vqc.torch.QModule</span></code> 以及 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code>。
该类可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>has_params</strong> – 是否具有参数,例如RX,RY等门需要设置为True,不含参数的需要设置为False,默认为False。</p></li>
<li><p><strong>trainable</strong> – 是否自带含待训练参数,如果该层使用外部输入数据构建逻辑门矩阵,设置为False,如果待训练参数需要从该层初始化,则为True,默认为False。</p></li>
<li><p><strong>init_params</strong> – 初始化参数,用来编码经典数据QTensor,默认为None。</p></li>
<li><p><strong>wires</strong> – 线路作用的比特索引,默认为None。</p></li>
<li><p><strong>dtype</strong> – 逻辑门内部矩阵的数据精度,可以设置为pyvqnet.kcomplex64,或pyvqnet.kcomplex128,分别对应float输入或者double入参。</p></li>
<li><p><strong>use_dagger</strong> – 是否使用该门的转置共轭版本,默认为False。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>一个 T 逻辑门实例</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.qnn.vqc.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">T</span><span class="p">,</span><span class="n">QMachine</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="n">device</span> <span class="o">=</span> <span class="n">QMachine</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">layer</span> <span class="o">=</span> <span class="n">T</span><span class="p">(</span><span class="n">wires</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">batchsize</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">device</span><span class="o">.</span><span class="n">reset_states</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">layer</span><span class="p">(</span><span class="n">q_machine</span> <span class="o">=</span> <span class="n">device</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">device</span><span class="o">.</span><span class="n">states</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="s">
<h4>S<a class="headerlink" href="#s" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.qnn.vqc.torch.S">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.qnn.vqc.torch.</span></span><span class="sig-name descname"><span class="pre">S</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">has_params</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trainable</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">init_params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wires</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">pyvqnet.kcomplex64</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_dagger</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.qnn.vqc.torch.S" title="Link to this definition">¶</a></dt>
<dd><p>定义一个S逻辑门类 。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.qnn.vqc.torch.QModule</span></code> 以及 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code>。
该类可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>has_params</strong> – 是否具有参数,例如RX,RY等门需要设置为True,不含参数的需要设置为False,默认为False。</p></li>
<li><p><strong>trainable</strong> – 是否自带含待训练参数,如果该层使用外部输入数据构建逻辑门矩阵,设置为False,如果待训练参数需要从该层初始化,则为True,默认为False。</p></li>
<li><p><strong>init_params</strong> – 初始化参数,用来编码经典数据QTensor,默认为None。</p></li>
<li><p><strong>wires</strong> – 线路作用的比特索引,默认为None。</p></li>
<li><p><strong>dtype</strong> – 逻辑门内部矩阵的数据精度,可以设置为pyvqnet.kcomplex64,或pyvqnet.kcomplex128,分别对应float输入或者double入参。</p></li>
<li><p><strong>use_dagger</strong> – 是否使用该门的转置共轭版本,默认为False。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>一个 S 逻辑门实例。</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.qnn.vqc.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">S</span><span class="p">,</span><span class="n">QMachine</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="n">device</span> <span class="o">=</span> <span class="n">QMachine</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">layer</span> <span class="o">=</span> <span class="n">S</span><span class="p">(</span><span class="n">wires</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">batchsize</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">device</span><span class="o">.</span><span class="n">reset_states</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">layer</span><span class="p">(</span><span class="n">q_machine</span> <span class="o">=</span> <span class="n">device</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">device</span><span class="o">.</span><span class="n">states</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="paulix">
<h4>PauliX<a class="headerlink" href="#paulix" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.qnn.vqc.torch.PauliX">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.qnn.vqc.torch.</span></span><span class="sig-name descname"><span class="pre">PauliX</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">has_params</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trainable</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">init_params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wires</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">pyvqnet.kcomplex64</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_dagger</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.qnn.vqc.torch.PauliX" title="Link to this definition">¶</a></dt>
<dd><p>定义一个PauliX逻辑门类 。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.qnn.vqc.torch.QModule</span></code> 以及 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code>。
该类可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>has_params</strong> – 是否具有参数,例如RX,RY等门需要设置为True,不含参数的需要设置为False,默认为False。</p></li>
<li><p><strong>trainable</strong> – 是否自带含待训练参数,如果该层使用外部输入数据构建逻辑门矩阵,设置为False,如果待训练参数需要从该层初始化,则为True,默认为False。</p></li>
<li><p><strong>init_params</strong> – 初始化参数,用来编码经典数据QTensor,默认为None。</p></li>
<li><p><strong>wires</strong> – 线路作用的比特索引,默认为None。</p></li>
<li><p><strong>dtype</strong> – 逻辑门内部矩阵的数据精度,可以设置为pyvqnet.kcomplex64,或pyvqnet.kcomplex128,分别对应float输入或者double入参。</p></li>
<li><p><strong>use_dagger</strong> – 是否使用该门的转置共轭版本,默认为False。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>一个 PauliX 逻辑门实例。</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.qnn.vqc.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">PauliX</span><span class="p">,</span><span class="n">QMachine</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="n">device</span> <span class="o">=</span> <span class="n">QMachine</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">layer</span> <span class="o">=</span> <span class="n">PauliX</span><span class="p">(</span><span class="n">wires</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">batchsize</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">device</span><span class="o">.</span><span class="n">reset_states</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">layer</span><span class="p">(</span><span class="n">q_machine</span> <span class="o">=</span> <span class="n">device</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">device</span><span class="o">.</span><span class="n">states</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="pauliy">
<h4>PauliY<a class="headerlink" href="#pauliy" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.qnn.vqc.torch.PauliY">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.qnn.vqc.torch.</span></span><span class="sig-name descname"><span class="pre">PauliY</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">has_params</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trainable</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">init_params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wires</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">pyvqnet.kcomplex64</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_dagger</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.qnn.vqc.torch.PauliY" title="Link to this definition">¶</a></dt>
<dd><p>定义一个PauliY逻辑门类 。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.qnn.vqc.torch.QModule</span></code> 以及 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code>。
该类可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>has_params</strong> – 是否具有参数,例如RX,RY等门需要设置为True,不含参数的需要设置为False,默认为False。</p></li>
<li><p><strong>trainable</strong> – 是否自带含待训练参数,如果该层使用外部输入数据构建逻辑门矩阵,设置为False,如果待训练参数需要从该层初始化,则为True,默认为False。</p></li>
<li><p><strong>init_params</strong> – 初始化参数,用来编码经典数据QTensor,默认为None。</p></li>
<li><p><strong>wires</strong> – 线路作用的比特索引,默认为None。</p></li>
<li><p><strong>dtype</strong> – 逻辑门内部矩阵的数据精度,可以设置为pyvqnet.kcomplex64,或pyvqnet.kcomplex128,分别对应float输入或者double入参。</p></li>
<li><p><strong>use_dagger</strong> – 是否使用该门的转置共轭版本,默认为False。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>一个 PauliY 逻辑门实例。</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.qnn.vqc.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">PauliY</span><span class="p">,</span><span class="n">QMachine</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="n">device</span> <span class="o">=</span> <span class="n">QMachine</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">layer</span> <span class="o">=</span> <span class="n">PauliY</span><span class="p">(</span><span class="n">wires</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">batchsize</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">device</span><span class="o">.</span><span class="n">reset_states</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">layer</span><span class="p">(</span><span class="n">q_machine</span> <span class="o">=</span> <span class="n">device</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">device</span><span class="o">.</span><span class="n">states</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="pauliz">
<h4>PauliZ<a class="headerlink" href="#pauliz" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.qnn.vqc.torch.PauliZ">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.qnn.vqc.torch.</span></span><span class="sig-name descname"><span class="pre">PauliZ</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">has_params</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trainable</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">init_params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wires</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">pyvqnet.kcomplex64</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_dagger</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.qnn.vqc.torch.PauliZ" title="Link to this definition">¶</a></dt>
<dd><p>定义一个PauliZ逻辑门类 。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.qnn.vqc.torch.QModule</span></code> 以及 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code>。
该类可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>has_params</strong> – 是否具有参数,例如RX,RY等门需要设置为True,不含参数的需要设置为False,默认为False。</p></li>
<li><p><strong>trainable</strong> – 是否自带含待训练参数,如果该层使用外部输入数据构建逻辑门矩阵,设置为False,如果待训练参数需要从该层初始化,则为True,默认为False。</p></li>
<li><p><strong>init_params</strong> – 初始化参数,用来编码经典数据QTensor,默认为None。</p></li>
<li><p><strong>wires</strong> – 线路作用的比特索引,默认为None。</p></li>
<li><p><strong>dtype</strong> – 逻辑门内部矩阵的数据精度,可以设置为pyvqnet.kcomplex64,或pyvqnet.kcomplex128,分别对应float输入或者double入参。</p></li>
<li><p><strong>use_dagger</strong> – 是否使用该门的转置共轭版本,默认为False。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>一个 PauliZ 逻辑门实例。</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.qnn.vqc.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">PauliZ</span><span class="p">,</span><span class="n">QMachine</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="n">device</span> <span class="o">=</span> <span class="n">QMachine</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">layer</span> <span class="o">=</span> <span class="n">PauliZ</span><span class="p">(</span><span class="n">wires</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">batchsize</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">device</span><span class="o">.</span><span class="n">reset_states</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">layer</span><span class="p">(</span><span class="n">q_machine</span> <span class="o">=</span> <span class="n">device</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">device</span><span class="o">.</span><span class="n">states</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="x1">
<h4>X1<a class="headerlink" href="#x1" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.qnn.vqc.torch.X1">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.qnn.vqc.torch.</span></span><span class="sig-name descname"><span class="pre">X1</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">has_params</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trainable</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">init_params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wires</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">pyvqnet.kcomplex64</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_dagger</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.qnn.vqc.torch.X1" title="Link to this definition">¶</a></dt>
<dd><p>定义一个X1逻辑门类 。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.qnn.vqc.torch.QModule</span></code> 以及 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code>。
该类可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>has_params</strong> – 是否具有参数,例如RX,RY等门需要设置为True,不含参数的需要设置为False,默认为False。</p></li>
<li><p><strong>trainable</strong> – 是否自带含待训练参数,如果该层使用外部输入数据构建逻辑门矩阵,设置为False,如果待训练参数需要从该层初始化,则为True,默认为False。</p></li>
<li><p><strong>init_params</strong> – 初始化参数,用来编码经典数据QTensor,默认为None。</p></li>
<li><p><strong>wires</strong> – 线路作用的比特索引,默认为None。</p></li>
<li><p><strong>dtype</strong> – 逻辑门内部矩阵的数据精度,可以设置为pyvqnet.kcomplex64,或pyvqnet.kcomplex128,分别对应float输入或者double入参。</p></li>
<li><p><strong>use_dagger</strong> – 是否使用该门的转置共轭版本,默认为False。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>一个 X1 逻辑门实例。</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.qnn.vqc.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">X1</span><span class="p">,</span><span class="n">QMachine</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="n">device</span> <span class="o">=</span> <span class="n">QMachine</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">layer</span> <span class="o">=</span> <span class="n">X1</span><span class="p">(</span><span class="n">wires</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">batchsize</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">device</span><span class="o">.</span><span class="n">reset_states</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">layer</span><span class="p">(</span><span class="n">q_machine</span> <span class="o">=</span> <span class="n">device</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">device</span><span class="o">.</span><span class="n">states</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="rx">
<h4>RX<a class="headerlink" href="#rx" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.qnn.vqc.torch.RX">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.qnn.vqc.torch.</span></span><span class="sig-name descname"><span class="pre">RX</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">has_params</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trainable</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">init_params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wires</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">pyvqnet.kcomplex64</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_dagger</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.qnn.vqc.torch.RX" title="Link to this definition">¶</a></dt>
<dd><p>定义一个RX逻辑门类 。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.qnn.vqc.torch.QModule</span></code> 以及 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code>。
该类可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>has_params</strong> – 是否具有参数,例如RX,RY等门需要设置为True,不含参数的需要设置为False,默认为False。</p></li>
<li><p><strong>trainable</strong> – 是否自带含待训练参数,如果该层使用外部输入数据构建逻辑门矩阵,设置为False,如果待训练参数需要从该层初始化,则为True,默认为False。</p></li>
<li><p><strong>init_params</strong> – 初始化参数,用来编码经典数据QTensor,默认为None。</p></li>
<li><p><strong>wires</strong> – 线路作用的比特索引,默认为None。</p></li>
<li><p><strong>dtype</strong> – 逻辑门内部矩阵的数据精度,可以设置为pyvqnet.kcomplex64,或pyvqnet.kcomplex128,分别对应float输入或者double入参。</p></li>
<li><p><strong>use_dagger</strong> – 是否使用该门的转置共轭版本,默认为False。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>一个 RX 逻辑门实例。</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.qnn.vqc.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">RX</span><span class="p">,</span><span class="n">QMachine</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="n">device</span> <span class="o">=</span> <span class="n">QMachine</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">layer</span> <span class="o">=</span> <span class="n">RX</span><span class="p">(</span><span class="n">has_params</span><span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">trainable</span><span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">wires</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">batchsize</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">device</span><span class="o">.</span><span class="n">reset_states</span><span class="p">(</span><span class="n">batchsize</span><span class="p">)</span>
<span class="n">layer</span><span class="p">(</span><span class="n">q_machine</span> <span class="o">=</span> <span class="n">device</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">device</span><span class="o">.</span><span class="n">states</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="ry">
<h4>RY<a class="headerlink" href="#ry" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.qnn.vqc.torch.RY">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.qnn.vqc.torch.</span></span><span class="sig-name descname"><span class="pre">RY</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">has_params</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trainable</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">init_params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wires</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">pyvqnet.kcomplex64</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_dagger</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.qnn.vqc.torch.RY" title="Link to this definition">¶</a></dt>
<dd><p>定义一个RY逻辑门类 。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.qnn.vqc.torch.QModule</span></code> 以及 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code>。
该类可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>has_params</strong> – 是否具有参数,例如RX,RY等门需要设置为True,不含参数的需要设置为False,默认为False。</p></li>
<li><p><strong>trainable</strong> – 是否自带含待训练参数,如果该层使用外部输入数据构建逻辑门矩阵,设置为False,如果待训练参数需要从该层初始化,则为True,默认为False。</p></li>
<li><p><strong>init_params</strong> – 初始化参数,用来编码经典数据QTensor,默认为None。</p></li>
<li><p><strong>wires</strong> – 线路作用的比特索引,默认为None。</p></li>
<li><p><strong>dtype</strong> – 逻辑门内部矩阵的数据精度,可以设置为pyvqnet.kcomplex64,或pyvqnet.kcomplex128,分别对应float输入或者double入参。</p></li>
<li><p><strong>use_dagger</strong> – 是否使用该门的转置共轭版本,默认为False。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>一个 RY 逻辑门实例。</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.qnn.vqc.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">RY</span><span class="p">,</span><span class="n">QMachine</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="n">device</span> <span class="o">=</span> <span class="n">QMachine</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">layer</span> <span class="o">=</span> <span class="n">RY</span><span class="p">(</span><span class="n">has_params</span><span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">trainable</span><span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">wires</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">batchsize</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">device</span><span class="o">.</span><span class="n">reset_states</span><span class="p">(</span><span class="n">batchsize</span><span class="p">)</span>
<span class="n">layer</span><span class="p">(</span><span class="n">q_machine</span> <span class="o">=</span> <span class="n">device</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">device</span><span class="o">.</span><span class="n">states</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="rz">
<h4>RZ<a class="headerlink" href="#rz" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.qnn.vqc.torch.RZ">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.qnn.vqc.torch.</span></span><span class="sig-name descname"><span class="pre">RZ</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">has_params</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trainable</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">init_params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wires</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">pyvqnet.kcomplex64</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_dagger</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.qnn.vqc.torch.RZ" title="Link to this definition">¶</a></dt>
<dd><p>定义一个RZ逻辑门类 。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.qnn.vqc.torch.QModule</span></code> 以及 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code>。
该类可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>has_params</strong> – 是否具有参数,例如RX,RY等门需要设置为True,不含参数的需要设置为False,默认为False。</p></li>
<li><p><strong>trainable</strong> – 是否自带含待训练参数,如果该层使用外部输入数据构建逻辑门矩阵,设置为False,如果待训练参数需要从该层初始化,则为True,默认为False。</p></li>
<li><p><strong>init_params</strong> – 初始化参数,用来编码经典数据QTensor,默认为None。</p></li>
<li><p><strong>wires</strong> – 线路作用的比特索引,默认为None。</p></li>
<li><p><strong>dtype</strong> – 逻辑门内部矩阵的数据精度,可以设置为pyvqnet.kcomplex64,或pyvqnet.kcomplex128,分别对应float输入或者double入参。</p></li>
<li><p><strong>use_dagger</strong> – 是否使用该门的转置共轭版本,默认为False。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>一个 RZ 逻辑门实例。</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.qnn.vqc.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">RZ</span><span class="p">,</span><span class="n">QMachine</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="n">device</span> <span class="o">=</span> <span class="n">QMachine</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">layer</span> <span class="o">=</span> <span class="n">RZ</span><span class="p">(</span><span class="n">has_params</span><span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">trainable</span><span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">wires</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">batchsize</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">device</span><span class="o">.</span><span class="n">reset_states</span><span class="p">(</span><span class="n">batchsize</span><span class="p">)</span>
<span class="n">layer</span><span class="p">(</span><span class="n">q_machine</span> <span class="o">=</span> <span class="n">device</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">device</span><span class="o">.</span><span class="n">states</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="crx">
<h4>CRX<a class="headerlink" href="#crx" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.qnn.vqc.torch.CRX">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.qnn.vqc.torch.</span></span><span class="sig-name descname"><span class="pre">CRX</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">has_params</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trainable</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">init_params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wires</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">pyvqnet.kcomplex64</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_dagger</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.qnn.vqc.torch.CRX" title="Link to this definition">¶</a></dt>
<dd><p>定义一个CRX逻辑门类 。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.qnn.vqc.torch.QModule</span></code> 以及 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code>。
该类可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>has_params</strong> – 是否具有参数,例如RX,RY等门需要设置为True,不含参数的需要设置为False,默认为False。</p></li>
<li><p><strong>trainable</strong> – 是否自带含待训练参数,如果该层使用外部输入数据构建逻辑门矩阵,设置为False,如果待训练参数需要从该层初始化,则为True,默认为False。</p></li>
<li><p><strong>init_params</strong> – 初始化参数,用来编码经典数据QTensor,默认为None。</p></li>
<li><p><strong>wires</strong> – 线路作用的比特索引,默认为None。</p></li>
<li><p><strong>dtype</strong> – 逻辑门内部矩阵的数据精度,可以设置为pyvqnet.kcomplex64,或pyvqnet.kcomplex128,分别对应float输入或者double入参。</p></li>
<li><p><strong>use_dagger</strong> – 是否使用该门的转置共轭版本,默认为False。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>一个 CRX 逻辑门实例。</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.qnn.vqc.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">CRX</span><span class="p">,</span><span class="n">QMachine</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="n">device</span> <span class="o">=</span> <span class="n">QMachine</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">layer</span> <span class="o">=</span> <span class="n">CRX</span><span class="p">(</span><span class="n">has_params</span><span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">trainable</span><span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">wires</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
<span class="n">batchsize</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">device</span><span class="o">.</span><span class="n">reset_states</span><span class="p">(</span><span class="n">batchsize</span><span class="p">)</span>
<span class="n">layer</span><span class="p">(</span><span class="n">q_machine</span> <span class="o">=</span> <span class="n">device</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">device</span><span class="o">.</span><span class="n">states</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="cry">
<h4>CRY<a class="headerlink" href="#cry" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.qnn.vqc.torch.CRY">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.qnn.vqc.torch.</span></span><span class="sig-name descname"><span class="pre">CRY</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">has_params</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trainable</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">init_params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wires</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">pyvqnet.kcomplex64</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_dagger</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.qnn.vqc.torch.CRY" title="Link to this definition">¶</a></dt>
<dd><p>定义一个CRY逻辑门类 。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.qnn.vqc.torch.QModule</span></code> 以及 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code>。
该类可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>has_params</strong> – 是否具有参数,例如RX,RY等门需要设置为True,不含参数的需要设置为False,默认为False。</p></li>
<li><p><strong>trainable</strong> – 是否自带含待训练参数,如果该层使用外部输入数据构建逻辑门矩阵,设置为False,如果待训练参数需要从该层初始化,则为True,默认为False。</p></li>
<li><p><strong>init_params</strong> – 初始化参数,用来编码经典数据QTensor,默认为None。</p></li>
<li><p><strong>wires</strong> – 线路作用的比特索引,默认为None。</p></li>
<li><p><strong>dtype</strong> – 逻辑门内部矩阵的数据精度,可以设置为pyvqnet.kcomplex64,或pyvqnet.kcomplex128,分别对应float输入或者double入参。</p></li>
<li><p><strong>use_dagger</strong> – 是否使用该门的转置共轭版本,默认为False。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>一个 CRY 逻辑门实例。</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.qnn.vqc.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">CRY</span><span class="p">,</span><span class="n">QMachine</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="n">device</span> <span class="o">=</span> <span class="n">QMachine</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">layer</span> <span class="o">=</span> <span class="n">CRY</span><span class="p">(</span><span class="n">has_params</span><span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">trainable</span><span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">wires</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
<span class="n">batchsize</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">device</span><span class="o">.</span><span class="n">reset_states</span><span class="p">(</span><span class="n">batchsize</span><span class="p">)</span>
<span class="n">layer</span><span class="p">(</span><span class="n">q_machine</span> <span class="o">=</span> <span class="n">device</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">device</span><span class="o">.</span><span class="n">states</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="crz">
<h4>CRZ<a class="headerlink" href="#crz" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.qnn.vqc.torch.CRZ">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.qnn.vqc.torch.</span></span><span class="sig-name descname"><span class="pre">CRZ</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">has_params</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trainable</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">init_params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wires</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">pyvqnet.kcomplex64</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_dagger</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.qnn.vqc.torch.CRZ" title="Link to this definition">¶</a></dt>
<dd><p>定义一个CRZ逻辑门类 。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.qnn.vqc.torch.QModule</span></code> 以及 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code>。
该类可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>has_params</strong> – 是否具有参数,例如RX,RY等门需要设置为True,不含参数的需要设置为False,默认为False。</p></li>
<li><p><strong>trainable</strong> – 是否自带含待训练参数,如果该层使用外部输入数据构建逻辑门矩阵,设置为False,如果待训练参数需要从该层初始化,则为True,默认为False。</p></li>
<li><p><strong>init_params</strong> – 初始化参数,用来编码经典数据QTensor,默认为None。</p></li>
<li><p><strong>wires</strong> – 线路作用的比特索引,默认为None。</p></li>
<li><p><strong>dtype</strong> – 逻辑门内部矩阵的数据精度,可以设置为pyvqnet.kcomplex64,或pyvqnet.kcomplex128,分别对应float输入或者double入参。</p></li>
<li><p><strong>use_dagger</strong> – 是否使用该门的转置共轭版本,默认为False。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>一个 CRZ 逻辑门实例。</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.qnn.vqc.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">CRZ</span><span class="p">,</span><span class="n">QMachine</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="n">device</span> <span class="o">=</span> <span class="n">QMachine</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">layer</span> <span class="o">=</span> <span class="n">CRZ</span><span class="p">(</span><span class="n">has_params</span><span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">trainable</span><span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">wires</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
<span class="n">batchsize</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">device</span><span class="o">.</span><span class="n">reset_states</span><span class="p">(</span><span class="n">batchsize</span><span class="p">)</span>
<span class="n">layer</span><span class="p">(</span><span class="n">q_machine</span> <span class="o">=</span> <span class="n">device</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">device</span><span class="o">.</span><span class="n">states</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="u1">
<h4>U1<a class="headerlink" href="#u1" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.qnn.vqc.torch.U1">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.qnn.vqc.torch.</span></span><span class="sig-name descname"><span class="pre">U1</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">has_params</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trainable</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">init_params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wires</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">pyvqnet.kcomplex64</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_dagger</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.qnn.vqc.torch.U1" title="Link to this definition">¶</a></dt>
<dd><p>定义一个U1逻辑门类 。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.qnn.vqc.torch.QModule</span></code> 以及 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code>。
该类可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>has_params</strong> – 是否具有参数,例如RX,RY等门需要设置为True,不含参数的需要设置为False,默认为False。</p></li>
<li><p><strong>trainable</strong> – 是否自带含待训练参数,如果该层使用外部输入数据构建逻辑门矩阵,设置为False,如果待训练参数需要从该层初始化,则为True,默认为False。</p></li>
<li><p><strong>init_params</strong> – 初始化参数,用来编码经典数据QTensor,默认为None。</p></li>
<li><p><strong>wires</strong> – 线路作用的比特索引,默认为None。</p></li>
<li><p><strong>dtype</strong> – 逻辑门内部矩阵的数据精度,可以设置为pyvqnet.kcomplex64,或pyvqnet.kcomplex128,分别对应float输入或者double入参。</p></li>
<li><p><strong>use_dagger</strong> – 是否使用该门的转置共轭版本,默认为False。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>一个 U1 逻辑门实例。</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.qnn.vqc.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">U1</span><span class="p">,</span><span class="n">QMachine</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="n">device</span> <span class="o">=</span> <span class="n">QMachine</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">layer</span> <span class="o">=</span> <span class="n">U1</span><span class="p">(</span><span class="n">has_params</span><span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">trainable</span><span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">wires</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">batchsize</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">device</span><span class="o">.</span><span class="n">reset_states</span><span class="p">(</span><span class="n">batchsize</span><span class="p">)</span>
<span class="n">layer</span><span class="p">(</span><span class="n">q_machine</span> <span class="o">=</span> <span class="n">device</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">device</span><span class="o">.</span><span class="n">states</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="u2">
<h4>U2<a class="headerlink" href="#u2" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.qnn.vqc.torch.U2">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.qnn.vqc.torch.</span></span><span class="sig-name descname"><span class="pre">U2</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">has_params</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trainable</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">init_params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wires</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">pyvqnet.kcomplex64</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_dagger</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.qnn.vqc.torch.U2" title="Link to this definition">¶</a></dt>
<dd><p>定义一个U2逻辑门类 。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.qnn.vqc.torch.QModule</span></code> 以及 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code>。
该类可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>has_params</strong> – 是否具有参数,例如RX,RY等门需要设置为True,不含参数的需要设置为False,默认为False。</p></li>
<li><p><strong>trainable</strong> – 是否自带含待训练参数,如果该层使用外部输入数据构建逻辑门矩阵,设置为False,如果待训练参数需要从该层初始化,则为True,默认为False。</p></li>
<li><p><strong>init_params</strong> – 初始化参数,用来编码经典数据QTensor,默认为None。</p></li>
<li><p><strong>wires</strong> – 线路作用的比特索引,默认为None。</p></li>
<li><p><strong>dtype</strong> – 逻辑门内部矩阵的数据精度,可以设置为pyvqnet.kcomplex64,或pyvqnet.kcomplex128,分别对应float输入或者double入参。</p></li>
<li><p><strong>use_dagger</strong> – 是否使用该门的转置共轭版本,默认为False。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>一个 U2 逻辑门实例。</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.qnn.vqc.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">U2</span><span class="p">,</span><span class="n">QMachine</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="n">device</span> <span class="o">=</span> <span class="n">QMachine</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">layer</span> <span class="o">=</span> <span class="n">U2</span><span class="p">(</span><span class="n">has_params</span><span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">trainable</span><span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">wires</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">batchsize</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">device</span><span class="o">.</span><span class="n">reset_states</span><span class="p">(</span><span class="n">batchsize</span><span class="p">)</span>
<span class="n">layer</span><span class="p">(</span><span class="n">q_machine</span> <span class="o">=</span> <span class="n">device</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">device</span><span class="o">.</span><span class="n">states</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="u3">
<h4>U3<a class="headerlink" href="#u3" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.qnn.vqc.torch.U3">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.qnn.vqc.torch.</span></span><span class="sig-name descname"><span class="pre">U3</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">has_params</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trainable</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">init_params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wires</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">pyvqnet.kcomplex64</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_dagger</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.qnn.vqc.torch.U3" title="Link to this definition">¶</a></dt>
<dd><p>定义一个U3逻辑门类 。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.qnn.vqc.torch.QModule</span></code> 以及 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code>。
该类可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>has_params</strong> – 是否具有参数,例如RX,RY等门需要设置为True,不含参数的需要设置为False,默认为False。</p></li>
<li><p><strong>trainable</strong> – 是否自带含待训练参数,如果该层使用外部输入数据构建逻辑门矩阵,设置为False,如果待训练参数需要从该层初始化,则为True,默认为False。</p></li>
<li><p><strong>init_params</strong> – 初始化参数,用来编码经典数据QTensor,默认为None。</p></li>
<li><p><strong>wires</strong> – 线路作用的比特索引,默认为None。</p></li>
<li><p><strong>dtype</strong> – 逻辑门内部矩阵的数据精度,可以设置为pyvqnet.kcomplex64,或pyvqnet.kcomplex128,分别对应float输入或者double入参。</p></li>
<li><p><strong>use_dagger</strong> – 是否使用该门的转置共轭版本,默认为False。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>一个 U3 逻辑门实例。</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.qnn.vqc.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">U3</span><span class="p">,</span><span class="n">QMachine</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="n">device</span> <span class="o">=</span> <span class="n">QMachine</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">layer</span> <span class="o">=</span> <span class="n">U3</span><span class="p">(</span><span class="n">has_params</span><span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">trainable</span><span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">wires</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">batchsize</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">device</span><span class="o">.</span><span class="n">reset_states</span><span class="p">(</span><span class="n">batchsize</span><span class="p">)</span>
<span class="n">layer</span><span class="p">(</span><span class="n">q_machine</span> <span class="o">=</span> <span class="n">device</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">device</span><span class="o">.</span><span class="n">states</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="cnot">
<h4>CNOT<a class="headerlink" href="#cnot" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.qnn.vqc.torch.CNOT">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.qnn.vqc.torch.</span></span><span class="sig-name descname"><span class="pre">CNOT</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">has_params</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trainable</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">init_params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wires</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">pyvqnet.kcomplex64</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_dagger</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.qnn.vqc.torch.CNOT" title="Link to this definition">¶</a></dt>
<dd><p>定义一个CNOT逻辑门类,也可称为CX。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.qnn.vqc.torch.QModule</span></code> 以及 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code>。
该类可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>has_params</strong> – 是否具有参数,例如RX,RY等门需要设置为True,不含参数的需要设置为False,默认为False。</p></li>
<li><p><strong>trainable</strong> – 是否自带含待训练参数,如果该层使用外部输入数据构建逻辑门矩阵,设置为False,如果待训练参数需要从该层初始化,则为True,默认为False。</p></li>
<li><p><strong>init_params</strong> – 初始化参数,用来编码经典数据QTensor,默认为None。</p></li>
<li><p><strong>wires</strong> – 线路作用的比特索引,默认为None。</p></li>
<li><p><strong>dtype</strong> – 逻辑门内部矩阵的数据精度,可以设置为pyvqnet.kcomplex64,或pyvqnet.kcomplex128,分别对应float输入或者double入参。</p></li>
<li><p><strong>use_dagger</strong> – 是否使用该门的转置共轭版本,默认为False。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>一个 CNOT 逻辑门实例。</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.qnn.vqc.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">CNOT</span><span class="p">,</span><span class="n">QMachine</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="n">device</span> <span class="o">=</span> <span class="n">QMachine</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">layer</span> <span class="o">=</span> <span class="n">CNOT</span><span class="p">(</span><span class="n">wires</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">batchsize</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">device</span><span class="o">.</span><span class="n">reset_states</span><span class="p">(</span><span class="n">batchsize</span><span class="p">)</span>
<span class="n">layer</span><span class="p">(</span><span class="n">q_machine</span> <span class="o">=</span> <span class="n">device</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">device</span><span class="o">.</span><span class="n">states</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="cy">
<h4>CY<a class="headerlink" href="#cy" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.qnn.vqc.torch.CY">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.qnn.vqc.torch.</span></span><span class="sig-name descname"><span class="pre">CY</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">has_params</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trainable</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">init_params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wires</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">pyvqnet.kcomplex64</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_dagger</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.qnn.vqc.torch.CY" title="Link to this definition">¶</a></dt>
<dd><p>定义一个CY逻辑门类 。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.qnn.vqc.torch.QModule</span></code> 以及 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code>。
该类可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>has_params</strong> – 是否具有参数,例如RX,RY等门需要设置为True,不含参数的需要设置为False,默认为False。</p></li>
<li><p><strong>trainable</strong> – 是否自带含待训练参数,如果该层使用外部输入数据构建逻辑门矩阵,设置为False,如果待训练参数需要从该层初始化,则为True,默认为False。</p></li>
<li><p><strong>init_params</strong> – 初始化参数,用来编码经典数据QTensor,默认为None。</p></li>
<li><p><strong>wires</strong> – 线路作用的比特索引,默认为None。</p></li>
<li><p><strong>dtype</strong> – 逻辑门内部矩阵的数据精度,可以设置为pyvqnet.kcomplex64,或pyvqnet.kcomplex128,分别对应float输入或者double入参。</p></li>
<li><p><strong>use_dagger</strong> – 是否使用该门的转置共轭版本,默认为False。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>一个 CY 逻辑门实例。</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.qnn.vqc.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">CY</span><span class="p">,</span><span class="n">QMachine</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="n">device</span> <span class="o">=</span> <span class="n">QMachine</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">layer</span> <span class="o">=</span> <span class="n">CY</span><span class="p">(</span><span class="n">wires</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">batchsize</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">device</span><span class="o">.</span><span class="n">reset_states</span><span class="p">(</span><span class="n">batchsize</span><span class="p">)</span>
<span class="n">layer</span><span class="p">(</span><span class="n">q_machine</span> <span class="o">=</span> <span class="n">device</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">device</span><span class="o">.</span><span class="n">states</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="cz">
<h4>CZ<a class="headerlink" href="#cz" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.qnn.vqc.torch.CZ">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.qnn.vqc.torch.</span></span><span class="sig-name descname"><span class="pre">CZ</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">has_params</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trainable</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">init_params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wires</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">pyvqnet.kcomplex64</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_dagger</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.qnn.vqc.torch.CZ" title="Link to this definition">¶</a></dt>
<dd><p>定义一个CZ逻辑门类 。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.qnn.vqc.torch.QModule</span></code> 以及 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code>。
该类可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>has_params</strong> – 是否具有参数,例如RX,RY等门需要设置为True,不含参数的需要设置为False,默认为False。</p></li>
<li><p><strong>trainable</strong> – 是否自带含待训练参数,如果该层使用外部输入数据构建逻辑门矩阵,设置为False,如果待训练参数需要从该层初始化,则为True,默认为False。</p></li>
<li><p><strong>init_params</strong> – 初始化参数,用来编码经典数据QTensor,默认为None。</p></li>
<li><p><strong>wires</strong> – 线路作用的比特索引,默认为None。</p></li>
<li><p><strong>dtype</strong> – 逻辑门内部矩阵的数据精度,可以设置为pyvqnet.kcomplex64,或pyvqnet.kcomplex128,分别对应float输入或者double入参。</p></li>
<li><p><strong>use_dagger</strong> – 是否使用该门的转置共轭版本,默认为False。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>一个 CZ 逻辑门实例。</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.qnn.vqc.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">CZ</span><span class="p">,</span><span class="n">QMachine</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="n">device</span> <span class="o">=</span> <span class="n">QMachine</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">layer</span> <span class="o">=</span> <span class="n">CZ</span><span class="p">(</span><span class="n">wires</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">batchsize</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">device</span><span class="o">.</span><span class="n">reset_states</span><span class="p">(</span><span class="n">batchsize</span><span class="p">)</span>
<span class="n">layer</span><span class="p">(</span><span class="n">q_machine</span> <span class="o">=</span> <span class="n">device</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">device</span><span class="o">.</span><span class="n">states</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="cr">
<h4>CR<a class="headerlink" href="#cr" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.qnn.vqc.torch.CR">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.qnn.vqc.torch.</span></span><span class="sig-name descname"><span class="pre">CR</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">has_params</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trainable</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">init_params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wires</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">pyvqnet.kcomplex64</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_dagger</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.qnn.vqc.torch.CR" title="Link to this definition">¶</a></dt>
<dd><p>定义一个CR逻辑门类 。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.qnn.vqc.torch.QModule</span></code> 以及 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code>。
该类可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>has_params</strong> – 是否具有参数,例如RX,RY等门需要设置为True,不含参数的需要设置为False,默认为False。</p></li>
<li><p><strong>trainable</strong> – 是否自带含待训练参数,如果该层使用外部输入数据构建逻辑门矩阵,设置为False,如果待训练参数需要从该层初始化,则为True,默认为False。</p></li>
<li><p><strong>init_params</strong> – 初始化参数,用来编码经典数据QTensor,默认为None。</p></li>
<li><p><strong>wires</strong> – 线路作用的比特索引,默认为None。</p></li>
<li><p><strong>dtype</strong> – 逻辑门内部矩阵的数据精度,可以设置为pyvqnet.kcomplex64,或pyvqnet.kcomplex128,分别对应float输入或者double入参。</p></li>
<li><p><strong>use_dagger</strong> – 是否使用该门的转置共轭版本,默认为False。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>一个 CR 逻辑门实例。</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.qnn.vqc.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">CR</span><span class="p">,</span><span class="n">QMachine</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="n">device</span> <span class="o">=</span> <span class="n">QMachine</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">device</span> <span class="o">=</span> <span class="n">QMachine</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">layer</span> <span class="o">=</span> <span class="n">CR</span><span class="p">(</span><span class="n">has_params</span><span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">trainable</span><span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">wires</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
<span class="n">batchsize</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">device</span><span class="o">.</span><span class="n">reset_states</span><span class="p">(</span><span class="n">batchsize</span><span class="p">)</span>
<span class="n">layer</span><span class="p">(</span><span class="n">q_machine</span> <span class="o">=</span> <span class="n">device</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">device</span><span class="o">.</span><span class="n">states</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="swap">
<h4>SWAP<a class="headerlink" href="#swap" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.qnn.vqc.torch.SWAP">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.qnn.vqc.torch.</span></span><span class="sig-name descname"><span class="pre">SWAP</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">has_params</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trainable</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">init_params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wires</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">pyvqnet.kcomplex64</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_dagger</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.qnn.vqc.torch.SWAP" title="Link to this definition">¶</a></dt>
<dd><p>定义一个SWAP逻辑门类 。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.qnn.vqc.torch.QModule</span></code> 以及 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code>。
该类可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>has_params</strong> – 是否具有参数,例如RX,RY等门需要设置为True,不含参数的需要设置为False,默认为False。</p></li>
<li><p><strong>trainable</strong> – 是否自带含待训练参数,如果该层使用外部输入数据构建逻辑门矩阵,设置为False,如果待训练参数需要从该层初始化,则为True,默认为False。</p></li>
<li><p><strong>init_params</strong> – 初始化参数,用来编码经典数据QTensor,默认为None。</p></li>
<li><p><strong>wires</strong> – 线路作用的比特索引,默认为None。</p></li>
<li><p><strong>dtype</strong> – 逻辑门内部矩阵的数据精度,可以设置为pyvqnet.kcomplex64,或pyvqnet.kcomplex128,分别对应float输入或者double入参。</p></li>
<li><p><strong>use_dagger</strong> – 是否使用该门的转置共轭版本,默认为False。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>一个 SWAP 逻辑门实例。</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.qnn.vqc.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">SWAP</span><span class="p">,</span><span class="n">QMachine</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="n">device</span> <span class="o">=</span> <span class="n">QMachine</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">layer</span> <span class="o">=</span> <span class="n">SWAP</span><span class="p">(</span><span class="n">wires</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">batchsize</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">device</span><span class="o">.</span><span class="n">reset_states</span><span class="p">(</span><span class="n">batchsize</span><span class="p">)</span>
<span class="n">layer</span><span class="p">(</span><span class="n">q_machine</span> <span class="o">=</span> <span class="n">device</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">device</span><span class="o">.</span><span class="n">states</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="cswap">
<h4>CSWAP<a class="headerlink" href="#cswap" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.qnn.vqc.torch.CSWAP">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.qnn.vqc.torch.</span></span><span class="sig-name descname"><span class="pre">CSWAP</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">has_params</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trainable</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">init_params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wires</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">pyvqnet.kcomplex64</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_dagger</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.qnn.vqc.torch.CSWAP" title="Link to this definition">¶</a></dt>
<dd><p>定义一个SWAP逻辑门类 。</p>
<div class="math notranslate nohighlight">
\[\begin{split}CSWAP = \begin{bmatrix}
    1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
    0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
    0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
    0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
    0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 \\
    0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 \\
    0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 \\
    0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1
\end{bmatrix}.\end{split}\]</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.qnn.vqc.torch.QModule</span></code> 以及 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code>。
该类可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>has_params</strong> – 是否具有参数,例如RX,RY等门需要设置为True,不含参数的需要设置为False,默认为False。</p></li>
<li><p><strong>trainable</strong> – 是否自带含待训练参数,如果该层使用外部输入数据构建逻辑门矩阵,设置为False,如果待训练参数需要从该层初始化,则为True,默认为False。</p></li>
<li><p><strong>init_params</strong> – 初始化参数,用来编码经典数据QTensor,默认为None。</p></li>
<li><p><strong>wires</strong> – 线路作用的比特索引,默认为None。</p></li>
<li><p><strong>dtype</strong> – 逻辑门内部矩阵的数据精度,可以设置为pyvqnet.kcomplex64,或pyvqnet.kcomplex128,分别对应float输入或者double入参。</p></li>
<li><p><strong>use_dagger</strong> – 是否使用该门的转置共轭版本,默认为False。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>一个 CSWAP 逻辑门实例。</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.qnn.vqc.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">CSWAP</span><span class="p">,</span><span class="n">QMachine</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="n">device</span> <span class="o">=</span> <span class="n">QMachine</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">layer</span> <span class="o">=</span> <span class="n">CSWAP</span><span class="p">(</span><span class="n">wires</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
<span class="n">batchsize</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">device</span><span class="o">.</span><span class="n">reset_states</span><span class="p">(</span><span class="n">batchsize</span><span class="p">)</span>
<span class="n">layer</span><span class="p">(</span><span class="n">q_machine</span> <span class="o">=</span> <span class="n">device</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">device</span><span class="o">.</span><span class="n">states</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="rxx">
<h4>RXX<a class="headerlink" href="#rxx" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.qnn.vqc.torch.RXX">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.qnn.vqc.torch.</span></span><span class="sig-name descname"><span class="pre">RXX</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">has_params</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trainable</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">init_params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wires</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">pyvqnet.kcomplex64</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_dagger</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.qnn.vqc.torch.RXX" title="Link to this definition">¶</a></dt>
<dd><p>定义一个RXX逻辑门类 。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.qnn.vqc.torch.QModule</span></code> 以及 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code>。
该类可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>has_params</strong> – 是否具有参数,例如RX,RY等门需要设置为True,不含参数的需要设置为False,默认为False。</p></li>
<li><p><strong>trainable</strong> – 是否自带含待训练参数,如果该层使用外部输入数据构建逻辑门矩阵,设置为False,如果待训练参数需要从该层初始化,则为True,默认为False。</p></li>
<li><p><strong>init_params</strong> – 初始化参数,用来编码经典数据QTensor,默认为None。</p></li>
<li><p><strong>wires</strong> – 线路作用的比特索引,默认为None。</p></li>
<li><p><strong>dtype</strong> – 逻辑门内部矩阵的数据精度,可以设置为pyvqnet.kcomplex64,或pyvqnet.kcomplex128,分别对应float输入或者double入参。</p></li>
<li><p><strong>use_dagger</strong> – 是否使用该门的转置共轭版本,默认为False。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>一个 RXX 逻辑门实例。</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.qnn.vqc.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">RXX</span><span class="p">,</span><span class="n">QMachine</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="n">device</span> <span class="o">=</span> <span class="n">QMachine</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">layer</span> <span class="o">=</span> <span class="n">RXX</span><span class="p">(</span><span class="n">has_params</span><span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">trainable</span><span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">wires</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
<span class="n">batchsize</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">device</span><span class="o">.</span><span class="n">reset_states</span><span class="p">(</span><span class="n">batchsize</span><span class="p">)</span>
<span class="n">layer</span><span class="p">(</span><span class="n">q_machine</span> <span class="o">=</span> <span class="n">device</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">device</span><span class="o">.</span><span class="n">states</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="ryy">
<h4>RYY<a class="headerlink" href="#ryy" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.qnn.vqc.torch.RYY">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.qnn.vqc.torch.</span></span><span class="sig-name descname"><span class="pre">RYY</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">has_params</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trainable</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">init_params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wires</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">pyvqnet.kcomplex64</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_dagger</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.qnn.vqc.torch.RYY" title="Link to this definition">¶</a></dt>
<dd><p>定义一个RYY逻辑门类 。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.qnn.vqc.torch.QModule</span></code> 以及 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code>。
该类可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>has_params</strong> – 是否具有参数,例如RX,RY等门需要设置为True,不含参数的需要设置为False,默认为False。</p></li>
<li><p><strong>trainable</strong> – 是否自带含待训练参数,如果该层使用外部输入数据构建逻辑门矩阵,设置为False,如果待训练参数需要从该层初始化,则为True,默认为False。</p></li>
<li><p><strong>init_params</strong> – 初始化参数,用来编码经典数据QTensor,默认为None。</p></li>
<li><p><strong>wires</strong> – 线路作用的比特索引,默认为None。</p></li>
<li><p><strong>dtype</strong> – 逻辑门内部矩阵的数据精度,可以设置为pyvqnet.kcomplex64,或pyvqnet.kcomplex128,分别对应float输入或者double入参。</p></li>
<li><p><strong>use_dagger</strong> – 是否使用该门的转置共轭版本,默认为False。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>一个 RYY 逻辑门实例。</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.qnn.vqc.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">RYY</span><span class="p">,</span><span class="n">QMachine</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="n">device</span> <span class="o">=</span> <span class="n">QMachine</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">layer</span> <span class="o">=</span> <span class="n">RYY</span><span class="p">(</span><span class="n">has_params</span><span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">trainable</span><span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">wires</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
<span class="n">batchsize</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">device</span><span class="o">.</span><span class="n">reset_states</span><span class="p">(</span><span class="n">batchsize</span><span class="p">)</span>
<span class="n">layer</span><span class="p">(</span><span class="n">q_machine</span> <span class="o">=</span> <span class="n">device</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">device</span><span class="o">.</span><span class="n">states</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="rzz">
<h4>RZZ<a class="headerlink" href="#rzz" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.qnn.vqc.torch.RZZ">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.qnn.vqc.torch.</span></span><span class="sig-name descname"><span class="pre">RZZ</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">has_params</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trainable</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">init_params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wires</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">pyvqnet.kcomplex64</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_dagger</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.qnn.vqc.torch.RZZ" title="Link to this definition">¶</a></dt>
<dd><p>定义一个RZZ逻辑门类 。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.qnn.vqc.torch.QModule</span></code> 以及 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code>。
该类可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>has_params</strong> – 是否具有参数,例如RX,RY等门需要设置为True,不含参数的需要设置为False,默认为False。</p></li>
<li><p><strong>trainable</strong> – 是否自带含待训练参数,如果该层使用外部输入数据构建逻辑门矩阵,设置为False,如果待训练参数需要从该层初始化,则为True,默认为False。</p></li>
<li><p><strong>init_params</strong> – 初始化参数,用来编码经典数据QTensor,默认为None。</p></li>
<li><p><strong>wires</strong> – 线路作用的比特索引,默认为None。</p></li>
<li><p><strong>dtype</strong> – 逻辑门内部矩阵的数据精度,可以设置为pyvqnet.kcomplex64,或pyvqnet.kcomplex128,分别对应float输入或者double入参。</p></li>
<li><p><strong>use_dagger</strong> – 是否使用该门的转置共轭版本,默认为False。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>一个RZZ 逻辑门实例。</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.qnn.vqc.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">RZZ</span><span class="p">,</span><span class="n">QMachine</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="n">device</span> <span class="o">=</span> <span class="n">QMachine</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">layer</span> <span class="o">=</span> <span class="n">RZZ</span><span class="p">(</span><span class="n">has_params</span><span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">trainable</span><span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">wires</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
<span class="n">batchsize</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">device</span><span class="o">.</span><span class="n">reset_states</span><span class="p">(</span><span class="n">batchsize</span><span class="p">)</span>
<span class="n">layer</span><span class="p">(</span><span class="n">q_machine</span> <span class="o">=</span> <span class="n">device</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">device</span><span class="o">.</span><span class="n">states</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="rzx">
<h4>RZX<a class="headerlink" href="#rzx" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.qnn.vqc.torch.RZX">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.qnn.vqc.torch.</span></span><span class="sig-name descname"><span class="pre">RZX</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">has_params</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trainable</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">init_params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wires</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">pyvqnet.kcomplex64</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_dagger</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.qnn.vqc.torch.RZX" title="Link to this definition">¶</a></dt>
<dd><p>定义一个RZX逻辑门类 。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.qnn.vqc.torch.QModule</span></code> 以及 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code>。
该类可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>has_params</strong> – 是否具有参数,例如RX,RY等门需要设置为True,不含参数的需要设置为False,默认为False。</p></li>
<li><p><strong>trainable</strong> – 是否自带含待训练参数,如果该层使用外部输入数据构建逻辑门矩阵,设置为False,如果待训练参数需要从该层初始化,则为True,默认为False。</p></li>
<li><p><strong>init_params</strong> – 初始化参数,用来编码经典数据QTensor,默认为None。</p></li>
<li><p><strong>wires</strong> – 线路作用的比特索引,默认为None。</p></li>
<li><p><strong>dtype</strong> – 逻辑门内部矩阵的数据精度,可以设置为pyvqnet.kcomplex64,或pyvqnet.kcomplex128,分别对应float输入或者double入参。</p></li>
<li><p><strong>use_dagger</strong> – 是否使用该门的转置共轭版本,默认为False。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>一个 RZX 逻辑门实例。</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.qnn.vqc.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">RZX</span><span class="p">,</span><span class="n">QMachine</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="n">device</span> <span class="o">=</span> <span class="n">QMachine</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">layer</span> <span class="o">=</span> <span class="n">RZX</span><span class="p">(</span><span class="n">has_params</span><span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">trainable</span><span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">wires</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
<span class="n">batchsize</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">device</span><span class="o">.</span><span class="n">reset_states</span><span class="p">(</span><span class="n">batchsize</span><span class="p">)</span>
<span class="n">layer</span><span class="p">(</span><span class="n">q_machine</span> <span class="o">=</span> <span class="n">device</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">device</span><span class="o">.</span><span class="n">states</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="toffoli">
<h4>Toffoli<a class="headerlink" href="#toffoli" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.qnn.vqc.torch.Toffoli">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.qnn.vqc.torch.</span></span><span class="sig-name descname"><span class="pre">Toffoli</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">has_params</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trainable</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">init_params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wires</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">pyvqnet.kcomplex64</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_dagger</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.qnn.vqc.torch.Toffoli" title="Link to this definition">¶</a></dt>
<dd><p>定义一个Toffoli逻辑门类 。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.qnn.vqc.torch.QModule</span></code> 以及 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code>。
该类可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>has_params</strong> – 是否具有参数,例如RX,RY等门需要设置为True,不含参数的需要设置为False,默认为False。</p></li>
<li><p><strong>trainable</strong> – 是否自带含待训练参数,如果该层使用外部输入数据构建逻辑门矩阵,设置为False,如果待训练参数需要从该层初始化,则为True,默认为False。</p></li>
<li><p><strong>init_params</strong> – 初始化参数,用来编码经典数据QTensor,默认为None。</p></li>
<li><p><strong>wires</strong> – 线路作用的比特索引,默认为None。</p></li>
<li><p><strong>dtype</strong> – 逻辑门内部矩阵的数据精度,可以设置为pyvqnet.kcomplex64,或pyvqnet.kcomplex128,分别对应float输入或者double入参。</p></li>
<li><p><strong>use_dagger</strong> – 是否使用该门的转置共轭版本,默认为False。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>一个 Toffoli 逻辑门实例。</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.qnn.vqc.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">Toffoli</span><span class="p">,</span><span class="n">QMachine</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="n">device</span> <span class="o">=</span> <span class="n">QMachine</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">layer</span> <span class="o">=</span> <span class="n">Toffoli</span><span class="p">(</span><span class="n">wires</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">batchsize</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">device</span><span class="o">.</span><span class="n">reset_states</span><span class="p">(</span><span class="n">batchsize</span><span class="p">)</span>
<span class="n">layer</span><span class="p">(</span><span class="n">q_machine</span> <span class="o">=</span> <span class="n">device</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">device</span><span class="o">.</span><span class="n">states</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="isingxx">
<h4>IsingXX<a class="headerlink" href="#isingxx" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.qnn.vqc.torch.IsingXX">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.qnn.vqc.torch.</span></span><span class="sig-name descname"><span class="pre">IsingXX</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">has_params</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trainable</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">init_params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wires</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">pyvqnet.kcomplex64</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_dagger</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.qnn.vqc.torch.IsingXX" title="Link to this definition">¶</a></dt>
<dd><p>定义一个IsingXX逻辑门类 。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.qnn.vqc.torch.QModule</span></code> 以及 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code>。
该类可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>has_params</strong> – 是否具有参数,例如RX,RY等门需要设置为True,不含参数的需要设置为False,默认为False。</p></li>
<li><p><strong>trainable</strong> – 是否自带含待训练参数,如果该层使用外部输入数据构建逻辑门矩阵,设置为False,如果待训练参数需要从该层初始化,则为True,默认为False。</p></li>
<li><p><strong>init_params</strong> – 初始化参数,用来编码经典数据QTensor,默认为None。</p></li>
<li><p><strong>wires</strong> – 线路作用的比特索引,默认为None。</p></li>
<li><p><strong>dtype</strong> – 逻辑门内部矩阵的数据精度,可以设置为pyvqnet.kcomplex64,或pyvqnet.kcomplex128,分别对应float输入或者double入参。</p></li>
<li><p><strong>use_dagger</strong> – 是否使用该门的转置共轭版本,默认为False。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>一个 IsingXX 逻辑门实例。</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.qnn.vqc.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">IsingXX</span><span class="p">,</span><span class="n">QMachine</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="n">device</span> <span class="o">=</span> <span class="n">QMachine</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">layer</span> <span class="o">=</span> <span class="n">IsingXX</span><span class="p">(</span><span class="n">has_params</span><span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">trainable</span><span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">wires</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
<span class="n">batchsize</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">device</span><span class="o">.</span><span class="n">reset_states</span><span class="p">(</span><span class="n">batchsize</span><span class="p">)</span>
<span class="n">layer</span><span class="p">(</span><span class="n">q_machine</span> <span class="o">=</span> <span class="n">device</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">device</span><span class="o">.</span><span class="n">states</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="isingyy">
<h4>IsingYY<a class="headerlink" href="#isingyy" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.qnn.vqc.torch.IsingYY">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.qnn.vqc.torch.</span></span><span class="sig-name descname"><span class="pre">IsingYY</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">has_params</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trainable</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">init_params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wires</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">pyvqnet.kcomplex64</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_dagger</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.qnn.vqc.torch.IsingYY" title="Link to this definition">¶</a></dt>
<dd><p>定义一个IsingYY逻辑门类 。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.qnn.vqc.torch.QModule</span></code> 以及 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code>。
该类可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>has_params</strong> – 是否具有参数,例如RX,RY等门需要设置为True,不含参数的需要设置为False,默认为False。</p></li>
<li><p><strong>trainable</strong> – 是否自带含待训练参数,如果该层使用外部输入数据构建逻辑门矩阵,设置为False,如果待训练参数需要从该层初始化,则为True,默认为False。</p></li>
<li><p><strong>init_params</strong> – 初始化参数,用来编码经典数据QTensor,默认为None。</p></li>
<li><p><strong>wires</strong> – 线路作用的比特索引,默认为None。</p></li>
<li><p><strong>dtype</strong> – 逻辑门内部矩阵的数据精度,可以设置为pyvqnet.kcomplex64,或pyvqnet.kcomplex128,分别对应float输入或者double入参。</p></li>
<li><p><strong>use_dagger</strong> – 是否使用该门的转置共轭版本,默认为False。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>一个 IsingYY 逻辑门实例。</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.qnn.vqc.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">IsingYY</span><span class="p">,</span><span class="n">QMachine</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="n">device</span> <span class="o">=</span> <span class="n">QMachine</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">layer</span> <span class="o">=</span> <span class="n">IsingYY</span><span class="p">(</span><span class="n">has_params</span><span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">trainable</span><span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">wires</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
<span class="n">batchsize</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">device</span><span class="o">.</span><span class="n">reset_states</span><span class="p">(</span><span class="n">batchsize</span><span class="p">)</span>
<span class="n">layer</span><span class="p">(</span><span class="n">q_machine</span> <span class="o">=</span> <span class="n">device</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">device</span><span class="o">.</span><span class="n">states</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="isingzz">
<h4>IsingZZ<a class="headerlink" href="#isingzz" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.qnn.vqc.torch.IsingZZ">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.qnn.vqc.torch.</span></span><span class="sig-name descname"><span class="pre">IsingZZ</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">has_params</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trainable</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">init_params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wires</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">pyvqnet.kcomplex64</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_dagger</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.qnn.vqc.torch.IsingZZ" title="Link to this definition">¶</a></dt>
<dd><p>定义一个IsingZZ逻辑门类 。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.qnn.vqc.torch.QModule</span></code> 以及 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code>。
该类可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>has_params</strong> – 是否具有参数,例如RX,RY等门需要设置为True,不含参数的需要设置为False,默认为False。</p></li>
<li><p><strong>trainable</strong> – 是否自带含待训练参数,如果该层使用外部输入数据构建逻辑门矩阵,设置为False,如果待训练参数需要从该层初始化,则为True,默认为False。</p></li>
<li><p><strong>init_params</strong> – 初始化参数,用来编码经典数据QTensor,默认为None。</p></li>
<li><p><strong>wires</strong> – 线路作用的比特索引,默认为None。</p></li>
<li><p><strong>dtype</strong> – 逻辑门内部矩阵的数据精度,可以设置为pyvqnet.kcomplex64,或pyvqnet.kcomplex128,分别对应float输入或者double入参。</p></li>
<li><p><strong>use_dagger</strong> – 是否使用该门的转置共轭版本,默认为False。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>一个 IsingZZ 逻辑门实例。</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.qnn.vqc.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">IsingZZ</span><span class="p">,</span><span class="n">QMachine</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="n">device</span> <span class="o">=</span> <span class="n">QMachine</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">layer</span> <span class="o">=</span> <span class="n">IsingZZ</span><span class="p">(</span><span class="n">has_params</span><span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">trainable</span><span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">wires</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
<span class="n">batchsize</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">device</span><span class="o">.</span><span class="n">reset_states</span><span class="p">(</span><span class="n">batchsize</span><span class="p">)</span>
<span class="n">layer</span><span class="p">(</span><span class="n">q_machine</span> <span class="o">=</span> <span class="n">device</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">device</span><span class="o">.</span><span class="n">states</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="isingxy">
<h4>IsingXY<a class="headerlink" href="#isingxy" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.qnn.vqc.torch.IsingXY">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.qnn.vqc.torch.</span></span><span class="sig-name descname"><span class="pre">IsingXY</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">has_params</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trainable</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">init_params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wires</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">pyvqnet.kcomplex64</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_dagger</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.qnn.vqc.torch.IsingXY" title="Link to this definition">¶</a></dt>
<dd><p>定义一个IsingXY逻辑门类 。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.qnn.vqc.torch.QModule</span></code> 以及 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code>。
该类可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>has_params</strong> – 是否具有参数,例如RX,RY等门需要设置为True,不含参数的需要设置为False,默认为False。</p></li>
<li><p><strong>trainable</strong> – 是否自带含待训练参数,如果该层使用外部输入数据构建逻辑门矩阵,设置为False,如果待训练参数需要从该层初始化,则为True,默认为False。</p></li>
<li><p><strong>init_params</strong> – 初始化参数,用来编码经典数据QTensor,默认为None。</p></li>
<li><p><strong>wires</strong> – 线路作用的比特索引,默认为None。</p></li>
<li><p><strong>dtype</strong> – 逻辑门内部矩阵的数据精度,可以设置为pyvqnet.kcomplex64,或pyvqnet.kcomplex128,分别对应float输入或者double入参。</p></li>
<li><p><strong>use_dagger</strong> – 是否使用该门的转置共轭版本,默认为False。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>一个 IsingXY 逻辑门实例。</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.qnn.vqc.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">IsingXY</span><span class="p">,</span><span class="n">QMachine</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="n">device</span> <span class="o">=</span> <span class="n">QMachine</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">layer</span> <span class="o">=</span> <span class="n">IsingXY</span><span class="p">(</span><span class="n">has_params</span><span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">trainable</span><span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">wires</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
<span class="n">batchsize</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">device</span><span class="o">.</span><span class="n">reset_states</span><span class="p">(</span><span class="n">batchsize</span><span class="p">)</span>
<span class="n">layer</span><span class="p">(</span><span class="n">q_machine</span> <span class="o">=</span> <span class="n">device</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">device</span><span class="o">.</span><span class="n">states</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="phaseshift">
<h4>PhaseShift<a class="headerlink" href="#phaseshift" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.qnn.vqc.torch.PhaseShift">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.qnn.vqc.torch.</span></span><span class="sig-name descname"><span class="pre">PhaseShift</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">has_params</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trainable</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">init_params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wires</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">pyvqnet.kcomplex64</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_dagger</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.qnn.vqc.torch.PhaseShift" title="Link to this definition">¶</a></dt>
<dd><p>定义一个PhaseShift逻辑门类 。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.qnn.vqc.torch.QModule</span></code> 以及 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code>。
该类可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>has_params</strong> – 是否具有参数,例如RX,RY等门需要设置为True,不含参数的需要设置为False,默认为False。</p></li>
<li><p><strong>trainable</strong> – 是否自带含待训练参数,如果该层使用外部输入数据构建逻辑门矩阵,设置为False,如果待训练参数需要从该层初始化,则为True,默认为False。</p></li>
<li><p><strong>init_params</strong> – 初始化参数,用来编码经典数据QTensor,默认为None。</p></li>
<li><p><strong>wires</strong> – 线路作用的比特索引,默认为None。</p></li>
<li><p><strong>dtype</strong> – 逻辑门内部矩阵的数据精度,可以设置为pyvqnet.kcomplex64,或pyvqnet.kcomplex128,分别对应float输入或者double入参。</p></li>
<li><p><strong>use_dagger</strong> – 是否使用该门的转置共轭版本,默认为False。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>一个 PhaseShift 逻辑门实例。</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.qnn.vqc.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">PhaseShift</span><span class="p">,</span><span class="n">QMachine</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="n">device</span> <span class="o">=</span> <span class="n">QMachine</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">layer</span> <span class="o">=</span> <span class="n">PhaseShift</span><span class="p">(</span><span class="n">has_params</span><span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">trainable</span><span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">wires</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">batchsize</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">device</span><span class="o">.</span><span class="n">reset_states</span><span class="p">(</span><span class="n">batchsize</span><span class="p">)</span>
<span class="n">layer</span><span class="p">(</span><span class="n">q_machine</span> <span class="o">=</span> <span class="n">device</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">device</span><span class="o">.</span><span class="n">states</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="multirz">
<h4>MultiRZ<a class="headerlink" href="#multirz" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.qnn.vqc.torch.MultiRZ">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.qnn.vqc.torch.</span></span><span class="sig-name descname"><span class="pre">MultiRZ</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">has_params</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trainable</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">init_params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wires</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">pyvqnet.kcomplex64</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_dagger</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.qnn.vqc.torch.MultiRZ" title="Link to this definition">¶</a></dt>
<dd><p>定义一个MultiRZ逻辑门类 。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.qnn.vqc.torch.QModule</span></code> 以及 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code>。
该类可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>has_params</strong> – 是否具有参数,例如RX,RY等门需要设置为True,不含参数的需要设置为False,默认为False。</p></li>
<li><p><strong>trainable</strong> – 是否自带含待训练参数,如果该层使用外部输入数据构建逻辑门矩阵,设置为False,如果待训练参数需要从该层初始化,则为True,默认为False。</p></li>
<li><p><strong>init_params</strong> – 初始化参数,用来编码经典数据QTensor,默认为None。</p></li>
<li><p><strong>wires</strong> – 线路作用的比特索引,默认为None。</p></li>
<li><p><strong>dtype</strong> – 逻辑门内部矩阵的数据精度,可以设置为pyvqnet.kcomplex64,或pyvqnet.kcomplex128,分别对应float输入或者double入参。</p></li>
<li><p><strong>use_dagger</strong> – 是否使用该门的转置共轭版本,默认为False。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>一个 MultiRZ 逻辑门实例。</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.qnn.vqc.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">MultiRZ</span><span class="p">,</span><span class="n">QMachine</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="n">device</span> <span class="o">=</span> <span class="n">QMachine</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">layer</span> <span class="o">=</span> <span class="n">MultiRZ</span><span class="p">(</span><span class="n">has_params</span><span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">trainable</span><span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">wires</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
<span class="n">batchsize</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">device</span><span class="o">.</span><span class="n">reset_states</span><span class="p">(</span><span class="n">batchsize</span><span class="p">)</span>
<span class="n">layer</span><span class="p">(</span><span class="n">q_machine</span> <span class="o">=</span> <span class="n">device</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">device</span><span class="o">.</span><span class="n">states</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="sdg">
<h4>SDG<a class="headerlink" href="#sdg" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.qnn.vqc.torch.SDG">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.qnn.vqc.torch.</span></span><span class="sig-name descname"><span class="pre">SDG</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">has_params</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trainable</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">init_params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wires</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">pyvqnet.kcomplex64</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_dagger</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.qnn.vqc.torch.SDG" title="Link to this definition">¶</a></dt>
<dd><p>定义一个SDG逻辑门类 。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.qnn.vqc.torch.QModule</span></code> 以及 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code>。
该类可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>has_params</strong> – 是否具有参数,例如RX,RY等门需要设置为True,不含参数的需要设置为False,默认为False。</p></li>
<li><p><strong>trainable</strong> – 是否自带含待训练参数,如果该层使用外部输入数据构建逻辑门矩阵,设置为False,如果待训练参数需要从该层初始化,则为True,默认为False。</p></li>
<li><p><strong>init_params</strong> – 初始化参数,用来编码经典数据QTensor,默认为None。</p></li>
<li><p><strong>wires</strong> – 线路作用的比特索引,默认为None。</p></li>
<li><p><strong>dtype</strong> – 逻辑门内部矩阵的数据精度,可以设置为pyvqnet.kcomplex64,或pyvqnet.kcomplex128,分别对应float输入或者double入参。</p></li>
<li><p><strong>use_dagger</strong> – 是否使用该门的转置共轭版本,默认为False。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>一个 SDG 逻辑门实例。</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.qnn.vqc.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">SDG</span><span class="p">,</span><span class="n">QMachine</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="n">device</span> <span class="o">=</span> <span class="n">QMachine</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">layer</span> <span class="o">=</span> <span class="n">SDG</span><span class="p">(</span><span class="n">wires</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">batchsize</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">device</span><span class="o">.</span><span class="n">reset_states</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">layer</span><span class="p">(</span><span class="n">q_machine</span> <span class="o">=</span> <span class="n">device</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">device</span><span class="o">.</span><span class="n">states</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="tdg">
<h4>TDG<a class="headerlink" href="#tdg" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.qnn.vqc.torch.TDG">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.qnn.vqc.torch.</span></span><span class="sig-name descname"><span class="pre">TDG</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">has_params</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trainable</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">init_params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wires</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">pyvqnet.kcomplex64</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_dagger</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.qnn.vqc.torch.TDG" title="Link to this definition">¶</a></dt>
<dd><p>定义一个SDG逻辑门类 。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.qnn.vqc.torch.QModule</span></code> 以及 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code>。
该类可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>has_params</strong> – 是否具有参数,例如RX,RY等门需要设置为True,不含参数的需要设置为False,默认为False。</p></li>
<li><p><strong>trainable</strong> – 是否自带含待训练参数,如果该层使用外部输入数据构建逻辑门矩阵,设置为False,如果待训练参数需要从该层初始化,则为True,默认为False。</p></li>
<li><p><strong>init_params</strong> – 初始化参数,用来编码经典数据QTensor,默认为None。</p></li>
<li><p><strong>wires</strong> – 线路作用的比特索引,默认为None。</p></li>
<li><p><strong>dtype</strong> – 逻辑门内部矩阵的数据精度,可以设置为pyvqnet.kcomplex64,或pyvqnet.kcomplex128,分别对应float输入或者double入参。</p></li>
<li><p><strong>use_dagger</strong> – 是否使用该门的转置共轭版本,默认为False。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>一个 TDG 逻辑门实例。</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.qnn.vqc.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">TDG</span><span class="p">,</span><span class="n">QMachine</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="n">device</span> <span class="o">=</span> <span class="n">QMachine</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">layer</span> <span class="o">=</span> <span class="n">TDG</span><span class="p">(</span><span class="n">wires</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">batchsize</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">device</span><span class="o">.</span><span class="n">reset_states</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">layer</span><span class="p">(</span><span class="n">q_machine</span> <span class="o">=</span> <span class="n">device</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">device</span><span class="o">.</span><span class="n">states</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="controlledphaseshift">
<h4>ControlledPhaseShift<a class="headerlink" href="#controlledphaseshift" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.qnn.vqc.torch.ControlledPhaseShift">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.qnn.vqc.torch.</span></span><span class="sig-name descname"><span class="pre">ControlledPhaseShift</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">has_params</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trainable</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">init_params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wires</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">pyvqnet.kcomplex64</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_dagger</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.qnn.vqc.torch.ControlledPhaseShift" title="Link to this definition">¶</a></dt>
<dd><p>定义一个ControlledPhaseShift逻辑门类 。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.qnn.vqc.torch.QModule</span></code> 以及 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code>。
该类可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>has_params</strong> – 是否具有参数,例如RX,RY等门需要设置为True,不含参数的需要设置为False,默认为False。</p></li>
<li><p><strong>trainable</strong> – 是否自带含待训练参数,如果该层使用外部输入数据构建逻辑门矩阵,设置为False,如果待训练参数需要从该层初始化,则为True,默认为False。</p></li>
<li><p><strong>init_params</strong> – 初始化参数,用来编码经典数据QTensor,默认为None。</p></li>
<li><p><strong>wires</strong> – 线路作用的比特索引,默认为None。</p></li>
<li><p><strong>dtype</strong> – 逻辑门内部矩阵的数据精度,可以设置为pyvqnet.kcomplex64,或pyvqnet.kcomplex128,分别对应float输入或者double入参。</p></li>
<li><p><strong>use_dagger</strong> – 是否使用该门的转置共轭版本,默认为False。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>一个 ControlledPhaseShift 逻辑门实例。</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.qnn.vqc.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">ControlledPhaseShift</span><span class="p">,</span><span class="n">QMachine</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="n">device</span> <span class="o">=</span> <span class="n">QMachine</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">layer</span> <span class="o">=</span> <span class="n">ControlledPhaseShift</span><span class="p">(</span><span class="n">has_params</span><span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">trainable</span><span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">wires</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
<span class="n">batchsize</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">device</span><span class="o">.</span><span class="n">reset_states</span><span class="p">(</span><span class="n">batchsize</span><span class="p">)</span>
<span class="n">layer</span><span class="p">(</span><span class="n">q_machine</span> <span class="o">=</span> <span class="n">device</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">device</span><span class="o">.</span><span class="n">states</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="multicontrolledx">
<h4>MultiControlledX<a class="headerlink" href="#multicontrolledx" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.qnn.vqc.torch.MultiControlledX">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.qnn.vqc.torch.</span></span><span class="sig-name descname"><span class="pre">MultiControlledX</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">has_params</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trainable</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">init_params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wires</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">pyvqnet.kcomplex64</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_dagger</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">control_values</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.qnn.vqc.torch.MultiControlledX" title="Link to this definition">¶</a></dt>
<dd><p>定义一个MultiControlledX逻辑门类 。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.qnn.vqc.torch.QModule</span></code> 以及 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code>。
该类可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>has_params</strong> – 是否具有参数,例如RX,RY等门需要设置为True,不含参数的需要设置为False,默认为False。</p></li>
<li><p><strong>trainable</strong> – 是否自带含待训练参数,如果该层使用外部输入数据构建逻辑门矩阵,设置为False,如果待训练参数需要从该层初始化,则为True,默认为False。</p></li>
<li><p><strong>init_params</strong> – 初始化参数,用来编码经典数据QTensor,默认为None。</p></li>
<li><p><strong>wires</strong> – 线路作用的比特索引,默认为None。</p></li>
<li><p><strong>dtype</strong> – 逻辑门内部矩阵的数据精度,可以设置为pyvqnet.kcomplex64,或pyvqnet.kcomplex128,分别对应float输入或者double入参。</p></li>
<li><p><strong>use_dagger</strong> – 是否使用该门的转置共轭版本,默认为False。</p></li>
<li><p><strong>control_values</strong> – 控制值,默认为None,当比特位为1时控制。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>一个 MultiControlledX 逻辑门实例。</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.qnn.vqc.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">QMachine</span><span class="p">,</span><span class="n">MultiControlledX</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.tensor</span><span class="w"> </span><span class="kn">import</span> <span class="n">QTensor</span><span class="p">,</span><span class="n">kcomplex64</span>
<span class="n">qm</span> <span class="o">=</span> <span class="n">QMachine</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">kcomplex64</span><span class="p">)</span>
<span class="n">qm</span><span class="o">.</span><span class="n">reset_states</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">mcx</span> <span class="o">=</span> <span class="n">MultiControlledX</span><span class="p">(</span>
                <span class="n">init_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">wires</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>
                <span class="n">dtype</span><span class="o">=</span><span class="n">kcomplex64</span><span class="p">,</span>
                <span class="n">use_dagger</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">control_values</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">mcx</span><span class="p">(</span><span class="n">q_machine</span> <span class="o">=</span> <span class="n">qm</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">qm</span><span class="o">.</span><span class="n">states</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
</section>
<section id="id12">
<h3>测量接口<a class="headerlink" href="#id12" title="Link to this heading">¶</a></h3>
<section id="probability">
<h4>Probability<a class="headerlink" href="#probability" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.qnn.vqc.torch.Probability">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.qnn.vqc.torch.</span></span><span class="sig-name descname"><span class="pre">Probability</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">wires</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.qnn.vqc.torch.Probability" title="Link to this definition">¶</a></dt>
<dd><p>计算量子线路在特定比特上概率测量结果。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.qnn.vqc.torch.QModule</span></code> 以及 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code>。
该类可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>wires</strong> – 测量比特的索引,列表、元组或者整数。</p></li>
<li><p><strong>name</strong> – 模块的名字,默认:””。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>测量结果,QTensor。</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.qnn.vqc.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">Probability</span><span class="p">,</span><span class="n">rx</span><span class="p">,</span><span class="n">ry</span><span class="p">,</span><span class="n">cnot</span><span class="p">,</span><span class="n">QMachine</span><span class="p">,</span><span class="n">rz</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.tensor</span><span class="w"> </span><span class="kn">import</span> <span class="n">QTensor</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet</span><span class="w"> </span><span class="kn">import</span> <span class="n">kfloat64</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">QTensor</span><span class="p">([[</span><span class="mf">0.56</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">],[</span><span class="mf">0.56</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">]],</span><span class="n">requires_grad</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">qm</span> <span class="o">=</span> <span class="n">QMachine</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">qm</span><span class="o">.</span><span class="n">reset_states</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">rz</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="n">qm</span><span class="p">,</span><span class="n">wires</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">params</span><span class="o">=</span><span class="n">x</span><span class="p">[:,[</span><span class="mi">0</span><span class="p">]])</span>
<span class="n">rz</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="n">qm</span><span class="p">,</span><span class="n">wires</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">params</span><span class="o">=</span><span class="n">x</span><span class="p">[:,[</span><span class="mi">0</span><span class="p">]])</span>
<span class="n">cnot</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="n">qm</span><span class="p">,</span><span class="n">wires</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ry</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="n">qm</span><span class="p">,</span><span class="n">wires</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">params</span><span class="o">=</span><span class="n">x</span><span class="p">[:,[</span><span class="mi">1</span><span class="p">]])</span>
<span class="n">cnot</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="n">qm</span><span class="p">,</span><span class="n">wires</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
<span class="n">rz</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="n">qm</span><span class="p">,</span><span class="n">wires</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">params</span><span class="o">=</span><span class="n">x</span><span class="p">[:,[</span><span class="mi">1</span><span class="p">]])</span>
<span class="n">ma</span> <span class="o">=</span> <span class="n">Probability</span><span class="p">(</span><span class="n">wires</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span><span class="n">ma</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="n">qm</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="measureall">
<h4>MeasureAll<a class="headerlink" href="#measureall" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.qnn.vqc.torch.MeasureAll">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.qnn.vqc.torch.</span></span><span class="sig-name descname"><span class="pre">MeasureAll</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">obs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.qnn.vqc.torch.MeasureAll" title="Link to this definition">¶</a></dt>
<dd><p>计算量子线路的测量结果,支持输入obs为多个或单个泡利算子或哈密顿量。
例如:</p>
<p>{'wires': [0,  1], 'observables': ['x', 'i'],'coefficient':[0.23,-3.5]}
或:
{'X0': 0.23}
或:
[{'wires': [0, 2, 3],'observables': ['X', 'Y', 'Z'],'coefficient': [1, 0.5, 0.4]}, {'wires': [0, 1, 2],'observables': ['X', 'Y', 'Z'],'coefficient': [1, 0.5, 0.4]}]</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.qnn.vqc.torch.QModule</span></code> 以及 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code>。
该类可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>obs</strong> – observable。</p></li>
<li><p><strong>name</strong> – 模块的名字,默认:””。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>一个 MeasureAll 测量方法实例。</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.qnn.vqc.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">MeasureAll</span><span class="p">,</span><span class="n">rx</span><span class="p">,</span><span class="n">ry</span><span class="p">,</span><span class="n">cnot</span><span class="p">,</span><span class="n">QMachine</span><span class="p">,</span><span class="n">rz</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.tensor</span><span class="w"> </span><span class="kn">import</span> <span class="n">QTensor</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet</span><span class="w"> </span><span class="kn">import</span> <span class="n">kfloat64</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">QTensor</span><span class="p">([[</span><span class="mf">0.56</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">],[</span><span class="mf">0.56</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">]],</span><span class="n">requires_grad</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">qm</span> <span class="o">=</span> <span class="n">QMachine</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">qm</span><span class="o">.</span><span class="n">reset_states</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">rz</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="n">qm</span><span class="p">,</span><span class="n">wires</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">params</span><span class="o">=</span><span class="n">x</span><span class="p">[:,[</span><span class="mi">0</span><span class="p">]])</span>
<span class="n">rz</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="n">qm</span><span class="p">,</span><span class="n">wires</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">params</span><span class="o">=</span><span class="n">x</span><span class="p">[:,[</span><span class="mi">0</span><span class="p">]])</span>
<span class="n">cnot</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="n">qm</span><span class="p">,</span><span class="n">wires</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ry</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="n">qm</span><span class="p">,</span><span class="n">wires</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">params</span><span class="o">=</span><span class="n">x</span><span class="p">[:,[</span><span class="mi">1</span><span class="p">]])</span>
<span class="n">cnot</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="n">qm</span><span class="p">,</span><span class="n">wires</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
<span class="n">rz</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="n">qm</span><span class="p">,</span><span class="n">wires</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">params</span><span class="o">=</span><span class="n">x</span><span class="p">[:,[</span><span class="mi">1</span><span class="p">]])</span>
<span class="n">obs_list</span> <span class="o">=</span> <span class="p">[{</span>
    <span class="s1">&#39;wires&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
    <span class="s1">&#39;observables&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="s1">&#39;Z&#39;</span><span class="p">],</span>
    <span class="s1">&#39;coefficient&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">]</span>
<span class="p">},</span> <span class="p">{</span>
    <span class="s1">&#39;wires&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
    <span class="s1">&#39;observables&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="s1">&#39;Z&#39;</span><span class="p">],</span>
    <span class="s1">&#39;coefficient&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">]</span>
<span class="p">}]</span>
<span class="n">ma</span> <span class="o">=</span> <span class="n">MeasureAll</span><span class="p">(</span><span class="n">obs</span> <span class="o">=</span> <span class="n">obs_list</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">ma</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="n">qm</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="samples">
<h4>Samples<a class="headerlink" href="#samples" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.qnn.vqc.torch.Samples">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.qnn.vqc.torch.</span></span><span class="sig-name descname"><span class="pre">Samples</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">wires</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">obs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shots</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.qnn.vqc.torch.Samples" title="Link to this definition">¶</a></dt>
<dd><p>获取特定线路上的带有 shot 的样本结果</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.qnn.vqc.torch.QModule</span></code> 以及 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code>。
该类可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>wires</strong> – 样本量子比特索引。默认值: None,根据运行时使用模拟器的所有比特。</p></li>
<li><p><strong>obs</strong> – 该值只能设为None。</p></li>
<li><p><strong>shots</strong> – 样本重复次数,默认值: 1。</p></li>
<li><p><strong>name</strong> – 此模块的名称,默认值: “”。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>一个 Samples 测量方法实例。</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.qnn.vqc.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">Samples</span><span class="p">,</span><span class="n">rx</span><span class="p">,</span><span class="n">ry</span><span class="p">,</span><span class="n">cnot</span><span class="p">,</span><span class="n">QMachine</span><span class="p">,</span><span class="n">rz</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.tensor</span><span class="w"> </span><span class="kn">import</span> <span class="n">QTensor</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet</span><span class="w"> </span><span class="kn">import</span> <span class="n">kfloat64</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">QTensor</span><span class="p">([[</span><span class="mf">0.56</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">],[</span><span class="mf">0.56</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">]],</span><span class="n">requires_grad</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">qm</span> <span class="o">=</span> <span class="n">QMachine</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">qm</span><span class="o">.</span><span class="n">reset_states</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">rz</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="n">qm</span><span class="p">,</span><span class="n">wires</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">params</span><span class="o">=</span><span class="n">x</span><span class="p">[:,[</span><span class="mi">0</span><span class="p">]])</span>
<span class="n">rx</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="n">qm</span><span class="p">,</span><span class="n">wires</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">params</span><span class="o">=</span><span class="n">x</span><span class="p">[:,[</span><span class="mi">0</span><span class="p">]])</span>
<span class="n">cnot</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="n">qm</span><span class="p">,</span><span class="n">wires</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>

<span class="n">cnot</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="n">qm</span><span class="p">,</span><span class="n">wires</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
<span class="n">ry</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="n">qm</span><span class="p">,</span><span class="n">wires</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">params</span><span class="o">=</span><span class="n">x</span><span class="p">[:,[</span><span class="mi">1</span><span class="p">]])</span>


<span class="n">ma</span> <span class="o">=</span> <span class="n">Samples</span><span class="p">(</span><span class="n">wires</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span><span class="n">shots</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">ma</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="n">qm</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="sparsehamiltonian">
<h4>SparseHamiltonian<a class="headerlink" href="#sparsehamiltonian" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.qnn.vqc.torch.SparseHamiltonian">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.qnn.vqc.torch.</span></span><span class="sig-name descname"><span class="pre">SparseHamiltonian</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">obs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.qnn.vqc.torch.SparseHamiltonian" title="Link to this definition">¶</a></dt>
<dd><p>计算观测量的稀疏哈密顿量,例如 {“observables”:H,”wires”:[0,2,3]}。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.qnn.vqc.torch.QModule</span></code> 以及 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code>。
该类可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>obs</strong> – 稀疏哈密顿量,使用 <cite>tensor.dense_to_csr()</cite> 函数获取稠密函数的稀疏格式。</p></li>
<li><p><strong>name</strong> – 模块的名字,默认:””。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>一个 SparseHamiltonian 测量方法实例。</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">set_random_seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet</span><span class="w"> </span><span class="kn">import</span> <span class="n">tensor</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.nn</span><span class="w"> </span><span class="kn">import</span> <span class="n">Module</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.qnn.vqc.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">QMachine</span><span class="p">,</span><span class="n">CRX</span><span class="p">,</span><span class="n">PauliX</span><span class="p">,</span><span class="n">paulix</span><span class="p">,</span><span class="n">crx</span><span class="p">,</span><span class="n">SparseHamiltonian</span>
<span class="n">H</span> <span class="o">=</span> <span class="n">tensor</span><span class="o">.</span><span class="n">QTensor</span><span class="p">(</span>
<span class="p">[[</span> <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>
<span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,],</span>
<span class="p">[</span> <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>
<span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">1.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,],</span>
<span class="p">[</span> <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>
<span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">1.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,],</span>
<span class="p">[</span> <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>
<span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,],</span>
<span class="p">[</span> <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>
<span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,],</span>
<span class="p">[</span> <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>
<span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">1.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,],</span>
<span class="p">[</span> <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>
<span class="mf">1.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,],</span>
<span class="p">[</span> <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>
<span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,],</span>
<span class="p">[</span> <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>
<span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,],</span>
<span class="p">[</span> <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">1.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>
<span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,],</span>
<span class="p">[</span> <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">1.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>
<span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,],</span>
<span class="p">[</span> <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>
<span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,],</span>
<span class="p">[</span> <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>
<span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,],</span>
<span class="p">[</span> <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">1.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>
<span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,],</span>
<span class="p">[</span> <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">1.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>
<span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,],</span>
<span class="p">[</span><span class="o">-</span><span class="mf">1.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>
<span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,</span>  <span class="mf">0.</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">,]],</span><span class="n">dtype</span><span class="o">=</span><span class="n">pyvqnet</span><span class="o">.</span><span class="n">kcomplex64</span><span class="p">)</span>
<span class="n">cpu_csr</span> <span class="o">=</span> <span class="n">tensor</span><span class="o">.</span><span class="n">dense_to_csr</span><span class="p">(</span><span class="n">H</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">QModel</span><span class="p">(</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_wires</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span><span class="n">grad_mode</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">QModel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_num_wires</span> <span class="o">=</span> <span class="n">num_wires</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dtype</span> <span class="o">=</span> <span class="n">dtype</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qm</span> <span class="o">=</span> <span class="n">QMachine</span><span class="p">(</span><span class="n">num_wires</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measure</span> <span class="o">=</span> <span class="n">SparseHamiltonian</span><span class="p">(</span><span class="n">obs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;observables&quot;</span><span class="p">:</span><span class="n">cpu_csr</span><span class="p">,</span> <span class="s2">&quot;wires&quot;</span><span class="p">:[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">]})</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qm</span><span class="o">.</span><span class="n">reset_states</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">paulix</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">qm</span><span class="p">,</span> <span class="n">wires</span><span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">paulix</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">qm</span><span class="p">,</span> <span class="n">wires</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">crx</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">qm</span><span class="p">,</span><span class="n">wires</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span><span class="n">params</span><span class="o">=</span><span class="n">tensor</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">1</span><span class="p">),</span><span class="mf">0.1</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">pyvqnet</span><span class="o">.</span><span class="n">kcomplex64</span><span class="p">))</span>
        <span class="n">crx</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">qm</span><span class="p">,</span><span class="n">wires</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span><span class="n">params</span><span class="o">=</span><span class="n">tensor</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">1</span><span class="p">),</span><span class="mf">0.2</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">pyvqnet</span><span class="o">.</span><span class="n">kcomplex64</span><span class="p">))</span>
        <span class="n">crx</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">qm</span><span class="p">,</span><span class="n">wires</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span><span class="n">params</span><span class="o">=</span><span class="n">tensor</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">1</span><span class="p">),</span><span class="mf">0.3</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">pyvqnet</span><span class="o">.</span><span class="n">kcomplex64</span><span class="p">))</span>
        <span class="n">crx</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">qm</span><span class="p">,</span><span class="n">wires</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span><span class="n">params</span><span class="o">=</span><span class="n">tensor</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">1</span><span class="p">),</span><span class="mf">0.3</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">pyvqnet</span><span class="o">.</span><span class="n">kcomplex64</span><span class="p">))</span>
        <span class="n">crx</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">qm</span><span class="p">,</span><span class="n">wires</span><span class="o">=</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span><span class="n">params</span><span class="o">=</span><span class="n">tensor</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">1</span><span class="p">),</span><span class="mf">0.3</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">pyvqnet</span><span class="o">.</span><span class="n">kcomplex64</span><span class="p">))</span>

        <span class="n">rlt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">qm</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rlt</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">QModel</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="n">pyvqnet</span><span class="o">.</span><span class="n">kcomplex64</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">tensor</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]))</span>

<span class="nb">print</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="hermitianexpval">
<h4>HermitianExpval<a class="headerlink" href="#hermitianexpval" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.qnn.vqc.torch.HermitianExpval">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.qnn.vqc.torch.</span></span><span class="sig-name descname"><span class="pre">HermitianExpval</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">obs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.qnn.vqc.torch.HermitianExpval" title="Link to this definition">¶</a></dt>
<dd><p>计算量子线路某个厄密特量的期望。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.qnn.vqc.torch.QModule</span></code> 以及 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code>。
该类可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>obs</strong> – 厄密特量。</p></li>
<li><p><strong>name</strong> – 模块的名字,默认:””。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>一个 HermitianExpval 测量方法实例。</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.qnn.vqc.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">QMachine</span><span class="p">,</span> <span class="n">rx</span><span class="p">,</span><span class="n">ry</span><span class="p">,</span>\
    <span class="n">RX</span><span class="p">,</span> <span class="n">RY</span><span class="p">,</span> <span class="n">CNOT</span><span class="p">,</span> <span class="n">PauliX</span><span class="p">,</span> <span class="n">PauliZ</span><span class="p">,</span> <span class="n">VQC_RotCircuit</span><span class="p">,</span><span class="n">HermitianExpval</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.tensor</span><span class="w"> </span><span class="kn">import</span> <span class="n">QTensor</span><span class="p">,</span> <span class="n">tensor</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.nn</span><span class="w"> </span><span class="kn">import</span> <span class="n">Parameter</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="n">bsz</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">H</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">6</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
<span class="k">class</span><span class="w"> </span><span class="nc">QModel</span><span class="p">(</span><span class="n">pyvqnet</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_wires</span><span class="p">,</span> <span class="n">dtype</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">QModel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rot_param</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rot_param</span><span class="o">.</span><span class="n">copy_value_from</span><span class="p">(</span><span class="n">tensor</span><span class="o">.</span><span class="n">QTensor</span><span class="p">([</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">2.3</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_num_wires</span> <span class="o">=</span> <span class="n">num_wires</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dtype</span> <span class="o">=</span> <span class="n">dtype</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qm</span> <span class="o">=</span> <span class="n">QMachine</span><span class="p">(</span><span class="n">num_wires</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rx_layer1</span> <span class="o">=</span> <span class="n">VQC_RotCircuit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ry_layer2</span> <span class="o">=</span> <span class="n">RY</span><span class="p">(</span><span class="n">has_params</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                            <span class="n">trainable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                            <span class="n">wires</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                            <span class="n">init_params</span><span class="o">=</span><span class="n">tensor</span><span class="o">.</span><span class="n">QTensor</span><span class="p">([</span><span class="o">-</span><span class="mf">0.5</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xlayer</span> <span class="o">=</span> <span class="n">PauliX</span><span class="p">(</span><span class="n">wires</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cnot</span> <span class="o">=</span> <span class="n">CNOT</span><span class="p">(</span><span class="n">wires</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measure</span> <span class="o">=</span> <span class="n">HermitianExpval</span><span class="p">(</span><span class="n">obs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;wires&#39;</span><span class="p">:(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="s1">&#39;observables&#39;</span><span class="p">:</span><span class="n">tensor</span><span class="o">.</span><span class="n">to_tensor</span><span class="p">(</span><span class="n">H</span><span class="p">)})</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qm</span><span class="o">.</span><span class="n">reset_states</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="n">rx</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">qm</span><span class="p">,</span> <span class="n">wires</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">x</span><span class="p">[:,</span> <span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
        <span class="n">ry</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">qm</span><span class="p">,</span> <span class="n">wires</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">x</span><span class="p">[:,</span> <span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xlayer</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">qm</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rx_layer1</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rot_param</span><span class="p">,</span> <span class="n">wire</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">q_machine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">qm</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ry_layer2</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">qm</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cnot</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">qm</span><span class="p">)</span>
        <span class="n">rlt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="n">q_machine</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qm</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">rlt</span>


<span class="n">input_x</span> <span class="o">=</span> <span class="n">tensor</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">bsz</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                        <span class="n">dtype</span><span class="o">=</span><span class="n">pyvqnet</span><span class="o">.</span><span class="n">kfloat32</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="n">bsz</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="n">input_x</span><span class="o">.</span><span class="n">requires_grad</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">qunatum_model</span> <span class="o">=</span> <span class="n">QModel</span><span class="p">(</span><span class="n">num_wires</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">pyvqnet</span><span class="o">.</span><span class="n">kcomplex64</span><span class="p">)</span>

<span class="n">batch_y</span> <span class="o">=</span> <span class="n">qunatum_model</span><span class="p">(</span><span class="n">input_x</span><span class="p">)</span>
<span class="n">batch_y</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="n">batch_y</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
</section>
<section id="id13">
<h3>量子线路常见模板<a class="headerlink" href="#id13" title="Link to this heading">¶</a></h3>
<section id="vqc-hardwareefficientansatz">
<h4>VQC_HardwareEfficientAnsatz<a class="headerlink" href="#vqc-hardwareefficientansatz" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.qnn.vqc.torch.VQC_HardwareEfficientAnsatz">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.qnn.vqc.torch.</span></span><span class="sig-name descname"><span class="pre">VQC_HardwareEfficientAnsatz</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">n_qubits</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">single_rot_gate_list</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">entangle_gate</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'CNOT'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">entangle_rules</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'linear'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">depth</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">initial</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.qnn.vqc.torch.VQC_HardwareEfficientAnsatz" title="Link to this definition">¶</a></dt>
<dd><p>论文介绍的Hardware Efficient Ansatz的实现: <a class="reference external" href="https://arxiv.org/pdf/1704.05018.pdf">Hardware-efficient Variational Quantum Eigensolver for Small Molecules</a> 。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.qnn.vqc.torch.QModule</span></code> 以及 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code>。
该类可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>n_qubits</strong> – 量子比特数。</p></li>
<li><p><strong>single_rot_gate_list</strong> – 单个量子比特旋转门列表由一个或多个作用于每个量子比特的旋转门构成。目前支持 Rx、Ry、Rz。</p></li>
<li><p><strong>entangle_gate</strong> – 非参数化纠缠门。支持 CNOT、CZ。默认值: CNOT。</p></li>
<li><p><strong>entangle_rules</strong> – 纠缠门在电路中的使用方式。’linear’ 表示纠缠门将作用于每个相邻的量子比特。’all’ 表示纠缠门将作用于任意两个量子比特。默认值: linear。</p></li>
<li><p><strong>depth</strong> – 假设的深度,默认值: 1。</p></li>
<li><p><strong>initial</strong> – 使用initial 初始化所有其中参数逻辑门的参数,默认值: None,此模块将随机初始化参数。</p></li>
<li><p><strong>dtype</strong> – 参数的数据类型,默认值: None,使用float32。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>一个 VQC_HardwareEfficientAnsatz 实例。</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.nn.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">TorchModule</span><span class="p">,</span><span class="n">Linear</span><span class="p">,</span><span class="n">TorchModuleList</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.qnn.vqc.torch.qcircuit</span><span class="w"> </span><span class="kn">import</span> <span class="n">VQC_HardwareEfficientAnsatz</span><span class="p">,</span><span class="n">RZZ</span><span class="p">,</span><span class="n">RZ</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.qnn.vqc.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">Probability</span><span class="p">,</span><span class="n">QMachine</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet</span><span class="w"> </span><span class="kn">import</span> <span class="n">tensor</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">set_random_seed</span><span class="p">(</span><span class="mi">25</span><span class="p">)</span>

<span class="k">class</span><span class="w"> </span><span class="nc">QM</span><span class="p">(</span><span class="n">TorchModule</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">linearx</span> <span class="o">=</span> <span class="n">Linear</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ansatz</span> <span class="o">=</span> <span class="n">VQC_HardwareEfficientAnsatz</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;rx&quot;</span><span class="p">,</span> <span class="s2">&quot;RY&quot;</span><span class="p">,</span> <span class="s2">&quot;rz&quot;</span><span class="p">],</span>
                                    <span class="n">entangle_gate</span><span class="o">=</span><span class="s2">&quot;cnot&quot;</span><span class="p">,</span>
                                    <span class="n">entangle_rules</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
                                    <span class="n">depth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">encode1</span> <span class="o">=</span> <span class="n">RZ</span><span class="p">(</span><span class="n">wires</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">encode2</span> <span class="o">=</span> <span class="n">RZ</span><span class="p">(</span><span class="n">wires</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measure</span> <span class="o">=</span> <span class="n">Probability</span><span class="p">(</span><span class="n">wires</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">QMachine</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">reset_states</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">linearx</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">encode1</span><span class="p">(</span><span class="n">params</span> <span class="o">=</span> <span class="n">y</span><span class="p">[:,</span> <span class="p">[</span><span class="mi">0</span><span class="p">]],</span><span class="n">q_machine</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">encode2</span><span class="p">(</span><span class="n">params</span> <span class="o">=</span> <span class="n">y</span><span class="p">[:,</span> <span class="p">[</span><span class="mi">1</span><span class="p">]],</span><span class="n">q_machine</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ansatz</span><span class="p">(</span><span class="n">q_machine</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="n">q_machine</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>

<span class="n">bz</span> <span class="o">=</span><span class="mi">3</span>
<span class="n">inputx</span> <span class="o">=</span> <span class="n">tensor</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="n">bz</span><span class="o">*</span><span class="mi">4</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="n">bz</span><span class="p">,</span><span class="mi">4</span><span class="p">])</span>
<span class="n">inputx</span><span class="o">.</span><span class="n">requires_grad</span><span class="o">=</span> <span class="kc">True</span>
<span class="n">qlayer</span> <span class="o">=</span> <span class="n">QM</span><span class="p">()</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">qlayer</span><span class="p">(</span><span class="n">inputx</span><span class="p">)</span>
<span class="n">y</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="vqc-basicentanglertemplate">
<h4>VQC_BasicEntanglerTemplate<a class="headerlink" href="#vqc-basicentanglertemplate" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.qnn.vqc.torch.VQC_BasicEntanglerTemplate">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.qnn.vqc.torch.</span></span><span class="sig-name descname"><span class="pre">VQC_BasicEntanglerTemplate</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">num_layer</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_qubits</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rotation</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'RX'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">initial</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.qnn.vqc.torch.VQC_BasicEntanglerTemplate" title="Link to this definition">¶</a></dt>
<dd><p>由每个量子位上的单参数单量子位旋转组成的层,后跟一个闭合链或环组合的多个CNOT门。</p>
<p>CNOT 门环将每个量子位与其邻居连接起来,最后一个量子位被认为是第一个量子位的邻居。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.qnn.vqc.torch.QModule</span></code> 以及 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code>。
该类可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>num_layer</strong> – 量子比特线路层数。</p></li>
<li><p><strong>num_qubits</strong> – 量子比特数,默认为1。</p></li>
<li><p><strong>rotation</strong> – 使用单参数单量子比特门,``RX`` 被用作默认值。</p></li>
<li><p><strong>initial</strong> – 使用initial 初始化所有其中参数逻辑门的参数,默认值: None,此模块将随机初始化参数。</p></li>
<li><p><strong>dtype</strong> – 参数的数据类型,默认值: None,使用float32。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>返回一个含可训练参数的VQC_BasicEntanglerTemplate实例。</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.qnn.vqc.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">QModule</span><span class="p">,</span>\
    <span class="n">VQC_BasicEntanglerTemplate</span><span class="p">,</span> <span class="n">Probability</span><span class="p">,</span> <span class="n">QMachine</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet</span><span class="w"> </span><span class="kn">import</span> <span class="n">tensor</span>


<span class="k">class</span><span class="w"> </span><span class="nc">QM</span><span class="p">(</span><span class="n">QModule</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ansatz</span> <span class="o">=</span> <span class="n">VQC_BasicEntanglerTemplate</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span>
                                            <span class="mi">4</span><span class="p">,</span>
                                            <span class="s2">&quot;rz&quot;</span><span class="p">,</span>
                                            <span class="n">initial</span><span class="o">=</span><span class="n">tensor</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">measure</span> <span class="o">=</span> <span class="n">Probability</span><span class="p">(</span><span class="n">wires</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">QMachine</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ansatz</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>

<span class="n">bz</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">inputx</span> <span class="o">=</span> <span class="n">tensor</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">bz</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="n">bz</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
<span class="n">qlayer</span> <span class="o">=</span> <span class="n">QM</span><span class="p">()</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">qlayer</span><span class="p">(</span><span class="n">inputx</span><span class="p">)</span>
<span class="n">y</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="vqc-stronglyentanglingtemplate">
<h4>VQC_StronglyEntanglingTemplate<a class="headerlink" href="#vqc-stronglyentanglingtemplate" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.qnn.vqc.torch.VQC_StronglyEntanglingTemplate">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.qnn.vqc.torch.</span></span><span class="sig-name descname"><span class="pre">VQC_StronglyEntanglingTemplate</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">num_layers=1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_qubits=1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rotation</span> <span class="pre">=</span> <span class="pre">&quot;RX&quot;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">initial</span> <span class="pre">=</span> <span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype:</span> <span class="pre">=</span> <span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.qnn.vqc.torch.VQC_StronglyEntanglingTemplate" title="Link to this definition">¶</a></dt>
<dd><p>由单个量子比特旋转和纠缠器组成的层,参考 <a class="reference external" href="https://arxiv.org/abs/1804.00633">circuit-centric classifier design</a> .</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.qnn.vqc.torch.QModule</span></code> 以及 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code>。
该类可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>num_layers</strong> – 重复层数,默认值: 1。</p></li>
<li><p><strong>num_qubits</strong> – 量子比特数,默认值: 1。</p></li>
<li><p><strong>rotation</strong> – 要使用的单参数单量子比特门,默认值: <cite>RX</cite></p></li>
<li><p><strong>initial</strong> – 使用initial 初始化所有其中参数逻辑门的参数,默认值: None,此模块将随机初始化参数。</p></li>
<li><p><strong>dtype</strong> – 参数的数据类型,默认值: None,使用 float32。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>VQC_BasicEntanglerTemplate 实例</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.nn.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">TorchModule</span><span class="p">,</span><span class="n">Linear</span><span class="p">,</span><span class="n">TorchModuleList</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.qnn.vqc.torch.qcircuit</span><span class="w"> </span><span class="kn">import</span> <span class="n">VQC_StronglyEntanglingTemplate</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.qnn.vqc.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">Probability</span><span class="p">,</span> <span class="n">QMachine</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet</span><span class="w"> </span><span class="kn">import</span> <span class="n">tensor</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>

<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">set_random_seed</span><span class="p">(</span><span class="mi">25</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">QM</span><span class="p">(</span><span class="n">TorchModule</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ansatz</span> <span class="o">=</span> <span class="n">VQC_StronglyEntanglingTemplate</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span>
                                            <span class="mi">4</span><span class="p">,</span>
                                            <span class="kc">None</span><span class="p">,</span>
                                            <span class="n">initial</span><span class="o">=</span><span class="n">tensor</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">measure</span> <span class="o">=</span> <span class="n">Probability</span><span class="p">(</span><span class="n">wires</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">QMachine</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ansatz</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>

<span class="n">bz</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">inputx</span> <span class="o">=</span> <span class="n">tensor</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">bz</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="n">bz</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
<span class="n">qlayer</span> <span class="o">=</span> <span class="n">QM</span><span class="p">()</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">qlayer</span><span class="p">(</span><span class="n">inputx</span><span class="p">)</span>
<span class="n">y</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="vqc-quantumembedding">
<h4>VQC_QuantumEmbedding<a class="headerlink" href="#vqc-quantumembedding" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.qnn.vqc.torch.VQC_QuantumEmbedding">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.qnn.vqc.torch.</span></span><span class="sig-name descname"><span class="pre">VQC_QuantumEmbedding</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">qubits</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">machine</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_repetitions_input</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">depth_input</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_unitary_layers</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_repetitions</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">initial</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.qnn.vqc.torch.VQC_QuantumEmbedding" title="Link to this definition">¶</a></dt>
<dd><p>使用 RZ,RY,RZ 创建变分量子电路,将经典数据编码为量子态。
参考 <a class="reference external" href="https://arxiv.org/abs/2001.03622">Quantum embeddings for machine learning</a>。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.qnn.vqc.torch.QModule</span></code> 以及 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code>。
该类可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>num_repetitions_input</strong> – 子模块中输入编码的重复次数。</p></li>
<li><p><strong>num_unitary_layers</strong> – 变分量子门的重复次数。</p></li>
<li><p><strong>num_repetitions</strong> – 子模块的重复次数。</p></li>
<li><p><strong>initial</strong> – 参数初始化值,默认为None</p></li>
<li><p><strong>dtype</strong> – 参数的类型,默认 None,使用float32.</p></li>
<li><p><strong>name</strong> – 类的名字</p></li>
</ul>
</dd>
<dt class="field-even">Paramdepth_input<span class="colon">:</span></dt>
<dd class="field-even"><p>输入维数。</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.nn.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">TorchModule</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.qnn.vqc.torch.qcircuit</span><span class="w"> </span><span class="kn">import</span> <span class="n">VQC_QuantumEmbedding</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.qnn.vqc.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">Probability</span><span class="p">,</span> <span class="n">QMachine</span><span class="p">,</span> <span class="n">MeasureAll</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet</span><span class="w"> </span><span class="kn">import</span> <span class="n">tensor</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>

<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">set_random_seed</span><span class="p">(</span><span class="mi">25</span><span class="p">)</span>
<span class="n">depth_input</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">num_repetitions</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">num_repetitions_input</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">num_unitary_layers</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">nq</span> <span class="o">=</span> <span class="n">depth_input</span> <span class="o">*</span> <span class="n">num_repetitions_input</span>
<span class="n">bz</span> <span class="o">=</span> <span class="mi">12</span>

<span class="k">class</span><span class="w"> </span><span class="nc">QM</span><span class="p">(</span><span class="n">TorchModule</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ansatz</span> <span class="o">=</span> <span class="n">VQC_QuantumEmbedding</span><span class="p">(</span><span class="n">num_repetitions_input</span><span class="p">,</span> <span class="n">depth_input</span><span class="p">,</span>
                                        <span class="n">num_unitary_layers</span><span class="p">,</span>
                                        <span class="n">num_repetitions</span><span class="p">,</span> <span class="n">initial</span><span class="o">=</span><span class="n">tensor</span><span class="o">.</span><span class="n">full</span><span class="p">([</span><span class="mi">1</span><span class="p">],</span><span class="mf">12.0</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="n">pyvqnet</span><span class="o">.</span><span class="n">kfloat64</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">measure</span> <span class="o">=</span> <span class="n">MeasureAll</span><span class="p">(</span><span class="n">obs</span><span class="o">=</span><span class="p">{</span><span class="sa">f</span><span class="s2">&quot;Z</span><span class="si">{</span><span class="n">nq</span><span class="o">-</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">QMachine</span><span class="p">(</span><span class="n">nq</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">reset_states</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ansatz</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">q_machine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>

<span class="n">inputx</span> <span class="o">=</span> <span class="n">tensor</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">bz</span> <span class="o">*</span> <span class="n">depth_input</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="n">bz</span><span class="p">,</span> <span class="n">depth_input</span><span class="p">])</span>
<span class="n">qlayer</span> <span class="o">=</span> <span class="n">QM</span><span class="p">()</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">qlayer</span><span class="p">(</span><span class="n">inputx</span><span class="p">)</span>
<span class="n">y</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="expressiveentanglingansatz">
<h4>ExpressiveEntanglingAnsatz<a class="headerlink" href="#expressiveentanglingansatz" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.qnn.vqc.torch.ExpressiveEntanglingAnsatz">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.qnn.vqc.torch.</span></span><span class="sig-name descname"><span class="pre">ExpressiveEntanglingAnsatz</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">type</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_wires</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">depth</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.qnn.vqc.torch.ExpressiveEntanglingAnsatz" title="Link to this definition">¶</a></dt>
<dd><p>论文 <a class="reference external" href="https://arxiv.org/pdf/1905.10876.pdf">Expressibility and entangling capability of parameterized quantum circuits for hybrid quantum-classical algorithms</a> 中的 19 种不同的ansatz。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.qnn.vqc.torch.QModule</span></code> 以及 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code>。
该类可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>type</strong> – 电路类型从 1 到 19,共19种线路。</p></li>
<li><p><strong>num_wires</strong> – 量子比特数。</p></li>
<li><p><strong>depth</strong> – 电路深度。</p></li>
<li><p><strong>dtype</strong> – 参数的数据类型, 默认值: None, 使用 float32。</p></li>
<li><p><strong>name</strong> – 名字,默认””.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>一个 ExpressiveEntanglingAnsatz 实例</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.nn.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">TorchModule</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.qnn.vqc.torch.qcircuit</span><span class="w"> </span><span class="kn">import</span> <span class="n">ExpressiveEntanglingAnsatz</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.qnn.vqc.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">Probability</span><span class="p">,</span> <span class="n">QMachine</span><span class="p">,</span> <span class="n">MeasureAll</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet</span><span class="w"> </span><span class="kn">import</span> <span class="n">tensor</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>

<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">set_random_seed</span><span class="p">(</span><span class="mi">25</span><span class="p">)</span>

<span class="k">class</span><span class="w"> </span><span class="nc">QModel</span><span class="p">(</span><span class="n">TorchModule</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_wires</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span><span class="n">grad_mode</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">QModel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_num_wires</span> <span class="o">=</span> <span class="n">num_wires</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dtype</span> <span class="o">=</span> <span class="n">dtype</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qm</span> <span class="o">=</span> <span class="n">QMachine</span><span class="p">(</span><span class="n">num_wires</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span><span class="n">grad_mode</span><span class="o">=</span><span class="n">grad_mode</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c1</span> <span class="o">=</span> <span class="n">ExpressiveEntanglingAnsatz</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measure</span> <span class="o">=</span> <span class="n">MeasureAll</span><span class="p">(</span><span class="n">obs</span><span class="o">=</span><span class="p">{</span>
            <span class="s1">&#39;wires&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="s1">&#39;observables&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">],</span>
            <span class="s1">&#39;coefficient&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="p">})</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qm</span><span class="o">.</span><span class="n">reset_states</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c1</span><span class="p">(</span><span class="n">q_machine</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qm</span><span class="p">)</span>
        <span class="n">rlt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">qm</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rlt</span>


<span class="n">input_x</span> <span class="o">=</span> <span class="n">tensor</span><span class="o">.</span><span class="n">QTensor</span><span class="p">([[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">]])</span>

<span class="n">qunatum_model</span> <span class="o">=</span> <span class="n">QModel</span><span class="p">(</span><span class="n">num_wires</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">pyvqnet</span><span class="o">.</span><span class="n">kcomplex64</span><span class="p">)</span>

<span class="n">batch_y</span> <span class="o">=</span> <span class="n">qunatum_model</span><span class="p">(</span><span class="n">input_x</span><span class="p">)</span>
<span class="n">batch_y</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">batch_y</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="vqc-basis-embedding">
<h4>vqc_basis_embedding<a class="headerlink" href="#vqc-basis-embedding" title="Link to this heading">¶</a></h4>
<dl class="py function">
<dt class="sig sig-object py" id="pyvqnet.qnn.vqc.torch.vqc_basis_embedding">
<span class="sig-prename descclassname"><span class="pre">pyvqnet.qnn.vqc.torch.</span></span><span class="sig-name descname"><span class="pre">vqc_basis_embedding</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">basis_state</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">q_machine</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.qnn.vqc.torch.vqc_basis_embedding" title="Link to this definition">¶</a></dt>
<dd><p>将n个二进制特征编码到 <code class="docutils literal notranslate"><span class="pre">q_machine</span></code> 的n个量子比特的基态。该函数别名 <cite>VQC_BasisEmbedding</cite> 。</p>
<p>例如, 对于 <code class="docutils literal notranslate"><span class="pre">basis_state=([0,</span> <span class="pre">1,</span> <span class="pre">1])</span></code>, 在量子系统下其基态为 <span class="math notranslate nohighlight">\(|011 \rangle\)</span>。</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>basis_state</strong> – <code class="docutils literal notranslate"><span class="pre">(n)</span></code> 大小的二进制输入。</p></li>
<li><p><strong>q_machine</strong> – 量子虚拟机设备。</p></li>
</ul>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.qnn.vqc.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">vqc_basis_embedding</span><span class="p">,</span><span class="n">QMachine</span>
<span class="n">qm</span>  <span class="o">=</span> <span class="n">QMachine</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">vqc_basis_embedding</span><span class="p">(</span><span class="n">basis_state</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">q_machine</span><span class="o">=</span><span class="n">qm</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">qm</span><span class="o">.</span><span class="n">states</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="vqc-angle-embedding">
<h4>vqc_angle_embedding<a class="headerlink" href="#vqc-angle-embedding" title="Link to this heading">¶</a></h4>
<dl class="py function">
<dt class="sig sig-object py" id="pyvqnet.qnn.vqc.torch.vqc_angle_embedding">
<span class="sig-prename descclassname"><span class="pre">pyvqnet.qnn.vqc.torch.</span></span><span class="sig-name descname"><span class="pre">vqc_angle_embedding</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_feat</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wires</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">q_machine</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#pyvqnet.qnn.vqc.torch.QMachine" title="pyvqnet.qnn.vqc.torch.QMachine"><span class="pre">pyvqnet.qnn.vqc.torch.QMachine</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">rotation</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'X'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.qnn.vqc.torch.vqc_angle_embedding" title="Link to this definition">¶</a></dt>
<dd><p>将 <span class="math notranslate nohighlight">\(N\)</span> 特征编码到 <span class="math notranslate nohighlight">\(n\)</span> 量子比特的旋转角度中, 其中 <span class="math notranslate nohighlight">\(N \leq n\)</span>。
该函数别名 <cite>VQC_AngleEmbedding</cite> 。</p>
<p>旋转可以选择为 : ‘X’ , ‘Y’ , ‘Z’, 如 <code class="docutils literal notranslate"><span class="pre">rotation</span></code> 的参数定义为:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">rotation='X'</span></code> 将特征用作RX旋转的角度。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rotation='Y'</span></code> 将特征用作RY旋转的角度。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rotation='Z'</span></code> 将特征用作RZ旋转的角度。</p></li>
</ul>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">wires</span></code> 代表旋转门在量子比特上的idx。</p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>input_feat</strong> – 表示参数的数组。</p></li>
<li><p><strong>wires</strong> – 量子比特idx。</p></li>
<li><p><strong>q_machine</strong> – 量子虚拟机设备。</p></li>
<li><p><strong>rotation</strong> – 旋转门,默认为“X”。</p></li>
</ul>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.qnn.vqc.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">vqc_angle_embedding</span><span class="p">,</span> <span class="n">QMachine</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.tensor</span><span class="w"> </span><span class="kn">import</span> <span class="n">QTensor</span>
<span class="n">qm</span>  <span class="o">=</span> <span class="n">QMachine</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">vqc_angle_embedding</span><span class="p">(</span><span class="n">QTensor</span><span class="p">([</span><span class="mf">2.2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">q_machine</span><span class="o">=</span><span class="n">qm</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">qm</span><span class="o">.</span><span class="n">states</span><span class="p">)</span>
<span class="n">vqc_angle_embedding</span><span class="p">(</span><span class="n">QTensor</span><span class="p">([</span><span class="mf">2.2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">q_machine</span><span class="o">=</span><span class="n">qm</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="s1">&#39;Y&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">qm</span><span class="o">.</span><span class="n">states</span><span class="p">)</span>
<span class="n">vqc_angle_embedding</span><span class="p">(</span><span class="n">QTensor</span><span class="p">([</span><span class="mf">2.2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">q_machine</span><span class="o">=</span><span class="n">qm</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="s1">&#39;Z&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">qm</span><span class="o">.</span><span class="n">states</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="vqc-amplitude-embedding">
<h4>vqc_amplitude_embedding<a class="headerlink" href="#vqc-amplitude-embedding" title="Link to this heading">¶</a></h4>
<dl class="py function">
<dt class="sig sig-object py" id="pyvqnet.qnn.vqc.torch.vqc_amplitude_embeddingVQC_AmplitudeEmbeddingCircuit">
<span class="sig-prename descclassname"><span class="pre">pyvqnet.qnn.vqc.torch.</span></span><span class="sig-name descname"><span class="pre">vqc_amplitude_embeddingVQC_AmplitudeEmbeddingCircuit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_feature</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">q_machine</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.qnn.vqc.torch.vqc_amplitude_embeddingVQC_AmplitudeEmbeddingCircuit" title="Link to this definition">¶</a></dt>
<dd><p>将 <span class="math notranslate nohighlight">\(2^n\)</span> 特征编码为 <span class="math notranslate nohighlight">\(n\)</span> 量子比特的振幅向量。该函数别名 <cite>VQC_AmplitudeEmbedding</cite> 。</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>input_feature</strong> – 表示参数的numpy数组。</p></li>
<li><p><strong>q_machine</strong> – 量子虚拟机设备。</p></li>
</ul>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.qnn.vqc.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">vqc_amplitude_embedding</span><span class="p">,</span> <span class="n">QMachine</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.tensor</span><span class="w"> </span><span class="kn">import</span> <span class="n">QTensor</span>
<span class="n">qm</span>  <span class="o">=</span> <span class="n">QMachine</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">vqc_amplitude_embedding</span><span class="p">(</span><span class="n">QTensor</span><span class="p">([</span><span class="mf">3.2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mf">0.3</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mf">0.1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">q_machine</span><span class="o">=</span><span class="n">qm</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">qm</span><span class="o">.</span><span class="n">states</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="vqc-iqp-embedding">
<h4>vqc_iqp_embedding<a class="headerlink" href="#vqc-iqp-embedding" title="Link to this heading">¶</a></h4>
<dl class="py function">
<dt class="sig sig-object py" id="pyvqnet.qnn.vqc.vqc_iqp_embedding">
<span class="sig-prename descclassname"><span class="pre">pyvqnet.qnn.vqc.</span></span><span class="sig-name descname"><span class="pre">vqc_iqp_embedding</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_feat</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">q_machine</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#pyvqnet.qnn.vqc.torch.QMachine" title="pyvqnet.qnn.vqc.torch.QMachine"><span class="pre">pyvqnet.qnn.vqc.torch.QMachine</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">rep</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.qnn.vqc.vqc_iqp_embedding" title="Link to this definition">¶</a></dt>
<dd><p>使用IQP线路的对角门将 <span class="math notranslate nohighlight">\(n\)</span> 特征编码为 <span class="math notranslate nohighlight">\(n\)</span> 量子比特。该函数别名:  <code class="docutils literal notranslate"><span class="pre">VQC_IQPEmbedding</span></code> 。</p>
<p>编码是由 <a class="reference external" href="https://arxiv.org/pdf/1804.11326.pdf">Havlicek et al. (2018)</a> 提出。</p>
<p>通过指定 <code class="docutils literal notranslate"><span class="pre">rep</span></code> ,可以重复基本IQP线路。</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>input_feat</strong> – 表示参数的数组。</p></li>
<li><p><strong>q_machine</strong> – 量子虚拟机设备。</p></li>
<li><p><strong>rep</strong> – 重复量子线路块次数,默认次数为1。</p></li>
</ul>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.qnn.vqc.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">vqc_iqp_embedding</span><span class="p">,</span> <span class="n">QMachine</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.tensor</span><span class="w"> </span><span class="kn">import</span> <span class="n">QTensor</span>
<span class="n">qm</span>  <span class="o">=</span> <span class="n">QMachine</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">vqc_iqp_embedding</span><span class="p">(</span><span class="n">QTensor</span><span class="p">([</span><span class="mf">3.2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">]),</span> <span class="n">q_machine</span><span class="o">=</span><span class="n">qm</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">qm</span><span class="o">.</span><span class="n">states</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="vqc-rotcircuit">
<h4>vqc_rotcircuit<a class="headerlink" href="#vqc-rotcircuit" title="Link to this heading">¶</a></h4>
<dl class="py function">
<dt class="sig sig-object py" id="pyvqnet.qnn.vqc.torch.vqc_rotcircuit">
<span class="sig-prename descclassname"><span class="pre">pyvqnet.qnn.vqc.torch.</span></span><span class="sig-name descname"><span class="pre">vqc_rotcircuit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">q_machine</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wire</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">params</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.qnn.vqc.torch.vqc_rotcircuit" title="Link to this definition">¶</a></dt>
<dd><p>任意单量子比特旋转的量子逻辑门组合。该函数别名:  <code class="docutils literal notranslate"><span class="pre">VQC_RotCircuit</span></code> 。</p>
<div class="math notranslate nohighlight">
\[\begin{split}R(\phi,\theta,\omega) = RZ(\omega)RY(\theta)RZ(\phi)= \begin{bmatrix}
e^{-i(\phi+\omega)/2}\cos(\theta/2) &amp; -e^{i(\phi-\omega)/2}\sin(\theta/2) \\
e^{-i(\phi-\omega)/2}\sin(\theta/2) &amp; e^{i(\phi+\omega)/2}\cos(\theta/2)
\end{bmatrix}.\end{split}\]</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>q_machine</strong> – 量子虚拟机设备。</p></li>
<li><p><strong>wire</strong> – 量子比特索引。</p></li>
<li><p><strong>params</strong> – 表示参数  <span class="math notranslate nohighlight">\([\phi, \theta, \omega]\)</span>。</p></li>
</ul>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.qnn.vqc.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">vqc_rotcircuit</span><span class="p">,</span> <span class="n">QMachine</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.tensor</span><span class="w"> </span><span class="kn">import</span> <span class="n">QTensor</span>
<span class="n">qm</span>  <span class="o">=</span> <span class="n">QMachine</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">vqc_rotcircuit</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="n">qm</span><span class="p">,</span> <span class="n">wire</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">params</span><span class="o">=</span><span class="n">QTensor</span><span class="p">([</span><span class="mf">2.0</span><span class="p">,</span><span class="mf">1.5</span><span class="p">,</span><span class="mf">2.1</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">qm</span><span class="o">.</span><span class="n">states</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="vqc-crot-circuit">
<h4>vqc_crot_circuit<a class="headerlink" href="#vqc-crot-circuit" title="Link to this heading">¶</a></h4>
<dl class="py function">
<dt class="sig sig-object py" id="pyvqnet.qnn.vqc.torch.vqc_crot_circuit">
<span class="sig-prename descclassname"><span class="pre">pyvqnet.qnn.vqc.torch.</span></span><span class="sig-name descname"><span class="pre">vqc_crot_circuit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">para</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">control_qubits</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rot_wire</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">q_machine</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.qnn.vqc.torch.vqc_crot_circuit" title="Link to this definition">¶</a></dt>
<dd><blockquote>
<div><p>受控Rot单量子比特旋转的量子逻辑门组合。该函数别名:  <code class="docutils literal notranslate"><span class="pre">VQC_CRotCircuit</span></code> 。</p>
</div></blockquote>
<div class="math notranslate nohighlight">
\[\begin{split}CR(\phi, \theta, \omega) = \begin{bmatrix}
    1 &amp; 0 &amp; 0 &amp; 0 \\
    0 &amp; 1 &amp; 0 &amp; 0\\
    0 &amp; 0 &amp; e^{-i(\phi+\omega)/2}\cos(\theta/2) &amp; -e^{i(\phi-\omega)/2}\sin(\theta/2)\\
    0 &amp; 0 &amp; e^{-i(\phi-\omega)/2}\sin(\theta/2) &amp; e^{i(\phi+\omega)/2}\cos(\theta/2)
\end{bmatrix}.\end{split}\]</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>para</strong> – 表示参数的数组。</p></li>
<li><p><strong>control_qubits</strong> – 控制量子比特索引。</p></li>
<li><p><strong>rot_wire</strong> – Rot量子比特索引。</p></li>
<li><p><strong>q_machine</strong> – 量子虚拟机设备。</p></li>
</ul>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.tensor</span><span class="w"> </span><span class="kn">import</span> <span class="n">QTensor</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.qnn.vqc.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">vqc_crot_circuit</span><span class="p">,</span><span class="n">QMachine</span><span class="p">,</span> <span class="n">MeasureAll</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">QTensor</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">])</span>
<span class="n">qm</span> <span class="o">=</span> <span class="n">QMachine</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">vqc_crot_circuit</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">qm</span><span class="p">)</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">MeasureAll</span><span class="p">(</span><span class="n">obs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Z0&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
<span class="n">exp</span> <span class="o">=</span> <span class="n">m</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="n">qm</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">exp</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="vqc-controlled-hadamard">
<h4>vqc_controlled_hadamard<a class="headerlink" href="#vqc-controlled-hadamard" title="Link to this heading">¶</a></h4>
<dl class="py function">
<dt class="sig sig-object py" id="pyvqnet.qnn.vqc.torch.vqc_controlled_hadamard">
<span class="sig-prename descclassname"><span class="pre">pyvqnet.qnn.vqc.torch.</span></span><span class="sig-name descname"><span class="pre">vqc_controlled_hadamard</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">wires</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">q_machine</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.qnn.vqc.torch.vqc_controlled_hadamard" title="Link to this definition">¶</a></dt>
<dd><p>受控Hadamard逻辑门量子线路。该函数别名:  <code class="docutils literal notranslate"><span class="pre">VQC_Controlled_Hadamard</span></code> 。</p>
<div class="math notranslate nohighlight">
\[\begin{split}CH = \begin{bmatrix}
    1 &amp; 0 &amp; 0 &amp; 0 \\
    0 &amp; 1 &amp; 0 &amp; 0 \\
    0 &amp; 0 &amp; \frac{1}{\sqrt{2}} &amp; \frac{1}{\sqrt{2}} \\
    0 &amp; 0 &amp; \frac{1}{\sqrt{2}} &amp; -\frac{1}{\sqrt{2}}
\end{bmatrix}.\end{split}\]</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>wires</strong> – 量子比特索引列表, 第一位是控制比特, 列表长度为2。</p></li>
<li><p><strong>q_machine</strong> – 量子虚拟机设备。</p></li>
</ul>
</dd>
</dl>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.tensor</span><span class="w"> </span><span class="kn">import</span> <span class="n">QTensor</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.qnn.vqc.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">vqc_controlled_hadamard</span><span class="p">,</span>\
    <span class="n">QMachine</span><span class="p">,</span> <span class="n">MeasureAll</span>

<span class="n">p</span> <span class="o">=</span> <span class="n">QTensor</span><span class="p">([</span><span class="mf">0.2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">])</span>
<span class="n">qm</span> <span class="o">=</span> <span class="n">QMachine</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">vqc_controlled_hadamard</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">qm</span><span class="p">)</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">MeasureAll</span><span class="p">(</span><span class="n">obs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Z0&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
<span class="n">exp</span> <span class="o">=</span> <span class="n">m</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="n">qm</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">exp</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="vqc-ccz">
<h4>vqc_ccz<a class="headerlink" href="#vqc-ccz" title="Link to this heading">¶</a></h4>
<dl class="py function">
<dt class="sig sig-object py" id="pyvqnet.qnn.vqc.torch.vqc_ccz">
<span class="sig-prename descclassname"><span class="pre">pyvqnet.qnn.vqc.torch.</span></span><span class="sig-name descname"><span class="pre">vqc_ccz</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">wires</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">q_machine</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.qnn.vqc.torch.vqc_ccz" title="Link to this definition">¶</a></dt>
<dd><p>受控-受控-Z (controlled-controlled-Z) 逻辑门。该函数别名:  <code class="docutils literal notranslate"><span class="pre">VQC_CCZ</span></code> 。</p>
<div class="math notranslate nohighlight">
\[\begin{split}CCZ =
\begin{pmatrix}
1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\
0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\
0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\
0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\
0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0\\
0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0\\
0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0\\
0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; -1
\end{pmatrix}\end{split}\]</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>wires</strong> – 量子比特下标列表,第一位是控制比特。列表长度为3。</p></li>
<li><p><strong>q_machine</strong> – 量子虚拟机设备。</p></li>
</ul>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.tensor</span><span class="w"> </span><span class="kn">import</span> <span class="n">QTensor</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.qnn.vqc.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">vqc_ccz</span><span class="p">,</span><span class="n">QMachine</span><span class="p">,</span> <span class="n">MeasureAll</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">QTensor</span><span class="p">([</span><span class="mf">0.2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">])</span>

<span class="n">qm</span> <span class="o">=</span> <span class="n">QMachine</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

<span class="n">vqc_ccz</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">qm</span><span class="p">)</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">MeasureAll</span><span class="p">(</span><span class="n">obs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Z0&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
<span class="n">exp</span> <span class="o">=</span> <span class="n">m</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="n">qm</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">exp</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="vqc-fermionic-single-excitation">
<h4>vqc_fermionic_single_excitation<a class="headerlink" href="#vqc-fermionic-single-excitation" title="Link to this heading">¶</a></h4>
<dl class="py function">
<dt class="sig sig-object py" id="pyvqnet.qnn.vqc.torch.vqc_fermionic_single_excitation">
<span class="sig-prename descclassname"><span class="pre">pyvqnet.qnn.vqc.torch.</span></span><span class="sig-name descname"><span class="pre">vqc_fermionic_single_excitation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">weight</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wires</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">q_machine</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.qnn.vqc.torch.vqc_fermionic_single_excitation" title="Link to this definition">¶</a></dt>
<dd><p>对泡利矩阵的张量积求幂的耦合簇单激励算子。矩阵形式下式给出:</p>
<div class="math notranslate nohighlight">
\[\hat{U}_{pr}(\theta) = \mathrm{exp} \{ \theta_{pr} (\hat{c}_p^\dagger \hat{c}_r
-\mathrm{H.c.}) \},\]</div>
<p>该函数别名:  <code class="docutils literal notranslate"><span class="pre">VQC_FermionicSingleExcitation</span></code> 。</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>weight</strong> – 量子比特p上的参数, 只有一个元素.</p></li>
<li><p><strong>wires</strong> – 表示区间[r, p]中的量子比特索引子集。最小长度必须为2。第一索引值被解释为r,最后一个索引值被解释为p。
中间的索引被CNOT门作用,以计算量子位集的奇偶校验。</p></li>
<li><p><strong>q_machine</strong> – 量子虚拟机设备。</p></li>
</ul>
</dd>
</dl>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.tensor</span><span class="w"> </span><span class="kn">import</span> <span class="n">QTensor</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.qnn.vqc.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">vqc_fermionic_single_excitation</span><span class="p">,</span>\
    <span class="n">QMachine</span><span class="p">,</span> <span class="n">MeasureAll</span>
<span class="n">qm</span> <span class="o">=</span> <span class="n">QMachine</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">p0</span> <span class="o">=</span> <span class="n">QTensor</span><span class="p">([</span><span class="mf">0.5</span><span class="p">])</span>

<span class="n">vqc_fermionic_single_excitation</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">qm</span><span class="p">)</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">MeasureAll</span><span class="p">(</span><span class="n">obs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Z0&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
<span class="n">exp</span> <span class="o">=</span> <span class="n">m</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="n">qm</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">exp</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="vqc-fermionic-double-excitation">
<h4>vqc_fermionic_double_excitation<a class="headerlink" href="#vqc-fermionic-double-excitation" title="Link to this heading">¶</a></h4>
<dl class="py function">
<dt class="sig sig-object py" id="pyvqnet.qnn.vqc.torch.vqc_fermionic_double_excitation">
<span class="sig-prename descclassname"><span class="pre">pyvqnet.qnn.vqc.torch.</span></span><span class="sig-name descname"><span class="pre">vqc_fermionic_double_excitation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">weight</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wires1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wires2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">q_machine</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.qnn.vqc.torch.vqc_fermionic_double_excitation" title="Link to this definition">¶</a></dt>
<dd><p>对泡利矩阵的张量积求幂的耦合聚类双激励算子,矩阵形式由下式给出:</p>
<div class="math notranslate nohighlight">
\[\hat{U}_{pqrs}(\theta) = \mathrm{exp} \{ \theta (\hat{c}_p^\dagger \hat{c}_q^\dagger
\hat{c}_r \hat{c}_s - \mathrm{H.c.}) \},\]</div>
<p>其中 <span class="math notranslate nohighlight">\(\hat{c}\)</span> 和 <span class="math notranslate nohighlight">\(\hat{c}^\dagger\)</span> 是费米子湮灭和
创建运算符和索引 <span class="math notranslate nohighlight">\(r, s\)</span> 和 <span class="math notranslate nohighlight">\(p, q\)</span> 在占用的和
分别为空分子轨道。 使用 <a class="reference external" href="https://arxiv.org/abs/1208.5986">Jordan-Wigner 变换</a> 上面定义的费米子算子可以写成
根据 Pauli 矩阵(有关更多详细信息,请参见
<a class="reference external" href="https://arxiv.org/abs/1805.04340">arXiv:1805.04340</a>)</p>
<div class="math notranslate nohighlight">
\[\begin{split}\hat{U}_{pqrs}(\theta) = \mathrm{exp} \Big\{
\frac{i\theta}{8} \bigotimes_{b=s+1}^{r-1} \hat{Z}_b \bigotimes_{a=q+1}^{p-1}
\hat{Z}_a (\hat{X}_s \hat{X}_r \hat{Y}_q \hat{X}_p +
\hat{Y}_s \hat{X}_r \hat{Y}_q \hat{Y}_p +\\ \hat{X}_s \hat{Y}_r \hat{Y}_q \hat{Y}_p +
\hat{X}_s \hat{X}_r \hat{X}_q \hat{Y}_p - \mathrm{H.c.}  ) \Big\}\end{split}\]</div>
<p>该函数别名:  <code class="docutils literal notranslate"><span class="pre">VQC_FermionicDoubleExcitation</span></code> 。</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>weight</strong> – 可变参数</p></li>
<li><p><strong>wires1</strong> – 代表的量子比特的索引列表区间 [s, r] 中占据量子比特的子集。第一个索引被解释为 s,最后一索引被解释为 r。 CNOT 门对中间的索引进行操作,以计算一组量子位的奇偶性。</p></li>
<li><p><strong>wires2</strong> – 代表的量子比特的索引列表区间 [q, p] 中占据量子比特的子集。第一根索引被解释为 q,最后一索引被解释为 p。 CNOT 门对中间的索引进行操作,以计算一组量子位的奇偶性。</p></li>
<li><p><strong>q_machine</strong> – 量子虚拟机设备。</p></li>
</ul>
</dd>
</dl>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.tensor</span><span class="w"> </span><span class="kn">import</span> <span class="n">QTensor</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.qnn.vqc.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">vqc_fermionic_double_excitation</span><span class="p">,</span>\
    <span class="n">QMachine</span><span class="p">,</span> <span class="n">MeasureAll</span>
<span class="n">qm</span> <span class="o">=</span> <span class="n">QMachine</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">p0</span> <span class="o">=</span> <span class="n">QTensor</span><span class="p">([</span><span class="mf">0.5</span><span class="p">])</span>

<span class="n">vqc_fermionic_double_excitation</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">qm</span><span class="p">)</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">MeasureAll</span><span class="p">(</span><span class="n">obs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Z0&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
<span class="n">exp</span> <span class="o">=</span> <span class="n">m</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="n">qm</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">exp</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="vqc-uccsd">
<h4>vqc_uccsd<a class="headerlink" href="#vqc-uccsd" title="Link to this heading">¶</a></h4>
<dl class="py function">
<dt class="sig sig-object py" id="pyvqnet.qnn.vqc.torch.vqc_uccsd">
<span class="sig-prename descclassname"><span class="pre">pyvqnet.qnn.vqc.torch.</span></span><span class="sig-name descname"><span class="pre">vqc_uccsd</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">weights</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wires</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">s_wires</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">d_wires</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">init_state</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">q_machine</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.qnn.vqc.torch.vqc_uccsd" title="Link to this definition">¶</a></dt>
<dd><p>实现酉耦合簇单激发和双激发拟设(UCCSD)。UCCSD 是 VQE 拟设,通常用于运行量子化学模拟。</p>
<p>在一阶 Trotter 近似内,UCCSD 酉函数由下式给出:</p>
<div class="math notranslate nohighlight">
\[\hat{U}(\vec{\theta}) =
\prod_{p &gt; r} \mathrm{exp} \Big\{\theta_{pr}
(\hat{c}_p^\dagger \hat{c}_r-\mathrm{H.c.}) \Big\}
\prod_{p &gt; q &gt; r &gt; s} \mathrm{exp} \Big\{\theta_{pqrs}
(\hat{c}_p^\dagger \hat{c}_q^\dagger \hat{c}_r \hat{c}_s-\mathrm{H.c.}) \Big\}\]</div>
<p>其中 <span class="math notranslate nohighlight">\(\hat{c}\)</span> 和 <span class="math notranslate nohighlight">\(\hat{c}^\dagger\)</span> 是费米子湮灭和
创建运算符和索引 <span class="math notranslate nohighlight">\(r, s\)</span> 和 <span class="math notranslate nohighlight">\(p, q\)</span> 在占用的和
分别为空分子轨道。(更多细节见
<a class="reference external" href="https://arxiv.org/abs/1805.04340">arXiv:1805.04340</a>):</p>
<p>该函数别名:  <code class="docutils literal notranslate"><span class="pre">VQC_UCCSD</span></code> 。</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>weights</strong> – 包含参数的大小 <code class="docutils literal notranslate"><span class="pre">(len(s_wires)+</span> <span class="pre">len(d_wires))</span></code> 张量
<span class="math notranslate nohighlight">\(\theta_{pr}\)</span> 和 <span class="math notranslate nohighlight">\(\theta_{pqrs}\)</span> 输入 Z 旋转
<code class="docutils literal notranslate"><span class="pre">FermionicSingleExcitation</span></code> 和 <code class="docutils literal notranslate"><span class="pre">FermionicDoubleExcitation</span></code> 。</p></li>
<li><p><strong>wires</strong> – 模板作用的量子比特索引</p></li>
<li><p><strong>s_wires</strong> – 包含量子比特索引的列表序列 <code class="docutils literal notranslate"><span class="pre">[r,...,p]</span></code>
由单一激发产生
<span class="math notranslate nohighlight">\(\vert r, p \rangle = \hat{c}_p^\dagger \hat{c}_r \vert \mathrm{HF} \rangle\)</span>,
其中 <span class="math notranslate nohighlight">\(\vert \mathrm{HF} \rangle\)</span> 表示 Hartee-Fock 参考态。</p></li>
<li><p><strong>d_wires</strong> – 列表序列,每个列表包含两个列表
指定索引 <code class="docutils literal notranslate"><span class="pre">[s,</span> <span class="pre">...,r]</span></code> 和 <code class="docutils literal notranslate"><span class="pre">[q,...,</span> <span class="pre">p]</span></code>
定义双激励 <span class="math notranslate nohighlight">\(\vert s, r, q, p \rangle = \hat{c}_p^\dagger \hat{c}_q^\dagger \hat{c}_r\hat{c}_s \vert \mathrm{HF} \rangle\)</span> 。</p></li>
<li><p><strong>init_state</strong> – 长度 <code class="docutils literal notranslate"><span class="pre">len(wires)</span></code> occupation-number vector 表示
高频状态。 <code class="docutils literal notranslate"><span class="pre">init_state</span></code> 在量子比特初始化状态。</p></li>
<li><p><strong>q_machine</strong> – 量子虚拟机设备。</p></li>
</ul>
</dd>
</dl>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.qnn.vqc.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">vqc_uccsd</span><span class="p">,</span> <span class="n">QMachine</span><span class="p">,</span> <span class="n">MeasureAll</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.tensor</span><span class="w"> </span><span class="kn">import</span> <span class="n">QTensor</span>
<span class="n">p0</span> <span class="o">=</span> <span class="n">QTensor</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">s_wires</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]]</span>
<span class="n">d_wires</span> <span class="o">=</span> <span class="p">[[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]],</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]],</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]],</span>
        <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]]]</span>
<span class="n">qm</span> <span class="o">=</span> <span class="n">QMachine</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>

<span class="n">vqc_uccsd</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span> <span class="n">s_wires</span><span class="p">,</span> <span class="n">d_wires</span><span class="p">,</span> <span class="n">QTensor</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]),</span> <span class="n">qm</span><span class="p">)</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">MeasureAll</span><span class="p">(</span><span class="n">obs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Z1&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
<span class="n">exp</span> <span class="o">=</span> <span class="n">m</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="n">qm</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">exp</span><span class="p">)</span>

<span class="c1"># [[0.963802]]</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="vqc-zfeaturemap">
<h4>vqc_zfeaturemap<a class="headerlink" href="#vqc-zfeaturemap" title="Link to this heading">¶</a></h4>
<dl class="py function">
<dt class="sig sig-object py" id="pyvqnet.qnn.vqc.torch.vqc_zfeaturemap">
<span class="sig-prename descclassname"><span class="pre">pyvqnet.qnn.vqc.torch.</span></span><span class="sig-name descname"><span class="pre">vqc_zfeaturemap</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_feat</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">q_machine</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#pyvqnet.qnn.vqc.torch.QMachine" title="pyvqnet.qnn.vqc.torch.QMachine"><span class="pre">pyvqnet.qnn.vqc.torch.QMachine</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">data_map_func</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rep</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">2</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.qnn.vqc.torch.vqc_zfeaturemap" title="Link to this definition">¶</a></dt>
<dd><p>一阶泡利 Z 演化电路。</p>
<p>对于 3 个量子位和 2 次重复,电路表示为:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>┌───┐┌──────────────┐┌───┐┌──────────────┐
┤ H ├┤ U1(2.0*x[0]) ├┤ H ├┤ U1(2.0*x[0]) ├
├───┤├──────────────┤├───┤├──────────────┤
┤ H ├┤ U1(2.0*x[1]) ├┤ H ├┤ U1(2.0*x[1]) ├
├───┤├──────────────┤├───┤├──────────────┤
┤ H ├┤ U1(2.0*x[2]) ├┤ H ├┤ U1(2.0*x[2]) ├
└───┘└──────────────┘└───┘└──────────────┘
</pre></div>
</div>
<p>泡利弦固定为 <code class="docutils literal notranslate"><span class="pre">Z</span></code>。 因此,一阶展开将是一个没有纠缠门的电路。</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>input_feat</strong> – 表示输入参数的数组。</p></li>
<li><p><strong>q_machine</strong> – 量子虚拟机。</p></li>
<li><p><strong>data_map_func</strong> – 参数映射矩阵, 为可调用函数, 设计方式为: <code class="docutils literal notranslate"><span class="pre">data_map_func</span> <span class="pre">=</span> <span class="pre">lambda</span> <span class="pre">x:</span> <span class="pre">x</span></code>。</p></li>
<li><p><strong>rep</strong> – 模块重复次数。</p></li>
</ul>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.qnn.vqc.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">vqc_zfeaturemap</span><span class="p">,</span> <span class="n">QMachine</span><span class="p">,</span> <span class="n">hadamard</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.tensor</span><span class="w"> </span><span class="kn">import</span> <span class="n">QTensor</span>
<span class="n">qm</span> <span class="o">=</span> <span class="n">QMachine</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">hadamard</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="n">qm</span><span class="p">,</span> <span class="n">wires</span><span class="o">=</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<span class="n">vqc_zfeaturemap</span><span class="p">(</span><span class="n">input_feat</span><span class="o">=</span><span class="n">QTensor</span><span class="p">([[</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.3</span><span class="p">]]),</span><span class="n">q_machine</span> <span class="o">=</span> <span class="n">qm</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">qm</span><span class="o">.</span><span class="n">states</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="vqc-zzfeaturemap">
<h4>vqc_zzfeaturemap<a class="headerlink" href="#vqc-zzfeaturemap" title="Link to this heading">¶</a></h4>
<dl class="py function">
<dt class="sig sig-object py" id="pyvqnet.qnn.vqc.torch.vqc_zzfeaturemap">
<span class="sig-prename descclassname"><span class="pre">pyvqnet.qnn.vqc.torch.</span></span><span class="sig-name descname"><span class="pre">vqc_zzfeaturemap</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_feat</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">q_machine</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#pyvqnet.qnn.vqc.torch.QMachine" title="pyvqnet.qnn.vqc.torch.QMachine"><span class="pre">pyvqnet.qnn.vqc.torch.QMachine</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">data_map_func</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">entanglement</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Callable</span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'full'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rep</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">2</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.qnn.vqc.torch.vqc_zzfeaturemap" title="Link to this definition">¶</a></dt>
<dd><p>二阶 Pauli-Z 演化电路。</p>
<p>对于 3 个量子位、1 个重复和线性纠缠,电路表示为:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>┌───┐┌─────────────────┐
┤ H ├┤ U1(2.0*φ(x[0])) ├──■────────────────────────────■────────────────────────────────────
├───┤├─────────────────┤┌─┴─┐┌──────────────────────┐┌─┴─┐
┤ H ├┤ U1(2.0*φ(x[1])) ├┤ X ├┤ U1(2.0*φ(x[0],x[1])) ├┤ X ├──■────────────────────────────■──
├───┤├─────────────────┤└───┘└──────────────────────┘└───┘┌─┴─┐┌──────────────────────┐┌─┴─┐
┤ H ├┤ U1(2.0*φ(x[2])) ├──────────────────────────────────┤ X ├┤ U1(2.0*φ(x[1],x[2])) ├┤ X ├
└───┘└─────────────────┘                                  └───┘└──────────────────────┘└───┘
</pre></div>
</div>
<p>其中 <code class="docutils literal notranslate"><span class="pre">φ</span></code> 是经典的非线性函数,如果输入两个值则 <code class="docutils literal notranslate"><span class="pre">φ(x,y)</span> <span class="pre">=</span> <span class="pre">(pi</span> <span class="pre">-</span> <span class="pre">x)(pi</span> <span class="pre">-</span> <span class="pre">y)</span></code>, 输入一个则为 <code class="docutils literal notranslate"><span class="pre">φ(x)</span> <span class="pre">=</span> <span class="pre">x</span></code>, 用 <code class="docutils literal notranslate"><span class="pre">data_map_func</span></code> 表示如下:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">data_map_func</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">coeff</span> <span class="o">=</span> <span class="n">x</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">ft</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span> <span class="n">y</span><span class="p">),</span> <span class="n">x</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">coeff</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>input_feat</strong> – 表示输入参数的数组。</p></li>
<li><p><strong>q_machine</strong> – 量子虚拟机。</p></li>
<li><p><strong>data_map_func</strong> – 参数映射矩阵, 为可调用函数。</p></li>
<li><p><strong>entanglement</strong> – 指定的纠缠结构。</p></li>
<li><p><strong>rep</strong> – 模块重复次数。</p></li>
</ul>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.qnn.vqc.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">vqc_zzfeaturemap</span><span class="p">,</span> <span class="n">QMachine</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.tensor</span><span class="w"> </span><span class="kn">import</span> <span class="n">QTensor</span>

<span class="n">qm</span> <span class="o">=</span> <span class="n">QMachine</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">vqc_zzfeaturemap</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="n">qm</span><span class="p">,</span> <span class="n">input_feat</span><span class="o">=</span><span class="n">QTensor</span><span class="p">([[</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.3</span><span class="p">]]))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">qm</span><span class="o">.</span><span class="n">states</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="vqc-allsinglesdoubles">
<h4>vqc_allsinglesdoubles<a class="headerlink" href="#vqc-allsinglesdoubles" title="Link to this heading">¶</a></h4>
<dl class="py function">
<dt class="sig sig-object py" id="pyvqnet.qnn.vqc.torch.vqc_allsinglesdoubles">
<span class="sig-prename descclassname"><span class="pre">pyvqnet.qnn.vqc.torch.</span></span><span class="sig-name descname"><span class="pre">vqc_allsinglesdoubles</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">weights</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">q_machine</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#pyvqnet.qnn.vqc.torch.QMachine" title="pyvqnet.qnn.vqc.torch.QMachine"><span class="pre">pyvqnet.qnn.vqc.torch.QMachine</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">hf_state</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wires</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">singles</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">doubles</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.qnn.vqc.torch.vqc_allsinglesdoubles" title="Link to this definition">¶</a></dt>
<dd><p>在这种情况下,我们有四个单激发和双激发来保留 Hartree-Fock 态的总自旋投影。</p>
<p>由此产生的酉矩阵保留了粒子数量,并在初始 Hartree-Fock 状态和编码多激发配置的其他状态的叠加中准备了n量子位系统。</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>weights</strong> – 大小为 <code class="docutils literal notranslate"><span class="pre">(len(singles)</span> <span class="pre">+</span> <span class="pre">len(doubles),)</span></code> 的QTensor,包含按顺序进入 vqc.qCircuit.single_excitation 和 vqc.qCircuit.double_excitation 操作的角度</p></li>
<li><p><strong>q_machine</strong> – 量子虚拟机。</p></li>
<li><p><strong>hf_state</strong> – 代表 Hartree-Fock 状态的长度 <code class="docutils literal notranslate"><span class="pre">len(wires)</span></code> 占用数向量, <code class="docutils literal notranslate"><span class="pre">hf_state</span></code> 用于初始化线路。</p></li>
<li><p><strong>wires</strong> – 作用的量子位。</p></li>
<li><p><strong>singles</strong> – 具有single_exitation操作所作用的两个量子位索引的列表序列。</p></li>
<li><p><strong>doubles</strong> – 具有double_exitation操作所作用的两个量子位索引的列表序列。</p></li>
</ul>
</dd>
</dl>
<p>例如,两个电子和六个量子位情况下的量子电路如下图所示:</p>
</dd></dl>

<a class="reference internal image-reference" href="../_images/all_singles_doubles.png"><img alt="../_images/all_singles_doubles.png" class="align-center" src="../_images/all_singles_doubles.png" style="width: 600px;" />
</a>
<div class="line-block">
<div class="line"><br /></div>
</div>
<blockquote>
<div><p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.qnn.vqc.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">vqc_allsinglesdoubles</span><span class="p">,</span> <span class="n">QMachine</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.tensor</span><span class="w"> </span><span class="kn">import</span> <span class="n">QTensor</span>
<span class="n">qubits</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">qm</span> <span class="o">=</span> <span class="n">QMachine</span><span class="p">(</span><span class="n">qubits</span><span class="p">)</span>

<span class="n">vqc_allsinglesdoubles</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="n">qm</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">QTensor</span><span class="p">([</span><span class="mf">0.55</span><span class="p">,</span> <span class="mf">0.11</span><span class="p">,</span> <span class="mf">0.53</span><span class="p">]),</span>
                      <span class="n">hf_state</span> <span class="o">=</span> <span class="n">QTensor</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]),</span> <span class="n">singles</span><span class="o">=</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]],</span> <span class="n">doubles</span><span class="o">=</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]],</span> <span class="n">wires</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">qm</span><span class="o">.</span><span class="n">states</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="vqc-basisrotation">
<h4>vqc_basisrotation<a class="headerlink" href="#vqc-basisrotation" title="Link to this heading">¶</a></h4>
<dl class="py function">
<dt class="sig sig-object py" id="pyvqnet.qnn.vqc.torch.vqc_basisrotation">
<span class="sig-prename descclassname"><span class="pre">pyvqnet.qnn.vqc.torch.</span></span><span class="sig-name descname"><span class="pre">vqc_basisrotation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">q_machine</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#pyvqnet.qnn.vqc.torch.QMachine" title="pyvqnet.qnn.vqc.torch.QMachine"><span class="pre">pyvqnet.qnn.vqc.torch.QMachine</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">wires</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">unitary_matrix</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="QTensor.html#pyvqnet.tensor.tensor.QTensor" title="pyvqnet.tensor.tensor.QTensor"><span class="pre">QTensor</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">check</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.qnn.vqc.torch.vqc_basisrotation" title="Link to this definition">¶</a></dt>
<dd><p>实现一个电路,提供可用于执行精确的单体基础旋转的整体。线路来自于 <a class="reference external" href="https://arxiv.org/abs/1711.04789">arXiv:1711.04789</a>中给出的单粒子费米子确定的酉变换 <span class="math notranslate nohighlight">\(U(u)\)</span></p>
<div class="math notranslate nohighlight">
\[U(u) = \exp{\left( \sum_{pq} \left[\log u \right]_{pq} (a_p^\dagger a_q - a_q^\dagger a_p) \right)}.\]</div>
<p><span class="math notranslate nohighlight">\(U(u)\)</span> 通过使用论文 <a class="reference external" href="https://opg.optica.org/optica/fulltext.cfm?uri=optica-3-12-1460&amp;id=355743">Optica, 3, 1460 (2016)</a>中给出的方案。</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>q_machine</strong> – 量子虚拟机。</p></li>
<li><p><strong>wires</strong> – 作用的量子位。</p></li>
<li><p><strong>unitary_matrix</strong> – 指定基础变换的矩阵。</p></li>
<li><p><strong>check</strong> – 检测 <cite>unitary_matrix</cite> 是否为酉矩阵。</p></li>
</ul>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>

<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.qnn.vqc.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">vqc_basisrotation</span><span class="p">,</span> <span class="n">QMachine</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.tensor</span><span class="w"> </span><span class="kn">import</span> <span class="n">QTensor</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="n">V</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.73678</span> <span class="o">+</span> <span class="mf">0.27511</span><span class="n">j</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5095</span> <span class="o">+</span> <span class="mf">0.10704</span><span class="n">j</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.06847</span> <span class="o">+</span> <span class="mf">0.32515</span><span class="n">j</span><span class="p">],</span>
            <span class="p">[</span><span class="mf">0.73678</span> <span class="o">+</span> <span class="mf">0.27511</span><span class="n">j</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5095</span> <span class="o">+</span> <span class="mf">0.10704</span><span class="n">j</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.06847</span> <span class="o">+</span> <span class="mf">0.32515</span><span class="n">j</span><span class="p">],</span>
            <span class="p">[</span><span class="o">-</span><span class="mf">0.21271</span> <span class="o">+</span> <span class="mf">0.34938</span><span class="n">j</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.38853</span> <span class="o">+</span> <span class="mf">0.36497</span><span class="n">j</span><span class="p">,</span> <span class="mf">0.61467</span> <span class="o">-</span> <span class="mf">0.41317</span><span class="n">j</span><span class="p">]])</span>

<span class="n">eigen_vals</span><span class="p">,</span> <span class="n">eigen_vecs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigh</span><span class="p">(</span><span class="n">V</span><span class="p">)</span>
<span class="n">umat</span> <span class="o">=</span> <span class="n">eigen_vecs</span><span class="o">.</span><span class="n">T</span>
<span class="n">wires</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">umat</span><span class="p">))</span>

<span class="n">qm</span> <span class="o">=</span> <span class="n">QMachine</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">umat</span><span class="p">))</span>

<span class="n">vqc_basisrotation</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="n">qm</span><span class="p">,</span>
                <span class="n">wires</span><span class="o">=</span><span class="n">wires</span><span class="p">,</span>
                <span class="n">unitary_matrix</span><span class="o">=</span><span class="n">QTensor</span><span class="p">(</span><span class="n">umat</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">qm</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">dtype</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="n">qm</span><span class="o">.</span><span class="n">states</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="vqc-quantumpooling-circuit">
<h4>vqc_quantumpooling_circuit<a class="headerlink" href="#vqc-quantumpooling-circuit" title="Link to this heading">¶</a></h4>
<dl class="py function">
<dt class="sig sig-object py" id="pyvqnet.qnn.vqc.torch.vqc_quantumpooling_circuit">
<span class="sig-prename descclassname"><span class="pre">pyvqnet.qnn.vqc.torch.</span></span><span class="sig-name descname"><span class="pre">vqc_quantumpooling_circuit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ignored_wires</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sinks_wires</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">params</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">q_machine</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.qnn.vqc.torch.vqc_quantumpooling_circuit" title="Link to this definition">¶</a></dt>
<dd><p>对数据进行降采样的量子电路。</p>
<p>为了减少电路中的量子位数量,首先在系统中创建成对的量子位。在最初配对所有量子位之后,将广义2量子位酉元应用于每一对量子位上。并在应用这两个量子位酉元之后,在神经网络的其余部分忽略每对量子位中的一个量子位。</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>sources_wires</strong> – 将被忽略的源量子位索引。</p></li>
<li><p><strong>sinks_wires</strong> – 将保留的目标量子位索引。</p></li>
<li><p><strong>params</strong> – 输入参数。</p></li>
<li><p><strong>q_machine</strong> – 量子虚拟机设备。</p></li>
</ul>
</dd>
</dl>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>

<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.qnn.vqc.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">vqc_quantumpooling_circuit</span><span class="p">,</span> <span class="n">QMachine</span><span class="p">,</span> <span class="n">MeasureAll</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet</span><span class="w"> </span><span class="kn">import</span> <span class="n">tensor</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">tensor</span><span class="o">.</span><span class="n">full</span><span class="p">([</span><span class="mi">6</span><span class="p">],</span> <span class="mf">0.35</span><span class="p">)</span>
<span class="n">qm</span> <span class="o">=</span> <span class="n">QMachine</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">vqc_quantumpooling_circuit</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="n">qm</span><span class="p">,</span>
                        <span class="n">ignored_wires</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                        <span class="n">sinks_wires</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
                        <span class="n">params</span><span class="o">=</span><span class="n">p</span><span class="p">)</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">MeasureAll</span><span class="p">(</span><span class="n">obs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Z1&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
<span class="n">exp</span> <span class="o">=</span> <span class="n">m</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="n">qm</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">exp</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="quantumlayeradjoint">
<h4>QuantumLayerAdjoint<a class="headerlink" href="#quantumlayeradjoint" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.qnn.vqc.torch.QuantumLayerAdjoint">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.qnn.vqc.torch.</span></span><span class="sig-name descname"><span class="pre">QuantumLayerAdjoint</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">general_module</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">q_machine</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.qnn.vqc.torch.QuantumLayerAdjoint" title="Link to this definition">¶</a></dt>
<dd><p>使用伴随矩阵方式进行梯度计算的可自动微分的变分量子线路层,参考  <a class="reference external" href="https://arxiv.org/abs/2009.02823">Efficient calculation of gradients in classical simulations of variational quantum algorithms</a> 。</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>general_module</strong> – 一个仅使用 <code class="docutils literal notranslate"><span class="pre">pyvqnet.qnn.vqc.torch</span></code> 下量子线路接口搭建的 <code class="docutils literal notranslate"><span class="pre">pyvqnet.qnn.vqc.torch.QModule</span></code> 实例。</p></li>
<li><p><strong>q_machine</strong> – general_module 模块中申请的QMachine实例。</p></li>
<li><p><strong>name</strong> – 该层名字,默认为””。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>返回一个 QuantumLayerAdjoint 类实例。</p>
</dd>
</dl>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.nn.torch.TorchModule</span></code> 以及 <code class="docutils literal notranslate"><span class="pre">pyvqnet.qnn.vqc.QuantumLayerAdjoint</span></code> ,可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>general_module 的 QMachine 应设置 grad_method = “adjoint”.</p>
<p>当前支持由如下含参逻辑门 <cite>RX</cite>, <cite>RY</cite>, <cite>RZ</cite>, <cite>PhaseShift</cite>, <cite>RXX</cite>, <cite>RYY</cite>, <cite>RZZ</cite>, <cite>RZX</cite>, <cite>U1</cite>, <cite>U2</cite>, <cite>U3</cite> 以及其他不含参逻辑门构成的变分线路。</p>
</div>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet</span><span class="w"> </span><span class="kn">import</span> <span class="n">tensor</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.qnn.vqc.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">QuantumLayerAdjoint</span><span class="p">,</span> \
    <span class="n">QMachine</span><span class="p">,</span> <span class="n">RX</span><span class="p">,</span> <span class="n">RY</span><span class="p">,</span> <span class="n">CNOT</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> \
        <span class="n">MeasureAll</span><span class="p">,</span> <span class="n">RZ</span><span class="p">,</span> <span class="n">VQC_HardwareEfficientAnsatz</span><span class="p">,</span>\
            <span class="n">QModule</span>

<span class="k">class</span><span class="w"> </span><span class="nc">QModel</span><span class="p">(</span><span class="n">QModule</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_wires</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">grad_mode</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">QModel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_num_wires</span> <span class="o">=</span> <span class="n">num_wires</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dtype</span> <span class="o">=</span> <span class="n">dtype</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qm</span> <span class="o">=</span> <span class="n">QMachine</span><span class="p">(</span><span class="n">num_wires</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">grad_mode</span><span class="o">=</span><span class="n">grad_mode</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rx_layer</span> <span class="o">=</span> <span class="n">RX</span><span class="p">(</span><span class="n">has_params</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">trainable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">wires</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ry_layer</span> <span class="o">=</span> <span class="n">RY</span><span class="p">(</span><span class="n">has_params</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">trainable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">wires</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rz_layer</span> <span class="o">=</span> <span class="n">RZ</span><span class="p">(</span><span class="n">has_params</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">trainable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">wires</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rz_layer2</span> <span class="o">=</span> <span class="n">RZ</span><span class="p">(</span><span class="n">has_params</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">trainable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">wires</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">rot</span> <span class="o">=</span> <span class="n">VQC_HardwareEfficientAnsatz</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;rx&quot;</span><span class="p">,</span> <span class="s2">&quot;RY&quot;</span><span class="p">,</span> <span class="s2">&quot;rz&quot;</span><span class="p">],</span>
                                            <span class="n">entangle_gate</span><span class="o">=</span><span class="s2">&quot;cnot&quot;</span><span class="p">,</span>
                                            <span class="n">entangle_rules</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
                                            <span class="n">depth</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tlayer</span> <span class="o">=</span> <span class="n">T</span><span class="p">(</span><span class="n">wires</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cnot</span> <span class="o">=</span> <span class="n">CNOT</span><span class="p">(</span><span class="n">wires</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measure</span> <span class="o">=</span> <span class="n">MeasureAll</span><span class="p">(</span><span class="n">obs</span><span class="o">=</span><span class="p">{</span>
            <span class="s1">&#39;wires&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="s1">&#39;observables&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span>
            <span class="s1">&#39;coefficient&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="p">})</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qm</span><span class="o">.</span><span class="n">reset_states</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">rx_layer</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="n">x</span><span class="p">[:,</span> <span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">q_machine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">qm</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cnot</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">qm</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ry_layer</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="n">x</span><span class="p">[:,</span> <span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">q_machine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">qm</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tlayer</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">qm</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rz_layer</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="n">x</span><span class="p">[:,</span> <span class="p">[</span><span class="mi">2</span><span class="p">]],</span> <span class="n">q_machine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">qm</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rz_layer2</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">qm</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rot</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">qm</span><span class="p">)</span>
        <span class="n">rlt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">qm</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">rlt</span>


<span class="n">input_x</span> <span class="o">=</span> <span class="n">tensor</span><span class="o">.</span><span class="n">QTensor</span><span class="p">([[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">]])</span>
<span class="n">input_x</span> <span class="o">=</span> <span class="n">tensor</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">input_x</span><span class="p">,</span> <span class="p">[</span><span class="mi">40</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="n">input_x</span><span class="o">.</span><span class="n">requires_grad</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">qunatum_model</span> <span class="o">=</span> <span class="n">QModel</span><span class="p">(</span><span class="n">num_wires</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
                    <span class="n">dtype</span><span class="o">=</span><span class="n">pyvqnet</span><span class="o">.</span><span class="n">kcomplex64</span><span class="p">,</span>
                    <span class="n">grad_mode</span><span class="o">=</span><span class="s2">&quot;adjoint&quot;</span><span class="p">)</span>
<span class="n">adjoint_model</span> <span class="o">=</span> <span class="n">QuantumLayerAdjoint</span><span class="p">(</span><span class="n">qunatum_model</span><span class="p">,</span><span class="n">q_machine</span><span class="o">=</span><span class="n">qunatum_model</span><span class="o">.</span><span class="n">qm</span><span class="p">)</span>
<span class="n">batch_y</span> <span class="o">=</span> <span class="n">adjoint_model</span><span class="p">(</span><span class="n">input_x</span><span class="p">)</span>
<span class="n">batch_y</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="hybirdvqcqpandaqvmlayer">
<h4>HybirdVQCQpandaQVMLayer<a class="headerlink" href="#hybirdvqcqpandaqvmlayer" title="Link to this heading">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.qnn.vqc.torch.HybirdVQCQpandaQVMLayer">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.qnn.vqc.torch.</span></span><span class="sig-name descname"><span class="pre">HybirdVQCQpandaQVMLayer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">vqc_module</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="nn.html#pyvqnet.nn.pyvqnet.nn.module.Module" title="pyvqnet.nn.pyvqnet.nn.module.Module"><span class="pre">Module</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">qcloud_token</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_qubits</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_cubits</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pauli_str_dict</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">Dict</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Dict</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shots</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">submit_kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">{}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">query_kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">{}</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.qnn.vqc.torch.HybirdVQCQpandaQVMLayer" title="Link to this definition">¶</a></dt>
<dd><p>混合 vqc 和 qpanda QVM 层。该层将用户 <cite>forward</cite> 函数定义的VQNet编写的量子线路计算转化为QPanda OriginIR,可在QPanda 本地虚拟机或者云端服务上进行前向运行,并在本地CPU上模拟计算线路参数梯度,降低了使用参数漂移法计算的时间复杂度。
其中 <code class="docutils literal notranslate"><span class="pre">vqc_module</span></code> 为用户自定义的量子变分线路模型,其中的QMachine设置 <code class="docutils literal notranslate"><span class="pre">save_ir=</span> <span class="pre">True</span></code> 。</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>vqc_module</strong> – 带有 forward() 的 vqc_module。</p></li>
<li><p><strong>qcloud_token</strong> – <cite>str</cite> - 量子机器的类型或用于执行的云令牌。</p></li>
<li><p><strong>num_qubits</strong> – <cite>int</cite> - 量子电路中的量子比特数。</p></li>
<li><p><strong>num_cubits</strong> – <cite>int</cite> - 量子电路中用于测量的经典比特数。</p></li>
<li><p><strong>pauli_str_dict</strong> – <cite>dict|list</cite> - 表示量子电路中泡利算子的字典或字典列表。默认值为 None。</p></li>
<li><p><strong>shots</strong> – <cite>int</cite> - 量子线路测量次数。默认值为 1000。</p></li>
<li><p><strong>name</strong> – 模块名称。默认值为空字符串。</p></li>
<li><p><strong>submit_kwargs</strong> – 提交量子电路的附加关键字参数,默认值:
{“chip_id”:pyqpanda.real_chip_type.origin_72,
“is_amend”:True,”is_mapping”:True,
“is_optimization”:True,
“default_task_group_size”:200,
“test_qcloud_fake”:True}。</p></li>
<li><p><strong>query_kwargs</strong> – 查询量子结果的附加关键字参数,默认值:{“timeout”:2,”print_query_info”:True,”sub_circuits_split_size”:1}。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>可以计算量子电路的模块。</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">pauli_str_dict</span></code> 不能为 None,并且应与 <code class="docutils literal notranslate"><span class="pre">vqc_module</span></code> 测量函数中的 obs 相同。
<code class="docutils literal notranslate"><span class="pre">vqc_module</span></code> 应具有 <code class="docutils literal notranslate"><span class="pre">pyvqnet.qnn.vqc.torch.QMachine</span></code> 类型的属性, <code class="docutils literal notranslate"><span class="pre">pyvqnet.qnn.vqc.torch.QMachine</span></code> 应设置 save_ir=True</p>
</div>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet.backends</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.qnn.vqc.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">QMachine</span><span class="p">,</span><span class="n">QModule</span><span class="p">,</span><span class="n">RX</span><span class="p">,</span><span class="n">RY</span><span class="p">,</span>\
<span class="n">RZ</span><span class="p">,</span><span class="n">U1</span><span class="p">,</span><span class="n">U2</span><span class="p">,</span><span class="n">U3</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">S</span><span class="p">,</span><span class="n">X1</span><span class="p">,</span><span class="n">PauliX</span><span class="p">,</span><span class="n">PauliY</span><span class="p">,</span><span class="n">PauliZ</span><span class="p">,</span><span class="n">SWAP</span><span class="p">,</span><span class="n">CZ</span><span class="p">,</span>\
<span class="n">RXX</span><span class="p">,</span><span class="n">RYY</span><span class="p">,</span><span class="n">RZX</span><span class="p">,</span><span class="n">RZZ</span><span class="p">,</span><span class="n">CR</span><span class="p">,</span><span class="n">Toffoli</span><span class="p">,</span><span class="n">Hadamard</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="n">CNOT</span><span class="p">,</span><span class="n">MeasureAll</span><span class="p">,</span>\
<span class="n">TorchHybirdVQCQpandaQVMLayer</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet</span><span class="w"> </span><span class="kn">import</span> <span class="n">tensor</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet.utils</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">set_random_seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>

<span class="k">class</span><span class="w"> </span><span class="nc">QModel</span><span class="p">(</span><span class="n">QModule</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_wires</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span><span class="n">grad_mode</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">QModel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_num_wires</span> <span class="o">=</span> <span class="n">num_wires</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dtype</span> <span class="o">=</span> <span class="n">dtype</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qm</span> <span class="o">=</span> <span class="n">QMachine</span><span class="p">(</span><span class="n">num_wires</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span><span class="n">grad_mode</span><span class="o">=</span><span class="n">grad_mode</span><span class="p">,</span><span class="n">save_ir</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rx_layer</span> <span class="o">=</span> <span class="n">RX</span><span class="p">(</span><span class="n">has_params</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">trainable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">wires</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ry_layer</span> <span class="o">=</span> <span class="n">RY</span><span class="p">(</span><span class="n">has_params</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">trainable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">wires</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rz_layer</span> <span class="o">=</span> <span class="n">RZ</span><span class="p">(</span><span class="n">has_params</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">trainable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">wires</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">u1</span> <span class="o">=</span> <span class="n">U1</span><span class="p">(</span><span class="n">has_params</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">trainable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">wires</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">u2</span> <span class="o">=</span> <span class="n">U2</span><span class="p">(</span><span class="n">has_params</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">trainable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">wires</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">u3</span> <span class="o">=</span> <span class="n">U3</span><span class="p">(</span><span class="n">has_params</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">trainable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">wires</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="o">=</span> <span class="n">I</span><span class="p">(</span><span class="n">wires</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s</span> <span class="o">=</span> <span class="n">S</span><span class="p">(</span><span class="n">wires</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x1</span> <span class="o">=</span> <span class="n">X1</span><span class="p">(</span><span class="n">wires</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">PauliX</span><span class="p">(</span><span class="n">wires</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">PauliY</span><span class="p">(</span><span class="n">wires</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">PauliZ</span><span class="p">(</span><span class="n">wires</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">swap</span> <span class="o">=</span> <span class="n">SWAP</span><span class="p">(</span><span class="n">wires</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cz</span> <span class="o">=</span> <span class="n">CZ</span><span class="p">(</span><span class="n">wires</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cr</span> <span class="o">=</span> <span class="n">CR</span><span class="p">(</span><span class="n">has_params</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">trainable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">wires</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rxx</span> <span class="o">=</span> <span class="n">RXX</span><span class="p">(</span><span class="n">has_params</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">trainable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">wires</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rzz</span> <span class="o">=</span> <span class="n">RYY</span><span class="p">(</span><span class="n">has_params</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">trainable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">wires</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ryy</span> <span class="o">=</span> <span class="n">RZZ</span><span class="p">(</span><span class="n">has_params</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">trainable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">wires</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rzx</span> <span class="o">=</span> <span class="n">RZX</span><span class="p">(</span><span class="n">has_params</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">trainable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">wires</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">toffoli</span> <span class="o">=</span> <span class="n">Toffoli</span><span class="p">(</span><span class="n">wires</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span><span class="n">use_dagger</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">=</span><span class="n">Hadamard</span><span class="p">(</span><span class="n">wires</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">tlayer</span> <span class="o">=</span> <span class="n">T</span><span class="p">(</span><span class="n">wires</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cnot</span> <span class="o">=</span> <span class="n">CNOT</span><span class="p">(</span><span class="n">wires</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measure</span> <span class="o">=</span> <span class="n">MeasureAll</span><span class="p">(</span><span class="n">obs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Z0&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;Y3&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">}</span>
    <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qm</span><span class="o">.</span><span class="n">reset_states</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">i</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">qm</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">qm</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">swap</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">qm</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cz</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">qm</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">qm</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x1</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">qm</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">qm</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">qm</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ryy</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">qm</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rxx</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">qm</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rzz</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">qm</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rzx</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">qm</span><span class="p">,</span><span class="n">params</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:,[</span><span class="mi">1</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cr</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">qm</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">u1</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">qm</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">u2</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">qm</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">u3</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">qm</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rx_layer</span><span class="p">(</span><span class="n">params</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:,[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">q_machine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">qm</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cnot</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">qm</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">qm</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ry_layer</span><span class="p">(</span><span class="n">params</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:,[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">q_machine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">qm</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tlayer</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">qm</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rz_layer</span><span class="p">(</span><span class="n">params</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:,[</span><span class="mi">2</span><span class="p">]],</span> <span class="n">q_machine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">qm</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">toffoli</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">qm</span><span class="p">)</span>
        <span class="n">rlt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">qm</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">rlt</span>


<span class="n">input_x</span> <span class="o">=</span> <span class="n">tensor</span><span class="o">.</span><span class="n">QTensor</span><span class="p">([[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">]])</span>

<span class="n">input_x</span> <span class="o">=</span> <span class="n">tensor</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">input_x</span><span class="p">,[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>

<span class="n">input_x</span><span class="o">.</span><span class="n">requires_grad</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">qunatum_model</span> <span class="o">=</span> <span class="n">QModel</span><span class="p">(</span><span class="n">num_wires</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">pyvqnet</span><span class="o">.</span><span class="n">kcomplex64</span><span class="p">)</span>

<span class="n">l</span> <span class="o">=</span> <span class="n">TorchHybirdVQCQpandaQVMLayer</span><span class="p">(</span><span class="n">qunatum_model</span><span class="p">,</span>
                        <span class="s2">&quot;3047DE8A59764BEDAC9C3282093B16AF1&quot;</span><span class="p">,</span>
            <span class="mi">6</span><span class="p">,</span>
            <span class="mi">6</span><span class="p">,</span>
            <span class="n">pauli_str_dict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Z0&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;Y3&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">},</span>
            <span class="n">shots</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">submit_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;test_qcloud_fake&quot;</span><span class="p">:</span><span class="kc">True</span><span class="p">},</span>
            <span class="n">query_kwargs</span><span class="o">=</span><span class="p">{})</span>

<span class="n">y</span> <span class="o">=</span> <span class="n">l</span><span class="p">(</span><span class="n">input_x</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>


<span class="n">y</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">input_x</span><span class="o">.</span><span class="n">grad</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
</section>
<section id="torchhybirdvqcqpanda3qvmlayer">
<h3>TorchHybirdVQCQpanda3QVMLayer<a class="headerlink" href="#torchhybirdvqcqpanda3qvmlayer" title="Link to this heading">¶</a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.qnn.vqc.torch.TorchHybirdVQCQpanda3QVMLayer">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.qnn.vqc.torch.</span></span><span class="sig-name descname"><span class="pre">TorchHybirdVQCQpanda3QVMLayer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">vqc_module</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="nn.html#pyvqnet.nn.pyvqnet.nn.module.Module" title="pyvqnet.nn.pyvqnet.nn.module.Module"><span class="pre">Module</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">qcloud_token</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pauli_str_dict</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">Dict</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Dict</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shots</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">submit_kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">{}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">query_kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">{}</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.qnn.vqc.torch.TorchHybirdVQCQpanda3QVMLayer" title="Link to this definition">¶</a></dt>
<dd><p>使用torch后端,混合 vqc 和 qpanda3 模拟计算。该层将用户 <cite>forward</cite> 函数定义的VQNet编写的量子线路计算转化为QPanda OriginIR,在QPanda3本地虚拟机或者云端服务上进行前向运行,并在基于自动微分计算线路参数梯度,降低了使用参数漂移法计算的时间复杂度。
其中 <code class="docutils literal notranslate"><span class="pre">vqc_module</span></code> 为用户自定义的量子变分线路模型,其中的QMachine设置 <code class="docutils literal notranslate"><span class="pre">save_ir=</span> <span class="pre">True</span></code> 。</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>vqc_module</strong> – 带有 forward() 的 vqc_module。</p></li>
<li><p><strong>qcloud_token</strong> – <cite>str</cite> - 量子机器的类型或用于执行的云令牌。</p></li>
<li><p><strong>pauli_str_dict</strong> – <cite>dict|list</cite> - 表示量子电路中泡利算子的字典或字典列表。默认值为 None。</p></li>
<li><p><strong>shots</strong> – <cite>int</cite> - 量子线路测量次数。默认值为 1000。</p></li>
<li><p><strong>name</strong> – 模块名称。默认值为空字符串。</p></li>
<li><p><strong>submit_kwargs</strong> – 提交量子电路的附加关键字参数,默认值:
{“chip_id”:pyqpanda.real_chip_type.origin_72,
“is_amend”:True,”is_mapping”:True,
“is_optimization”:True,
“default_task_group_size”:200,
“test_qcloud_fake”:True}。</p></li>
<li><p><strong>query_kwargs</strong> – 查询量子结果的附加关键字参数,默认值:{“timeout”:2,”print_query_info”:True,”sub_circuits_split_size”:1}。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>可以计算量子电路的模块。</p>
</dd>
</dl>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>该类继承于 <code class="docutils literal notranslate"><span class="pre">pyvqnet.nn.torch.TorchModule</span></code> 以及 <code class="docutils literal notranslate"><span class="pre">pyvqnet.qnn.HybirdVQCQpandaQVMLayer</span></code> ,可以作为 <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> 的一个子模块加入torch的模型中。</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>pauli_str_dict 不能为 None,并且应与 vqc_module 测量函数中的 obs 相同。
vqc_module 应具有 QMachine 类型的属性,QMachine 应设置 save_ir=True</p>
</div>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet.backends</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.qnn.vqc.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">QMachine</span><span class="p">,</span><span class="n">QModule</span><span class="p">,</span><span class="n">RX</span><span class="p">,</span><span class="n">RY</span><span class="p">,</span>\
<span class="n">RZ</span><span class="p">,</span><span class="n">U1</span><span class="p">,</span><span class="n">U2</span><span class="p">,</span><span class="n">U3</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">S</span><span class="p">,</span><span class="n">X1</span><span class="p">,</span><span class="n">PauliX</span><span class="p">,</span><span class="n">PauliY</span><span class="p">,</span><span class="n">PauliZ</span><span class="p">,</span><span class="n">SWAP</span><span class="p">,</span><span class="n">CZ</span><span class="p">,</span>\
<span class="n">RXX</span><span class="p">,</span><span class="n">RYY</span><span class="p">,</span><span class="n">RZX</span><span class="p">,</span><span class="n">RZZ</span><span class="p">,</span><span class="n">CR</span><span class="p">,</span><span class="n">Toffoli</span><span class="p">,</span><span class="n">Hadamard</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="n">CNOT</span><span class="p">,</span><span class="n">MeasureAll</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.qnn.vqc.torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">HybirdVQCQpanda3QVMLayer</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet</span><span class="w"> </span><span class="kn">import</span> <span class="n">tensor</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet.utils</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">set_random_seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>

<span class="k">class</span><span class="w"> </span><span class="nc">QModel</span><span class="p">(</span><span class="n">QModule</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_wires</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span><span class="n">grad_mode</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">QModel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_num_wires</span> <span class="o">=</span> <span class="n">num_wires</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dtype</span> <span class="o">=</span> <span class="n">dtype</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qm</span> <span class="o">=</span> <span class="n">QMachine</span><span class="p">(</span><span class="n">num_wires</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span><span class="n">grad_mode</span><span class="o">=</span><span class="n">grad_mode</span><span class="p">,</span><span class="n">save_ir</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rx_layer</span> <span class="o">=</span> <span class="n">RX</span><span class="p">(</span><span class="n">has_params</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">trainable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">wires</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ry_layer</span> <span class="o">=</span> <span class="n">RY</span><span class="p">(</span><span class="n">has_params</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">trainable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">wires</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rz_layer</span> <span class="o">=</span> <span class="n">RZ</span><span class="p">(</span><span class="n">has_params</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">trainable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">wires</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">u1</span> <span class="o">=</span> <span class="n">U1</span><span class="p">(</span><span class="n">has_params</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">trainable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">wires</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">u2</span> <span class="o">=</span> <span class="n">U2</span><span class="p">(</span><span class="n">has_params</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">trainable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">wires</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">u3</span> <span class="o">=</span> <span class="n">U3</span><span class="p">(</span><span class="n">has_params</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">trainable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">wires</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="o">=</span> <span class="n">I</span><span class="p">(</span><span class="n">wires</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s</span> <span class="o">=</span> <span class="n">S</span><span class="p">(</span><span class="n">wires</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x1</span> <span class="o">=</span> <span class="n">X1</span><span class="p">(</span><span class="n">wires</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">PauliX</span><span class="p">(</span><span class="n">wires</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">PauliY</span><span class="p">(</span><span class="n">wires</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">PauliZ</span><span class="p">(</span><span class="n">wires</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">swap</span> <span class="o">=</span> <span class="n">SWAP</span><span class="p">(</span><span class="n">wires</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cz</span> <span class="o">=</span> <span class="n">CZ</span><span class="p">(</span><span class="n">wires</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cr</span> <span class="o">=</span> <span class="n">CR</span><span class="p">(</span><span class="n">has_params</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">trainable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">wires</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rxx</span> <span class="o">=</span> <span class="n">RXX</span><span class="p">(</span><span class="n">has_params</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">trainable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">wires</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rzz</span> <span class="o">=</span> <span class="n">RYY</span><span class="p">(</span><span class="n">has_params</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">trainable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">wires</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ryy</span> <span class="o">=</span> <span class="n">RZZ</span><span class="p">(</span><span class="n">has_params</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">trainable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">wires</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rzx</span> <span class="o">=</span> <span class="n">RZX</span><span class="p">(</span><span class="n">has_params</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">trainable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">wires</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">toffoli</span> <span class="o">=</span> <span class="n">Toffoli</span><span class="p">(</span><span class="n">wires</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span><span class="n">use_dagger</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">=</span><span class="n">Hadamard</span><span class="p">(</span><span class="n">wires</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">tlayer</span> <span class="o">=</span> <span class="n">T</span><span class="p">(</span><span class="n">wires</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cnot</span> <span class="o">=</span> <span class="n">CNOT</span><span class="p">(</span><span class="n">wires</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measure</span> <span class="o">=</span> <span class="n">MeasureAll</span><span class="p">(</span><span class="n">obs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Z0&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;Y3&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">}</span>
    <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qm</span><span class="o">.</span><span class="n">reset_states</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">i</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">qm</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">qm</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">swap</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">qm</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cz</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">qm</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">qm</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x1</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">qm</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">qm</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">qm</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ryy</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">qm</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rxx</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">qm</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rzz</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">qm</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rzx</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">qm</span><span class="p">,</span><span class="n">params</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:,[</span><span class="mi">1</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cr</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">qm</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">u1</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">qm</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">u2</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">qm</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">u3</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">qm</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rx_layer</span><span class="p">(</span><span class="n">params</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:,[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">q_machine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">qm</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cnot</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">qm</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">qm</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ry_layer</span><span class="p">(</span><span class="n">params</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:,[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">q_machine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">qm</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tlayer</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">qm</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rz_layer</span><span class="p">(</span><span class="n">params</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:,[</span><span class="mi">2</span><span class="p">]],</span> <span class="n">q_machine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">qm</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">toffoli</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">qm</span><span class="p">)</span>
        <span class="n">rlt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="n">q_machine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">qm</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">rlt</span>


<span class="n">input_x</span> <span class="o">=</span> <span class="n">tensor</span><span class="o">.</span><span class="n">QTensor</span><span class="p">([[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">]])</span>

<span class="n">input_x</span> <span class="o">=</span> <span class="n">tensor</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">input_x</span><span class="p">,[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>

<span class="n">input_x</span><span class="o">.</span><span class="n">requires_grad</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">qunatum_model</span> <span class="o">=</span> <span class="n">QModel</span><span class="p">(</span><span class="n">num_wires</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">pyvqnet</span><span class="o">.</span><span class="n">kcomplex64</span><span class="p">)</span>

<span class="n">l</span> <span class="o">=</span> <span class="n">HybirdVQCQpanda3QVMLayer</span><span class="p">(</span><span class="n">qunatum_model</span><span class="p">,</span>
                        <span class="s2">&quot;3047DE8A59764BEDAC9C3282093B16AF1&quot;</span><span class="p">,</span>

            <span class="n">pauli_str_dict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Z0&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;Y3&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">},</span>
            <span class="n">shots</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">submit_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;test_qcloud_fake&quot;</span><span class="p">:</span><span class="kc">True</span><span class="p">},</span>
            <span class="n">query_kwargs</span><span class="o">=</span><span class="p">{})</span>

<span class="n">y</span> <span class="o">=</span> <span class="n">l</span><span class="p">(</span><span class="n">input_x</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

<span class="n">y</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">input_x</span><span class="o">.</span><span class="n">grad</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
</section>
<section id="id15">
<h2>分布式接口<a class="headerlink" href="#id15" title="Link to this heading">¶</a></h2>
<p>分布式相关功能,当使用 <code class="docutils literal notranslate"><span class="pre">torch</span></code> 计算后端时候,封装使用了torch的 <code class="docutils literal notranslate"><span class="pre">torch.distributed</span></code> 的接口,</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>请参考 &lt;<a class="reference external" href="https://pytorch.org/docs/stable/distributed.html7">https://pytorch.org/docs/stable/distributed.html7</a>&gt;`__ 中启动分布式的方法启动。
当使用CPU上进行分布式,请使用 <code class="docutils literal notranslate"><span class="pre">gloo</span></code> 而不是 <code class="docutils literal notranslate"><span class="pre">mpi</span></code> 。
当使用GPU上进行分布式,请使用 <code class="docutils literal notranslate"><span class="pre">nccl</span></code>。</p>
<p><a class="reference internal" href="nn.html#vqnet-dist"><span class="std std-ref">VQNet原生分布式计算模块</span></a> 下VQNet自己实现的分布式接口不适用 <code class="docutils literal notranslate"><span class="pre">torch</span></code> 计算后端。</p>
</div>
<section id="commcontroller">
<h3>CommController<a class="headerlink" href="#commcontroller" title="Link to this heading">¶</a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="pyvqnet.distributed.ControllComm.CommController">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyvqnet.distributed.ControllComm.</span></span><span class="sig-name descname"><span class="pre">CommController</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">backend</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rank</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">world_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.distributed.ControllComm.CommController" title="Link to this definition">¶</a></dt>
<dd><p>CommController用于控制在cpu、gpu下数据通信的控制器, 通过设置参数 <cite>backend</cite> 来生成cpu(gloo)、gpu(nccl)的控制器。
这个类会调用 backend,rank,world_size 初始化 <code class="docutils literal notranslate"><span class="pre">torch.distributed.init_process_group(backend,rank,world_size)</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>backend</strong> – 用于生成cpu或者gpu的数据通信控制器,’gloo’ 或 ‘nccl’。</p></li>
<li><p><strong>rank</strong> – 当前程序所在的进程号。</p></li>
<li><p><strong>world_size</strong> – 全局所有的进程数量。</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>CommController 实例。</p>
</dd>
</dl>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.distributed</span><span class="w"> </span><span class="kn">import</span> <span class="n">CommController</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">multiprocessing</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mp</span>


<span class="k">def</span><span class="w"> </span><span class="nf">init_process</span><span class="p">(</span><span class="n">rank</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Initialize the distributed environment. &quot;&quot;&quot;</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;MASTER_ADDR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;127.0.0.1&#39;</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;MASTER_PORT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;29500&#39;</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;LOCAL_RANK&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">rank</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">pp</span> <span class="o">=</span> <span class="n">CommController</span><span class="p">(</span><span class="s2">&quot;gloo&quot;</span><span class="p">,</span> <span class="n">rank</span><span class="o">=</span><span class="n">rank</span><span class="p">,</span> <span class="n">world_size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>

    <span class="n">local_rank</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">get_rank</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">local_rank</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">world_size</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">processes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">mp</span><span class="o">.</span><span class="n">set_start_method</span><span class="p">(</span><span class="s2">&quot;spawn&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">rank</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">world_size</span><span class="p">):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">init_process</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">rank</span><span class="p">,</span> <span class="n">world_size</span><span class="p">))</span>
        <span class="n">p</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="n">processes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">processes</span><span class="p">:</span>
        <span class="n">p</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
</pre></div>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="pyvqnet.distributed.ControllComm.CommController.getRank">
<span class="sig-name descname"><span class="pre">getRank</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.distributed.ControllComm.CommController.getRank" title="Link to this definition">¶</a></dt>
<dd><p>用于获得当前进程的进程号。</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>返回当前进程的进程号。</p>
</dd>
</dl>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.distributed</span><span class="w"> </span><span class="kn">import</span> <span class="n">CommController</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">multiprocessing</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mp</span>


<span class="k">def</span><span class="w"> </span><span class="nf">init_process</span><span class="p">(</span><span class="n">rank</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Initialize the distributed environment. &quot;&quot;&quot;</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;MASTER_ADDR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;127.0.0.1&#39;</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;MASTER_PORT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;29500&#39;</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;LOCAL_RANK&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">rank</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">pp</span> <span class="o">=</span> <span class="n">CommController</span><span class="p">(</span><span class="s2">&quot;gloo&quot;</span><span class="p">,</span> <span class="n">rank</span><span class="o">=</span><span class="n">rank</span><span class="p">,</span> <span class="n">world_size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>

    <span class="n">local_rank</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">getRank</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">local_rank</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">world_size</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">processes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">mp</span><span class="o">.</span><span class="n">set_start_method</span><span class="p">(</span><span class="s2">&quot;spawn&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">rank</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">world_size</span><span class="p">):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">init_process</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">rank</span><span class="p">,</span> <span class="n">world_size</span><span class="p">))</span>
        <span class="n">p</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="n">processes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">processes</span><span class="p">:</span>
        <span class="n">p</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyvqnet.distributed.ControllComm.CommController.getSize">
<span class="sig-name descname"><span class="pre">getSize</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.distributed.ControllComm.CommController.getSize" title="Link to this definition">¶</a></dt>
<dd><p>用于获得总共启动的进程数。</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>返回总共进程的数量。</p>
</dd>
</dl>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>            <span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.distributed</span><span class="w"> </span><span class="kn">import</span> <span class="n">CommController</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">multiprocessing</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mp</span>


<span class="k">def</span><span class="w"> </span><span class="nf">init_process</span><span class="p">(</span><span class="n">rank</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Initialize the distributed environment. &quot;&quot;&quot;</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;MASTER_ADDR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;127.0.0.1&#39;</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;MASTER_PORT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;29500&#39;</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;LOCAL_RANK&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">rank</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">pp</span> <span class="o">=</span> <span class="n">CommController</span><span class="p">(</span><span class="s2">&quot;gloo&quot;</span><span class="p">,</span> <span class="n">rank</span><span class="o">=</span><span class="n">rank</span><span class="p">,</span> <span class="n">world_size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>

    <span class="n">local_rank</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">getSize</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">local_rank</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">world_size</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">processes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">mp</span><span class="o">.</span><span class="n">set_start_method</span><span class="p">(</span><span class="s2">&quot;spawn&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">rank</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">world_size</span><span class="p">):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">init_process</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">rank</span><span class="p">,</span> <span class="n">world_size</span><span class="p">))</span>
        <span class="n">p</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="n">processes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">processes</span><span class="p">:</span>
        <span class="n">p</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyvqnet.distributed.ControllComm.CommController.getLocalRank">
<span class="sig-name descname"><span class="pre">getLocalRank</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.distributed.ControllComm.CommController.getLocalRank" title="Link to this definition">¶</a></dt>
<dd><p>在每个进程中通过 <code class="docutils literal notranslate"><span class="pre">os.environ['LOCAL_RANK']</span> <span class="pre">=</span> <span class="pre">rank</span></code> 获取每个机器的局部进程号。
需要事先对环境变量 <cite>LOCAL_RANK</cite> 进行设置。</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>当前机器上的当前进程号。</p>
</dd>
</dl>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.distributed</span><span class="w"> </span><span class="kn">import</span> <span class="n">CommController</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">multiprocessing</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mp</span>


<span class="k">def</span><span class="w"> </span><span class="nf">init_process</span><span class="p">(</span><span class="n">rank</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Initialize the distributed environment. &quot;&quot;&quot;</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;MASTER_ADDR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;127.0.0.1&#39;</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;MASTER_PORT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;29500&#39;</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;LOCAL_RANK&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">rank</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">pp</span> <span class="o">=</span> <span class="n">CommController</span><span class="p">(</span><span class="s2">&quot;gloo&quot;</span><span class="p">,</span> <span class="n">rank</span><span class="o">=</span><span class="n">rank</span><span class="p">,</span> <span class="n">world_size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>

    <span class="n">local_rank</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">getLocalRank</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">local_rank</span> <span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">world_size</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">processes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">mp</span><span class="o">.</span><span class="n">set_start_method</span><span class="p">(</span><span class="s2">&quot;spawn&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">rank</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">world_size</span><span class="p">):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">init_process</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">rank</span><span class="p">,</span> <span class="n">world_size</span><span class="p">))</span>
        <span class="n">p</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="n">processes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">processes</span><span class="p">:</span>
        <span class="n">p</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyvqnet.distributed.ControllComm.CommController.split_group">
<span class="sig-name descname"><span class="pre">split_group</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">rankL</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.distributed.ControllComm.CommController.split_group" title="Link to this definition">¶</a></dt>
<dd><p>根据入参设置的进程号列表用于划分多个通信组。</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>rankL</strong> – 进程组列表。</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>包含 <code class="docutils literal notranslate"><span class="pre">torch.distributed.ProcessGroup</span></code> 的列表</p>
</dd>
</dl>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.distributed</span><span class="w"> </span><span class="kn">import</span> <span class="n">CommController</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">multiprocessing</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mp</span>


<span class="k">def</span><span class="w"> </span><span class="nf">init_process</span><span class="p">(</span><span class="n">rank</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Initialize the distributed environment. &quot;&quot;&quot;</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;MASTER_ADDR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;127.0.0.1&#39;</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;MASTER_PORT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;29500&#39;</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;LOCAL_RANK&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">rank</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">pp</span> <span class="o">=</span> <span class="n">CommController</span><span class="p">(</span><span class="s2">&quot;gloo&quot;</span><span class="p">,</span> <span class="n">rank</span><span class="o">=</span><span class="n">rank</span><span class="p">,</span> <span class="n">world_size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>

    <span class="n">local_rank</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">split_group</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]])</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">local_rank</span> <span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">world_size</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">processes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">mp</span><span class="o">.</span><span class="n">set_start_method</span><span class="p">(</span><span class="s2">&quot;spawn&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">rank</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">world_size</span><span class="p">):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">init_process</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">rank</span><span class="p">,</span> <span class="n">world_size</span><span class="p">))</span>
        <span class="n">p</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="n">processes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">processes</span><span class="p">:</span>
        <span class="n">p</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyvqnet.distributed.ControllComm.CommController.barrier">
<span class="sig-name descname"><span class="pre">barrier</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.distributed.ControllComm.CommController.barrier" title="Link to this definition">¶</a></dt>
<dd><p>不同进程的同步。</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>同步操作。</p>
</dd>
</dl>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.distributed</span><span class="w"> </span><span class="kn">import</span> <span class="n">CommController</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">multiprocessing</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mp</span>


<span class="k">def</span><span class="w"> </span><span class="nf">init_process</span><span class="p">(</span><span class="n">rank</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Initialize the distributed environment. &quot;&quot;&quot;</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;MASTER_ADDR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;127.0.0.1&#39;</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;MASTER_PORT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;29500&#39;</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;LOCAL_RANK&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">rank</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">pp</span> <span class="o">=</span> <span class="n">CommController</span><span class="p">(</span><span class="s2">&quot;gloo&quot;</span><span class="p">,</span> <span class="n">rank</span><span class="o">=</span><span class="n">rank</span><span class="p">,</span> <span class="n">world_size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>

    <span class="n">pp</span><span class="o">.</span><span class="n">barrier</span><span class="p">()</span>



<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">world_size</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">processes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">mp</span><span class="o">.</span><span class="n">set_start_method</span><span class="p">(</span><span class="s2">&quot;spawn&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">rank</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">world_size</span><span class="p">):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">init_process</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">rank</span><span class="p">,</span> <span class="n">world_size</span><span class="p">))</span>
        <span class="n">p</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="n">processes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">processes</span><span class="p">:</span>
        <span class="n">p</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyvqnet.distributed.ControllComm.CommController.allreduce">
<span class="sig-name descname"><span class="pre">allreduce</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tensor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">c_op</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'avg'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.distributed.ControllComm.CommController.allreduce" title="Link to this definition">¶</a></dt>
<dd><p>支持对数据作allreduce通信。</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tensor</strong> – 输入数据.</p></li>
<li><p><strong>c_op</strong> – 计算方式.</p></li>
</ul>
</dd>
</dl>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.distributed</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_local_rank</span><span class="p">,</span><span class="n">CommController</span><span class="p">,</span><span class="n">init_group</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.tensor</span><span class="w"> </span><span class="kn">import</span> <span class="n">tensor</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">multiprocessing</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mp</span>


<span class="k">def</span><span class="w"> </span><span class="nf">init_process</span><span class="p">(</span><span class="n">rank</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Initialize the distributed environment. &quot;&quot;&quot;</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;MASTER_ADDR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;127.0.0.1&#39;</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;MASTER_PORT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;29500&#39;</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;LOCAL_RANK&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">rank</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">Comm_OP</span> <span class="o">=</span> <span class="n">CommController</span><span class="p">(</span><span class="s2">&quot;gloo&quot;</span><span class="p">,</span> <span class="n">rank</span><span class="o">=</span><span class="n">rank</span><span class="p">,</span> <span class="n">world_size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>



    <span class="n">num</span> <span class="o">=</span> <span class="n">tensor</span><span class="o">.</span><span class="n">to_tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;rank </span><span class="si">{</span><span class="n">Comm_OP</span><span class="o">.</span><span class="n">getRank</span><span class="p">()</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">num</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">Comm_OP</span><span class="o">.</span><span class="n">all_reduce</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="s2">&quot;sum&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;rank </span><span class="si">{</span><span class="n">Comm_OP</span><span class="o">.</span><span class="n">getRank</span><span class="p">()</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">num</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">world_size</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">processes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">mp</span><span class="o">.</span><span class="n">set_start_method</span><span class="p">(</span><span class="s2">&quot;spawn&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">rank</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">world_size</span><span class="p">):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">init_process</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">rank</span><span class="p">,</span> <span class="n">world_size</span><span class="p">))</span>
        <span class="n">p</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="n">processes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">processes</span><span class="p">:</span>
        <span class="n">p</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyvqnet.distributed.ControllComm.CommController.reduce">
<span class="sig-name descname"><span class="pre">reduce</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tensor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">root</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">c_op</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'avg'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.distributed.ControllComm.CommController.reduce" title="Link to this definition">¶</a></dt>
<dd><p>支持对数据作reduce通信。</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tensor</strong> – 输入数据。</p></li>
<li><p><strong>root</strong> – 指定数据返回的节点。</p></li>
<li><p><strong>c_op</strong> – 计算方式。</p></li>
</ul>
</dd>
</dl>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.distributed</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_local_rank</span><span class="p">,</span><span class="n">CommController</span><span class="p">,</span><span class="n">init_group</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.tensor</span><span class="w"> </span><span class="kn">import</span> <span class="n">tensor</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">multiprocessing</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mp</span>


<span class="k">def</span><span class="w"> </span><span class="nf">init_process</span><span class="p">(</span><span class="n">rank</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Initialize the distributed environment. &quot;&quot;&quot;</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;MASTER_ADDR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;127.0.0.1&#39;</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;MASTER_PORT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;29500&#39;</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;LOCAL_RANK&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">rank</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">Comm_OP</span> <span class="o">=</span> <span class="n">CommController</span><span class="p">(</span><span class="s2">&quot;gloo&quot;</span><span class="p">,</span> <span class="n">rank</span><span class="o">=</span><span class="n">rank</span><span class="p">,</span> <span class="n">world_size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>



    <span class="n">num</span> <span class="o">=</span> <span class="n">tensor</span><span class="o">.</span><span class="n">to_tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;before rank </span><span class="si">{</span><span class="n">Comm_OP</span><span class="o">.</span><span class="n">getRank</span><span class="p">()</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">num</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">Comm_OP</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span><span class="s2">&quot;sum&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;after rank </span><span class="si">{</span><span class="n">Comm_OP</span><span class="o">.</span><span class="n">getRank</span><span class="p">()</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">num</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">world_size</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">processes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">mp</span><span class="o">.</span><span class="n">set_start_method</span><span class="p">(</span><span class="s2">&quot;spawn&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">rank</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">world_size</span><span class="p">):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">init_process</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">rank</span><span class="p">,</span> <span class="n">world_size</span><span class="p">))</span>
        <span class="n">p</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="n">processes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">processes</span><span class="p">:</span>
        <span class="n">p</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyvqnet.distributed.ControllComm.CommController.broadcast">
<span class="sig-name descname"><span class="pre">broadcast</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tensor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">root</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.distributed.ControllComm.CommController.broadcast" title="Link to this definition">¶</a></dt>
<dd><p>将指定进程root上的数据广播到所有进程上。</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tensor</strong> – 输入数据。</p></li>
<li><p><strong>root</strong> – 指定的节点。</p></li>
</ul>
</dd>
</dl>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.distributed</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_local_rank</span><span class="p">,</span><span class="n">CommController</span><span class="p">,</span><span class="n">init_group</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.tensor</span><span class="w"> </span><span class="kn">import</span> <span class="n">tensor</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">multiprocessing</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mp</span>


<span class="k">def</span><span class="w"> </span><span class="nf">init_process</span><span class="p">(</span><span class="n">rank</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Initialize the distributed environment. &quot;&quot;&quot;</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;MASTER_ADDR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;127.0.0.1&#39;</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;MASTER_PORT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;29500&#39;</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;LOCAL_RANK&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">rank</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">Comm_OP</span> <span class="o">=</span> <span class="n">CommController</span><span class="p">(</span><span class="s2">&quot;gloo&quot;</span><span class="p">,</span> <span class="n">rank</span><span class="o">=</span><span class="n">rank</span><span class="p">,</span> <span class="n">world_size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>



    <span class="n">num</span> <span class="o">=</span> <span class="n">tensor</span><span class="o">.</span><span class="n">to_tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span><span class="o">+</span> <span class="n">rank</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;before rank </span><span class="si">{</span><span class="n">Comm_OP</span><span class="o">.</span><span class="n">getRank</span><span class="p">()</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">num</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">Comm_OP</span><span class="o">.</span><span class="n">broadcast</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;after rank </span><span class="si">{</span><span class="n">Comm_OP</span><span class="o">.</span><span class="n">getRank</span><span class="p">()</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">num</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">world_size</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">processes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">mp</span><span class="o">.</span><span class="n">set_start_method</span><span class="p">(</span><span class="s2">&quot;spawn&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">rank</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">world_size</span><span class="p">):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">init_process</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">rank</span><span class="p">,</span> <span class="n">world_size</span><span class="p">))</span>
        <span class="n">p</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="n">processes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">processes</span><span class="p">:</span>
        <span class="n">p</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyvqnet.distributed.ControllComm.CommController.allgather">
<span class="sig-name descname"><span class="pre">allgather</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tensor</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.distributed.ControllComm.CommController.allgather" title="Link to this definition">¶</a></dt>
<dd><p>将所有进程上数据allgather到一起。本接口只支持nccl后端。</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>tensor</strong> – 输入数据。</p>
</dd>
</dl>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.distributed</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_local_rank</span><span class="p">,</span><span class="n">CommController</span><span class="p">,</span><span class="n">get_world_size</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.tensor</span><span class="w"> </span><span class="kn">import</span> <span class="n">tensor</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">multiprocessing</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mp</span>


<span class="k">def</span><span class="w"> </span><span class="nf">init_process</span><span class="p">(</span><span class="n">rank</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Initialize the distributed environment. &quot;&quot;&quot;</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;MASTER_ADDR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;127.0.0.1&#39;</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;MASTER_PORT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;29500&#39;</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;LOCAL_RANK&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">rank</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">Comm_OP</span> <span class="o">=</span> <span class="n">CommController</span><span class="p">(</span><span class="s2">&quot;nccl&quot;</span><span class="p">,</span> <span class="n">rank</span><span class="o">=</span><span class="n">rank</span><span class="p">,</span> <span class="n">world_size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>

    <span class="n">num</span> <span class="o">=</span> <span class="n">tensor</span><span class="o">.</span><span class="n">QTensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span><span class="n">device</span><span class="o">=</span><span class="n">pyvqnet</span><span class="o">.</span><span class="n">DEV_GPU_0</span><span class="o">+</span><span class="n">rank</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;before rank </span><span class="si">{</span><span class="n">Comm_OP</span><span class="o">.</span><span class="n">getRank</span><span class="p">()</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">num</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">num</span> <span class="o">=</span> <span class="n">Comm_OP</span><span class="o">.</span><span class="n">all_gather</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;after rank </span><span class="si">{</span><span class="n">Comm_OP</span><span class="o">.</span><span class="n">getRank</span><span class="p">()</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">num</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">world_size</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">processes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">mp</span><span class="o">.</span><span class="n">set_start_method</span><span class="p">(</span><span class="s2">&quot;spawn&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">rank</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">world_size</span><span class="p">):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">init_process</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">rank</span><span class="p">,</span> <span class="n">world_size</span><span class="p">))</span>
        <span class="n">p</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="n">processes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">processes</span><span class="p">:</span>
        <span class="n">p</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyvqnet.distributed.ControllComm.CommController.send">
<span class="sig-name descname"><span class="pre">send</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tensor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dest</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.distributed.ControllComm.CommController.send" title="Link to this definition">¶</a></dt>
<dd><p>p2p通信接口。</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tensor</strong> – 输入数据.</p></li>
<li><p><strong>dest</strong> – 目的进程.</p></li>
</ul>
</dd>
</dl>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.distributed</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_rank</span><span class="p">,</span><span class="n">CommController</span><span class="p">,</span><span class="n">get_world_size</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.tensor</span><span class="w"> </span><span class="kn">import</span> <span class="n">tensor</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">multiprocessing</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mp</span>


<span class="k">def</span><span class="w"> </span><span class="nf">init_process</span><span class="p">(</span><span class="n">rank</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Initialize the distributed environment. &quot;&quot;&quot;</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;MASTER_ADDR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;127.0.0.1&#39;</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;MASTER_PORT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;29500&#39;</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;LOCAL_RANK&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">rank</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">Comm_OP</span> <span class="o">=</span> <span class="n">CommController</span><span class="p">(</span><span class="s2">&quot;gloo&quot;</span><span class="p">,</span> <span class="n">rank</span><span class="o">=</span><span class="n">rank</span><span class="p">,</span> <span class="n">world_size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>

    <span class="n">num</span> <span class="o">=</span> <span class="n">tensor</span><span class="o">.</span><span class="n">to_tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="n">recv</span> <span class="o">=</span> <span class="n">tensor</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">get_rank</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">Comm_OP</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">get_rank</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">Comm_OP</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="n">recv</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;before rank </span><span class="si">{</span><span class="n">Comm_OP</span><span class="o">.</span><span class="n">getRank</span><span class="p">()</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">num</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;after rank </span><span class="si">{</span><span class="n">Comm_OP</span><span class="o">.</span><span class="n">getRank</span><span class="p">()</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">recv</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">world_size</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">processes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">mp</span><span class="o">.</span><span class="n">set_start_method</span><span class="p">(</span><span class="s2">&quot;spawn&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">rank</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">world_size</span><span class="p">):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">init_process</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">rank</span><span class="p">,</span> <span class="n">world_size</span><span class="p">))</span>
        <span class="n">p</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="n">processes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">processes</span><span class="p">:</span>
        <span class="n">p</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyvqnet.distributed.ControllComm.CommController.recv">
<span class="sig-name descname"><span class="pre">recv</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tensor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">source</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.distributed.ControllComm.CommController.recv" title="Link to this definition">¶</a></dt>
<dd><p>p2p通信接口。</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tensor</strong> – 输入数据.</p></li>
<li><p><strong>source</strong> – 接受进程.</p></li>
</ul>
</dd>
</dl>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.distributed</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_rank</span><span class="p">,</span><span class="n">CommController</span><span class="p">,</span><span class="n">get_world_size</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.tensor</span><span class="w"> </span><span class="kn">import</span> <span class="n">tensor</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">multiprocessing</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mp</span>


<span class="k">def</span><span class="w"> </span><span class="nf">init_process</span><span class="p">(</span><span class="n">rank</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Initialize the distributed environment. &quot;&quot;&quot;</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;MASTER_ADDR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;127.0.0.1&#39;</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;MASTER_PORT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;29500&#39;</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;LOCAL_RANK&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">rank</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">Comm_OP</span> <span class="o">=</span> <span class="n">CommController</span><span class="p">(</span><span class="s2">&quot;gloo&quot;</span><span class="p">,</span> <span class="n">rank</span><span class="o">=</span><span class="n">rank</span><span class="p">,</span> <span class="n">world_size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>

    <span class="n">num</span> <span class="o">=</span> <span class="n">tensor</span><span class="o">.</span><span class="n">to_tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="n">recv</span> <span class="o">=</span> <span class="n">tensor</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">get_rank</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">Comm_OP</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">get_rank</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">Comm_OP</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="n">recv</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;before rank </span><span class="si">{</span><span class="n">Comm_OP</span><span class="o">.</span><span class="n">getRank</span><span class="p">()</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">num</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;after rank </span><span class="si">{</span><span class="n">Comm_OP</span><span class="o">.</span><span class="n">getRank</span><span class="p">()</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">recv</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">world_size</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">processes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">mp</span><span class="o">.</span><span class="n">set_start_method</span><span class="p">(</span><span class="s2">&quot;spawn&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">rank</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">world_size</span><span class="p">):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">init_process</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">rank</span><span class="p">,</span> <span class="n">world_size</span><span class="p">))</span>
        <span class="n">p</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="n">processes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">processes</span><span class="p">:</span>
        <span class="n">p</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyvqnet.distributed.ControllComm.CommController.allreduce_group">
<span class="sig-name descname"><span class="pre">allreduce_group</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tensor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">c_op</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'avg'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">GroupComm</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.distributed.ControllComm.CommController.allreduce_group" title="Link to this definition">¶</a></dt>
<dd><p>组内allreduce通信接口。</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tensor</strong> – 输入数据.</p></li>
<li><p><strong>c_op</strong> – 计算方法.</p></li>
<li><p><strong>GroupComm</strong> – 通信组, 仅mpi进行组内通信时需要.</p></li>
</ul>
</dd>
</dl>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.distributed</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_local_rank</span><span class="p">,</span><span class="n">CommController</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.tensor</span><span class="w"> </span><span class="kn">import</span> <span class="n">tensor</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">multiprocessing</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mp</span>


<span class="k">def</span><span class="w"> </span><span class="nf">init_process</span><span class="p">(</span><span class="n">rank</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Initialize the distributed environment. &quot;&quot;&quot;</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;MASTER_ADDR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;127.0.0.1&#39;</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;MASTER_PORT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;29500&#39;</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;LOCAL_RANK&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">rank</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">Comm_OP</span> <span class="o">=</span> <span class="n">CommController</span><span class="p">(</span><span class="s2">&quot;gloo&quot;</span><span class="p">,</span> <span class="n">rank</span><span class="o">=</span><span class="n">rank</span><span class="p">,</span> <span class="n">world_size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>


    <span class="n">groups</span> <span class="o">=</span> <span class="n">Comm_OP</span><span class="o">.</span><span class="n">split_group</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">]])</span>
    <span class="n">num</span> <span class="o">=</span> <span class="n">tensor</span><span class="o">.</span><span class="n">to_tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span><span class="o">+</span><span class="n">get_local_rank</span><span class="p">()</span><span class="o">*</span><span class="mi">1000</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;rank </span><span class="si">{</span><span class="n">Comm_OP</span><span class="o">.</span><span class="n">getRank</span><span class="p">()</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">num</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">Comm_OP</span><span class="o">.</span><span class="n">all_reduce_group</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="s2">&quot;sum&quot;</span><span class="p">,</span><span class="n">groups</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;rank </span><span class="si">{</span><span class="n">Comm_OP</span><span class="o">.</span><span class="n">getRank</span><span class="p">()</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">num</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">num</span> <span class="o">=</span> <span class="n">tensor</span><span class="o">.</span><span class="n">to_tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span><span class="o">-</span><span class="n">get_local_rank</span><span class="p">()</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;rank </span><span class="si">{</span><span class="n">Comm_OP</span><span class="o">.</span><span class="n">getRank</span><span class="p">()</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">num</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">Comm_OP</span><span class="o">.</span><span class="n">all_reduce_group</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="s2">&quot;sum&quot;</span><span class="p">,</span><span class="n">groups</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;rank </span><span class="si">{</span><span class="n">Comm_OP</span><span class="o">.</span><span class="n">getRank</span><span class="p">()</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">num</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">world_size</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">mp</span><span class="o">.</span><span class="n">set_start_method</span><span class="p">(</span><span class="s2">&quot;spawn&quot;</span><span class="p">)</span>
    <span class="n">processes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">rank</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">world_size</span><span class="p">):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">init_process</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">rank</span><span class="p">,</span> <span class="n">world_size</span><span class="p">))</span>
        <span class="n">p</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="n">processes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">processes</span><span class="p">:</span>
        <span class="n">p</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyvqnet.distributed.ControllComm.CommController.reduce_group">
<span class="sig-name descname"><span class="pre">reduce_group</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tensor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">root</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">c_op</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'avg'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">GroupComm</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.distributed.ControllComm.CommController.reduce_group" title="Link to this definition">¶</a></dt>
<dd><p>组内reduce通信接口。</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tensor</strong> – 输入数据.</p></li>
<li><p><strong>root</strong> – 指定进程号.</p></li>
<li><p><strong>c_op</strong> – 计算方法.</p></li>
<li><p><strong>GroupComm</strong> – 通信组, 仅mpi进行组内通信时需要.</p></li>
</ul>
</dd>
</dl>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.distributed</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_local_rank</span><span class="p">,</span><span class="n">CommController</span><span class="p">,</span><span class="n">init_group</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.tensor</span><span class="w"> </span><span class="kn">import</span> <span class="n">tensor</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">multiprocessing</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mp</span>


<span class="k">def</span><span class="w"> </span><span class="nf">init_process</span><span class="p">(</span><span class="n">rank</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Initialize the distributed environment. &quot;&quot;&quot;</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;MASTER_ADDR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;127.0.0.1&#39;</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;MASTER_PORT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;29500&#39;</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;LOCAL_RANK&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">rank</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">Comm_OP</span> <span class="o">=</span> <span class="n">CommController</span><span class="p">(</span><span class="s2">&quot;gloo&quot;</span><span class="p">,</span> <span class="n">rank</span><span class="o">=</span><span class="n">rank</span><span class="p">,</span> <span class="n">world_size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>

    <span class="n">group</span> <span class="o">=</span> <span class="n">Comm_OP</span><span class="o">.</span><span class="n">split_group</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>

    <span class="n">num</span> <span class="o">=</span> <span class="n">tensor</span><span class="o">.</span><span class="n">to_tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span><span class="o">+</span><span class="n">get_local_rank</span><span class="p">()</span><span class="o">*</span><span class="mi">10</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;before rank </span><span class="si">{</span><span class="n">Comm_OP</span><span class="o">.</span><span class="n">getRank</span><span class="p">()</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">num</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">Comm_OP</span><span class="o">.</span><span class="n">reduce_group</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span><span class="s2">&quot;sum&quot;</span><span class="p">,</span><span class="n">group</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;after rank </span><span class="si">{</span><span class="n">Comm_OP</span><span class="o">.</span><span class="n">getRank</span><span class="p">()</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">num</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">world_size</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">processes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">mp</span><span class="o">.</span><span class="n">set_start_method</span><span class="p">(</span><span class="s2">&quot;spawn&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">rank</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">world_size</span><span class="p">):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">init_process</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">rank</span><span class="p">,</span> <span class="n">world_size</span><span class="p">))</span>
        <span class="n">p</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="n">processes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">processes</span><span class="p">:</span>
        <span class="n">p</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyvqnet.distributed.ControllComm.CommController.broadcast_group">
<span class="sig-name descname"><span class="pre">broadcast_group</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tensor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">root</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">GroupComm</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.distributed.ControllComm.CommController.broadcast_group" title="Link to this definition">¶</a></dt>
<dd><p>组内broadcast通信接口。</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tensor</strong> – 输入数据.</p></li>
<li><p><strong>root</strong> – 指定进程号.</p></li>
<li><p><strong>GroupComm</strong> – 通信组, 仅mpi进行组内通信时需要.</p></li>
</ul>
</dd>
</dl>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.distributed</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_local_rank</span><span class="p">,</span><span class="n">CommController</span><span class="p">,</span><span class="n">init_group</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.tensor</span><span class="w"> </span><span class="kn">import</span> <span class="n">tensor</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">multiprocessing</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mp</span>


<span class="k">def</span><span class="w"> </span><span class="nf">init_process</span><span class="p">(</span><span class="n">rank</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Initialize the distributed environment. &quot;&quot;&quot;</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;MASTER_ADDR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;127.0.0.1&#39;</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;MASTER_PORT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;29500&#39;</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;LOCAL_RANK&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">rank</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">Comm_OP</span> <span class="o">=</span> <span class="n">CommController</span><span class="p">(</span><span class="s2">&quot;gloo&quot;</span><span class="p">,</span> <span class="n">rank</span><span class="o">=</span><span class="n">rank</span><span class="p">,</span> <span class="n">world_size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>

    <span class="n">group</span> <span class="o">=</span> <span class="n">Comm_OP</span><span class="o">.</span><span class="n">split_group</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>

    <span class="n">num</span> <span class="o">=</span> <span class="n">tensor</span><span class="o">.</span><span class="n">to_tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span><span class="o">+</span> <span class="n">rank</span><span class="o">*</span><span class="mi">1000</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;before rank </span><span class="si">{</span><span class="n">Comm_OP</span><span class="o">.</span><span class="n">getRank</span><span class="p">()</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">num</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">Comm_OP</span><span class="o">.</span><span class="n">broadcast_group</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span><span class="n">group</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;after rank </span><span class="si">{</span><span class="n">Comm_OP</span><span class="o">.</span><span class="n">getRank</span><span class="p">()</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">num</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">world_size</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="n">processes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">mp</span><span class="o">.</span><span class="n">set_start_method</span><span class="p">(</span><span class="s2">&quot;spawn&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">rank</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">world_size</span><span class="p">):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">init_process</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">rank</span><span class="p">,</span> <span class="n">world_size</span><span class="p">))</span>
        <span class="n">p</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="n">processes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">processes</span><span class="p">:</span>
        <span class="n">p</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyvqnet.distributed.ControllComm.CommController.allgather_group">
<span class="sig-name descname"><span class="pre">allgather_group</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tensor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">GroupComm</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyvqnet.distributed.ControllComm.CommController.allgather_group" title="Link to this definition">¶</a></dt>
<dd><p>组内allgather通信接口。</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tensor</strong> – 输入数据.</p></li>
<li><p><strong>GroupComm</strong> – 通信组, 仅mpi进行组内通信时需要.</p></li>
</ul>
</dd>
</dl>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.distributed</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_local_rank</span><span class="p">,</span><span class="n">CommController</span><span class="p">,</span><span class="n">get_world_size</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvqnet</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvqnet.tensor</span><span class="w"> </span><span class="kn">import</span> <span class="n">tensor</span>
<span class="n">pyvqnet</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">)</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">multiprocessing</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mp</span>


<span class="k">def</span><span class="w"> </span><span class="nf">init_process</span><span class="p">(</span><span class="n">rank</span><span class="p">,</span> <span class="n">size</span> <span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Initialize the distributed environment. &quot;&quot;&quot;</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;MASTER_ADDR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;127.0.0.1&#39;</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;MASTER_PORT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;29500&#39;</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;LOCAL_RANK&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">rank</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">Comm_OP</span> <span class="o">=</span> <span class="n">CommController</span><span class="p">(</span><span class="s2">&quot;gloo&quot;</span><span class="p">,</span> <span class="n">rank</span><span class="o">=</span><span class="n">rank</span><span class="p">,</span> <span class="n">world_size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>

    <span class="n">group</span> <span class="o">=</span> <span class="n">Comm_OP</span><span class="o">.</span><span class="n">split_group</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;get_world_size </span><span class="si">{</span><span class="n">get_world_size</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">num</span> <span class="o">=</span> <span class="n">tensor</span><span class="o">.</span><span class="n">QTensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="o">+</span><span class="n">get_local_rank</span><span class="p">()</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;before rank </span><span class="si">{</span><span class="n">Comm_OP</span><span class="o">.</span><span class="n">getRank</span><span class="p">()</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">num</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">num</span> <span class="o">=</span> <span class="n">Comm_OP</span><span class="o">.</span><span class="n">all_gather_group</span><span class="p">(</span><span class="n">num</span><span class="p">,</span><span class="n">group</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;after rank </span><span class="si">{</span><span class="n">Comm_OP</span><span class="o">.</span><span class="n">getRank</span><span class="p">()</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">num</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>


    <span class="n">num</span> <span class="o">=</span> <span class="n">tensor</span><span class="o">.</span><span class="n">QTensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">+</span><span class="n">get_local_rank</span><span class="p">()</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;before rank </span><span class="si">{</span><span class="n">Comm_OP</span><span class="o">.</span><span class="n">getRank</span><span class="p">()</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">num</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">num</span> <span class="o">=</span> <span class="n">Comm_OP</span><span class="o">.</span><span class="n">all_gather_group</span><span class="p">(</span><span class="n">num</span><span class="p">,</span><span class="n">group</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;after rank </span><span class="si">{</span><span class="n">Comm_OP</span><span class="o">.</span><span class="n">getRank</span><span class="p">()</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">num</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">num</span> <span class="o">=</span> <span class="n">tensor</span><span class="o">.</span><span class="n">QTensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="o">+</span><span class="n">get_local_rank</span><span class="p">()</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;before rank </span><span class="si">{</span><span class="n">Comm_OP</span><span class="o">.</span><span class="n">getRank</span><span class="p">()</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">num</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">num</span> <span class="o">=</span> <span class="n">Comm_OP</span><span class="o">.</span><span class="n">all_gather_group</span><span class="p">(</span><span class="n">num</span><span class="p">,</span><span class="n">group</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;after rank </span><span class="si">{</span><span class="n">Comm_OP</span><span class="o">.</span><span class="n">getRank</span><span class="p">()</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">num</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">world_size</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">processes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">mp</span><span class="o">.</span><span class="n">set_start_method</span><span class="p">(</span><span class="s2">&quot;spawn&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">rank</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">world_size</span><span class="p">):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">init_process</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">rank</span><span class="p">,</span> <span class="n">world_size</span> <span class="p">))</span>
        <span class="n">p</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="n">processes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">processes</span><span class="p">:</span>
        <span class="n">p</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="llm.html" class="btn btn-neutral float-left" title="量子大模型微调示例" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="FAQ.html" class="btn btn-neutral float-right" title="常见问题" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Original Quantum.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>